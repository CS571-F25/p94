(function(){const Y=document.createElement("link").relList;if(Y&&Y.supports&&Y.supports("modulepreload"))return;for(const lt of document.querySelectorAll('link[rel="modulepreload"]'))q(lt);new MutationObserver(lt=>{for(const yt of lt)if(yt.type==="childList")for(const P of yt.addedNodes)P.tagName==="LINK"&&P.rel==="modulepreload"&&q(P)}).observe(document,{childList:!0,subtree:!0});function nt(lt){const yt={};return lt.integrity&&(yt.integrity=lt.integrity),lt.referrerPolicy&&(yt.referrerPolicy=lt.referrerPolicy),lt.crossOrigin==="use-credentials"?yt.credentials="include":lt.crossOrigin==="anonymous"?yt.credentials="omit":yt.credentials="same-origin",yt}function q(lt){if(lt.ep)return;lt.ep=!0;const yt=nt(lt);fetch(lt.href,yt)}})();function X_(B){return B&&B.__esModule&&Object.prototype.hasOwnProperty.call(B,"default")?B.default:B}var Tg={exports:{}},Hp={};var t_;function Y_(){if(t_)return Hp;t_=1;var B=Symbol.for("react.transitional.element"),Y=Symbol.for("react.fragment");function nt(q,lt,yt){var P=null;if(yt!==void 0&&(P=""+yt),lt.key!==void 0&&(P=""+lt.key),"key"in lt){yt={};for(var h in lt)h!=="key"&&(yt[h]=lt[h])}else yt=lt;return lt=yt.ref,{$$typeof:B,type:q,key:P,ref:lt!==void 0?lt:null,props:yt}}return Hp.Fragment=Y,Hp.jsx=nt,Hp.jsxs=nt,Hp}var e_;function W_(){return e_||(e_=1,Tg.exports=Y_()),Tg.exports}var U=W_(),Sg={exports:{}},ri={};var i_;function K_(){if(i_)return ri;i_=1;var B=Symbol.for("react.transitional.element"),Y=Symbol.for("react.portal"),nt=Symbol.for("react.fragment"),q=Symbol.for("react.strict_mode"),lt=Symbol.for("react.profiler"),yt=Symbol.for("react.consumer"),P=Symbol.for("react.context"),h=Symbol.for("react.forward_ref"),et=Symbol.for("react.suspense"),ft=Symbol.for("react.memo"),Bt=Symbol.for("react.lazy"),Dt=Symbol.for("react.activity"),se=Symbol.iterator;function he(bt){return bt===null||typeof bt!="object"?null:(bt=se&&bt[se]||bt["@@iterator"],typeof bt=="function"?bt:null)}var xe={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Kt=Object.assign,gt={};function Yt(bt,Ht,_e){this.props=bt,this.context=Ht,this.refs=gt,this.updater=_e||xe}Yt.prototype.isReactComponent={},Yt.prototype.setState=function(bt,Ht){if(typeof bt!="object"&&typeof bt!="function"&&bt!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,bt,Ht,"setState")},Yt.prototype.forceUpdate=function(bt){this.updater.enqueueForceUpdate(this,bt,"forceUpdate")};function Pt(){}Pt.prototype=Yt.prototype;function At(bt,Ht,_e){this.props=bt,this.context=Ht,this.refs=gt,this.updater=_e||xe}var ce=At.prototype=new Pt;ce.constructor=At,Kt(ce,Yt.prototype),ce.isPureReactComponent=!0;var ue=Array.isArray;function we(){}var pe={H:null,A:null,T:null,S:null},pi=Object.prototype.hasOwnProperty;function $e(bt,Ht,_e){var Te=_e.ref;return{$$typeof:B,type:bt,key:Ht,ref:Te!==void 0?Te:null,props:_e}}function Ai(bt,Ht){return $e(bt.type,Ht,bt.props)}function sn(bt){return typeof bt=="object"&&bt!==null&&bt.$$typeof===B}function on(bt){var Ht={"=":"=0",":":"=2"};return"$"+bt.replace(/[=:]/g,function(_e){return Ht[_e]})}var va=/\/+/g;function On(bt,Ht){return typeof bt=="object"&&bt!==null&&bt.key!=null?on(""+bt.key):Ht.toString(36)}function Zn(bt){switch(bt.status){case"fulfilled":return bt.value;case"rejected":throw bt.reason;default:switch(typeof bt.status=="string"?bt.then(we,we):(bt.status="pending",bt.then(function(Ht){bt.status==="pending"&&(bt.status="fulfilled",bt.value=Ht)},function(Ht){bt.status==="pending"&&(bt.status="rejected",bt.reason=Ht)})),bt.status){case"fulfilled":return bt.value;case"rejected":throw bt.reason}}throw bt}function $t(bt,Ht,_e,Te,be){var Ie=typeof bt;(Ie==="undefined"||Ie==="boolean")&&(bt=null);var Ue=!1;if(bt===null)Ue=!0;else switch(Ie){case"bigint":case"string":case"number":Ue=!0;break;case"object":switch(bt.$$typeof){case B:case Y:Ue=!0;break;case Bt:return Ue=bt._init,$t(Ue(bt._payload),Ht,_e,Te,be)}}if(Ue)return be=be(bt),Ue=Te===""?"."+On(bt,0):Te,ue(be)?(_e="",Ue!=null&&(_e=Ue.replace(va,"$&/")+"/"),$t(be,Ht,_e,"",function(dn){return dn})):be!=null&&(sn(be)&&(be=Ai(be,_e+(be.key==null||bt&&bt.key===be.key?"":(""+be.key).replace(va,"$&/")+"/")+Ue)),Ht.push(be)),1;Ue=0;var Ke=Te===""?".":Te+":";if(ue(bt))for(var mi=0;mi<bt.length;mi++)Te=bt[mi],Ie=Ke+On(Te,mi),Ue+=$t(Te,Ht,_e,Ie,be);else if(mi=he(bt),typeof mi=="function")for(bt=mi.call(bt),mi=0;!(Te=bt.next()).done;)Te=Te.value,Ie=Ke+On(Te,mi++),Ue+=$t(Te,Ht,_e,Ie,be);else if(Ie==="object"){if(typeof bt.then=="function")return $t(Zn(bt),Ht,_e,Te,be);throw Ht=String(bt),Error("Objects are not valid as a React child (found: "+(Ht==="[object Object]"?"object with keys {"+Object.keys(bt).join(", ")+"}":Ht)+"). If you meant to render a collection of children, use an array instead.")}return Ue}function de(bt,Ht,_e){if(bt==null)return bt;var Te=[],be=0;return $t(bt,Te,"","",function(Ie){return Ht.call(_e,Ie,be++)}),Te}function Ne(bt){if(bt._status===-1){var Ht=bt._result;Ht=Ht(),Ht.then(function(_e){(bt._status===0||bt._status===-1)&&(bt._status=1,bt._result=_e)},function(_e){(bt._status===0||bt._status===-1)&&(bt._status=2,bt._result=_e)}),bt._status===-1&&(bt._status=0,bt._result=Ht)}if(bt._status===1)return bt._result.default;throw bt._result}var Re=typeof reportError=="function"?reportError:function(bt){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var Ht=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof bt=="object"&&bt!==null&&typeof bt.message=="string"?String(bt.message):String(bt),error:bt});if(!window.dispatchEvent(Ht))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",bt);return}console.error(bt)},si={map:de,forEach:function(bt,Ht,_e){de(bt,function(){Ht.apply(this,arguments)},_e)},count:function(bt){var Ht=0;return de(bt,function(){Ht++}),Ht},toArray:function(bt){return de(bt,function(Ht){return Ht})||[]},only:function(bt){if(!sn(bt))throw Error("React.Children.only expected to receive a single React element child.");return bt}};return ri.Activity=Dt,ri.Children=si,ri.Component=Yt,ri.Fragment=nt,ri.Profiler=lt,ri.PureComponent=At,ri.StrictMode=q,ri.Suspense=et,ri.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=pe,ri.__COMPILER_RUNTIME={__proto__:null,c:function(bt){return pe.H.useMemoCache(bt)}},ri.cache=function(bt){return function(){return bt.apply(null,arguments)}},ri.cacheSignal=function(){return null},ri.cloneElement=function(bt,Ht,_e){if(bt==null)throw Error("The argument must be a React element, but you passed "+bt+".");var Te=Kt({},bt.props),be=bt.key;if(Ht!=null)for(Ie in Ht.key!==void 0&&(be=""+Ht.key),Ht)!pi.call(Ht,Ie)||Ie==="key"||Ie==="__self"||Ie==="__source"||Ie==="ref"&&Ht.ref===void 0||(Te[Ie]=Ht[Ie]);var Ie=arguments.length-2;if(Ie===1)Te.children=_e;else if(1<Ie){for(var Ue=Array(Ie),Ke=0;Ke<Ie;Ke++)Ue[Ke]=arguments[Ke+2];Te.children=Ue}return $e(bt.type,be,Te)},ri.createContext=function(bt){return bt={$$typeof:P,_currentValue:bt,_currentValue2:bt,_threadCount:0,Provider:null,Consumer:null},bt.Provider=bt,bt.Consumer={$$typeof:yt,_context:bt},bt},ri.createElement=function(bt,Ht,_e){var Te,be={},Ie=null;if(Ht!=null)for(Te in Ht.key!==void 0&&(Ie=""+Ht.key),Ht)pi.call(Ht,Te)&&Te!=="key"&&Te!=="__self"&&Te!=="__source"&&(be[Te]=Ht[Te]);var Ue=arguments.length-2;if(Ue===1)be.children=_e;else if(1<Ue){for(var Ke=Array(Ue),mi=0;mi<Ue;mi++)Ke[mi]=arguments[mi+2];be.children=Ke}if(bt&&bt.defaultProps)for(Te in Ue=bt.defaultProps,Ue)be[Te]===void 0&&(be[Te]=Ue[Te]);return $e(bt,Ie,be)},ri.createRef=function(){return{current:null}},ri.forwardRef=function(bt){return{$$typeof:h,render:bt}},ri.isValidElement=sn,ri.lazy=function(bt){return{$$typeof:Bt,_payload:{_status:-1,_result:bt},_init:Ne}},ri.memo=function(bt,Ht){return{$$typeof:ft,type:bt,compare:Ht===void 0?null:Ht}},ri.startTransition=function(bt){var Ht=pe.T,_e={};pe.T=_e;try{var Te=bt(),be=pe.S;be!==null&&be(_e,Te),typeof Te=="object"&&Te!==null&&typeof Te.then=="function"&&Te.then(we,Re)}catch(Ie){Re(Ie)}finally{Ht!==null&&_e.types!==null&&(Ht.types=_e.types),pe.T=Ht}},ri.unstable_useCacheRefresh=function(){return pe.H.useCacheRefresh()},ri.use=function(bt){return pe.H.use(bt)},ri.useActionState=function(bt,Ht,_e){return pe.H.useActionState(bt,Ht,_e)},ri.useCallback=function(bt,Ht){return pe.H.useCallback(bt,Ht)},ri.useContext=function(bt){return pe.H.useContext(bt)},ri.useDebugValue=function(){},ri.useDeferredValue=function(bt,Ht){return pe.H.useDeferredValue(bt,Ht)},ri.useEffect=function(bt,Ht){return pe.H.useEffect(bt,Ht)},ri.useEffectEvent=function(bt){return pe.H.useEffectEvent(bt)},ri.useId=function(){return pe.H.useId()},ri.useImperativeHandle=function(bt,Ht,_e){return pe.H.useImperativeHandle(bt,Ht,_e)},ri.useInsertionEffect=function(bt,Ht){return pe.H.useInsertionEffect(bt,Ht)},ri.useLayoutEffect=function(bt,Ht){return pe.H.useLayoutEffect(bt,Ht)},ri.useMemo=function(bt,Ht){return pe.H.useMemo(bt,Ht)},ri.useOptimistic=function(bt,Ht){return pe.H.useOptimistic(bt,Ht)},ri.useReducer=function(bt,Ht,_e){return pe.H.useReducer(bt,Ht,_e)},ri.useRef=function(bt){return pe.H.useRef(bt)},ri.useState=function(bt){return pe.H.useState(bt)},ri.useSyncExternalStore=function(bt,Ht,_e){return pe.H.useSyncExternalStore(bt,Ht,_e)},ri.useTransition=function(){return pe.H.useTransition()},ri.version="19.2.0",ri}var n_;function Ng(){return n_||(n_=1,Sg.exports=K_()),Sg.exports}var Mt=Ng(),Eg={exports:{}},$p={},Mg={exports:{}},Cg={};var a_;function Q_(){return a_||(a_=1,(function(B){function Y($t,de){var Ne=$t.length;$t.push(de);t:for(;0<Ne;){var Re=Ne-1>>>1,si=$t[Re];if(0<lt(si,de))$t[Re]=de,$t[Ne]=si,Ne=Re;else break t}}function nt($t){return $t.length===0?null:$t[0]}function q($t){if($t.length===0)return null;var de=$t[0],Ne=$t.pop();if(Ne!==de){$t[0]=Ne;t:for(var Re=0,si=$t.length,bt=si>>>1;Re<bt;){var Ht=2*(Re+1)-1,_e=$t[Ht],Te=Ht+1,be=$t[Te];if(0>lt(_e,Ne))Te<si&&0>lt(be,_e)?($t[Re]=be,$t[Te]=Ne,Re=Te):($t[Re]=_e,$t[Ht]=Ne,Re=Ht);else if(Te<si&&0>lt(be,Ne))$t[Re]=be,$t[Te]=Ne,Re=Te;else break t}}return de}function lt($t,de){var Ne=$t.sortIndex-de.sortIndex;return Ne!==0?Ne:$t.id-de.id}if(B.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var yt=performance;B.unstable_now=function(){return yt.now()}}else{var P=Date,h=P.now();B.unstable_now=function(){return P.now()-h}}var et=[],ft=[],Bt=1,Dt=null,se=3,he=!1,xe=!1,Kt=!1,gt=!1,Yt=typeof setTimeout=="function"?setTimeout:null,Pt=typeof clearTimeout=="function"?clearTimeout:null,At=typeof setImmediate<"u"?setImmediate:null;function ce($t){for(var de=nt(ft);de!==null;){if(de.callback===null)q(ft);else if(de.startTime<=$t)q(ft),de.sortIndex=de.expirationTime,Y(et,de);else break;de=nt(ft)}}function ue($t){if(Kt=!1,ce($t),!xe)if(nt(et)!==null)xe=!0,we||(we=!0,on());else{var de=nt(ft);de!==null&&Zn(ue,de.startTime-$t)}}var we=!1,pe=-1,pi=5,$e=-1;function Ai(){return gt?!0:!(B.unstable_now()-$e<pi)}function sn(){if(gt=!1,we){var $t=B.unstable_now();$e=$t;var de=!0;try{t:{xe=!1,Kt&&(Kt=!1,Pt(pe),pe=-1),he=!0;var Ne=se;try{e:{for(ce($t),Dt=nt(et);Dt!==null&&!(Dt.expirationTime>$t&&Ai());){var Re=Dt.callback;if(typeof Re=="function"){Dt.callback=null,se=Dt.priorityLevel;var si=Re(Dt.expirationTime<=$t);if($t=B.unstable_now(),typeof si=="function"){Dt.callback=si,ce($t),de=!0;break e}Dt===nt(et)&&q(et),ce($t)}else q(et);Dt=nt(et)}if(Dt!==null)de=!0;else{var bt=nt(ft);bt!==null&&Zn(ue,bt.startTime-$t),de=!1}}break t}finally{Dt=null,se=Ne,he=!1}de=void 0}}finally{de?on():we=!1}}}var on;if(typeof At=="function")on=function(){At(sn)};else if(typeof MessageChannel<"u"){var va=new MessageChannel,On=va.port2;va.port1.onmessage=sn,on=function(){On.postMessage(null)}}else on=function(){Yt(sn,0)};function Zn($t,de){pe=Yt(function(){$t(B.unstable_now())},de)}B.unstable_IdlePriority=5,B.unstable_ImmediatePriority=1,B.unstable_LowPriority=4,B.unstable_NormalPriority=3,B.unstable_Profiling=null,B.unstable_UserBlockingPriority=2,B.unstable_cancelCallback=function($t){$t.callback=null},B.unstable_forceFrameRate=function($t){0>$t||125<$t?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):pi=0<$t?Math.floor(1e3/$t):5},B.unstable_getCurrentPriorityLevel=function(){return se},B.unstable_next=function($t){switch(se){case 1:case 2:case 3:var de=3;break;default:de=se}var Ne=se;se=de;try{return $t()}finally{se=Ne}},B.unstable_requestPaint=function(){gt=!0},B.unstable_runWithPriority=function($t,de){switch($t){case 1:case 2:case 3:case 4:case 5:break;default:$t=3}var Ne=se;se=$t;try{return de()}finally{se=Ne}},B.unstable_scheduleCallback=function($t,de,Ne){var Re=B.unstable_now();switch(typeof Ne=="object"&&Ne!==null?(Ne=Ne.delay,Ne=typeof Ne=="number"&&0<Ne?Re+Ne:Re):Ne=Re,$t){case 1:var si=-1;break;case 2:si=250;break;case 5:si=1073741823;break;case 4:si=1e4;break;default:si=5e3}return si=Ne+si,$t={id:Bt++,callback:de,priorityLevel:$t,startTime:Ne,expirationTime:si,sortIndex:-1},Ne>Re?($t.sortIndex=Ne,Y(ft,$t),nt(et)===null&&$t===nt(ft)&&(Kt?(Pt(pe),pe=-1):Kt=!0,Zn(ue,Ne-Re))):($t.sortIndex=si,Y(et,$t),xe||he||(xe=!0,we||(we=!0,on()))),$t},B.unstable_shouldYield=Ai,B.unstable_wrapCallback=function($t){var de=se;return function(){var Ne=se;se=de;try{return $t.apply(this,arguments)}finally{se=Ne}}}})(Cg)),Cg}var r_;function J_(){return r_||(r_=1,Mg.exports=Q_()),Mg.exports}var Ag={exports:{}},Dr={};var s_;function ty(){if(s_)return Dr;s_=1;var B=Ng();function Y(et){var ft="https://react.dev/errors/"+et;if(1<arguments.length){ft+="?args[]="+encodeURIComponent(arguments[1]);for(var Bt=2;Bt<arguments.length;Bt++)ft+="&args[]="+encodeURIComponent(arguments[Bt])}return"Minified React error #"+et+"; visit "+ft+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function nt(){}var q={d:{f:nt,r:function(){throw Error(Y(522))},D:nt,C:nt,L:nt,m:nt,X:nt,S:nt,M:nt},p:0,findDOMNode:null},lt=Symbol.for("react.portal");function yt(et,ft,Bt){var Dt=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:lt,key:Dt==null?null:""+Dt,children:et,containerInfo:ft,implementation:Bt}}var P=B.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function h(et,ft){if(et==="font")return"";if(typeof ft=="string")return ft==="use-credentials"?ft:""}return Dr.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=q,Dr.createPortal=function(et,ft){var Bt=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!ft||ft.nodeType!==1&&ft.nodeType!==9&&ft.nodeType!==11)throw Error(Y(299));return yt(et,ft,null,Bt)},Dr.flushSync=function(et){var ft=P.T,Bt=q.p;try{if(P.T=null,q.p=2,et)return et()}finally{P.T=ft,q.p=Bt,q.d.f()}},Dr.preconnect=function(et,ft){typeof et=="string"&&(ft?(ft=ft.crossOrigin,ft=typeof ft=="string"?ft==="use-credentials"?ft:"":void 0):ft=null,q.d.C(et,ft))},Dr.prefetchDNS=function(et){typeof et=="string"&&q.d.D(et)},Dr.preinit=function(et,ft){if(typeof et=="string"&&ft&&typeof ft.as=="string"){var Bt=ft.as,Dt=h(Bt,ft.crossOrigin),se=typeof ft.integrity=="string"?ft.integrity:void 0,he=typeof ft.fetchPriority=="string"?ft.fetchPriority:void 0;Bt==="style"?q.d.S(et,typeof ft.precedence=="string"?ft.precedence:void 0,{crossOrigin:Dt,integrity:se,fetchPriority:he}):Bt==="script"&&q.d.X(et,{crossOrigin:Dt,integrity:se,fetchPriority:he,nonce:typeof ft.nonce=="string"?ft.nonce:void 0})}},Dr.preinitModule=function(et,ft){if(typeof et=="string")if(typeof ft=="object"&&ft!==null){if(ft.as==null||ft.as==="script"){var Bt=h(ft.as,ft.crossOrigin);q.d.M(et,{crossOrigin:Bt,integrity:typeof ft.integrity=="string"?ft.integrity:void 0,nonce:typeof ft.nonce=="string"?ft.nonce:void 0})}}else ft==null&&q.d.M(et)},Dr.preload=function(et,ft){if(typeof et=="string"&&typeof ft=="object"&&ft!==null&&typeof ft.as=="string"){var Bt=ft.as,Dt=h(Bt,ft.crossOrigin);q.d.L(et,Bt,{crossOrigin:Dt,integrity:typeof ft.integrity=="string"?ft.integrity:void 0,nonce:typeof ft.nonce=="string"?ft.nonce:void 0,type:typeof ft.type=="string"?ft.type:void 0,fetchPriority:typeof ft.fetchPriority=="string"?ft.fetchPriority:void 0,referrerPolicy:typeof ft.referrerPolicy=="string"?ft.referrerPolicy:void 0,imageSrcSet:typeof ft.imageSrcSet=="string"?ft.imageSrcSet:void 0,imageSizes:typeof ft.imageSizes=="string"?ft.imageSizes:void 0,media:typeof ft.media=="string"?ft.media:void 0})}},Dr.preloadModule=function(et,ft){if(typeof et=="string")if(ft){var Bt=h(ft.as,ft.crossOrigin);q.d.m(et,{as:typeof ft.as=="string"&&ft.as!=="script"?ft.as:void 0,crossOrigin:Bt,integrity:typeof ft.integrity=="string"?ft.integrity:void 0})}else q.d.m(et)},Dr.requestFormReset=function(et){q.d.r(et)},Dr.unstable_batchedUpdates=function(et,ft){return et(ft)},Dr.useFormState=function(et,ft,Bt){return P.H.useFormState(et,ft,Bt)},Dr.useFormStatus=function(){return P.H.useHostTransitionStatus()},Dr.version="19.2.0",Dr}var o_;function ey(){if(o_)return Ag.exports;o_=1;function B(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(B)}catch(Y){console.error(Y)}}return B(),Ag.exports=ty(),Ag.exports}var l_;function iy(){if(l_)return $p;l_=1;var B=J_(),Y=Ng(),nt=ey();function q(n){var s="https://react.dev/errors/"+n;if(1<arguments.length){s+="?args[]="+encodeURIComponent(arguments[1]);for(var u=2;u<arguments.length;u++)s+="&args[]="+encodeURIComponent(arguments[u])}return"Minified React error #"+n+"; visit "+s+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function lt(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function yt(n){var s=n,u=n;if(n.alternate)for(;s.return;)s=s.return;else{n=s;do s=n,(s.flags&4098)!==0&&(u=s.return),n=s.return;while(n)}return s.tag===3?u:null}function P(n){if(n.tag===13){var s=n.memoizedState;if(s===null&&(n=n.alternate,n!==null&&(s=n.memoizedState)),s!==null)return s.dehydrated}return null}function h(n){if(n.tag===31){var s=n.memoizedState;if(s===null&&(n=n.alternate,n!==null&&(s=n.memoizedState)),s!==null)return s.dehydrated}return null}function et(n){if(yt(n)!==n)throw Error(q(188))}function ft(n){var s=n.alternate;if(!s){if(s=yt(n),s===null)throw Error(q(188));return s!==n?null:n}for(var u=n,_=s;;){var b=u.return;if(b===null)break;var E=b.alternate;if(E===null){if(_=b.return,_!==null){u=_;continue}break}if(b.child===E.child){for(E=b.child;E;){if(E===u)return et(b),n;if(E===_)return et(b),s;E=E.sibling}throw Error(q(188))}if(u.return!==_.return)u=b,_=E;else{for(var O=!1,X=b.child;X;){if(X===u){O=!0,u=b,_=E;break}if(X===_){O=!0,_=b,u=E;break}X=X.sibling}if(!O){for(X=E.child;X;){if(X===u){O=!0,u=E,_=b;break}if(X===_){O=!0,_=E,u=b;break}X=X.sibling}if(!O)throw Error(q(189))}}if(u.alternate!==_)throw Error(q(190))}if(u.tag!==3)throw Error(q(188));return u.stateNode.current===u?n:s}function Bt(n){var s=n.tag;if(s===5||s===26||s===27||s===6)return n;for(n=n.child;n!==null;){if(s=Bt(n),s!==null)return s;n=n.sibling}return null}var Dt=Object.assign,se=Symbol.for("react.element"),he=Symbol.for("react.transitional.element"),xe=Symbol.for("react.portal"),Kt=Symbol.for("react.fragment"),gt=Symbol.for("react.strict_mode"),Yt=Symbol.for("react.profiler"),Pt=Symbol.for("react.consumer"),At=Symbol.for("react.context"),ce=Symbol.for("react.forward_ref"),ue=Symbol.for("react.suspense"),we=Symbol.for("react.suspense_list"),pe=Symbol.for("react.memo"),pi=Symbol.for("react.lazy"),$e=Symbol.for("react.activity"),Ai=Symbol.for("react.memo_cache_sentinel"),sn=Symbol.iterator;function on(n){return n===null||typeof n!="object"?null:(n=sn&&n[sn]||n["@@iterator"],typeof n=="function"?n:null)}var va=Symbol.for("react.client.reference");function On(n){if(n==null)return null;if(typeof n=="function")return n.$$typeof===va?null:n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case Kt:return"Fragment";case Yt:return"Profiler";case gt:return"StrictMode";case ue:return"Suspense";case we:return"SuspenseList";case $e:return"Activity"}if(typeof n=="object")switch(n.$$typeof){case xe:return"Portal";case At:return n.displayName||"Context";case Pt:return(n._context.displayName||"Context")+".Consumer";case ce:var s=n.render;return n=n.displayName,n||(n=s.displayName||s.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case pe:return s=n.displayName||null,s!==null?s:On(n.type)||"Memo";case pi:s=n._payload,n=n._init;try{return On(n(s))}catch{}}return null}var Zn=Array.isArray,$t=Y.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,de=nt.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Ne={pending:!1,data:null,method:null,action:null},Re=[],si=-1;function bt(n){return{current:n}}function Ht(n){0>si||(n.current=Re[si],Re[si]=null,si--)}function _e(n,s){si++,Re[si]=n.current,n.current=s}var Te=bt(null),be=bt(null),Ie=bt(null),Ue=bt(null);function Ke(n,s){switch(_e(Ie,s),_e(be,n),_e(Te,null),s.nodeType){case 9:case 11:n=(n=s.documentElement)&&(n=n.namespaceURI)?wp(n):0;break;default:if(n=s.tagName,s=s.namespaceURI)s=wp(s),n=wf(s,n);else switch(n){case"svg":n=1;break;case"math":n=2;break;default:n=0}}Ht(Te),_e(Te,n)}function mi(){Ht(Te),Ht(be),Ht(Ie)}function dn(n){n.memoizedState!==null&&_e(Ue,n);var s=Te.current,u=wf(s,n.type);s!==u&&(_e(be,n),_e(Te,u))}function Qe(n){be.current===n&&(Ht(Te),Ht(be)),Ue.current===n&&(Ht(Ue),ou._currentValue=Ne)}var qe,Ki;function oi(n){if(qe===void 0)try{throw Error()}catch(u){var s=u.stack.trim().match(/\n( *(at )?)/);qe=s&&s[1]||"",Ki=-1<u.stack.indexOf(`
    at`)?" (<anonymous>)":-1<u.stack.indexOf("@")?"@unknown:0:0":""}return`
`+qe+n+Ki}var ia=!1;function xn(n,s){if(!n||ia)return"";ia=!0;var u=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var _={DetermineComponentFrameRoot:function(){try{if(s){var ie=function(){throw Error()};if(Object.defineProperty(ie.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(ie,[])}catch(Gt){var Vt=Gt}Reflect.construct(n,[],ie)}else{try{ie.call()}catch(Gt){Vt=Gt}n.call(ie.prototype)}}else{try{throw Error()}catch(Gt){Vt=Gt}(ie=n())&&typeof ie.catch=="function"&&ie.catch(function(){})}}catch(Gt){if(Gt&&Vt&&typeof Gt.stack=="string")return[Gt.stack,Vt.stack]}return[null,null]}};_.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var b=Object.getOwnPropertyDescriptor(_.DetermineComponentFrameRoot,"name");b&&b.configurable&&Object.defineProperty(_.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var E=_.DetermineComponentFrameRoot(),O=E[0],X=E[1];if(O&&X){var _t=O.split(`
`),Ft=X.split(`
`);for(b=_=0;_<_t.length&&!_t[_].includes("DetermineComponentFrameRoot");)_++;for(;b<Ft.length&&!Ft[b].includes("DetermineComponentFrameRoot");)b++;if(_===_t.length||b===Ft.length)for(_=_t.length-1,b=Ft.length-1;1<=_&&0<=b&&_t[_]!==Ft[b];)b--;for(;1<=_&&0<=b;_--,b--)if(_t[_]!==Ft[b]){if(_!==1||b!==1)do if(_--,b--,0>b||_t[_]!==Ft[b]){var Wt=`
`+_t[_].replace(" at new "," at ");return n.displayName&&Wt.includes("<anonymous>")&&(Wt=Wt.replace("<anonymous>",n.displayName)),Wt}while(1<=_&&0<=b);break}}}finally{ia=!1,Error.prepareStackTrace=u}return(u=n?n.displayName||n.name:"")?oi(u):""}function Di(n,s){switch(n.tag){case 26:case 27:case 5:return oi(n.type);case 16:return oi("Lazy");case 13:return n.child!==s&&s!==null?oi("Suspense Fallback"):oi("Suspense");case 19:return oi("SuspenseList");case 0:case 15:return xn(n.type,!1);case 11:return xn(n.type.render,!1);case 1:return xn(n.type,!0);case 31:return oi("Activity");default:return""}}function Cn(n){try{var s="",u=null;do s+=Di(n,u),u=n,n=n.return;while(n);return s}catch(_){return`
Error generating stack: `+_.message+`
`+_.stack}}var An=Object.prototype.hasOwnProperty,ca=B.unstable_scheduleCallback,Qi=B.unstable_cancelCallback,fn=B.unstable_shouldYield,xa=B.unstable_requestPaint,qi=B.unstable_now,bn=B.unstable_getCurrentPriorityLevel,Io=B.unstable_ImmediatePriority,Sl=B.unstable_UserBlockingPriority,Wr=B.unstable_NormalPriority,El=B.unstable_LowPriority,Ts=B.unstable_IdlePriority,Ml=B.log,Ro=B.unstable_setDisableYieldValue,za=null,Ji=null;function pt(n){if(typeof Ml=="function"&&Ro(n),Ji&&typeof Ji.setStrictMode=="function")try{Ji.setStrictMode(za,n)}catch{}}var F=Math.clz32?Math.clz32:ot,G=Math.log,H=Math.LN2;function ot(n){return n>>>=0,n===0?32:31-(G(n)/H|0)|0}var ut=256,Et=262144,J=4194304;function wt(n){var s=n&42;if(s!==0)return s;switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return n&261888;case 262144:case 524288:case 1048576:case 2097152:return n&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return n&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return n}}function Nt(n,s,u){var _=n.pendingLanes;if(_===0)return 0;var b=0,E=n.suspendedLanes,O=n.pingedLanes;n=n.warmLanes;var X=_&134217727;return X!==0?(_=X&~E,_!==0?b=wt(_):(O&=X,O!==0?b=wt(O):u||(u=X&~n,u!==0&&(b=wt(u))))):(X=_&~E,X!==0?b=wt(X):O!==0?b=wt(O):u||(u=_&~n,u!==0&&(b=wt(u)))),b===0?0:s!==0&&s!==b&&(s&E)===0&&(E=b&-b,u=s&-s,E>=u||E===32&&(u&4194048)!==0)?s:b}function jt(n,s){return(n.pendingLanes&~(n.suspendedLanes&~n.pingedLanes)&s)===0}function Ut(n,s){switch(n){case 1:case 2:case 4:case 8:case 64:return s+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return s+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function ye(){var n=J;return J<<=1,(J&62914560)===0&&(J=4194304),n}function Ce(n){for(var s=[],u=0;31>u;u++)s.push(n);return s}function je(n,s){n.pendingLanes|=s,s!==268435456&&(n.suspendedLanes=0,n.pingedLanes=0,n.warmLanes=0)}function pn(n,s,u,_,b,E){var O=n.pendingLanes;n.pendingLanes=u,n.suspendedLanes=0,n.pingedLanes=0,n.warmLanes=0,n.expiredLanes&=u,n.entangledLanes&=u,n.errorRecoveryDisabledLanes&=u,n.shellSuspendCounter=0;var X=n.entanglements,_t=n.expirationTimes,Ft=n.hiddenUpdates;for(u=O&~u;0<u;){var Wt=31-F(u),ie=1<<Wt;X[Wt]=0,_t[Wt]=-1;var Vt=Ft[Wt];if(Vt!==null)for(Ft[Wt]=null,Wt=0;Wt<Vt.length;Wt++){var Gt=Vt[Wt];Gt!==null&&(Gt.lane&=-536870913)}u&=~ie}_!==0&&Je(n,_,0),E!==0&&b===0&&n.tag!==0&&(n.suspendedLanes|=E&~(O&~s))}function Je(n,s,u){n.pendingLanes|=s,n.suspendedLanes&=~s;var _=31-F(s);n.entangledLanes|=s,n.entanglements[_]=n.entanglements[_]|1073741824|u&261930}function yi(n,s){var u=n.entangledLanes|=s;for(n=n.entanglements;u;){var _=31-F(u),b=1<<_;b&s|n[_]&s&&(n[_]|=s),u&=~b}}function Li(n,s){var u=s&-s;return u=(u&42)!==0?1:ne(u),(u&(n.suspendedLanes|s))!==0?0:u}function ne(n){switch(n){case 2:n=1;break;case 8:n=4;break;case 32:n=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:n=128;break;case 268435456:n=134217728;break;default:n=0}return n}function ki(n){return n&=-n,2<n?8<n?(n&134217727)!==0?32:268435456:8:2}function Oi(){var n=de.p;return n!==0?n:(n=window.event,n===void 0?32:jm(n.type))}function Dn(n,s){var u=de.p;try{return de.p=n,s()}finally{de.p=u}}var vi=Math.random().toString(36).slice(2),Qt="__reactFiber$"+vi,me="__reactProps$"+vi,Ae="__reactContainer$"+vi,ba="__reactEvents$"+vi,Lo="__reactListeners$"+vi,na="__reactHandles$"+vi,Be="__reactResources$"+vi,ir="__reactMarker$"+vi;function Js(n){delete n[Qt],delete n[me],delete n[ba],delete n[Lo],delete n[na]}function zr(n){var s=n[Qt];if(s)return s;for(var u=n.parentNode;u;){if(s=u[Ae]||u[Qt]){if(u=s.alternate,s.child!==null||u!==null&&u.child!==null)for(n=Mp(n);n!==null;){if(u=n[Qt])return u;n=Mp(n)}return s}n=u,u=n.parentNode}return null}function wa(n){if(n=n[Qt]||n[Ae]){var s=n.tag;if(s===5||s===6||s===13||s===31||s===26||s===27||s===3)return n}return null}function Pr(n){var s=n.tag;if(s===5||s===26||s===27||s===6)return n.stateNode;throw Error(q(33))}function Ir(n){var s=n[Be];return s||(s=n[Be]={hoistableStyles:new Map,hoistableScripts:new Map}),s}function mn(n){n[ir]=!0}var Ua=new Set,Bi={};function ko(n,s){Pa(n,s),Pa(n+"Capture",s)}function Pa(n,s){for(Bi[n]=s,n=0;n<s.length;n++)Ua.add(s[n])}var dc=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),tn={},Ss={};function vh(n){return An.call(Ss,n)?!0:An.call(tn,n)?!1:dc.test(n)?Ss[n]=!0:(tn[n]=!0,!1)}function Es(n,s,u){if(vh(s))if(u===null)n.removeAttribute(s);else{switch(typeof u){case"undefined":case"function":case"symbol":n.removeAttribute(s);return;case"boolean":var _=s.toLowerCase().slice(0,5);if(_!=="data-"&&_!=="aria-"){n.removeAttribute(s);return}}n.setAttribute(s,""+u)}}function Cl(n,s,u){if(u===null)n.removeAttribute(s);else{switch(typeof u){case"undefined":case"function":case"symbol":case"boolean":n.removeAttribute(s);return}n.setAttribute(s,""+u)}}function Ga(n,s,u,_){if(_===null)n.removeAttribute(u);else{switch(typeof _){case"undefined":case"function":case"symbol":case"boolean":n.removeAttribute(u);return}n.setAttributeNS(s,u,""+_)}}function nr(n){switch(typeof n){case"bigint":case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function xh(n){var s=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(s==="checkbox"||s==="radio")}function Bf(n,s,u){var _=Object.getOwnPropertyDescriptor(n.constructor.prototype,s);if(!n.hasOwnProperty(s)&&typeof _<"u"&&typeof _.get=="function"&&typeof _.set=="function"){var b=_.get,E=_.set;return Object.defineProperty(n,s,{configurable:!0,get:function(){return b.call(this)},set:function(O){u=""+O,E.call(this,O)}}),Object.defineProperty(n,s,{enumerable:_.enumerable}),{getValue:function(){return u},setValue:function(O){u=""+O},stopTracking:function(){n._valueTracker=null,delete n[s]}}}}function mu(n){if(!n._valueTracker){var s=xh(n)?"checked":"value";n._valueTracker=Bf(n,s,""+n[s])}}function bh(n){if(!n)return!1;var s=n._valueTracker;if(!s)return!0;var u=s.getValue(),_="";return n&&(_=xh(n)?n.checked?"true":"false":n.value),n=_,n!==u?(s.setValue(n),!0):!1}function fc(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}var wh=/[\n"\\]/g;function qa(n){return n.replace(wh,function(s){return"\\"+s.charCodeAt(0).toString(16)+" "})}function gu(n,s,u,_,b,E,O,X){n.name="",O!=null&&typeof O!="function"&&typeof O!="symbol"&&typeof O!="boolean"?n.type=O:n.removeAttribute("type"),s!=null?O==="number"?(s===0&&n.value===""||n.value!=s)&&(n.value=""+nr(s)):n.value!==""+nr(s)&&(n.value=""+nr(s)):O!=="submit"&&O!=="reset"||n.removeAttribute("value"),s!=null?pc(n,O,nr(s)):u!=null?pc(n,O,nr(u)):_!=null&&n.removeAttribute("value"),b==null&&E!=null&&(n.defaultChecked=!!E),b!=null&&(n.checked=b&&typeof b!="function"&&typeof b!="symbol"),X!=null&&typeof X!="function"&&typeof X!="symbol"&&typeof X!="boolean"?n.name=""+nr(X):n.removeAttribute("name")}function _u(n,s,u,_,b,E,O,X){if(E!=null&&typeof E!="function"&&typeof E!="symbol"&&typeof E!="boolean"&&(n.type=E),s!=null||u!=null){if(!(E!=="submit"&&E!=="reset"||s!=null)){mu(n);return}u=u!=null?""+nr(u):"",s=s!=null?""+nr(s):u,X||s===n.value||(n.value=s),n.defaultValue=s}_=_??b,_=typeof _!="function"&&typeof _!="symbol"&&!!_,n.checked=X?n.checked:!!_,n.defaultChecked=!!_,O!=null&&typeof O!="function"&&typeof O!="symbol"&&typeof O!="boolean"&&(n.name=O),mu(n)}function pc(n,s,u){s==="number"&&fc(n.ownerDocument)===n||n.defaultValue===""+u||(n.defaultValue=""+u)}function Oo(n,s,u,_){if(n=n.options,s){s={};for(var b=0;b<u.length;b++)s["$"+u[b]]=!0;for(u=0;u<n.length;u++)b=s.hasOwnProperty("$"+n[u].value),n[u].selected!==b&&(n[u].selected=b),b&&_&&(n[u].defaultSelected=!0)}else{for(u=""+nr(u),s=null,b=0;b<n.length;b++){if(n[b].value===u){n[b].selected=!0,_&&(n[b].defaultSelected=!0);return}s!==null||n[b].disabled||(s=n[b])}s!==null&&(s.selected=!0)}}function Kr(n,s,u){if(s!=null&&(s=""+nr(s),s!==n.value&&(n.value=s),u==null)){n.defaultValue!==s&&(n.defaultValue=s);return}n.defaultValue=u!=null?""+nr(u):""}function mc(n,s,u,_){if(s==null){if(_!=null){if(u!=null)throw Error(q(92));if(Zn(_)){if(1<_.length)throw Error(q(93));_=_[0]}u=_}u==null&&(u=""),s=u}u=nr(s),n.defaultValue=u,_=n.textContent,_===u&&_!==""&&_!==null&&(n.value=_),mu(n)}function Bo(n,s){if(s){var u=n.firstChild;if(u&&u===n.lastChild&&u.nodeType===3){u.nodeValue=s;return}}n.textContent=s}var Qr=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Th(n,s,u){var _=s.indexOf("--")===0;u==null||typeof u=="boolean"||u===""?_?n.setProperty(s,""):s==="float"?n.cssFloat="":n[s]="":_?n.setProperty(s,u):typeof u!="number"||u===0||Qr.has(s)?s==="float"?n.cssFloat=u:n[s]=(""+u).trim():n[s]=u+"px"}function zd(n,s,u){if(s!=null&&typeof s!="object")throw Error(q(62));if(n=n.style,u!=null){for(var _ in u)!u.hasOwnProperty(_)||s!=null&&s.hasOwnProperty(_)||(_.indexOf("--")===0?n.setProperty(_,""):_==="float"?n.cssFloat="":n[_]="");for(var b in s)_=s[b],s.hasOwnProperty(b)&&u[b]!==_&&Th(n,b,_)}else for(var E in s)s.hasOwnProperty(E)&&Th(n,E,s[E])}function Jr(n){if(n.indexOf("-")===-1)return!1;switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var No=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),ii=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Ia(n){return ii.test(""+n)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":n}function Xe(){}var ts=null;function wn(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var zn=null,Pn=null;function Bn(n){var s=wa(n);if(s&&(n=s.stateNode)){var u=n[me]||null;t:switch(n=s.stateNode,s.type){case"input":if(gu(n,u.value,u.defaultValue,u.defaultValue,u.checked,u.defaultChecked,u.type,u.name),s=u.name,u.type==="radio"&&s!=null){for(u=n;u.parentNode;)u=u.parentNode;for(u=u.querySelectorAll('input[name="'+qa(""+s)+'"][type="radio"]'),s=0;s<u.length;s++){var _=u[s];if(_!==n&&_.form===n.form){var b=_[me]||null;if(!b)throw Error(q(90));gu(_,b.value,b.defaultValue,b.defaultValue,b.checked,b.defaultChecked,b.type,b.name)}}for(s=0;s<u.length;s++)_=u[s],_.form===n.form&&bh(_)}break t;case"textarea":Kr(n,u.value,u.defaultValue);break t;case"select":s=u.value,s!=null&&Oo(n,!!u.multiple,s,!1)}}}var Ii=!1;function gc(n,s,u){if(Ii)return n(s,u);Ii=!0;try{var _=n(s);return _}finally{if(Ii=!1,(zn!==null||Pn!==null)&&(ih(),zn&&(s=zn,n=Pn,Pn=zn=null,Bn(s),n)))for(s=0;s<n.length;s++)Bn(n[s])}}function Hn(n,s){var u=n.stateNode;if(u===null)return null;var _=u[me]||null;if(_===null)return null;u=_[s];t:switch(s){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(_=!_.disabled)||(n=n.type,_=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!_;break t;default:n=!1}if(n)return null;if(u&&typeof u!="function")throw Error(q(231,s,typeof u));return u}var Tn=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),aa=!1;if(Tn)try{var Al={};Object.defineProperty(Al,"passive",{get:function(){aa=!0}}),window.addEventListener("test",Al,Al),window.removeEventListener("test",Al,Al)}catch{aa=!1}var Ra=null,Ni=null,Ms=null;function Cs(){if(Ms)return Ms;var n,s=Ni,u=s.length,_,b="value"in Ra?Ra.value:Ra.textContent,E=b.length;for(n=0;n<u&&s[n]===b[n];n++);var O=u-n;for(_=1;_<=O&&s[u-_]===b[E-_];_++);return Ms=b.slice(n,1<_?1-_:void 0)}function to(n){var s=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&s===13&&(n=13)):n=s,n===10&&(n=13),32<=n||n===13?n:0}function ua(){return!0}function Zi(){return!1}function gn(n){function s(u,_,b,E,O){this._reactName=u,this._targetInst=b,this.type=_,this.nativeEvent=E,this.target=O,this.currentTarget=null;for(var X in n)n.hasOwnProperty(X)&&(u=n[X],this[X]=u?u(E):E[X]);return this.isDefaultPrevented=(E.defaultPrevented!=null?E.defaultPrevented:E.returnValue===!1)?ua:Zi,this.isPropagationStopped=Zi,this}return Dt(s.prototype,{preventDefault:function(){this.defaultPrevented=!0;var u=this.nativeEvent;u&&(u.preventDefault?u.preventDefault():typeof u.returnValue!="unknown"&&(u.returnValue=!1),this.isDefaultPrevented=ua)},stopPropagation:function(){var u=this.nativeEvent;u&&(u.stopPropagation?u.stopPropagation():typeof u.cancelBubble!="unknown"&&(u.cancelBubble=!0),this.isPropagationStopped=ua)},persist:function(){},isPersistent:ua}),s}var ti={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Ze=gn(ti),es=Dt({},ti,{view:0,detail:0}),ci=gn(es),eo,ar,As,is=Dt({},es,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:xu,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==As&&(As&&n.type==="mousemove"?(eo=n.screenX-As.screenX,ar=n.screenY-As.screenY):ar=eo=0,As=n),eo)},movementY:function(n){return"movementY"in n?n.movementY:ar}}),_c=gn(is),yc=Dt({},is,{dataTransfer:0}),vc=gn(yc),yu=Dt({},es,{relatedTarget:0}),io=gn(yu),Pd=Dt({},ti,{animationName:0,elapsedTime:0,pseudoElement:0}),ns=gn(Pd),ha=Dt({},ti,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),vu=gn(ha),Id=Dt({},ti,{data:0}),ra=gn(Id),Nn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Rr={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Dl={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Sh(n){var s=this.nativeEvent;return s.getModifierState?s.getModifierState(n):(n=Dl[n])?!!s[n]:!1}function xu(){return Sh}var Lr=Dt({},es,{key:function(n){if(n.key){var s=Nn[n.key]||n.key;if(s!=="Unidentified")return s}return n.type==="keypress"?(n=to(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?Rr[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:xu,charCode:function(n){return n.type==="keypress"?to(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?to(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),bu=gn(Lr),Eh=Dt({},is,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Rd=gn(Eh),Ld=Dt({},es,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:xu}),wu=gn(Ld),Tu=Dt({},ti,{propertyName:0,elapsedTime:0,pseudoElement:0}),Za=gn(Tu),Su=Dt({},is,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),Fo=gn(Su),Mh=Dt({},ti,{newState:0,oldState:0}),xc=gn(Mh),as=[9,13,27,32],Ch=Tn&&"CompositionEvent"in window,jo=null;Tn&&"documentMode"in document&&(jo=document.documentMode);var bc=Tn&&"TextEvent"in window&&!jo,Ds=Tn&&(!Ch||jo&&8<jo&&11>=jo),kd=" ",zl=!1;function Ah(n,s){switch(n){case"keyup":return as.indexOf(s.keyCode)!==-1;case"keydown":return s.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Vo(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var Uo=!1;function Od(n,s){switch(n){case"compositionend":return Vo(s);case"keypress":return s.which!==32?null:(zl=!0,kd);case"textInput":return n=s.data,n===kd&&zl?null:n;default:return null}}function Nf(n,s){if(Uo)return n==="compositionend"||!Ch&&Ah(n,s)?(n=Cs(),Ms=Ni=Ra=null,Uo=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(s.ctrlKey||s.altKey||s.metaKey)||s.ctrlKey&&s.altKey){if(s.char&&1<s.char.length)return s.char;if(s.which)return String.fromCharCode(s.which)}return null;case"compositionend":return Ds&&s.locale!=="ko"?null:s.data;default:return null}}var Bd={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Eu(n){var s=n&&n.nodeName&&n.nodeName.toLowerCase();return s==="input"?!!Bd[n.type]:s==="textarea"}function Dh(n,s,u,_){zn?Pn?Pn.push(_):Pn=[_]:zn=_,s=pd(s,"onChange"),0<s.length&&(u=new Ze("onChange","change",null,u,_),n.push({event:u,listeners:s}))}var Go=null,qo=null;function zh(n){ml(n,0)}function rs(n){var s=Pr(n);if(bh(s))return n}function Ph(n,s){if(n==="change")return s}var Ih=!1;if(Tn){var Zo;if(Tn){var Pl="oninput"in document;if(!Pl){var Il=document.createElement("div");Il.setAttribute("oninput","return;"),Pl=typeof Il.oninput=="function"}Zo=Pl}else Zo=!1;Ih=Zo&&(!document.documentMode||9<document.documentMode)}function Nd(){Go&&(Go.detachEvent("onpropertychange",Fd),qo=Go=null)}function Fd(n){if(n.propertyName==="value"&&rs(qo)){var s=[];Dh(s,qo,n,wn(n)),gc(zh,s)}}function jd(n,s,u){n==="focusin"?(Nd(),Go=s,qo=u,Go.attachEvent("onpropertychange",Fd)):n==="focusout"&&Nd()}function Mu(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return rs(qo)}function Rh(n,s){if(n==="click")return rs(s)}function Lh(n,s){if(n==="input"||n==="change")return rs(s)}function Vd(n,s){return n===s&&(n!==0||1/n===1/s)||n!==n&&s!==s}var da=typeof Object.is=="function"?Object.is:Vd;function Ha(n,s){if(da(n,s))return!0;if(typeof n!="object"||n===null||typeof s!="object"||s===null)return!1;var u=Object.keys(n),_=Object.keys(s);if(u.length!==_.length)return!1;for(_=0;_<u.length;_++){var b=u[_];if(!An.call(s,b)||!da(n[b],s[b]))return!1}return!0}function Cu(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function Au(n,s){var u=Cu(n);n=0;for(var _;u;){if(u.nodeType===3){if(_=n+u.textContent.length,n<=s&&_>=s)return{node:u,offset:s-n};n=_}t:{for(;u;){if(u.nextSibling){u=u.nextSibling;break t}u=u.parentNode}u=void 0}u=Cu(u)}}function Du(n,s){return n&&s?n===s?!0:n&&n.nodeType===3?!1:s&&s.nodeType===3?Du(n,s.parentNode):"contains"in n?n.contains(s):n.compareDocumentPosition?!!(n.compareDocumentPosition(s)&16):!1:!1}function zu(n){n=n!=null&&n.ownerDocument!=null&&n.ownerDocument.defaultView!=null?n.ownerDocument.defaultView:window;for(var s=fc(n.document);s instanceof n.HTMLIFrameElement;){try{var u=typeof s.contentWindow.location.href=="string"}catch{u=!1}if(u)n=s.contentWindow;else break;s=fc(n.document)}return s}function wc(n){var s=n&&n.nodeName&&n.nodeName.toLowerCase();return s&&(s==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||s==="textarea"||n.contentEditable==="true")}var Ho=Tn&&"documentMode"in document&&11>=document.documentMode,no=null,kh=null,ui=null,Oh=!1;function Ud(n,s,u){var _=u.window===u?u.document:u.nodeType===9?u:u.ownerDocument;Oh||no==null||no!==fc(_)||(_=no,"selectionStart"in _&&wc(_)?_={start:_.selectionStart,end:_.selectionEnd}:(_=(_.ownerDocument&&_.ownerDocument.defaultView||window).getSelection(),_={anchorNode:_.anchorNode,anchorOffset:_.anchorOffset,focusNode:_.focusNode,focusOffset:_.focusOffset}),ui&&Ha(ui,_)||(ui=_,_=pd(kh,"onSelect"),0<_.length&&(s=new Ze("onSelect","select",null,s,u),n.push({event:s,listeners:_}),s.target=no)))}function ao(n,s){var u={};return u[n.toLowerCase()]=s.toLowerCase(),u["Webkit"+n]="webkit"+s,u["Moz"+n]="moz"+s,u}var Rl={animationend:ao("Animation","AnimationEnd"),animationiteration:ao("Animation","AnimationIteration"),animationstart:ao("Animation","AnimationStart"),transitionrun:ao("Transition","TransitionRun"),transitionstart:ao("Transition","TransitionStart"),transitioncancel:ao("Transition","TransitionCancel"),transitionend:ao("Transition","TransitionEnd")},Pu={},Tc={};Tn&&(Tc=document.createElement("div").style,"AnimationEvent"in window||(delete Rl.animationend.animation,delete Rl.animationiteration.animation,delete Rl.animationstart.animation),"TransitionEvent"in window||delete Rl.transitionend.transition);function ss(n){if(Pu[n])return Pu[n];if(!Rl[n])return n;var s=Rl[n],u;for(u in s)if(s.hasOwnProperty(u)&&u in Tc)return Pu[n]=s[u];return n}var Sc=ss("animationend"),Iu=ss("animationiteration"),ro=ss("animationstart"),Ec=ss("transitionrun"),Ll=ss("transitionstart"),gr=ss("transitioncancel"),Bh=ss("transitionend"),Nh=new Map,Mc="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Mc.push("scrollEnd");function fa(n,s){Nh.set(n,s),ko(s,[n])}var $o=typeof reportError=="function"?reportError:function(n){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var s=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof n=="object"&&n!==null&&typeof n.message=="string"?String(n.message):String(n),error:n});if(!window.dispatchEvent(s))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",n);return}console.error(n)},La=[],os=0,kl=0;function Cc(){for(var n=os,s=kl=os=0;s<n;){var u=La[s];La[s++]=null;var _=La[s];La[s++]=null;var b=La[s];La[s++]=null;var E=La[s];if(La[s++]=null,_!==null&&b!==null){var O=_.pending;O===null?b.next=b:(b.next=O.next,O.next=b),_.pending=b}E!==0&&Ru(u,b,E)}}function zs(n,s,u,_){La[os++]=n,La[os++]=s,La[os++]=u,La[os++]=_,kl|=_,n.lanes|=_,n=n.alternate,n!==null&&(n.lanes|=_)}function so(n,s,u,_){return zs(n,s,u,_),Ye(n)}function oo(n,s){return zs(n,null,null,s),Ye(n)}function Ru(n,s,u){n.lanes|=u;var _=n.alternate;_!==null&&(_.lanes|=u);for(var b=!1,E=n.return;E!==null;)E.childLanes|=u,_=E.alternate,_!==null&&(_.childLanes|=u),E.tag===22&&(n=E.stateNode,n===null||n._visibility&1||(b=!0)),n=E,E=E.return;return n.tag===3?(E=n.stateNode,b&&s!==null&&(b=31-F(u),n=E.hiddenUpdates,_=n[b],_===null?n[b]=[s]:_.push(s),s.lane=u|536870912),E):null}function Ye(n){if(50<fl)throw fl=0,ap=null,Error(q(185));for(var s=n.return;s!==null;)n=s,s=n.return;return n.tag===3?n.stateNode:null}var Ps={};function Ff(n,s,u,_){this.tag=n,this.key=u,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=s,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=_,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function $a(n,s,u,_){return new Ff(n,s,u,_)}function Xo(n){return n=n.prototype,!(!n||!n.isReactComponent)}function kr(n,s){var u=n.alternate;return u===null?(u=$a(n.tag,s,n.key,n.mode),u.elementType=n.elementType,u.type=n.type,u.stateNode=n.stateNode,u.alternate=n,n.alternate=u):(u.pendingProps=s,u.type=n.type,u.flags=0,u.subtreeFlags=0,u.deletions=null),u.flags=n.flags&65011712,u.childLanes=n.childLanes,u.lanes=n.lanes,u.child=n.child,u.memoizedProps=n.memoizedProps,u.memoizedState=n.memoizedState,u.updateQueue=n.updateQueue,s=n.dependencies,u.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext},u.sibling=n.sibling,u.index=n.index,u.ref=n.ref,u.refCleanup=n.refCleanup,u}function Gd(n,s){n.flags&=65011714;var u=n.alternate;return u===null?(n.childLanes=0,n.lanes=s,n.child=null,n.subtreeFlags=0,n.memoizedProps=null,n.memoizedState=null,n.updateQueue=null,n.dependencies=null,n.stateNode=null):(n.childLanes=u.childLanes,n.lanes=u.lanes,n.child=u.child,n.subtreeFlags=0,n.deletions=null,n.memoizedProps=u.memoizedProps,n.memoizedState=u.memoizedState,n.updateQueue=u.updateQueue,n.type=u.type,s=u.dependencies,n.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext}),n}function Ac(n,s,u,_,b,E){var O=0;if(_=n,typeof n=="function")Xo(n)&&(O=1);else if(typeof n=="string")O=Ip(n,u,Te.current)?26:n==="html"||n==="head"||n==="body"?27:5;else t:switch(n){case $e:return n=$a(31,u,s,b),n.elementType=$e,n.lanes=E,n;case Kt:return Yo(u.children,b,E,s);case gt:O=8,b|=24;break;case Yt:return n=$a(12,u,s,b|2),n.elementType=Yt,n.lanes=E,n;case ue:return n=$a(13,u,s,b),n.elementType=ue,n.lanes=E,n;case we:return n=$a(19,u,s,b),n.elementType=we,n.lanes=E,n;default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case At:O=10;break t;case Pt:O=9;break t;case ce:O=11;break t;case pe:O=14;break t;case pi:O=16,_=null;break t}O=29,u=Error(q(130,n===null?"null":typeof n,"")),_=null}return s=$a(O,u,s,b),s.elementType=n,s.type=_,s.lanes=E,s}function Yo(n,s,u,_){return n=$a(7,n,_,s),n.lanes=u,n}function Ol(n,s,u){return n=$a(6,n,null,s),n.lanes=u,n}function Dc(n){var s=$a(18,null,null,0);return s.stateNode=n,s}function Bl(n,s,u){return s=$a(4,n.children!==null?n.children:[],n.key,s),s.lanes=u,s.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},s}var lo=new WeakMap;function ka(n,s){if(typeof n=="object"&&n!==null){var u=lo.get(n);return u!==void 0?u:(s={value:n,source:s,stack:Cn(s)},lo.set(n,s),s)}return{value:n,source:s,stack:Cn(s)}}var Wo=[],Is=0,Ko=null,co=0,pa=[],Oa=0,Rs=null,Xa=1,ls="";function Or(n,s){Wo[Is++]=co,Wo[Is++]=Ko,Ko=n,co=s}function Nl(n,s,u){pa[Oa++]=Xa,pa[Oa++]=ls,pa[Oa++]=Rs,Rs=n;var _=Xa;n=ls;var b=32-F(_)-1;_&=~(1<<b),u+=1;var E=32-F(s)+b;if(30<E){var O=b-b%5;E=(_&(1<<O)-1).toString(32),_>>=O,b-=O,Xa=1<<32-F(s)+b|u<<b|_,ls=E+n}else Xa=1<<E|u<<b|_,ls=n}function Fl(n){n.return!==null&&(Or(n,1),Nl(n,1,0))}function Lu(n){for(;n===Ko;)Ko=Wo[--Is],Wo[Is]=null,co=Wo[--Is],Wo[Is]=null;for(;n===Rs;)Rs=pa[--Oa],pa[Oa]=null,ls=pa[--Oa],pa[Oa]=null,Xa=pa[--Oa],pa[Oa]=null}function Fh(n,s){pa[Oa++]=Xa,pa[Oa++]=ls,pa[Oa++]=Rs,Xa=s.id,ls=s.overflow,Rs=n}var Fn=null,Hi=null,hi=!1,cs=null,gi=!1,Br=Error(q(519));function In(n){var s=Error(q(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw Ls(ka(s,n)),Br}function jl(n){var s=n.stateNode,u=n.type,_=n.memoizedProps;switch(s[Qt]=n,s[me]=_,u){case"dialog":di("cancel",s),di("close",s);break;case"iframe":case"object":case"embed":di("load",s);break;case"video":case"audio":for(u=0;u<dd.length;u++)di(dd[u],s);break;case"source":di("error",s);break;case"img":case"image":case"link":di("error",s),di("load",s);break;case"details":di("toggle",s);break;case"input":di("invalid",s),_u(s,_.value,_.defaultValue,_.checked,_.defaultChecked,_.type,_.name,!0);break;case"select":di("invalid",s);break;case"textarea":di("invalid",s),mc(s,_.value,_.defaultValue,_.children)}u=_.children,typeof u!="string"&&typeof u!="number"&&typeof u!="bigint"||s.textContent===""+u||_.suppressHydrationWarning===!0||iu(s.textContent,u)?(_.popover!=null&&(di("beforetoggle",s),di("toggle",s)),_.onScroll!=null&&di("scroll",s),_.onScrollEnd!=null&&di("scrollend",s),_.onClick!=null&&(s.onclick=Xe),s=!0):s=!1,s||In(n,!0)}function uo(n){for(Fn=n.return;Fn;)switch(Fn.tag){case 5:case 31:case 13:gi=!1;return;case 27:case 3:gi=!0;return;default:Fn=Fn.return}}function Qo(n){if(n!==Fn)return!1;if(!hi)return uo(n),hi=!0,!1;var s=n.tag,u;if((u=s!==3&&s!==27)&&((u=s===5)&&(u=n.type,u=!(u!=="form"&&u!=="button")||_d(n.type,n.memoizedProps)),u=!u),u&&Hi&&In(n),uo(n),s===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(q(317));Hi=Rm(n)}else if(s===31){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(q(317));Hi=Rm(n)}else s===27?(s=Hi,Jn(n.type)?(n=rc,rc=null,Hi=n):Hi=s):Hi=Fn?Ca(n.stateNode.nextSibling):null;return!0}function _r(){Hi=Fn=null,hi=!1}function zc(){var n=cs;return n!==null&&(ur===null?ur=n:ur.push.apply(ur,n),cs=null),n}function Ls(n){cs===null?cs=[n]:cs.push(n)}var Pc=bt(null),ho=null,Nr=null;function us(n,s,u){_e(Pc,s._currentValue),s._currentValue=u}function rr(n){n._currentValue=Pc.current,Ht(Pc)}function ku(n,s,u){for(;n!==null;){var _=n.alternate;if((n.childLanes&s)!==s?(n.childLanes|=s,_!==null&&(_.childLanes|=s)):_!==null&&(_.childLanes&s)!==s&&(_.childLanes|=s),n===u)break;n=n.return}}function hs(n,s,u,_){var b=n.child;for(b!==null&&(b.return=n);b!==null;){var E=b.dependencies;if(E!==null){var O=b.child;E=E.firstContext;t:for(;E!==null;){var X=E;E=b;for(var _t=0;_t<s.length;_t++)if(X.context===s[_t]){E.lanes|=u,X=E.alternate,X!==null&&(X.lanes|=u),ku(E.return,u,n),_||(O=null);break t}E=X.next}}else if(b.tag===18){if(O=b.return,O===null)throw Error(q(341));O.lanes|=u,E=O.alternate,E!==null&&(E.lanes|=u),ku(O,u,n),O=null}else O=b.child;if(O!==null)O.return=b;else for(O=b;O!==null;){if(O===n){O=null;break}if(b=O.sibling,b!==null){b.return=O.return,O=b;break}O=O.return}b=O}}function fo(n,s,u,_){n=null;for(var b=s,E=!1;b!==null;){if(!E){if((b.flags&524288)!==0)E=!0;else if((b.flags&262144)!==0)break}if(b.tag===10){var O=b.alternate;if(O===null)throw Error(q(387));if(O=O.memoizedProps,O!==null){var X=b.type;da(b.pendingProps.value,O.value)||(n!==null?n.push(X):n=[X])}}else if(b===Ue.current){if(O=b.alternate,O===null)throw Error(q(387));O.memoizedState.memoizedState!==b.memoizedState.memoizedState&&(n!==null?n.push(ou):n=[ou])}b=b.return}n!==null&&hs(s,n,u,_),s.flags|=262144}function Ic(n){for(n=n.firstContext;n!==null;){if(!da(n.context._currentValue,n.memoizedValue))return!0;n=n.next}return!1}function ks(n){ho=n,Nr=null,n=n.dependencies,n!==null&&(n.firstContext=null)}function $n(n){return jh(ho,n)}function Os(n,s){return ho===null&&ks(n),jh(n,s)}function jh(n,s){var u=s._currentValue;if(s={context:s,memoizedValue:u,next:null},Nr===null){if(n===null)throw Error(q(308));Nr=s,n.dependencies={lanes:0,firstContext:s},n.flags|=524288}else Nr=Nr.next=s;return u}var qd=typeof AbortController<"u"?AbortController:function(){var n=[],s=this.signal={aborted:!1,addEventListener:function(u,_){n.push(_)}};this.abort=function(){s.aborted=!0,n.forEach(function(u){return u()})}},Zd=B.unstable_scheduleCallback,Ou=B.unstable_NormalPriority,Rn={$$typeof:At,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Ya(){return{controller:new qd,data:new Map,refCount:0}}function Xn(n){n.refCount--,n.refCount===0&&Zd(Ou,function(){n.controller.abort()})}var ds=null,en=0,fs=0,yr=null;function jf(n,s){if(ds===null){var u=ds=[];en=0,fs=ud(),yr={status:"pending",value:void 0,then:function(_){u.push(_)}}}return en++,s.then(Hd,Hd),s}function Hd(){if(--en===0&&ds!==null){yr!==null&&(yr.status="fulfilled");var n=ds;ds=null,fs=0,yr=null;for(var s=0;s<n.length;s++)(0,n[s])()}}function Rc(n,s){var u=[],_={status:"pending",value:null,reason:null,then:function(b){u.push(b)}};return n.then(function(){_.status="fulfilled",_.value=s;for(var b=0;b<u.length;b++)(0,u[b])(s)},function(b){for(_.status="rejected",_.reason=b,b=0;b<u.length;b++)(0,u[b])(void 0)}),_}var Vh=$t.S;$t.S=function(n,s){_m=qi(),typeof s=="object"&&s!==null&&typeof s.then=="function"&&jf(n,s),Vh!==null&&Vh(n,s)};var ps=bt(null);function Jo(){var n=ps.current;return n!==null?n:Yi.pooledCache}function Wa(n,s){s===null?_e(ps,ps.current):_e(ps,s.pool)}function ge(){var n=Jo();return n===null?null:{parent:Rn._currentValue,pool:n}}var Fr=Error(q(460)),Lc=Error(q(474)),kc=Error(q(542)),po={then:function(){}};function ms(n){return n=n.status,n==="fulfilled"||n==="rejected"}function Bu(n,s,u){switch(u=n[u],u===void 0?n.push(s):u!==s&&(s.then(Xe,Xe),s=u),s.status){case"fulfilled":return s.value;case"rejected":throw n=s.reason,Vl(n),n;default:if(typeof s.status=="string")s.then(Xe,Xe);else{if(n=Yi,n!==null&&100<n.shellSuspendCounter)throw Error(q(482));n=s,n.status="pending",n.then(function(_){if(s.status==="pending"){var b=s;b.status="fulfilled",b.value=_}},function(_){if(s.status==="pending"){var b=s;b.status="rejected",b.reason=_}})}switch(s.status){case"fulfilled":return s.value;case"rejected":throw n=s.reason,Vl(n),n}throw vr=s,Fr}}function tl(n){try{var s=n._init;return s(n._payload)}catch(u){throw u!==null&&typeof u=="object"&&typeof u.then=="function"?(vr=u,Fr):u}}var vr=null;function Uh(){if(vr===null)throw Error(q(459));var n=vr;return vr=null,n}function Vl(n){if(n===Fr||n===kc)throw Error(q(483))}var Bs=null,el=0;function Oc(n){var s=el;return el+=1,Bs===null&&(Bs=[]),Bu(Bs,n,s)}function Ul(n,s){s=s.props.ref,n.ref=s!==void 0?s:null}function Gl(n,s){throw s.$$typeof===se?Error(q(525)):(n=Object.prototype.toString.call(s),Error(q(31,n==="[object Object]"?"object with keys {"+Object.keys(s).join(", ")+"}":n)))}function Nu(n){function s(Ct,St){if(n){var Ot=Ct.deletions;Ot===null?(Ct.deletions=[St],Ct.flags|=16):Ot.push(St)}}function u(Ct,St){if(!n)return null;for(;St!==null;)s(Ct,St),St=St.sibling;return null}function _(Ct){for(var St=new Map;Ct!==null;)Ct.key!==null?St.set(Ct.key,Ct):St.set(Ct.index,Ct),Ct=Ct.sibling;return St}function b(Ct,St){return Ct=kr(Ct,St),Ct.index=0,Ct.sibling=null,Ct}function E(Ct,St,Ot){return Ct.index=Ot,n?(Ot=Ct.alternate,Ot!==null?(Ot=Ot.index,Ot<St?(Ct.flags|=67108866,St):Ot):(Ct.flags|=67108866,St)):(Ct.flags|=1048576,St)}function O(Ct){return n&&Ct.alternate===null&&(Ct.flags|=67108866),Ct}function X(Ct,St,Ot,te){return St===null||St.tag!==6?(St=Ol(Ot,Ct.mode,te),St.return=Ct,St):(St=b(St,Ot),St.return=Ct,St)}function _t(Ct,St,Ot,te){var Oe=Ot.type;return Oe===Kt?Wt(Ct,St,Ot.props.children,te,Ot.key):St!==null&&(St.elementType===Oe||typeof Oe=="object"&&Oe!==null&&Oe.$$typeof===pi&&tl(Oe)===St.type)?(St=b(St,Ot.props),Ul(St,Ot),St.return=Ct,St):(St=Ac(Ot.type,Ot.key,Ot.props,null,Ct.mode,te),Ul(St,Ot),St.return=Ct,St)}function Ft(Ct,St,Ot,te){return St===null||St.tag!==4||St.stateNode.containerInfo!==Ot.containerInfo||St.stateNode.implementation!==Ot.implementation?(St=Bl(Ot,Ct.mode,te),St.return=Ct,St):(St=b(St,Ot.children||[]),St.return=Ct,St)}function Wt(Ct,St,Ot,te,Oe){return St===null||St.tag!==7?(St=Yo(Ot,Ct.mode,te,Oe),St.return=Ct,St):(St=b(St,Ot),St.return=Ct,St)}function ie(Ct,St,Ot){if(typeof St=="string"&&St!==""||typeof St=="number"||typeof St=="bigint")return St=Ol(""+St,Ct.mode,Ot),St.return=Ct,St;if(typeof St=="object"&&St!==null){switch(St.$$typeof){case he:return Ot=Ac(St.type,St.key,St.props,null,Ct.mode,Ot),Ul(Ot,St),Ot.return=Ct,Ot;case xe:return St=Bl(St,Ct.mode,Ot),St.return=Ct,St;case pi:return St=tl(St),ie(Ct,St,Ot)}if(Zn(St)||on(St))return St=Yo(St,Ct.mode,Ot,null),St.return=Ct,St;if(typeof St.then=="function")return ie(Ct,Oc(St),Ot);if(St.$$typeof===At)return ie(Ct,Os(Ct,St),Ot);Gl(Ct,St)}return null}function Vt(Ct,St,Ot,te){var Oe=St!==null?St.key:null;if(typeof Ot=="string"&&Ot!==""||typeof Ot=="number"||typeof Ot=="bigint")return Oe!==null?null:X(Ct,St,""+Ot,te);if(typeof Ot=="object"&&Ot!==null){switch(Ot.$$typeof){case he:return Ot.key===Oe?_t(Ct,St,Ot,te):null;case xe:return Ot.key===Oe?Ft(Ct,St,Ot,te):null;case pi:return Ot=tl(Ot),Vt(Ct,St,Ot,te)}if(Zn(Ot)||on(Ot))return Oe!==null?null:Wt(Ct,St,Ot,te,null);if(typeof Ot.then=="function")return Vt(Ct,St,Oc(Ot),te);if(Ot.$$typeof===At)return Vt(Ct,St,Os(Ct,Ot),te);Gl(Ct,Ot)}return null}function Gt(Ct,St,Ot,te,Oe){if(typeof te=="string"&&te!==""||typeof te=="number"||typeof te=="bigint")return Ct=Ct.get(Ot)||null,X(St,Ct,""+te,Oe);if(typeof te=="object"&&te!==null){switch(te.$$typeof){case he:return Ct=Ct.get(te.key===null?Ot:te.key)||null,_t(St,Ct,te,Oe);case xe:return Ct=Ct.get(te.key===null?Ot:te.key)||null,Ft(St,Ct,te,Oe);case pi:return te=tl(te),Gt(Ct,St,Ot,te,Oe)}if(Zn(te)||on(te))return Ct=Ct.get(Ot)||null,Wt(St,Ct,te,Oe,null);if(typeof te.then=="function")return Gt(Ct,St,Ot,Oc(te),Oe);if(te.$$typeof===At)return Gt(Ct,St,Ot,Os(St,te),Oe);Gl(St,te)}return null}function Me(Ct,St,Ot,te){for(var Oe=null,wi=null,De=St,ei=St=0,fi=null;De!==null&&ei<Ot.length;ei++){De.index>ei?(fi=De,De=null):fi=De.sibling;var Ei=Vt(Ct,De,Ot[ei],te);if(Ei===null){De===null&&(De=fi);break}n&&De&&Ei.alternate===null&&s(Ct,De),St=E(Ei,St,ei),wi===null?Oe=Ei:wi.sibling=Ei,wi=Ei,De=fi}if(ei===Ot.length)return u(Ct,De),hi&&Or(Ct,ei),Oe;if(De===null){for(;ei<Ot.length;ei++)De=ie(Ct,Ot[ei],te),De!==null&&(St=E(De,St,ei),wi===null?Oe=De:wi.sibling=De,wi=De);return hi&&Or(Ct,ei),Oe}for(De=_(De);ei<Ot.length;ei++)fi=Gt(De,Ct,ei,Ot[ei],te),fi!==null&&(n&&fi.alternate!==null&&De.delete(fi.key===null?ei:fi.key),St=E(fi,St,ei),wi===null?Oe=fi:wi.sibling=fi,wi=fi);return n&&De.forEach(function(uc){return s(Ct,uc)}),hi&&Or(Ct,ei),Oe}function Ve(Ct,St,Ot,te){if(Ot==null)throw Error(q(151));for(var Oe=null,wi=null,De=St,ei=St=0,fi=null,Ei=Ot.next();De!==null&&!Ei.done;ei++,Ei=Ot.next()){De.index>ei?(fi=De,De=null):fi=De.sibling;var uc=Vt(Ct,De,Ei.value,te);if(uc===null){De===null&&(De=fi);break}n&&De&&uc.alternate===null&&s(Ct,De),St=E(uc,St,ei),wi===null?Oe=uc:wi.sibling=uc,wi=uc,De=fi}if(Ei.done)return u(Ct,De),hi&&Or(Ct,ei),Oe;if(De===null){for(;!Ei.done;ei++,Ei=Ot.next())Ei=ie(Ct,Ei.value,te),Ei!==null&&(St=E(Ei,St,ei),wi===null?Oe=Ei:wi.sibling=Ei,wi=Ei);return hi&&Or(Ct,ei),Oe}for(De=_(De);!Ei.done;ei++,Ei=Ot.next())Ei=Gt(De,Ct,ei,Ei.value,te),Ei!==null&&(n&&Ei.alternate!==null&&De.delete(Ei.key===null?ei:Ei.key),St=E(Ei,St,ei),wi===null?Oe=Ei:wi.sibling=Ei,wi=Ei);return n&&De.forEach(function(a){return s(Ct,a)}),hi&&Or(Ct,ei),Oe}function Gi(Ct,St,Ot,te){if(typeof Ot=="object"&&Ot!==null&&Ot.type===Kt&&Ot.key===null&&(Ot=Ot.props.children),typeof Ot=="object"&&Ot!==null){switch(Ot.$$typeof){case he:t:{for(var Oe=Ot.key;St!==null;){if(St.key===Oe){if(Oe=Ot.type,Oe===Kt){if(St.tag===7){u(Ct,St.sibling),te=b(St,Ot.props.children),te.return=Ct,Ct=te;break t}}else if(St.elementType===Oe||typeof Oe=="object"&&Oe!==null&&Oe.$$typeof===pi&&tl(Oe)===St.type){u(Ct,St.sibling),te=b(St,Ot.props),Ul(te,Ot),te.return=Ct,Ct=te;break t}u(Ct,St);break}else s(Ct,St);St=St.sibling}Ot.type===Kt?(te=Yo(Ot.props.children,Ct.mode,te,Ot.key),te.return=Ct,Ct=te):(te=Ac(Ot.type,Ot.key,Ot.props,null,Ct.mode,te),Ul(te,Ot),te.return=Ct,Ct=te)}return O(Ct);case xe:t:{for(Oe=Ot.key;St!==null;){if(St.key===Oe)if(St.tag===4&&St.stateNode.containerInfo===Ot.containerInfo&&St.stateNode.implementation===Ot.implementation){u(Ct,St.sibling),te=b(St,Ot.children||[]),te.return=Ct,Ct=te;break t}else{u(Ct,St);break}else s(Ct,St);St=St.sibling}te=Bl(Ot,Ct.mode,te),te.return=Ct,Ct=te}return O(Ct);case pi:return Ot=tl(Ot),Gi(Ct,St,Ot,te)}if(Zn(Ot))return Me(Ct,St,Ot,te);if(on(Ot)){if(Oe=on(Ot),typeof Oe!="function")throw Error(q(150));return Ot=Oe.call(Ot),Ve(Ct,St,Ot,te)}if(typeof Ot.then=="function")return Gi(Ct,St,Oc(Ot),te);if(Ot.$$typeof===At)return Gi(Ct,St,Os(Ct,Ot),te);Gl(Ct,Ot)}return typeof Ot=="string"&&Ot!==""||typeof Ot=="number"||typeof Ot=="bigint"?(Ot=""+Ot,St!==null&&St.tag===6?(u(Ct,St.sibling),te=b(St,Ot),te.return=Ct,Ct=te):(u(Ct,St),te=Ol(Ot,Ct.mode,te),te.return=Ct,Ct=te),O(Ct)):u(Ct,St)}return function(Ct,St,Ot,te){try{el=0;var Oe=Gi(Ct,St,Ot,te);return Bs=null,Oe}catch(De){if(De===Fr||De===kc)throw De;var wi=$a(29,De,null,Ct.mode);return wi.lanes=te,wi.return=Ct,wi}finally{}}}var Ns=Nu(!0),$d=Nu(!1),Fs=!1;function gs(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Mi(n,s){n=n.updateQueue,s.updateQueue===n&&(s.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,callbacks:null})}function mo(n){return{lane:n,tag:0,payload:null,callback:null,next:null}}function xr(n,s,u){var _=n.updateQueue;if(_===null)return null;if(_=_.shared,(bi&2)!==0){var b=_.pending;return b===null?s.next=s:(s.next=b.next,b.next=s),_.pending=s,s=Ye(n),Ru(n,null,u),s}return zs(n,_,s,u),Ye(n)}function js(n,s,u){if(s=s.updateQueue,s!==null&&(s=s.shared,(u&4194048)!==0)){var _=s.lanes;_&=n.pendingLanes,u|=_,s.lanes=u,yi(n,u)}}function Bc(n,s){var u=n.updateQueue,_=n.alternate;if(_!==null&&(_=_.updateQueue,u===_)){var b=null,E=null;if(u=u.firstBaseUpdate,u!==null){do{var O={lane:u.lane,tag:u.tag,payload:u.payload,callback:null,next:null};E===null?b=E=O:E=E.next=O,u=u.next}while(u!==null);E===null?b=E=s:E=E.next=s}else b=E=s;u={baseState:_.baseState,firstBaseUpdate:b,lastBaseUpdate:E,shared:_.shared,callbacks:_.callbacks},n.updateQueue=u;return}n=u.lastBaseUpdate,n===null?u.firstBaseUpdate=s:n.next=s,u.lastBaseUpdate=s}var Fu=!1;function il(){if(Fu){var n=yr;if(n!==null)throw n}}function nl(n,s,u,_){Fu=!1;var b=n.updateQueue;Fs=!1;var E=b.firstBaseUpdate,O=b.lastBaseUpdate,X=b.shared.pending;if(X!==null){b.shared.pending=null;var _t=X,Ft=_t.next;_t.next=null,O===null?E=Ft:O.next=Ft,O=_t;var Wt=n.alternate;Wt!==null&&(Wt=Wt.updateQueue,X=Wt.lastBaseUpdate,X!==O&&(X===null?Wt.firstBaseUpdate=Ft:X.next=Ft,Wt.lastBaseUpdate=_t))}if(E!==null){var ie=b.baseState;O=0,Wt=Ft=_t=null,X=E;do{var Vt=X.lane&-536870913,Gt=Vt!==X.lane;if(Gt?(xi&Vt)===Vt:(_&Vt)===Vt){Vt!==0&&Vt===fs&&(Fu=!0),Wt!==null&&(Wt=Wt.next={lane:0,tag:X.tag,payload:X.payload,callback:null,next:null});t:{var Me=n,Ve=X;Vt=s;var Gi=u;switch(Ve.tag){case 1:if(Me=Ve.payload,typeof Me=="function"){ie=Me.call(Gi,ie,Vt);break t}ie=Me;break t;case 3:Me.flags=Me.flags&-65537|128;case 0:if(Me=Ve.payload,Vt=typeof Me=="function"?Me.call(Gi,ie,Vt):Me,Vt==null)break t;ie=Dt({},ie,Vt);break t;case 2:Fs=!0}}Vt=X.callback,Vt!==null&&(n.flags|=64,Gt&&(n.flags|=8192),Gt=b.callbacks,Gt===null?b.callbacks=[Vt]:Gt.push(Vt))}else Gt={lane:Vt,tag:X.tag,payload:X.payload,callback:X.callback,next:null},Wt===null?(Ft=Wt=Gt,_t=ie):Wt=Wt.next=Gt,O|=Vt;if(X=X.next,X===null){if(X=b.shared.pending,X===null)break;Gt=X,X=Gt.next,Gt.next=null,b.lastBaseUpdate=Gt,b.shared.pending=null}}while(!0);Wt===null&&(_t=ie),b.baseState=_t,b.firstBaseUpdate=Ft,b.lastBaseUpdate=Wt,E===null&&(b.shared.lanes=0),ec|=O,n.lanes=O,n.memoizedState=ie}}function Gh(n,s){if(typeof n!="function")throw Error(q(191,n));n.call(s)}function br(n,s){var u=n.callbacks;if(u!==null)for(n.callbacks=null,n=0;n<u.length;n++)Gh(u[n],s)}var wr=bt(null),Se=bt(0);function Le(n,s){n=So,_e(Se,n),_e(wr,s),So=n|s.baseLanes}function al(){_e(Se,So),_e(wr,wr.current)}function ju(){So=Se.current,Ht(wr),Ht(Se)}var ma=bt(null),$i=null;function Yn(n){var s=n.alternate;_e(nn,nn.current&1),_e(ma,n),$i===null&&(s===null||wr.current!==null||s.memoizedState!==null)&&($i=n)}function Vu(n){_e(nn,nn.current),_e(ma,n),$i===null&&($i=n)}function Xd(n){n.tag===22?(_e(nn,nn.current),_e(ma,n),$i===null&&($i=n)):go()}function go(){_e(nn,nn.current),_e(ma,ma.current)}function sr(n){Ht(ma),$i===n&&($i=null),Ht(nn)}var nn=bt(0);function Ti(n){for(var s=n;s!==null;){if(s.tag===13){var u=s.memoizedState;if(u!==null&&(u=u.dehydrated,u===null||oh(u)||Ep(u)))return s}else if(s.tag===19&&(s.memoizedProps.revealOrder==="forwards"||s.memoizedProps.revealOrder==="backwards"||s.memoizedProps.revealOrder==="unstable_legacy-backwards"||s.memoizedProps.revealOrder==="together")){if((s.flags&128)!==0)return s}else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===n)break;for(;s.sibling===null;){if(s.return===null||s.return===n)return null;s=s.return}s.sibling.return=s.return,s=s.sibling}return null}var zi=0,We=null,Si=null,ln=null,ql=!1,_o=!1,Ba=!1,Vs=0,Us=0,Gs=null,Nc=0;function cn(){throw Error(q(321))}function yo(n,s){if(s===null)return!1;for(var u=0;u<s.length&&u<n.length;u++)if(!da(n[u],s[u]))return!1;return!0}function qs(n,s,u,_,b,E){return zi=E,We=s,s.memoizedState=null,s.updateQueue=null,s.lanes=0,$t.H=n===null||n.memoizedState===null?Zh:Hs,Ba=!1,E=u(_,b),Ba=!1,_o&&(E=Fc(s,u,_,b)),Uu(n),E}function Uu(n){$t.H=$l;var s=Si!==null&&Si.next!==null;if(zi=0,ln=Si=We=null,ql=!1,Us=0,Gs=null,s)throw Error(q(300));n===null||Wn||(n=n.dependencies,n!==null&&Ic(n)&&(Wn=!0))}function Fc(n,s,u,_){We=n;var b=0;do{if(_o&&(Gs=null),Us=0,_o=!1,25<=b)throw Error(q(301));if(b+=1,ln=Si=null,n.updateQueue!=null){var E=n.updateQueue;E.lastEffect=null,E.events=null,E.stores=null,E.memoCache!=null&&(E.memoCache.index=0)}$t.H=Yd,E=s(u,_)}while(_o);return E}function rl(){var n=$t.H,s=n.useState()[0];return s=typeof s.then=="function"?r(s):s,n=n.useState()[0],(Si!==null?Si.memoizedState:null)!==n&&(We.flags|=1024),s}function Zl(){var n=Vs!==0;return Vs=0,n}function jc(n,s,u){s.updateQueue=n.updateQueue,s.flags&=-2053,n.lanes&=~u}function Hl(n){if(ql){for(n=n.memoizedState;n!==null;){var s=n.queue;s!==null&&(s.pending=null),n=n.next}ql=!1}zi=0,ln=Si=We=null,_o=!1,Us=Vs=0,Gs=null}function sa(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ln===null?We.memoizedState=ln=n:ln=ln.next=n,ln}function m(){if(Si===null){var n=We.alternate;n=n!==null?n.memoizedState:null}else n=Si.next;var s=ln===null?We.memoizedState:ln.next;if(s!==null)ln=s,Si=n;else{if(n===null)throw We.alternate===null?Error(q(467)):Error(q(310));Si=n,n={memoizedState:Si.memoizedState,baseState:Si.baseState,baseQueue:Si.baseQueue,queue:Si.queue,next:null},ln===null?We.memoizedState=ln=n:ln=ln.next=n}return ln}function e(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function r(n){var s=Us;return Us+=1,Gs===null&&(Gs=[]),n=Bu(Gs,n,s),s=We,(ln===null?s.memoizedState:ln.next)===null&&(s=s.alternate,$t.H=s===null||s.memoizedState===null?Zh:Hs),n}function c(n){if(n!==null&&typeof n=="object"){if(typeof n.then=="function")return r(n);if(n.$$typeof===At)return $n(n)}throw Error(q(438,String(n)))}function f(n){var s=null,u=We.updateQueue;if(u!==null&&(s=u.memoCache),s==null){var _=We.alternate;_!==null&&(_=_.updateQueue,_!==null&&(_=_.memoCache,_!=null&&(s={data:_.data.map(function(b){return b.slice()}),index:0})))}if(s==null&&(s={data:[],index:0}),u===null&&(u=e(),We.updateQueue=u),u.memoCache=s,u=s.data[s.index],u===void 0)for(u=s.data[s.index]=Array(n),_=0;_<n;_++)u[_]=Ai;return s.index++,u}function g(n,s){return typeof s=="function"?s(n):s}function v(n){var s=m();return w(s,Si,n)}function w(n,s,u){var _=n.queue;if(_===null)throw Error(q(311));_.lastRenderedReducer=u;var b=n.baseQueue,E=_.pending;if(E!==null){if(b!==null){var O=b.next;b.next=E.next,E.next=O}s.baseQueue=b=E,_.pending=null}if(E=n.baseState,b===null)n.memoizedState=E;else{s=b.next;var X=O=null,_t=null,Ft=s,Wt=!1;do{var ie=Ft.lane&-536870913;if(ie!==Ft.lane?(xi&ie)===ie:(zi&ie)===ie){var Vt=Ft.revertLane;if(Vt===0)_t!==null&&(_t=_t.next={lane:0,revertLane:0,gesture:null,action:Ft.action,hasEagerState:Ft.hasEagerState,eagerState:Ft.eagerState,next:null}),ie===fs&&(Wt=!0);else if((zi&Vt)===Vt){Ft=Ft.next,Vt===fs&&(Wt=!0);continue}else ie={lane:0,revertLane:Ft.revertLane,gesture:null,action:Ft.action,hasEagerState:Ft.hasEagerState,eagerState:Ft.eagerState,next:null},_t===null?(X=_t=ie,O=E):_t=_t.next=ie,We.lanes|=Vt,ec|=Vt;ie=Ft.action,Ba&&u(E,ie),E=Ft.hasEagerState?Ft.eagerState:u(E,ie)}else Vt={lane:ie,revertLane:Ft.revertLane,gesture:Ft.gesture,action:Ft.action,hasEagerState:Ft.hasEagerState,eagerState:Ft.eagerState,next:null},_t===null?(X=_t=Vt,O=E):_t=_t.next=Vt,We.lanes|=ie,ec|=ie;Ft=Ft.next}while(Ft!==null&&Ft!==s);if(_t===null?O=E:_t.next=X,!da(E,n.memoizedState)&&(Wn=!0,Wt&&(u=yr,u!==null)))throw u;n.memoizedState=E,n.baseState=O,n.baseQueue=_t,_.lastRenderedState=E}return b===null&&(_.lanes=0),[n.memoizedState,_.dispatch]}function S(n){var s=m(),u=s.queue;if(u===null)throw Error(q(311));u.lastRenderedReducer=n;var _=u.dispatch,b=u.pending,E=s.memoizedState;if(b!==null){u.pending=null;var O=b=b.next;do E=n(E,O.action),O=O.next;while(O!==b);da(E,s.memoizedState)||(Wn=!0),s.memoizedState=E,s.baseQueue===null&&(s.baseState=E),u.lastRenderedState=E}return[E,_]}function C(n,s,u){var _=We,b=m(),E=hi;if(E){if(u===void 0)throw Error(q(407));u=u()}else u=s();var O=!da((Si||b).memoizedState,u);if(O&&(b.memoizedState=u,Wn=!0),b=b.queue,Fe(L.bind(null,_,b,n),[n]),b.getSnapshot!==s||O||ln!==null&&ln.memoizedState.tag&1){if(_.flags|=2048,ae(9,{destroy:void 0},k.bind(null,_,b,u,s),null),Yi===null)throw Error(q(349));E||(zi&127)!==0||D(_,s,u)}return u}function D(n,s,u){n.flags|=16384,n={getSnapshot:s,value:u},s=We.updateQueue,s===null?(s=e(),We.updateQueue=s,s.stores=[n]):(u=s.stores,u===null?s.stores=[n]:u.push(n))}function k(n,s,u,_){s.value=u,s.getSnapshot=_,j(s)&&Z(n)}function L(n,s,u){return u(function(){j(s)&&Z(n)})}function j(n){var s=n.getSnapshot;n=n.value;try{var u=s();return!da(n,u)}catch{return!0}}function Z(n){var s=oo(n,2);s!==null&&hr(s,n,2)}function W(n){var s=sa();if(typeof n=="function"){var u=n;if(n=u(),Ba){pt(!0);try{u()}finally{pt(!1)}}}return s.memoizedState=s.baseState=n,s.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:g,lastRenderedState:n},s}function Q(n,s,u,_){return n.baseState=u,w(n,Si,typeof _=="function"?_:g)}function it(n,s,u,_,b){if(Ci(n))throw Error(q(485));if(n=s.action,n!==null){var E={payload:b,action:n,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(O){E.listeners.push(O)}};$t.T!==null?u(!0):E.isTransition=!1,_(E),u=s.pending,u===null?(E.next=s.pending=E,st(s,E)):(E.next=u.next,s.pending=u.next=E)}}function st(n,s){var u=s.action,_=s.payload,b=n.state;if(s.isTransition){var E=$t.T,O={};$t.T=O;try{var X=u(b,_),_t=$t.S;_t!==null&&_t(O,X),ht(n,s,X)}catch(Ft){dt(n,s,Ft)}finally{E!==null&&O.types!==null&&(E.types=O.types),$t.T=E}}else try{E=u(b,_),ht(n,s,E)}catch(Ft){dt(n,s,Ft)}}function ht(n,s,u){u!==null&&typeof u=="object"&&typeof u.then=="function"?u.then(function(_){at(n,s,_)},function(_){return dt(n,s,_)}):at(n,s,u)}function at(n,s,u){s.status="fulfilled",s.value=u,mt(s),n.state=u,s=n.pending,s!==null&&(u=s.next,u===s?n.pending=null:(u=u.next,s.next=u,st(n,u)))}function dt(n,s,u){var _=n.pending;if(n.pending=null,_!==null){_=_.next;do s.status="rejected",s.reason=u,mt(s),s=s.next;while(s!==_)}n.action=null}function mt(n){n=n.listeners;for(var s=0;s<n.length;s++)(0,n[s])()}function ct(n,s){return s}function Tt(n,s){if(hi){var u=Yi.formState;if(u!==null){t:{var _=We;if(hi){if(Hi){e:{for(var b=Hi,E=gi;b.nodeType!==8;){if(!E){b=null;break e}if(b=Ca(b.nextSibling),b===null){b=null;break e}}E=b.data,b=E==="F!"||E==="F"?b:null}if(b){Hi=Ca(b.nextSibling),_=b.data==="F!";break t}}In(_)}_=!1}_&&(s=u[0])}}return u=sa(),u.memoizedState=u.baseState=s,_={pending:null,lanes:0,dispatch:null,lastRenderedReducer:ct,lastRenderedState:s},u.queue=_,u=un.bind(null,We,_),_.dispatch=u,_=W(!1),E=En.bind(null,We,!1,_.queue),_=sa(),b={state:s,dispatch:null,action:n,pending:null},_.queue=b,u=it.bind(null,We,b,E,u),b.dispatch=u,_.memoizedState=n,[s,u,!1]}function kt(n){var s=m();return zt(s,Si,n)}function zt(n,s,u){if(s=w(n,s,ct)[0],n=v(g)[0],typeof s=="object"&&s!==null&&typeof s.then=="function")try{var _=r(s)}catch(O){throw O===Fr?kc:O}else _=s;s=m();var b=s.queue,E=b.dispatch;return u!==s.memoizedState&&(We.flags|=2048,ae(9,{destroy:void 0},It.bind(null,b,u),null)),[_,E,n]}function It(n,s){n.action=s}function Rt(n){var s=m(),u=Si;if(u!==null)return zt(s,u,n);m(),s=s.memoizedState,u=m();var _=u.queue.dispatch;return u.memoizedState=n,[s,_,!1]}function ae(n,s,u,_){return n={tag:n,create:u,deps:_,inst:s,next:null},s=We.updateQueue,s===null&&(s=e(),We.updateQueue=s),u=s.lastEffect,u===null?s.lastEffect=n.next=n:(_=u.next,u.next=n,n.next=_,s.lastEffect=n),n}function re(){return m().memoizedState}function Xt(n,s,u,_){var b=sa();We.flags|=n,b.memoizedState=ae(1|s,{destroy:void 0},u,_===void 0?null:_)}function ve(n,s,u,_){var b=m();_=_===void 0?null:_;var E=b.memoizedState.inst;Si!==null&&_!==null&&yo(_,Si.memoizedState.deps)?b.memoizedState=ae(s,E,u,_):(We.flags|=n,b.memoizedState=ae(1|s,E,u,_))}function Ge(n,s){Xt(8390656,8,n,s)}function Fe(n,s){ve(2048,8,n,s)}function Xi(n){We.flags|=4;var s=We.updateQueue;if(s===null)s=e(),We.updateQueue=s,s.events=[n];else{var u=s.events;u===null?s.events=[n]:u.push(n)}}function Fi(n){var s=m().memoizedState;return Xi({ref:s,nextImpl:n}),function(){if((bi&2)!==0)throw Error(q(440));return s.impl.apply(void 0,arguments)}}function an(n,s){return ve(4,2,n,s)}function Ri(n,s){return ve(4,4,n,s)}function Ln(n,s){if(typeof s=="function"){n=n();var u=s(n);return function(){typeof u=="function"?u():s(null)}}if(s!=null)return n=n(),s.current=n,function(){s.current=null}}function Wi(n,s,u){u=u!=null?u.concat([n]):null,ve(4,4,Ln.bind(null,s,n),u)}function _n(){}function yn(n,s){var u=m();s=s===void 0?null:s;var _=u.memoizedState;return s!==null&&yo(s,_[1])?_[0]:(u.memoizedState=[n,s],n)}function Sn(n,s){var u=m();s=s===void 0?null:s;var _=u.memoizedState;if(s!==null&&yo(s,_[1]))return _[0];if(_=n(),Ba){pt(!0);try{n()}finally{pt(!1)}}return u.memoizedState=[_,s],_}function Ta(n,s,u){return u===void 0||(zi&1073741824)!==0&&(xi&261930)===0?n.memoizedState=s:(n.memoizedState=u,n=rp(),We.lanes|=n,ec|=n,u)}function _s(n,s,u,_){return da(u,s)?u:wr.current!==null?(n=Ta(n,u,_),da(n,s)||(Wn=!0),n):(zi&42)===0||(zi&1073741824)!==0&&(xi&261930)===0?(Wn=!0,n.memoizedState=u):(n=rp(),We.lanes|=n,ec|=n,s)}function jr(n,s,u,_,b){var E=de.p;de.p=E!==0&&8>E?E:8;var O=$t.T,X={};$t.T=X,En(n,!1,s,u);try{var _t=b(),Ft=$t.S;if(Ft!==null&&Ft(X,_t),_t!==null&&typeof _t=="object"&&typeof _t.then=="function"){var Wt=Rc(_t,_);ji(n,s,Wt,qr(n))}else ji(n,s,_,qr(n))}catch(ie){ji(n,s,{then:function(){},status:"rejected",reason:ie},qr())}finally{de.p=E,O!==null&&X.types!==null&&(O.types=X.types),$t.T=O}}function vo(){}function ys(n,s,u,_){if(n.tag!==5)throw Error(q(476));var b=xo(n).queue;jr(n,b,s,Ne,u===null?vo:function(){return or(n),u(_)})}function xo(n){var s=n.memoizedState;if(s!==null)return s;s={memoizedState:Ne,baseState:Ne,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:g,lastRenderedState:Ne},next:null};var u={};return s.next={memoizedState:u,baseState:u,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:g,lastRenderedState:u},next:null},n.memoizedState=s,n=n.alternate,n!==null&&(n.memoizedState=s),s}function or(n){var s=xo(n);s.next===null&&(s=n.alternate.memoizedState),ji(n,s.next.queue,{},qr())}function Vr(){return $n(ou)}function Ka(){return m().memoizedState}function vs(){return m().memoizedState}function sl(n){for(var s=n.return;s!==null;){switch(s.tag){case 24:case 3:var u=qr();n=mo(u);var _=xr(s,n,u);_!==null&&(hr(_,s,u),js(_,s,u)),s={cache:Ya()},n.payload=s;return}s=s.return}}function ol(n,s,u){var _=qr();u={lane:_,revertLane:0,gesture:null,action:u,hasEagerState:!1,eagerState:null,next:null},Ci(n)?Zs(s,u):(u=so(n,s,u,_),u!==null&&(hr(u,n,_),qh(u,s,_)))}function un(n,s,u){var _=qr();ji(n,s,u,_)}function ji(n,s,u,_){var b={lane:_,revertLane:0,gesture:null,action:u,hasEagerState:!1,eagerState:null,next:null};if(Ci(n))Zs(s,b);else{var E=n.alternate;if(n.lanes===0&&(E===null||E.lanes===0)&&(E=s.lastRenderedReducer,E!==null))try{var O=s.lastRenderedState,X=E(O,u);if(b.hasEagerState=!0,b.eagerState=X,da(X,O))return zs(n,s,b,0),Yi===null&&Cc(),!1}catch{}finally{}if(u=so(n,s,b,_),u!==null)return hr(u,n,_),qh(u,s,_),!0}return!1}function En(n,s,u,_){if(_={lane:2,revertLane:ud(),gesture:null,action:_,hasEagerState:!1,eagerState:null,next:null},Ci(n)){if(s)throw Error(q(479))}else s=so(n,u,_,2),s!==null&&hr(s,n,2)}function Ci(n){var s=n.alternate;return n===We||s!==null&&s===We}function Zs(n,s){_o=ql=!0;var u=n.pending;u===null?s.next=s:(s.next=u.next,u.next=s),n.pending=s}function qh(n,s,u){if((u&4194048)!==0){var _=s.lanes;_&=n.pendingLanes,u|=_,s.lanes=u,yi(n,u)}}var $l={readContext:$n,use:c,useCallback:cn,useContext:cn,useEffect:cn,useImperativeHandle:cn,useLayoutEffect:cn,useInsertionEffect:cn,useMemo:cn,useReducer:cn,useRef:cn,useState:cn,useDebugValue:cn,useDeferredValue:cn,useTransition:cn,useSyncExternalStore:cn,useId:cn,useHostTransitionStatus:cn,useFormState:cn,useActionState:cn,useOptimistic:cn,useMemoCache:cn,useCacheRefresh:cn};$l.useEffectEvent=cn;var Zh={readContext:$n,use:c,useCallback:function(n,s){return sa().memoizedState=[n,s===void 0?null:s],n},useContext:$n,useEffect:Ge,useImperativeHandle:function(n,s,u){u=u!=null?u.concat([n]):null,Xt(4194308,4,Ln.bind(null,s,n),u)},useLayoutEffect:function(n,s){return Xt(4194308,4,n,s)},useInsertionEffect:function(n,s){Xt(4,2,n,s)},useMemo:function(n,s){var u=sa();s=s===void 0?null:s;var _=n();if(Ba){pt(!0);try{n()}finally{pt(!1)}}return u.memoizedState=[_,s],_},useReducer:function(n,s,u){var _=sa();if(u!==void 0){var b=u(s);if(Ba){pt(!0);try{u(s)}finally{pt(!1)}}}else b=s;return _.memoizedState=_.baseState=b,n={pending:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:b},_.queue=n,n=n.dispatch=ol.bind(null,We,n),[_.memoizedState,n]},useRef:function(n){var s=sa();return n={current:n},s.memoizedState=n},useState:function(n){n=W(n);var s=n.queue,u=un.bind(null,We,s);return s.dispatch=u,[n.memoizedState,u]},useDebugValue:_n,useDeferredValue:function(n,s){var u=sa();return Ta(u,n,s)},useTransition:function(){var n=W(!1);return n=jr.bind(null,We,n.queue,!0,!1),sa().memoizedState=n,[!1,n]},useSyncExternalStore:function(n,s,u){var _=We,b=sa();if(hi){if(u===void 0)throw Error(q(407));u=u()}else{if(u=s(),Yi===null)throw Error(q(349));(xi&127)!==0||D(_,s,u)}b.memoizedState=u;var E={value:u,getSnapshot:s};return b.queue=E,Ge(L.bind(null,_,E,n),[n]),_.flags|=2048,ae(9,{destroy:void 0},k.bind(null,_,E,u,s),null),u},useId:function(){var n=sa(),s=Yi.identifierPrefix;if(hi){var u=ls,_=Xa;u=(_&~(1<<32-F(_)-1)).toString(32)+u,s="_"+s+"R_"+u,u=Vs++,0<u&&(s+="H"+u.toString(32)),s+="_"}else u=Nc++,s="_"+s+"r_"+u.toString(32)+"_";return n.memoizedState=s},useHostTransitionStatus:Vr,useFormState:Tt,useActionState:Tt,useOptimistic:function(n){var s=sa();s.memoizedState=s.baseState=n;var u={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return s.queue=u,s=En.bind(null,We,!0,u),u.dispatch=s,[n,s]},useMemoCache:f,useCacheRefresh:function(){return sa().memoizedState=sl.bind(null,We)},useEffectEvent:function(n){var s=sa(),u={impl:n};return s.memoizedState=u,function(){if((bi&2)!==0)throw Error(q(440));return u.impl.apply(void 0,arguments)}}},Hs={readContext:$n,use:c,useCallback:yn,useContext:$n,useEffect:Fe,useImperativeHandle:Wi,useInsertionEffect:an,useLayoutEffect:Ri,useMemo:Sn,useReducer:v,useRef:re,useState:function(){return v(g)},useDebugValue:_n,useDeferredValue:function(n,s){var u=m();return _s(u,Si.memoizedState,n,s)},useTransition:function(){var n=v(g)[0],s=m().memoizedState;return[typeof n=="boolean"?n:r(n),s]},useSyncExternalStore:C,useId:Ka,useHostTransitionStatus:Vr,useFormState:kt,useActionState:kt,useOptimistic:function(n,s){var u=m();return Q(u,Si,n,s)},useMemoCache:f,useCacheRefresh:vs};Hs.useEffectEvent=Fi;var Yd={readContext:$n,use:c,useCallback:yn,useContext:$n,useEffect:Fe,useImperativeHandle:Wi,useInsertionEffect:an,useLayoutEffect:Ri,useMemo:Sn,useReducer:S,useRef:re,useState:function(){return S(g)},useDebugValue:_n,useDeferredValue:function(n,s){var u=m();return Si===null?Ta(u,n,s):_s(u,Si.memoizedState,n,s)},useTransition:function(){var n=S(g)[0],s=m().memoizedState;return[typeof n=="boolean"?n:r(n),s]},useSyncExternalStore:C,useId:Ka,useHostTransitionStatus:Vr,useFormState:Rt,useActionState:Rt,useOptimistic:function(n,s){var u=m();return Si!==null?Q(u,Si,n,s):(u.baseState=n,[n,u.queue.dispatch])},useMemoCache:f,useCacheRefresh:vs};Yd.useEffectEvent=Fi;function xs(n,s,u,_){s=n.memoizedState,u=u(_,s),u=u==null?s:Dt({},s,u),n.memoizedState=u,n.lanes===0&&(n.updateQueue.baseState=u)}var Xl={enqueueSetState:function(n,s,u){n=n._reactInternals;var _=qr(),b=mo(_);b.payload=s,u!=null&&(b.callback=u),s=xr(n,b,_),s!==null&&(hr(s,n,_),js(s,n,_))},enqueueReplaceState:function(n,s,u){n=n._reactInternals;var _=qr(),b=mo(_);b.tag=1,b.payload=s,u!=null&&(b.callback=u),s=xr(n,b,_),s!==null&&(hr(s,n,_),js(s,n,_))},enqueueForceUpdate:function(n,s){n=n._reactInternals;var u=qr(),_=mo(u);_.tag=2,s!=null&&(_.callback=s),s=xr(n,_,u),s!==null&&(hr(s,n,u),js(s,n,u))}};function Gu(n,s,u,_,b,E,O){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(_,E,O):s.prototype&&s.prototype.isPureReactComponent?!Ha(u,_)||!Ha(b,E):!0}function $s(n,s,u,_){n=s.state,typeof s.componentWillReceiveProps=="function"&&s.componentWillReceiveProps(u,_),typeof s.UNSAFE_componentWillReceiveProps=="function"&&s.UNSAFE_componentWillReceiveProps(u,_),s.state!==n&&Xl.enqueueReplaceState(s,s.state,null)}function Na(n,s){var u=s;if("ref"in s){u={};for(var _ in s)_!=="ref"&&(u[_]=s[_])}if(n=n.defaultProps){u===s&&(u=Dt({},u));for(var b in n)u[b]===void 0&&(u[b]=n[b])}return u}function qu(n){$o(n)}function Zu(n){console.error(n)}function Wd(n){$o(n)}function Hh(n,s){try{var u=n.onUncaughtError;u(s.value,{componentStack:s.stack})}catch(_){setTimeout(function(){throw _})}}function $h(n,s,u){try{var _=n.onCaughtError;_(u.value,{componentStack:u.stack,errorBoundary:s.tag===1?s.stateNode:null})}catch(b){setTimeout(function(){throw b})}}function Kd(n,s,u){return u=mo(u),u.tag=3,u.payload={element:null},u.callback=function(){Hh(n,s)},u}function em(n){return n=mo(n),n.tag=3,n}function Qd(n,s,u,_){var b=u.type.getDerivedStateFromError;if(typeof b=="function"){var E=_.value;n.payload=function(){return b(E)},n.callback=function(){$h(s,u,_)}}var O=u.stateNode;O!==null&&typeof O.componentDidCatch=="function"&&(n.callback=function(){$h(s,u,_),typeof b!="function"&&(dl===null?dl=new Set([this]):dl.add(this));var X=_.stack;this.componentDidCatch(_.value,{componentStack:X!==null?X:""})})}function eg(n,s,u,_,b){if(u.flags|=32768,_!==null&&typeof _=="object"&&typeof _.then=="function"){if(s=u.alternate,s!==null&&fo(s,u,b,!0),u=ma.current,u!==null){switch(u.tag){case 31:case 13:return $i===null?ff():u.alternate===null&&jn===0&&(jn=3),u.flags&=-257,u.flags|=65536,u.lanes=b,_===po?u.flags|=16384:(s=u.updateQueue,s===null?u.updateQueue=new Set([_]):s.add(_),hp(n,_,b)),!1;case 22:return u.flags|=65536,_===po?u.flags|=16384:(s=u.updateQueue,s===null?(s={transitions:null,markerInstances:null,retryQueue:new Set([_])},u.updateQueue=s):(u=s.retryQueue,u===null?s.retryQueue=new Set([_]):u.add(_)),hp(n,_,b)),!1}throw Error(q(435,u.tag))}return hp(n,_,b),ff(),!1}if(hi)return s=ma.current,s!==null?((s.flags&65536)===0&&(s.flags|=256),s.flags|=65536,s.lanes=b,_!==Br&&(n=Error(q(422),{cause:_}),Ls(ka(n,u)))):(_!==Br&&(s=Error(q(423),{cause:_}),Ls(ka(s,u))),n=n.current.alternate,n.flags|=65536,b&=-b,n.lanes|=b,_=ka(_,u),b=Kd(n.stateNode,_,b),Bc(n,b),jn!==4&&(jn=2)),!1;var E=Error(q(520),{cause:_});if(E=ka(E,u),Yc===null?Yc=[E]:Yc.push(E),jn!==4&&(jn=2),s===null)return!0;_=ka(_,u),u=s;do{switch(u.tag){case 3:return u.flags|=65536,n=b&-b,u.lanes|=n,n=Kd(u.stateNode,_,n),Bc(u,n),!1;case 1:if(s=u.type,E=u.stateNode,(u.flags&128)===0&&(typeof s.getDerivedStateFromError=="function"||E!==null&&typeof E.componentDidCatch=="function"&&(dl===null||!dl.has(E))))return u.flags|=65536,b&=-b,u.lanes|=b,b=em(b),Qd(b,n,u,_),Bc(u,b),!1}u=u.return}while(u!==null);return!1}var Xh=Error(q(461)),Wn=!1;function Sa(n,s,u,_){s.child=n===null?$d(s,null,u,_):Ns(s,n.child,u,_)}function Vc(n,s,u,_,b){u=u.render;var E=s.ref;if("ref"in _){var O={};for(var X in _)X!=="ref"&&(O[X]=_[X])}else O=_;return ks(s),_=qs(n,s,u,O,E,b),X=Zl(),n!==null&&!Wn?(jc(n,s,b),Xs(n,s,b)):(hi&&X&&Fl(s),s.flags|=1,Sa(n,s,_,b),s.child)}function im(n,s,u,_,b){if(n===null){var E=u.type;return typeof E=="function"&&!Xo(E)&&E.defaultProps===void 0&&u.compare===null?(s.tag=15,s.type=E,Uc(n,s,E,_,b)):(n=Ac(u.type,null,_,s,s.mode,b),n.ref=s.ref,n.return=s,s.child=n)}if(E=n.child,!Zf(n,b)){var O=E.memoizedProps;if(u=u.compare,u=u!==null?u:Ha,u(O,_)&&n.ref===s.ref)return Xs(n,s,b)}return s.flags|=1,n=kr(E,_),n.ref=s.ref,n.return=s,s.child=n}function Uc(n,s,u,_,b){if(n!==null){var E=n.memoizedProps;if(Ha(E,_)&&n.ref===s.ref)if(Wn=!1,s.pendingProps=_=E,Zf(n,b))(n.flags&131072)!==0&&(Wn=!0);else return s.lanes=n.lanes,Xs(n,s,b)}return Kh(n,s,u,_,b)}function Yh(n,s,u,_){var b=_.children,E=n!==null?n.memoizedState:null;if(n===null&&s.stateNode===null&&(s.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),_.mode==="hidden"){if((s.flags&128)!==0){if(E=E!==null?E.baseLanes|u:u,n!==null){for(_=s.child=n.child,b=0;_!==null;)b=b|_.lanes|_.childLanes,_=_.sibling;_=b&~E}else _=0,s.child=null;return nm(n,s,E,u,_)}if((u&536870912)!==0)s.memoizedState={baseLanes:0,cachePool:null},n!==null&&Wa(s,E!==null?E.cachePool:null),E!==null?Le(s,E):al(),Xd(s);else return _=s.lanes=536870912,nm(n,s,E!==null?E.baseLanes|u:u,u,_)}else E!==null?(Wa(s,E.cachePool),Le(s,E),go(),s.memoizedState=null):(n!==null&&Wa(s,null),al(),go());return Sa(n,s,b,u),s.child}function Yl(n,s){return n!==null&&n.tag===22||s.stateNode!==null||(s.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),s.sibling}function nm(n,s,u,_,b){var E=Jo();return E=E===null?null:{parent:Rn._currentValue,pool:E},s.memoizedState={baseLanes:u,cachePool:E},n!==null&&Wa(s,null),al(),Xd(s),n!==null&&fo(n,s,_,!0),s.childLanes=b,null}function Jd(n,s){return s=Jh({mode:s.mode,children:s.children},n.mode),s.ref=n.ref,n.child=s,s.return=n,s}function am(n,s,u){return Ns(s,n.child,null,u),n=Jd(s,s.pendingProps),n.flags|=2,sr(s),s.memoizedState=null,n}function ig(n,s,u){var _=s.pendingProps,b=(s.flags&128)!==0;if(s.flags&=-129,n===null){if(hi){if(_.mode==="hidden")return n=Jd(s,_),s.lanes=536870912,Yl(null,n);if(Vu(s),(n=Hi)?(n=Vn(n,gi),n=n!==null&&n.data==="&"?n:null,n!==null&&(s.memoizedState={dehydrated:n,treeContext:Rs!==null?{id:Xa,overflow:ls}:null,retryLane:536870912,hydrationErrors:null},u=Dc(n),u.return=s,s.child=u,Fn=s,Hi=null)):n=null,n===null)throw In(s);return s.lanes=536870912,null}return Jd(s,_)}var E=n.memoizedState;if(E!==null){var O=E.dehydrated;if(Vu(s),b)if(s.flags&256)s.flags&=-257,s=am(n,s,u);else if(s.memoizedState!==null)s.child=n.child,s.flags|=128,s=null;else throw Error(q(558));else if(Wn||fo(n,s,u,!1),b=(u&n.childLanes)!==0,Wn||b){if(_=Yi,_!==null&&(O=Li(_,u),O!==0&&O!==E.retryLane))throw E.retryLane=O,oo(n,O),hr(_,n,O),Xh;ff(),s=am(n,s,u)}else n=E.treeContext,Hi=Ca(O.nextSibling),Fn=s,hi=!0,cs=null,gi=!1,n!==null&&Fh(s,n),s=Jd(s,_),s.flags|=4096;return s}return n=kr(n.child,{mode:_.mode,children:_.children}),n.ref=s.ref,s.child=n,n.return=s,n}function Wh(n,s){var u=s.ref;if(u===null)n!==null&&n.ref!==null&&(s.flags|=4194816);else{if(typeof u!="function"&&typeof u!="object")throw Error(q(284));(n===null||n.ref!==u)&&(s.flags|=4194816)}}function Kh(n,s,u,_,b){return ks(s),u=qs(n,s,u,_,void 0,b),_=Zl(),n!==null&&!Wn?(jc(n,s,b),Xs(n,s,b)):(hi&&_&&Fl(s),s.flags|=1,Sa(n,s,u,b),s.child)}function Vf(n,s,u,_,b,E){return ks(s),s.updateQueue=null,u=Fc(s,_,u,b),Uu(n),_=Zl(),n!==null&&!Wn?(jc(n,s,E),Xs(n,s,E)):(hi&&_&&Fl(s),s.flags|=1,Sa(n,s,u,E),s.child)}function Uf(n,s,u,_,b){if(ks(s),s.stateNode===null){var E=Ps,O=u.contextType;typeof O=="object"&&O!==null&&(E=$n(O)),E=new u(_,E),s.memoizedState=E.state!==null&&E.state!==void 0?E.state:null,E.updater=Xl,s.stateNode=E,E._reactInternals=s,E=s.stateNode,E.props=_,E.state=s.memoizedState,E.refs={},gs(s),O=u.contextType,E.context=typeof O=="object"&&O!==null?$n(O):Ps,E.state=s.memoizedState,O=u.getDerivedStateFromProps,typeof O=="function"&&(xs(s,u,O,_),E.state=s.memoizedState),typeof u.getDerivedStateFromProps=="function"||typeof E.getSnapshotBeforeUpdate=="function"||typeof E.UNSAFE_componentWillMount!="function"&&typeof E.componentWillMount!="function"||(O=E.state,typeof E.componentWillMount=="function"&&E.componentWillMount(),typeof E.UNSAFE_componentWillMount=="function"&&E.UNSAFE_componentWillMount(),O!==E.state&&Xl.enqueueReplaceState(E,E.state,null),nl(s,_,E,b),il(),E.state=s.memoizedState),typeof E.componentDidMount=="function"&&(s.flags|=4194308),_=!0}else if(n===null){E=s.stateNode;var X=s.memoizedProps,_t=Na(u,X);E.props=_t;var Ft=E.context,Wt=u.contextType;O=Ps,typeof Wt=="object"&&Wt!==null&&(O=$n(Wt));var ie=u.getDerivedStateFromProps;Wt=typeof ie=="function"||typeof E.getSnapshotBeforeUpdate=="function",X=s.pendingProps!==X,Wt||typeof E.UNSAFE_componentWillReceiveProps!="function"&&typeof E.componentWillReceiveProps!="function"||(X||Ft!==O)&&$s(s,E,_,O),Fs=!1;var Vt=s.memoizedState;E.state=Vt,nl(s,_,E,b),il(),Ft=s.memoizedState,X||Vt!==Ft||Fs?(typeof ie=="function"&&(xs(s,u,ie,_),Ft=s.memoizedState),(_t=Fs||Gu(s,u,_t,_,Vt,Ft,O))?(Wt||typeof E.UNSAFE_componentWillMount!="function"&&typeof E.componentWillMount!="function"||(typeof E.componentWillMount=="function"&&E.componentWillMount(),typeof E.UNSAFE_componentWillMount=="function"&&E.UNSAFE_componentWillMount()),typeof E.componentDidMount=="function"&&(s.flags|=4194308)):(typeof E.componentDidMount=="function"&&(s.flags|=4194308),s.memoizedProps=_,s.memoizedState=Ft),E.props=_,E.state=Ft,E.context=O,_=_t):(typeof E.componentDidMount=="function"&&(s.flags|=4194308),_=!1)}else{E=s.stateNode,Mi(n,s),O=s.memoizedProps,Wt=Na(u,O),E.props=Wt,ie=s.pendingProps,Vt=E.context,Ft=u.contextType,_t=Ps,typeof Ft=="object"&&Ft!==null&&(_t=$n(Ft)),X=u.getDerivedStateFromProps,(Ft=typeof X=="function"||typeof E.getSnapshotBeforeUpdate=="function")||typeof E.UNSAFE_componentWillReceiveProps!="function"&&typeof E.componentWillReceiveProps!="function"||(O!==ie||Vt!==_t)&&$s(s,E,_,_t),Fs=!1,Vt=s.memoizedState,E.state=Vt,nl(s,_,E,b),il();var Gt=s.memoizedState;O!==ie||Vt!==Gt||Fs||n!==null&&n.dependencies!==null&&Ic(n.dependencies)?(typeof X=="function"&&(xs(s,u,X,_),Gt=s.memoizedState),(Wt=Fs||Gu(s,u,Wt,_,Vt,Gt,_t)||n!==null&&n.dependencies!==null&&Ic(n.dependencies))?(Ft||typeof E.UNSAFE_componentWillUpdate!="function"&&typeof E.componentWillUpdate!="function"||(typeof E.componentWillUpdate=="function"&&E.componentWillUpdate(_,Gt,_t),typeof E.UNSAFE_componentWillUpdate=="function"&&E.UNSAFE_componentWillUpdate(_,Gt,_t)),typeof E.componentDidUpdate=="function"&&(s.flags|=4),typeof E.getSnapshotBeforeUpdate=="function"&&(s.flags|=1024)):(typeof E.componentDidUpdate!="function"||O===n.memoizedProps&&Vt===n.memoizedState||(s.flags|=4),typeof E.getSnapshotBeforeUpdate!="function"||O===n.memoizedProps&&Vt===n.memoizedState||(s.flags|=1024),s.memoizedProps=_,s.memoizedState=Gt),E.props=_,E.state=Gt,E.context=_t,_=Wt):(typeof E.componentDidUpdate!="function"||O===n.memoizedProps&&Vt===n.memoizedState||(s.flags|=4),typeof E.getSnapshotBeforeUpdate!="function"||O===n.memoizedProps&&Vt===n.memoizedState||(s.flags|=1024),_=!1)}return E=_,Wh(n,s),_=(s.flags&128)!==0,E||_?(E=s.stateNode,u=_&&typeof u.getDerivedStateFromError!="function"?null:E.render(),s.flags|=1,n!==null&&_?(s.child=Ns(s,n.child,null,b),s.child=Ns(s,null,u,b)):Sa(n,s,u,b),s.memoizedState=E.state,n=s.child):n=Xs(n,s,b),n}function rm(n,s,u,_){return _r(),s.flags|=256,Sa(n,s,u,_),s.child}var Gf={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function tf(n){return{baseLanes:n,cachePool:ge()}}function ef(n,s,u){return n=n!==null?n.childLanes&~u:0,s&&(n|=Gr),n}function sm(n,s,u){var _=s.pendingProps,b=!1,E=(s.flags&128)!==0,O;if((O=E)||(O=n!==null&&n.memoizedState===null?!1:(nn.current&2)!==0),O&&(b=!0,s.flags&=-129),O=(s.flags&32)!==0,s.flags&=-33,n===null){if(hi){if(b?Yn(s):go(),(n=Hi)?(n=Vn(n,gi),n=n!==null&&n.data!=="&"?n:null,n!==null&&(s.memoizedState={dehydrated:n,treeContext:Rs!==null?{id:Xa,overflow:ls}:null,retryLane:536870912,hydrationErrors:null},u=Dc(n),u.return=s,s.child=u,Fn=s,Hi=null)):n=null,n===null)throw In(s);return Ep(n)?s.lanes=32:s.lanes=536870912,null}var X=_.children;return _=_.fallback,b?(go(),b=s.mode,X=Jh({mode:"hidden",children:X},b),_=Yo(_,b,u,null),X.return=s,_.return=s,X.sibling=_,s.child=X,_=s.child,_.memoizedState=tf(u),_.childLanes=ef(n,O,u),s.memoizedState=Gf,Yl(null,_)):(Yn(s),Qh(s,X))}var _t=n.memoizedState;if(_t!==null&&(X=_t.dehydrated,X!==null)){if(E)s.flags&256?(Yn(s),s.flags&=-257,s=td(n,s,u)):s.memoizedState!==null?(go(),s.child=n.child,s.flags|=128,s=null):(go(),X=_.fallback,b=s.mode,_=Jh({mode:"visible",children:_.children},b),X=Yo(X,b,u,null),X.flags|=2,_.return=s,X.return=s,_.sibling=X,s.child=_,Ns(s,n.child,null,u),_=s.child,_.memoizedState=tf(u),_.childLanes=ef(n,O,u),s.memoizedState=Gf,s=Yl(null,_));else if(Yn(s),Ep(X)){if(O=X.nextSibling&&X.nextSibling.dataset,O)var Ft=O.dgst;O=Ft,_=Error(q(419)),_.stack="",_.digest=O,Ls({value:_,source:null,stack:null}),s=td(n,s,u)}else if(Wn||fo(n,s,u,!1),O=(u&n.childLanes)!==0,Wn||O){if(O=Yi,O!==null&&(_=Li(O,u),_!==0&&_!==_t.retryLane))throw _t.retryLane=_,oo(n,_),hr(O,n,_),Xh;oh(X)||ff(),s=td(n,s,u)}else oh(X)?(s.flags|=192,s.child=n.child,s=null):(n=_t.treeContext,Hi=Ca(X.nextSibling),Fn=s,hi=!0,cs=null,gi=!1,n!==null&&Fh(s,n),s=Qh(s,_.children),s.flags|=4096);return s}return b?(go(),X=_.fallback,b=s.mode,_t=n.child,Ft=_t.sibling,_=kr(_t,{mode:"hidden",children:_.children}),_.subtreeFlags=_t.subtreeFlags&65011712,Ft!==null?X=kr(Ft,X):(X=Yo(X,b,u,null),X.flags|=2),X.return=s,_.return=s,_.sibling=X,s.child=_,Yl(null,_),_=s.child,X=n.child.memoizedState,X===null?X=tf(u):(b=X.cachePool,b!==null?(_t=Rn._currentValue,b=b.parent!==_t?{parent:_t,pool:_t}:b):b=ge(),X={baseLanes:X.baseLanes|u,cachePool:b}),_.memoizedState=X,_.childLanes=ef(n,O,u),s.memoizedState=Gf,Yl(n.child,_)):(Yn(s),u=n.child,n=u.sibling,u=kr(u,{mode:"visible",children:_.children}),u.return=s,u.sibling=null,n!==null&&(O=s.deletions,O===null?(s.deletions=[n],s.flags|=16):O.push(n)),s.child=u,s.memoizedState=null,u)}function Qh(n,s){return s=Jh({mode:"visible",children:s},n.mode),s.return=n,n.child=s}function Jh(n,s){return n=$a(22,n,null,s),n.lanes=0,n}function td(n,s,u){return Ns(s,n.child,null,u),n=Qh(s,s.pendingProps.children),n.flags|=2,s.memoizedState=null,n}function Hu(n,s,u){n.lanes|=s;var _=n.alternate;_!==null&&(_.lanes|=s),ku(n.return,s,u)}function Fa(n,s,u,_,b,E){var O=n.memoizedState;O===null?n.memoizedState={isBackwards:s,rendering:null,renderingStartTime:0,last:_,tail:u,tailMode:b,treeForkCount:E}:(O.isBackwards=s,O.rendering=null,O.renderingStartTime=0,O.last=_,O.tail=u,O.tailMode=b,O.treeForkCount=E)}function qf(n,s,u){var _=s.pendingProps,b=_.revealOrder,E=_.tail;_=_.children;var O=nn.current,X=(O&2)!==0;if(X?(O=O&1|2,s.flags|=128):O&=1,_e(nn,O),Sa(n,s,_,u),_=hi?co:0,!X&&n!==null&&(n.flags&128)!==0)t:for(n=s.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&Hu(n,u,s);else if(n.tag===19)Hu(n,u,s);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===s)break t;for(;n.sibling===null;){if(n.return===null||n.return===s)break t;n=n.return}n.sibling.return=n.return,n=n.sibling}switch(b){case"forwards":for(u=s.child,b=null;u!==null;)n=u.alternate,n!==null&&Ti(n)===null&&(b=u),u=u.sibling;u=b,u===null?(b=s.child,s.child=null):(b=u.sibling,u.sibling=null),Fa(s,!1,b,u,E,_);break;case"backwards":case"unstable_legacy-backwards":for(u=null,b=s.child,s.child=null;b!==null;){if(n=b.alternate,n!==null&&Ti(n)===null){s.child=b;break}n=b.sibling,b.sibling=u,u=b,b=n}Fa(s,!0,u,null,E,_);break;case"together":Fa(s,!1,null,null,void 0,_);break;default:s.memoizedState=null}return s.child}function Xs(n,s,u){if(n!==null&&(s.dependencies=n.dependencies),ec|=s.lanes,(u&s.childLanes)===0)if(n!==null){if(fo(n,s,u,!1),(u&s.childLanes)===0)return null}else return null;if(n!==null&&s.child!==n.child)throw Error(q(153));if(s.child!==null){for(n=s.child,u=kr(n,n.pendingProps),s.child=u,u.return=s;n.sibling!==null;)n=n.sibling,u=u.sibling=kr(n,n.pendingProps),u.return=s;u.sibling=null}return s.child}function Zf(n,s){return(n.lanes&s)!==0?!0:(n=n.dependencies,!!(n!==null&&Ic(n)))}function om(n,s,u){switch(s.tag){case 3:Ke(s,s.stateNode.containerInfo),us(s,Rn,n.memoizedState.cache),_r();break;case 27:case 5:dn(s);break;case 4:Ke(s,s.stateNode.containerInfo);break;case 10:us(s,s.type,s.memoizedProps.value);break;case 31:if(s.memoizedState!==null)return s.flags|=128,Vu(s),null;break;case 13:var _=s.memoizedState;if(_!==null)return _.dehydrated!==null?(Yn(s),s.flags|=128,null):(u&s.child.childLanes)!==0?sm(n,s,u):(Yn(s),n=Xs(n,s,u),n!==null?n.sibling:null);Yn(s);break;case 19:var b=(n.flags&128)!==0;if(_=(u&s.childLanes)!==0,_||(fo(n,s,u,!1),_=(u&s.childLanes)!==0),b){if(_)return qf(n,s,u);s.flags|=128}if(b=s.memoizedState,b!==null&&(b.rendering=null,b.tail=null,b.lastEffect=null),_e(nn,nn.current),_)break;return null;case 22:return s.lanes=0,Yh(n,s,u,s.pendingProps);case 24:us(s,Rn,n.memoizedState.cache)}return Xs(n,s,u)}function lm(n,s,u){if(n!==null)if(n.memoizedProps!==s.pendingProps)Wn=!0;else{if(!Zf(n,u)&&(s.flags&128)===0)return Wn=!1,om(n,s,u);Wn=(n.flags&131072)!==0}else Wn=!1,hi&&(s.flags&1048576)!==0&&Nl(s,co,s.index);switch(s.lanes=0,s.tag){case 16:t:{var _=s.pendingProps;if(n=tl(s.elementType),s.type=n,typeof n=="function")Xo(n)?(_=Na(n,_),s.tag=1,s=Uf(null,s,n,_,u)):(s.tag=0,s=Kh(null,s,n,_,u));else{if(n!=null){var b=n.$$typeof;if(b===ce){s.tag=11,s=Vc(null,s,n,_,u);break t}else if(b===pe){s.tag=14,s=im(null,s,n,_,u);break t}}throw s=On(n)||n,Error(q(306,s,""))}}return s;case 0:return Kh(n,s,s.type,s.pendingProps,u);case 1:return _=s.type,b=Na(_,s.pendingProps),Uf(n,s,_,b,u);case 3:t:{if(Ke(s,s.stateNode.containerInfo),n===null)throw Error(q(387));_=s.pendingProps;var E=s.memoizedState;b=E.element,Mi(n,s),nl(s,_,null,u);var O=s.memoizedState;if(_=O.cache,us(s,Rn,_),_!==E.cache&&hs(s,[Rn],u,!0),il(),_=O.element,E.isDehydrated)if(E={element:_,isDehydrated:!1,cache:O.cache},s.updateQueue.baseState=E,s.memoizedState=E,s.flags&256){s=rm(n,s,_,u);break t}else if(_!==b){b=ka(Error(q(424)),s),Ls(b),s=rm(n,s,_,u);break t}else{switch(n=s.stateNode.containerInfo,n.nodeType){case 9:n=n.body;break;default:n=n.nodeName==="HTML"?n.ownerDocument.body:n}for(Hi=Ca(n.firstChild),Fn=s,hi=!0,cs=null,gi=!0,u=$d(s,null,_,u),s.child=u;u;)u.flags=u.flags&-3|4096,u=u.sibling}else{if(_r(),_===b){s=Xs(n,s,u);break t}Sa(n,s,_,u)}s=s.child}return s;case 26:return Wh(n,s),n===null?(u=Dp(s.type,null,s.pendingProps,null))?s.memoizedState=u:hi||(u=s.type,n=s.pendingProps,_=sh(Ie.current).createElement(u),_[Qt]=s,_[me]=n,Ma(_,u,n),mn(_),s.stateNode=_):s.memoizedState=Dp(s.type,n.memoizedProps,s.pendingProps,n.memoizedState),null;case 27:return dn(s),n===null&&hi&&(_=s.stateNode=Cp(s.type,s.pendingProps,Ie.current),Fn=s,gi=!0,b=Hi,Jn(s.type)?(rc=b,Hi=Ca(_.firstChild)):Hi=b),Sa(n,s,s.pendingProps.children,u),Wh(n,s),n===null&&(s.flags|=4194304),s.child;case 5:return n===null&&hi&&((b=_=Hi)&&(_=$r(_,s.type,s.pendingProps,gi),_!==null?(s.stateNode=_,Fn=s,Hi=Ca(_.firstChild),gi=!1,b=!0):b=!1),b||In(s)),dn(s),b=s.type,E=s.pendingProps,O=n!==null?n.memoizedProps:null,_=E.children,_d(b,E)?_=null:O!==null&&_d(b,O)&&(s.flags|=32),s.memoizedState!==null&&(b=qs(n,s,rl,null,null,u),ou._currentValue=b),Wh(n,s),Sa(n,s,_,u),s.child;case 6:return n===null&&hi&&((n=u=Hi)&&(u=Sp(u,s.pendingProps,gi),u!==null?(s.stateNode=u,Fn=s,Hi=null,n=!0):n=!1),n||In(s)),null;case 13:return sm(n,s,u);case 4:return Ke(s,s.stateNode.containerInfo),_=s.pendingProps,n===null?s.child=Ns(s,null,_,u):Sa(n,s,_,u),s.child;case 11:return Vc(n,s,s.type,s.pendingProps,u);case 7:return Sa(n,s,s.pendingProps,u),s.child;case 8:return Sa(n,s,s.pendingProps.children,u),s.child;case 12:return Sa(n,s,s.pendingProps.children,u),s.child;case 10:return _=s.pendingProps,us(s,s.type,_.value),Sa(n,s,_.children,u),s.child;case 9:return b=s.type._context,_=s.pendingProps.children,ks(s),b=$n(b),_=_(b),s.flags|=1,Sa(n,s,_,u),s.child;case 14:return im(n,s,s.type,s.pendingProps,u);case 15:return Uc(n,s,s.type,s.pendingProps,u);case 19:return qf(n,s,u);case 31:return ig(n,s,u);case 22:return Yh(n,s,u,s.pendingProps);case 24:return ks(s),_=$n(Rn),n===null?(b=Jo(),b===null&&(b=Yi,E=Ya(),b.pooledCache=E,E.refCount++,E!==null&&(b.pooledCacheLanes|=u),b=E),s.memoizedState={parent:_,cache:b},gs(s),us(s,Rn,b)):((n.lanes&u)!==0&&(Mi(n,s),nl(s,null,null,u),il()),b=n.memoizedState,E=s.memoizedState,b.parent!==_?(b={parent:_,cache:_},s.memoizedState=b,s.lanes===0&&(s.memoizedState=s.updateQueue.baseState=b),us(s,Rn,_)):(_=E.cache,us(s,Rn,_),_!==b.cache&&hs(s,[Rn],u,!0))),Sa(n,s,s.pendingProps.children,u),s.child;case 29:throw s.pendingProps}throw Error(q(156,s.tag))}function ll(n){n.flags|=4}function nf(n,s,u,_,b){if((s=(n.mode&32)!==0)&&(s=!1),s){if(n.flags|=16777216,(b&335544128)===b)if(n.stateNode.complete)n.flags|=8192;else if(Qc())n.flags|=8192;else throw vr=po,Lc}else n.flags&=-16777217}function cm(n,s){if(s.type!=="stylesheet"||(s.state.loading&4)!==0)n.flags&=-16777217;else if(n.flags|=16777216,!Rp(s))if(Qc())n.flags|=8192;else throw vr=po,Lc}function $u(n,s){s!==null&&(n.flags|=4),n.flags&16384&&(s=n.tag!==22?ye():536870912,n.lanes|=s,Xc|=s)}function Xu(n,s){if(!hi)switch(n.tailMode){case"hidden":s=n.tail;for(var u=null;s!==null;)s.alternate!==null&&(u=s),s=s.sibling;u===null?n.tail=null:u.sibling=null;break;case"collapsed":u=n.tail;for(var _=null;u!==null;)u.alternate!==null&&(_=u),u=u.sibling;_===null?s||n.tail===null?n.tail=null:n.tail.sibling=null:_.sibling=null}}function hn(n){var s=n.alternate!==null&&n.alternate.child===n.child,u=0,_=0;if(s)for(var b=n.child;b!==null;)u|=b.lanes|b.childLanes,_|=b.subtreeFlags&65011712,_|=b.flags&65011712,b.return=n,b=b.sibling;else for(b=n.child;b!==null;)u|=b.lanes|b.childLanes,_|=b.subtreeFlags,_|=b.flags,b.return=n,b=b.sibling;return n.subtreeFlags|=_,n.childLanes=u,s}function ng(n,s,u){var _=s.pendingProps;switch(Lu(s),s.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return hn(s),null;case 1:return hn(s),null;case 3:return u=s.stateNode,_=null,n!==null&&(_=n.memoizedState.cache),s.memoizedState.cache!==_&&(s.flags|=2048),rr(Rn),mi(),u.pendingContext&&(u.context=u.pendingContext,u.pendingContext=null),(n===null||n.child===null)&&(Qo(s)?ll(s):n===null||n.memoizedState.isDehydrated&&(s.flags&256)===0||(s.flags|=1024,zc())),hn(s),null;case 26:var b=s.type,E=s.memoizedState;return n===null?(ll(s),E!==null?(hn(s),cm(s,E)):(hn(s),nf(s,b,null,_,u))):E?E!==n.memoizedState?(ll(s),hn(s),cm(s,E)):(hn(s),s.flags&=-16777217):(n=n.memoizedProps,n!==_&&ll(s),hn(s),nf(s,b,n,_,u)),null;case 27:if(Qe(s),u=Ie.current,b=s.type,n!==null&&s.stateNode!=null)n.memoizedProps!==_&&ll(s);else{if(!_){if(s.stateNode===null)throw Error(q(166));return hn(s),null}n=Te.current,Qo(s)?jl(s):(n=Cp(b,_,u),s.stateNode=n,ll(s))}return hn(s),null;case 5:if(Qe(s),b=s.type,n!==null&&s.stateNode!=null)n.memoizedProps!==_&&ll(s);else{if(!_){if(s.stateNode===null)throw Error(q(166));return hn(s),null}if(E=Te.current,Qo(s))jl(s);else{var O=sh(Ie.current);switch(E){case 1:E=O.createElementNS("http://www.w3.org/2000/svg",b);break;case 2:E=O.createElementNS("http://www.w3.org/1998/Math/MathML",b);break;default:switch(b){case"svg":E=O.createElementNS("http://www.w3.org/2000/svg",b);break;case"math":E=O.createElementNS("http://www.w3.org/1998/Math/MathML",b);break;case"script":E=O.createElement("div"),E.innerHTML="<script><\/script>",E=E.removeChild(E.firstChild);break;case"select":E=typeof _.is=="string"?O.createElement("select",{is:_.is}):O.createElement("select"),_.multiple?E.multiple=!0:_.size&&(E.size=_.size);break;default:E=typeof _.is=="string"?O.createElement(b,{is:_.is}):O.createElement(b)}}E[Qt]=s,E[me]=_;t:for(O=s.child;O!==null;){if(O.tag===5||O.tag===6)E.appendChild(O.stateNode);else if(O.tag!==4&&O.tag!==27&&O.child!==null){O.child.return=O,O=O.child;continue}if(O===s)break t;for(;O.sibling===null;){if(O.return===null||O.return===s)break t;O=O.return}O.sibling.return=O.return,O=O.sibling}s.stateNode=E;t:switch(Ma(E,b,_),b){case"button":case"input":case"select":case"textarea":_=!!_.autoFocus;break t;case"img":_=!0;break t;default:_=!1}_&&ll(s)}}return hn(s),nf(s,s.type,n===null?null:n.memoizedProps,s.pendingProps,u),null;case 6:if(n&&s.stateNode!=null)n.memoizedProps!==_&&ll(s);else{if(typeof _!="string"&&s.stateNode===null)throw Error(q(166));if(n=Ie.current,Qo(s)){if(n=s.stateNode,u=s.memoizedProps,_=null,b=Fn,b!==null)switch(b.tag){case 27:case 5:_=b.memoizedProps}n[Qt]=s,n=!!(n.nodeValue===u||_!==null&&_.suppressHydrationWarning===!0||iu(n.nodeValue,u)),n||In(s,!0)}else n=sh(n).createTextNode(_),n[Qt]=s,s.stateNode=n}return hn(s),null;case 31:if(u=s.memoizedState,n===null||n.memoizedState!==null){if(_=Qo(s),u!==null){if(n===null){if(!_)throw Error(q(318));if(n=s.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(q(557));n[Qt]=s}else _r(),(s.flags&128)===0&&(s.memoizedState=null),s.flags|=4;hn(s),n=!1}else u=zc(),n!==null&&n.memoizedState!==null&&(n.memoizedState.hydrationErrors=u),n=!0;if(!n)return s.flags&256?(sr(s),s):(sr(s),null);if((s.flags&128)!==0)throw Error(q(558))}return hn(s),null;case 13:if(_=s.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(b=Qo(s),_!==null&&_.dehydrated!==null){if(n===null){if(!b)throw Error(q(318));if(b=s.memoizedState,b=b!==null?b.dehydrated:null,!b)throw Error(q(317));b[Qt]=s}else _r(),(s.flags&128)===0&&(s.memoizedState=null),s.flags|=4;hn(s),b=!1}else b=zc(),n!==null&&n.memoizedState!==null&&(n.memoizedState.hydrationErrors=b),b=!0;if(!b)return s.flags&256?(sr(s),s):(sr(s),null)}return sr(s),(s.flags&128)!==0?(s.lanes=u,s):(u=_!==null,n=n!==null&&n.memoizedState!==null,u&&(_=s.child,b=null,_.alternate!==null&&_.alternate.memoizedState!==null&&_.alternate.memoizedState.cachePool!==null&&(b=_.alternate.memoizedState.cachePool.pool),E=null,_.memoizedState!==null&&_.memoizedState.cachePool!==null&&(E=_.memoizedState.cachePool.pool),E!==b&&(_.flags|=2048)),u!==n&&u&&(s.child.flags|=8192),$u(s,s.updateQueue),hn(s),null);case 4:return mi(),n===null&&xf(s.stateNode.containerInfo),hn(s),null;case 10:return rr(s.type),hn(s),null;case 19:if(Ht(nn),_=s.memoizedState,_===null)return hn(s),null;if(b=(s.flags&128)!==0,E=_.rendering,E===null)if(b)Xu(_,!1);else{if(jn!==0||n!==null&&(n.flags&128)!==0)for(n=s.child;n!==null;){if(E=Ti(n),E!==null){for(s.flags|=128,Xu(_,!1),n=E.updateQueue,s.updateQueue=n,$u(s,n),s.subtreeFlags=0,n=u,u=s.child;u!==null;)Gd(u,n),u=u.sibling;return _e(nn,nn.current&1|2),hi&&Or(s,_.treeForkCount),s.child}n=n.sibling}_.tail!==null&&qi()>Wc&&(s.flags|=128,b=!0,Xu(_,!1),s.lanes=4194304)}else{if(!b)if(n=Ti(E),n!==null){if(s.flags|=128,b=!0,n=n.updateQueue,s.updateQueue=n,$u(s,n),Xu(_,!0),_.tail===null&&_.tailMode==="hidden"&&!E.alternate&&!hi)return hn(s),null}else 2*qi()-_.renderingStartTime>Wc&&u!==536870912&&(s.flags|=128,b=!0,Xu(_,!1),s.lanes=4194304);_.isBackwards?(E.sibling=s.child,s.child=E):(n=_.last,n!==null?n.sibling=E:s.child=E,_.last=E)}return _.tail!==null?(n=_.tail,_.rendering=n,_.tail=n.sibling,_.renderingStartTime=qi(),n.sibling=null,u=nn.current,_e(nn,b?u&1|2:u&1),hi&&Or(s,_.treeForkCount),n):(hn(s),null);case 22:case 23:return sr(s),ju(),_=s.memoizedState!==null,n!==null?n.memoizedState!==null!==_&&(s.flags|=8192):_&&(s.flags|=8192),_?(u&536870912)!==0&&(s.flags&128)===0&&(hn(s),s.subtreeFlags&6&&(s.flags|=8192)):hn(s),u=s.updateQueue,u!==null&&$u(s,u.retryQueue),u=null,n!==null&&n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(u=n.memoizedState.cachePool.pool),_=null,s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(_=s.memoizedState.cachePool.pool),_!==u&&(s.flags|=2048),n!==null&&Ht(ps),null;case 24:return u=null,n!==null&&(u=n.memoizedState.cache),s.memoizedState.cache!==u&&(s.flags|=2048),rr(Rn),hn(s),null;case 25:return null;case 30:return null}throw Error(q(156,s.tag))}function ag(n,s){switch(Lu(s),s.tag){case 1:return n=s.flags,n&65536?(s.flags=n&-65537|128,s):null;case 3:return rr(Rn),mi(),n=s.flags,(n&65536)!==0&&(n&128)===0?(s.flags=n&-65537|128,s):null;case 26:case 27:case 5:return Qe(s),null;case 31:if(s.memoizedState!==null){if(sr(s),s.alternate===null)throw Error(q(340));_r()}return n=s.flags,n&65536?(s.flags=n&-65537|128,s):null;case 13:if(sr(s),n=s.memoizedState,n!==null&&n.dehydrated!==null){if(s.alternate===null)throw Error(q(340));_r()}return n=s.flags,n&65536?(s.flags=n&-65537|128,s):null;case 19:return Ht(nn),null;case 4:return mi(),null;case 10:return rr(s.type),null;case 22:case 23:return sr(s),ju(),n!==null&&Ht(ps),n=s.flags,n&65536?(s.flags=n&-65537|128,s):null;case 24:return rr(Rn),null;case 25:return null;default:return null}}function um(n,s){switch(Lu(s),s.tag){case 3:rr(Rn),mi();break;case 26:case 27:case 5:Qe(s);break;case 4:mi();break;case 31:s.memoizedState!==null&&sr(s);break;case 13:sr(s);break;case 19:Ht(nn);break;case 10:rr(s.type);break;case 22:case 23:sr(s),ju(),n!==null&&Ht(ps);break;case 24:rr(Rn)}}function Wl(n,s){try{var u=s.updateQueue,_=u!==null?u.lastEffect:null;if(_!==null){var b=_.next;u=b;do{if((u.tag&n)===n){_=void 0;var E=u.create,O=u.inst;_=E(),O.destroy=_}u=u.next}while(u!==b)}}catch(X){Ui(s,s.return,X)}}function bo(n,s,u){try{var _=s.updateQueue,b=_!==null?_.lastEffect:null;if(b!==null){var E=b.next;_=E;do{if((_.tag&n)===n){var O=_.inst,X=O.destroy;if(X!==void 0){O.destroy=void 0,b=s;var _t=u,Ft=X;try{Ft()}catch(Wt){Ui(b,_t,Wt)}}}_=_.next}while(_!==E)}}catch(Wt){Ui(s,s.return,Wt)}}function Hf(n){var s=n.updateQueue;if(s!==null){var u=n.stateNode;try{br(s,u)}catch(_){Ui(n,n.return,_)}}}function Kl(n,s,u){u.props=Na(n.type,n.memoizedProps),u.state=n.memoizedState;try{u.componentWillUnmount()}catch(_){Ui(n,s,_)}}function cl(n,s){try{var u=n.ref;if(u!==null){switch(n.tag){case 26:case 27:case 5:var _=n.stateNode;break;case 30:_=n.stateNode;break;default:_=n.stateNode}typeof u=="function"?n.refCleanup=u(_):u.current=_}}catch(b){Ui(n,s,b)}}function wo(n,s){var u=n.ref,_=n.refCleanup;if(u!==null)if(typeof _=="function")try{_()}catch(b){Ui(n,s,b)}finally{n.refCleanup=null,n=n.alternate,n!=null&&(n.refCleanup=null)}else if(typeof u=="function")try{u(null)}catch(b){Ui(n,s,b)}else u.current=null}function hm(n){var s=n.type,u=n.memoizedProps,_=n.stateNode;try{t:switch(s){case"button":case"input":case"select":case"textarea":u.autoFocus&&_.focus();break t;case"img":u.src?_.src=u.src:u.srcSet&&(_.srcset=u.srcSet)}}catch(b){Ui(n,n.return,b)}}function $f(n,s,u){try{var _=n.stateNode;Pm(_,n.type,u,s),_[me]=s}catch(b){Ui(n,n.return,b)}}function dm(n){return n.tag===5||n.tag===3||n.tag===26||n.tag===27&&Jn(n.type)||n.tag===4}function Xf(n){t:for(;;){for(;n.sibling===null;){if(n.return===null||dm(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.tag===27&&Jn(n.type)||n.flags&2||n.child===null||n.tag===4)continue t;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function Yf(n,s,u){var _=n.tag;if(_===5||_===6)n=n.stateNode,s?(u.nodeType===9?u.body:u.nodeName==="HTML"?u.ownerDocument.body:u).insertBefore(n,s):(s=u.nodeType===9?u.body:u.nodeName==="HTML"?u.ownerDocument.body:u,s.appendChild(n),u=u._reactRootContainer,u!=null||s.onclick!==null||(s.onclick=Xe));else if(_!==4&&(_===27&&Jn(n.type)&&(u=n.stateNode,s=null),n=n.child,n!==null))for(Yf(n,s,u),n=n.sibling;n!==null;)Yf(n,s,u),n=n.sibling}function af(n,s,u){var _=n.tag;if(_===5||_===6)n=n.stateNode,s?u.insertBefore(n,s):u.appendChild(n);else if(_!==4&&(_===27&&Jn(n.type)&&(u=n.stateNode),n=n.child,n!==null))for(af(n,s,u),n=n.sibling;n!==null;)af(n,s,u),n=n.sibling}function rf(n){var s=n.stateNode,u=n.memoizedProps;try{for(var _=n.type,b=s.attributes;b.length;)s.removeAttributeNode(b[0]);Ma(s,_,u),s[Qt]=n,s[me]=u}catch(E){Ui(n,n.return,E)}}var ul=!1,Kn=!1,Gc=!1,fm=typeof WeakSet=="function"?WeakSet:Set,li=null;function Yu(n,s){if(n=n.containerInfo,rh=Cf,n=zu(n),wc(n)){if("selectionStart"in n)var u={start:n.selectionStart,end:n.selectionEnd};else t:{u=(u=n.ownerDocument)&&u.defaultView||window;var _=u.getSelection&&u.getSelection();if(_&&_.rangeCount!==0){u=_.anchorNode;var b=_.anchorOffset,E=_.focusNode;_=_.focusOffset;try{u.nodeType,E.nodeType}catch{u=null;break t}var O=0,X=-1,_t=-1,Ft=0,Wt=0,ie=n,Vt=null;e:for(;;){for(var Gt;ie!==u||b!==0&&ie.nodeType!==3||(X=O+b),ie!==E||_!==0&&ie.nodeType!==3||(_t=O+_),ie.nodeType===3&&(O+=ie.nodeValue.length),(Gt=ie.firstChild)!==null;)Vt=ie,ie=Gt;for(;;){if(ie===n)break e;if(Vt===u&&++Ft===b&&(X=O),Vt===E&&++Wt===_&&(_t=O),(Gt=ie.nextSibling)!==null)break;ie=Vt,Vt=ie.parentNode}ie=Gt}u=X===-1||_t===-1?null:{start:X,end:_t}}else u=null}u=u||{start:0,end:0}}else u=null;for(gd={focusedElem:n,selectionRange:u},Cf=!1,li=s;li!==null;)if(s=li,n=s.child,(s.subtreeFlags&1028)!==0&&n!==null)n.return=s,li=n;else for(;li!==null;){switch(s=li,E=s.alternate,n=s.flags,s.tag){case 0:if((n&4)!==0&&(n=s.updateQueue,n=n!==null?n.events:null,n!==null))for(u=0;u<n.length;u++)b=n[u],b.ref.impl=b.nextImpl;break;case 11:case 15:break;case 1:if((n&1024)!==0&&E!==null){n=void 0,u=s,b=E.memoizedProps,E=E.memoizedState,_=u.stateNode;try{var Me=Na(u.type,b);n=_.getSnapshotBeforeUpdate(Me,E),_.__reactInternalSnapshotBeforeUpdate=n}catch(Ve){Ui(u,u.return,Ve)}}break;case 3:if((n&1024)!==0){if(n=s.stateNode.containerInfo,u=n.nodeType,u===9)Tf(n);else if(u===1)switch(n.nodeName){case"HEAD":case"HTML":case"BODY":Tf(n);break;default:n.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((n&1024)!==0)throw Error(q(163))}if(n=s.sibling,n!==null){n.return=s.return,li=n;break}li=s.return}}function Wf(n,s,u){var _=u.flags;switch(u.tag){case 0:case 11:case 15:hl(n,u),_&4&&Wl(5,u);break;case 1:if(hl(n,u),_&4)if(n=u.stateNode,s===null)try{n.componentDidMount()}catch(O){Ui(u,u.return,O)}else{var b=Na(u.type,s.memoizedProps);s=s.memoizedState;try{n.componentDidUpdate(b,s,n.__reactInternalSnapshotBeforeUpdate)}catch(O){Ui(u,u.return,O)}}_&64&&Hf(u),_&512&&cl(u,u.return);break;case 3:if(hl(n,u),_&64&&(n=u.updateQueue,n!==null)){if(s=null,u.child!==null)switch(u.child.tag){case 27:case 5:s=u.child.stateNode;break;case 1:s=u.child.stateNode}try{br(n,s)}catch(O){Ui(u,u.return,O)}}break;case 27:s===null&&_&4&&rf(u);case 26:case 5:hl(n,u),s===null&&_&4&&hm(u),_&512&&cl(u,u.return);break;case 12:hl(n,u);break;case 31:hl(n,u),_&4&&Wu(n,u);break;case 13:hl(n,u),_&4&&sf(n,u),_&64&&(n=u.memoizedState,n!==null&&(n=n.dehydrated,n!==null&&(u=ug.bind(null,u),Im(n,u))));break;case 22:if(_=u.memoizedState!==null||ul,!_){s=s!==null&&s.memoizedState!==null||Kn,b=ul;var E=Kn;ul=_,(Kn=s)&&!E?Ur(n,u,(u.subtreeFlags&8772)!==0):hl(n,u),ul=b,Kn=E}break;case 30:break;default:hl(n,u)}}function ed(n){var s=n.alternate;s!==null&&(n.alternate=null,ed(s)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(s=n.stateNode,s!==null&&Js(s)),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}var rn=null,Ea=!1;function To(n,s,u){for(u=u.child;u!==null;)Kf(n,s,u),u=u.sibling}function Kf(n,s,u){if(Ji&&typeof Ji.onCommitFiberUnmount=="function")try{Ji.onCommitFiberUnmount(za,u)}catch{}switch(u.tag){case 26:Kn||wo(u,s),To(n,s,u),u.memoizedState?u.memoizedState.count--:u.stateNode&&(u=u.stateNode,u.parentNode.removeChild(u));break;case 27:Kn||wo(u,s);var _=rn,b=Ea;Jn(u.type)&&(rn=u.stateNode,Ea=!1),To(n,s,u),lh(u.stateNode),rn=_,Ea=b;break;case 5:Kn||wo(u,s);case 6:if(_=rn,b=Ea,rn=null,To(n,s,u),rn=_,Ea=b,rn!==null)if(Ea)try{(rn.nodeType===9?rn.body:rn.nodeName==="HTML"?rn.ownerDocument.body:rn).removeChild(u.stateNode)}catch(E){Ui(u,s,E)}else try{rn.removeChild(u.stateNode)}catch(E){Ui(u,s,E)}break;case 18:rn!==null&&(Ea?(n=rn,ta(n.nodeType===9?n.body:n.nodeName==="HTML"?n.ownerDocument.body:n,u.stateNode),mh(n)):ta(rn,u.stateNode));break;case 4:_=rn,b=Ea,rn=u.stateNode.containerInfo,Ea=!0,To(n,s,u),rn=_,Ea=b;break;case 0:case 11:case 14:case 15:bo(2,u,s),Kn||bo(4,u,s),To(n,s,u);break;case 1:Kn||(wo(u,s),_=u.stateNode,typeof _.componentWillUnmount=="function"&&Kl(u,s,_)),To(n,s,u);break;case 21:To(n,s,u);break;case 22:Kn=(_=Kn)||u.memoizedState!==null,To(n,s,u),Kn=_;break;default:To(n,s,u)}}function Wu(n,s){if(s.memoizedState===null&&(n=s.alternate,n!==null&&(n=n.memoizedState,n!==null))){n=n.dehydrated;try{mh(n)}catch(u){Ui(s,s.return,u)}}}function sf(n,s){if(s.memoizedState===null&&(n=s.alternate,n!==null&&(n=n.memoizedState,n!==null&&(n=n.dehydrated,n!==null))))try{mh(n)}catch(u){Ui(s,s.return,u)}}function Ku(n){switch(n.tag){case 31:case 13:case 19:var s=n.stateNode;return s===null&&(s=n.stateNode=new fm),s;case 22:return n=n.stateNode,s=n._retryCache,s===null&&(s=n._retryCache=new fm),s;default:throw Error(q(435,n.tag))}}function qc(n,s){var u=Ku(n);s.forEach(function(_){if(!u.has(_)){u.add(_);var b=hg.bind(null,n,_);_.then(b,b)}})}function ga(n,s){var u=s.deletions;if(u!==null)for(var _=0;_<u.length;_++){var b=u[_],E=n,O=s,X=O;t:for(;X!==null;){switch(X.tag){case 27:if(Jn(X.type)){rn=X.stateNode,Ea=!1;break t}break;case 5:rn=X.stateNode,Ea=!1;break t;case 3:case 4:rn=X.stateNode.containerInfo,Ea=!0;break t}X=X.return}if(rn===null)throw Error(q(160));Kf(E,O,b),rn=null,Ea=!1,E=b.alternate,E!==null&&(E.return=null),b.return=null}if(s.subtreeFlags&13886)for(s=s.child;s!==null;)pm(s,n),s=s.sibling}var lr=null;function pm(n,s){var u=n.alternate,_=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:ga(s,n),cr(n),_&4&&(bo(3,n,n.return),Wl(3,n),bo(5,n,n.return));break;case 1:ga(s,n),cr(n),_&512&&(Kn||u===null||wo(u,u.return)),_&64&&ul&&(n=n.updateQueue,n!==null&&(_=n.callbacks,_!==null&&(u=n.shared.hiddenCallbacks,n.shared.hiddenCallbacks=u===null?_:u.concat(_))));break;case 26:var b=lr;if(ga(s,n),cr(n),_&512&&(Kn||u===null||wo(u,u.return)),_&4){var E=u!==null?u.memoizedState:null;if(_=n.memoizedState,u===null)if(_===null)if(n.stateNode===null){t:{_=n.type,u=n.memoizedProps,b=b.ownerDocument||b;e:switch(_){case"title":E=b.getElementsByTagName("title")[0],(!E||E[ir]||E[Qt]||E.namespaceURI==="http://www.w3.org/2000/svg"||E.hasAttribute("itemprop"))&&(E=b.createElement(_),b.head.insertBefore(E,b.querySelector("head > title"))),Ma(E,_,u),E[Qt]=n,mn(E),_=E;break t;case"link":var O=xd("link","href",b).get(_+(u.href||""));if(O){for(var X=0;X<O.length;X++)if(E=O[X],E.getAttribute("href")===(u.href==null||u.href===""?null:u.href)&&E.getAttribute("rel")===(u.rel==null?null:u.rel)&&E.getAttribute("title")===(u.title==null?null:u.title)&&E.getAttribute("crossorigin")===(u.crossOrigin==null?null:u.crossOrigin)){O.splice(X,1);break e}}E=b.createElement(_),Ma(E,_,u),b.head.appendChild(E);break;case"meta":if(O=xd("meta","content",b).get(_+(u.content||""))){for(X=0;X<O.length;X++)if(E=O[X],E.getAttribute("content")===(u.content==null?null:""+u.content)&&E.getAttribute("name")===(u.name==null?null:u.name)&&E.getAttribute("property")===(u.property==null?null:u.property)&&E.getAttribute("http-equiv")===(u.httpEquiv==null?null:u.httpEquiv)&&E.getAttribute("charset")===(u.charSet==null?null:u.charSet)){O.splice(X,1);break e}}E=b.createElement(_),Ma(E,_,u),b.head.appendChild(E);break;default:throw Error(q(468,_))}E[Qt]=n,mn(E),_=E}n.stateNode=_}else Om(b,n.type,n.stateNode);else n.stateNode=Pp(b,_,n.memoizedProps);else E!==_?(E===null?u.stateNode!==null&&(u=u.stateNode,u.parentNode.removeChild(u)):E.count--,_===null?Om(b,n.type,n.stateNode):Pp(b,_,n.memoizedProps)):_===null&&n.stateNode!==null&&$f(n,n.memoizedProps,u.memoizedProps)}break;case 27:ga(s,n),cr(n),_&512&&(Kn||u===null||wo(u,u.return)),u!==null&&_&4&&$f(n,n.memoizedProps,u.memoizedProps);break;case 5:if(ga(s,n),cr(n),_&512&&(Kn||u===null||wo(u,u.return)),n.flags&32){b=n.stateNode;try{Bo(b,"")}catch(Me){Ui(n,n.return,Me)}}_&4&&n.stateNode!=null&&(b=n.memoizedProps,$f(n,b,u!==null?u.memoizedProps:b)),_&1024&&(Gc=!0);break;case 6:if(ga(s,n),cr(n),_&4){if(n.stateNode===null)throw Error(q(162));_=n.memoizedProps,u=n.stateNode;try{u.nodeValue=_}catch(Me){Ui(n,n.return,Me)}}break;case 3:if(su=null,b=lr,lr=Ws(s.containerInfo),ga(s,n),lr=b,cr(n),_&4&&u!==null&&u.memoizedState.isDehydrated)try{mh(s.containerInfo)}catch(Me){Ui(n,n.return,Me)}Gc&&(Gc=!1,Ql(n));break;case 4:_=lr,lr=Ws(n.stateNode.containerInfo),ga(s,n),cr(n),lr=_;break;case 12:ga(s,n),cr(n);break;case 31:ga(s,n),cr(n),_&4&&(_=n.updateQueue,_!==null&&(n.updateQueue=null,qc(n,_)));break;case 13:ga(s,n),cr(n),n.child.flags&8192&&n.memoizedState!==null!=(u!==null&&u.memoizedState!==null)&&(sd=qi()),_&4&&(_=n.updateQueue,_!==null&&(n.updateQueue=null,qc(n,_)));break;case 22:b=n.memoizedState!==null;var _t=u!==null&&u.memoizedState!==null,Ft=ul,Wt=Kn;if(ul=Ft||b,Kn=Wt||_t,ga(s,n),Kn=Wt,ul=Ft,cr(n),_&8192)t:for(s=n.stateNode,s._visibility=b?s._visibility&-2:s._visibility|1,b&&(u===null||_t||ul||Kn||Jl(n)),u=null,s=n;;){if(s.tag===5||s.tag===26){if(u===null){_t=u=s;try{if(E=_t.stateNode,b)O=E.style,typeof O.setProperty=="function"?O.setProperty("display","none","important"):O.display="none";else{X=_t.stateNode;var ie=_t.memoizedProps.style,Vt=ie!=null&&ie.hasOwnProperty("display")?ie.display:null;X.style.display=Vt==null||typeof Vt=="boolean"?"":(""+Vt).trim()}}catch(Me){Ui(_t,_t.return,Me)}}}else if(s.tag===6){if(u===null){_t=s;try{_t.stateNode.nodeValue=b?"":_t.memoizedProps}catch(Me){Ui(_t,_t.return,Me)}}}else if(s.tag===18){if(u===null){_t=s;try{var Gt=_t.stateNode;b?ea(Gt,!0):ea(_t.stateNode,!1)}catch(Me){Ui(_t,_t.return,Me)}}}else if((s.tag!==22&&s.tag!==23||s.memoizedState===null||s===n)&&s.child!==null){s.child.return=s,s=s.child;continue}if(s===n)break t;for(;s.sibling===null;){if(s.return===null||s.return===n)break t;u===s&&(u=null),s=s.return}u===s&&(u=null),s.sibling.return=s.return,s=s.sibling}_&4&&(_=n.updateQueue,_!==null&&(u=_.retryQueue,u!==null&&(_.retryQueue=null,qc(n,u))));break;case 19:ga(s,n),cr(n),_&4&&(_=n.updateQueue,_!==null&&(n.updateQueue=null,qc(n,_)));break;case 30:break;case 21:break;default:ga(s,n),cr(n)}}function cr(n){var s=n.flags;if(s&2){try{for(var u,_=n.return;_!==null;){if(dm(_)){u=_;break}_=_.return}if(u==null)throw Error(q(160));switch(u.tag){case 27:var b=u.stateNode,E=Xf(n);af(n,E,b);break;case 5:var O=u.stateNode;u.flags&32&&(Bo(O,""),u.flags&=-33);var X=Xf(n);af(n,X,O);break;case 3:case 4:var _t=u.stateNode.containerInfo,Ft=Xf(n);Yf(n,Ft,_t);break;default:throw Error(q(161))}}catch(Wt){Ui(n,n.return,Wt)}n.flags&=-3}s&4096&&(n.flags&=-4097)}function Ql(n){if(n.subtreeFlags&1024)for(n=n.child;n!==null;){var s=n;Ql(s),s.tag===5&&s.flags&1024&&s.stateNode.reset(),n=n.sibling}}function hl(n,s){if(s.subtreeFlags&8772)for(s=s.child;s!==null;)Wf(n,s.alternate,s),s=s.sibling}function Jl(n){for(n=n.child;n!==null;){var s=n;switch(s.tag){case 0:case 11:case 14:case 15:bo(4,s,s.return),Jl(s);break;case 1:wo(s,s.return);var u=s.stateNode;typeof u.componentWillUnmount=="function"&&Kl(s,s.return,u),Jl(s);break;case 27:lh(s.stateNode);case 26:case 5:wo(s,s.return),Jl(s);break;case 22:s.memoizedState===null&&Jl(s);break;case 30:Jl(s);break;default:Jl(s)}n=n.sibling}}function Ur(n,s,u){for(u=u&&(s.subtreeFlags&8772)!==0,s=s.child;s!==null;){var _=s.alternate,b=n,E=s,O=E.flags;switch(E.tag){case 0:case 11:case 15:Ur(b,E,u),Wl(4,E);break;case 1:if(Ur(b,E,u),_=E,b=_.stateNode,typeof b.componentDidMount=="function")try{b.componentDidMount()}catch(Ft){Ui(_,_.return,Ft)}if(_=E,b=_.updateQueue,b!==null){var X=_.stateNode;try{var _t=b.shared.hiddenCallbacks;if(_t!==null)for(b.shared.hiddenCallbacks=null,b=0;b<_t.length;b++)Gh(_t[b],X)}catch(Ft){Ui(_,_.return,Ft)}}u&&O&64&&Hf(E),cl(E,E.return);break;case 27:rf(E);case 26:case 5:Ur(b,E,u),u&&_===null&&O&4&&hm(E),cl(E,E.return);break;case 12:Ur(b,E,u);break;case 31:Ur(b,E,u),u&&O&4&&Wu(b,E);break;case 13:Ur(b,E,u),u&&O&4&&sf(b,E);break;case 22:E.memoizedState===null&&Ur(b,E,u),cl(E,E.return);break;case 30:break;default:Ur(b,E,u)}s=s.sibling}}function id(n,s){var u=null;n!==null&&n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(u=n.memoizedState.cachePool.pool),n=null,s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(n=s.memoizedState.cachePool.pool),n!==u&&(n!=null&&n.refCount++,u!=null&&Xn(u))}function of(n,s){n=null,s.alternate!==null&&(n=s.alternate.memoizedState.cache),s=s.memoizedState.cache,s!==n&&(s.refCount++,n!=null&&Xn(n))}function bs(n,s,u,_){if(s.subtreeFlags&10256)for(s=s.child;s!==null;)mm(n,s,u,_),s=s.sibling}function mm(n,s,u,_){var b=s.flags;switch(s.tag){case 0:case 11:case 15:bs(n,s,u,_),b&2048&&Wl(9,s);break;case 1:bs(n,s,u,_);break;case 3:bs(n,s,u,_),b&2048&&(n=null,s.alternate!==null&&(n=s.alternate.memoizedState.cache),s=s.memoizedState.cache,s!==n&&(s.refCount++,n!=null&&Xn(n)));break;case 12:if(b&2048){bs(n,s,u,_),n=s.stateNode;try{var E=s.memoizedProps,O=E.id,X=E.onPostCommit;typeof X=="function"&&X(O,s.alternate===null?"mount":"update",n.passiveEffectDuration,-0)}catch(_t){Ui(s,s.return,_t)}}else bs(n,s,u,_);break;case 31:bs(n,s,u,_);break;case 13:bs(n,s,u,_);break;case 23:break;case 22:E=s.stateNode,O=s.alternate,s.memoizedState!==null?E._visibility&2?bs(n,s,u,_):nd(n,s):E._visibility&2?bs(n,s,u,_):(E._visibility|=2,Qu(n,s,u,_,(s.subtreeFlags&10256)!==0||!1)),b&2048&&id(O,s);break;case 24:bs(n,s,u,_),b&2048&&of(s.alternate,s);break;default:bs(n,s,u,_)}}function Qu(n,s,u,_,b){for(b=b&&((s.subtreeFlags&10256)!==0||!1),s=s.child;s!==null;){var E=n,O=s,X=u,_t=_,Ft=O.flags;switch(O.tag){case 0:case 11:case 15:Qu(E,O,X,_t,b),Wl(8,O);break;case 23:break;case 22:var Wt=O.stateNode;O.memoizedState!==null?Wt._visibility&2?Qu(E,O,X,_t,b):nd(E,O):(Wt._visibility|=2,Qu(E,O,X,_t,b)),b&&Ft&2048&&id(O.alternate,O);break;case 24:Qu(E,O,X,_t,b),b&&Ft&2048&&of(O.alternate,O);break;default:Qu(E,O,X,_t,b)}s=s.sibling}}function nd(n,s){if(s.subtreeFlags&10256)for(s=s.child;s!==null;){var u=n,_=s,b=_.flags;switch(_.tag){case 22:nd(u,_),b&2048&&id(_.alternate,_);break;case 24:nd(u,_),b&2048&&of(_.alternate,_);break;default:nd(u,_)}s=s.sibling}}var ad=8192;function Ju(n,s,u){if(n.subtreeFlags&ad)for(n=n.child;n!==null;)Zc(n,s,u),n=n.sibling}function Zc(n,s,u){switch(n.tag){case 26:Ju(n,s,u),n.flags&ad&&n.memoizedState!==null&&yg(u,lr,n.memoizedState,n.memoizedProps);break;case 5:Ju(n,s,u);break;case 3:case 4:var _=lr;lr=Ws(n.stateNode.containerInfo),Ju(n,s,u),lr=_;break;case 22:n.memoizedState===null&&(_=n.alternate,_!==null&&_.memoizedState!==null?(_=ad,ad=16777216,Ju(n,s,u),ad=_):Ju(n,s,u));break;default:Ju(n,s,u)}}function gm(n){var s=n.alternate;if(s!==null&&(n=s.child,n!==null)){s.child=null;do s=n.sibling,n.sibling=null,n=s;while(n!==null)}}function rd(n){var s=n.deletions;if((n.flags&16)!==0){if(s!==null)for(var u=0;u<s.length;u++){var _=s[u];li=_,Jf(_,n)}gm(n)}if(n.subtreeFlags&10256)for(n=n.child;n!==null;)Qf(n),n=n.sibling}function Qf(n){switch(n.tag){case 0:case 11:case 15:rd(n),n.flags&2048&&bo(9,n,n.return);break;case 3:rd(n);break;case 12:rd(n);break;case 22:var s=n.stateNode;n.memoizedState!==null&&s._visibility&2&&(n.return===null||n.return.tag!==13)?(s._visibility&=-3,lf(n)):rd(n);break;default:rd(n)}}function lf(n){var s=n.deletions;if((n.flags&16)!==0){if(s!==null)for(var u=0;u<s.length;u++){var _=s[u];li=_,Jf(_,n)}gm(n)}for(n=n.child;n!==null;){switch(s=n,s.tag){case 0:case 11:case 15:bo(8,s,s.return),lf(s);break;case 22:u=s.stateNode,u._visibility&2&&(u._visibility&=-3,lf(s));break;default:lf(s)}n=n.sibling}}function Jf(n,s){for(;li!==null;){var u=li;switch(u.tag){case 0:case 11:case 15:bo(8,u,s);break;case 23:case 22:if(u.memoizedState!==null&&u.memoizedState.cachePool!==null){var _=u.memoizedState.cachePool.pool;_!=null&&_.refCount++}break;case 24:Xn(u.memoizedState.cache)}if(_=u.child,_!==null)_.return=u,li=_;else t:for(u=n;li!==null;){_=li;var b=_.sibling,E=_.return;if(ed(_),_===u){li=null;break t}if(b!==null){b.return=E,li=b;break t}li=E}}}var rg={getCacheForType:function(n){var s=$n(Rn),u=s.data.get(n);return u===void 0&&(u=n(),s.data.set(n,u)),u},cacheSignal:function(){return $n(Rn).controller.signal}},tp=typeof WeakMap=="function"?WeakMap:Map,bi=0,Yi=null,_i=null,xi=0,Vi=0,Tr=null,tc=!1,th=!1,Hc=!1,So=0,jn=0,ec=0,$c=0,ep=0,Gr=0,Xc=0,Yc=null,ur=null,cf=!1,sd=0,_m=0,Wc=1/0,uf=null,dl=null,_a=0,ic=null,eh=null,Eo=0,ip=0,np=null,Qn=null,fl=0,ap=null;function qr(){return(bi&2)!==0&&xi!==0?xi&-xi:$t.T!==null?ud():Oi()}function rp(){if(Gr===0)if((xi&536870912)===0||hi){var n=Et;Et<<=1,(Et&3932160)===0&&(Et=262144),Gr=n}else Gr=536870912;return n=ma.current,n!==null&&(n.flags|=32),Gr}function hr(n,s,u){(n===Yi&&(Vi===2||Vi===9)||n.cancelPendingCommit!==null)&&(Kc(n,0),Zr(n,xi,Gr,!1)),je(n,u),((bi&2)===0||n!==Yi)&&(n===Yi&&((bi&2)===0&&($c|=u),jn===4&&Zr(n,xi,Gr,!1)),Hr(n))}function ym(n,s,u){if((bi&6)!==0)throw Error(q(327));var _=!u&&(s&127)===0&&(s&n.expiredLanes)===0||jt(n,s),b=_?og(n,s):lp(n,s,!0),E=_;do{if(b===0){th&&!_&&Zr(n,s,0,!1);break}else{if(u=n.current.alternate,E&&!vm(u)){b=lp(n,s,!1),E=!1;continue}if(b===2){if(E=s,n.errorRecoveryDisabledLanes&E)var O=0;else O=n.pendingLanes&-536870913,O=O!==0?O:O&536870912?536870912:0;if(O!==0){s=O;t:{var X=n;b=Yc;var _t=X.current.memoizedState.isDehydrated;if(_t&&(Kc(X,O).flags|=256),O=lp(X,O,!1),O!==2){if(Hc&&!_t){X.errorRecoveryDisabledLanes|=E,$c|=E,b=4;break t}E=ur,ur=b,E!==null&&(ur===null?ur=E:ur.push.apply(ur,E))}b=O}if(E=!1,b!==2)continue}}if(b===1){Kc(n,0),Zr(n,s,0,!0);break}t:{switch(_=n,E=b,E){case 0:case 1:throw Error(q(345));case 4:if((s&4194048)!==s)break;case 6:Zr(_,s,Gr,!tc);break t;case 2:ur=null;break;case 3:case 5:break;default:throw Error(q(329))}if((s&62914560)===s&&(b=sd+300-qi(),10<b)){if(Zr(_,s,Gr,!tc),Nt(_,0,!0)!==0)break t;Eo=s,_.timeoutHandle=ya(sp.bind(null,_,u,ur,uf,cf,s,Gr,$c,Xc,tc,E,"Throttled",-0,0),b);break t}sp(_,u,ur,uf,cf,s,Gr,$c,Xc,tc,E,null,-0,0)}}break}while(!0);Hr(n)}function sp(n,s,u,_,b,E,O,X,_t,Ft,Wt,ie,Vt,Gt){if(n.timeoutHandle=-1,ie=s.subtreeFlags,ie&8192||(ie&16785408)===16785408){ie={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:Xe},Zc(s,E,ie);var Me=(E&62914560)===E?sd-qi():(E&4194048)===E?_m-qi():0;if(Me=Bm(ie,Me),Me!==null){Eo=E,n.cancelPendingCommit=Me(Sm.bind(null,n,s,E,u,_,b,O,X,_t,Wt,ie,null,Vt,Gt)),Zr(n,E,O,!Ft);return}}Sm(n,s,E,u,_,b,O,X,_t)}function vm(n){for(var s=n;;){var u=s.tag;if((u===0||u===11||u===15)&&s.flags&16384&&(u=s.updateQueue,u!==null&&(u=u.stores,u!==null)))for(var _=0;_<u.length;_++){var b=u[_],E=b.getSnapshot;b=b.value;try{if(!da(E(),b))return!1}catch{return!1}}if(u=s.child,s.subtreeFlags&16384&&u!==null)u.return=s,s=u;else{if(s===n)break;for(;s.sibling===null;){if(s.return===null||s.return===n)return!0;s=s.return}s.sibling.return=s.return,s=s.sibling}}return!0}function Zr(n,s,u,_){s&=~ep,s&=~$c,n.suspendedLanes|=s,n.pingedLanes&=~s,_&&(n.warmLanes|=s),_=n.expirationTimes;for(var b=s;0<b;){var E=31-F(b),O=1<<E;_[E]=-1,b&=~O}u!==0&&Je(n,u,s)}function ih(){return(bi&6)===0?(tu(0),!1):!0}function hf(){if(_i!==null){if(Vi===0)var n=_i.return;else n=_i,Nr=ho=null,Hl(n),Bs=null,el=0,n=_i;for(;n!==null;)um(n.alternate,n),n=n.return;_i=null}}function Kc(n,s){var u=n.timeoutHandle;u!==-1&&(n.timeoutHandle=-1,ni(u)),u=n.cancelPendingCommit,u!==null&&(n.cancelPendingCommit=null,u()),Eo=0,hf(),Yi=n,_i=u=kr(n.current,null),xi=s,Vi=0,Tr=null,tc=!1,th=jt(n,s),Hc=!1,Xc=Gr=ep=$c=ec=jn=0,ur=Yc=null,cf=!1,(s&8)!==0&&(s|=s&32);var _=n.entangledLanes;if(_!==0)for(n=n.entanglements,_&=s;0<_;){var b=31-F(_),E=1<<b;s|=n[b],_&=~E}return So=s,Cc(),u}function df(n,s){We=null,$t.H=$l,s===Fr||s===kc?(s=Uh(),Vi=3):s===Lc?(s=Uh(),Vi=4):Vi=s===Xh?8:s!==null&&typeof s=="object"&&typeof s.then=="function"?6:1,Tr=s,_i===null&&(jn=1,Hh(n,ka(s,n.current)))}function Qc(){var n=ma.current;return n===null?!0:(xi&4194048)===xi?$i===null:(xi&62914560)===xi||(xi&536870912)!==0?n===$i:!1}function op(){var n=$t.H;return $t.H=$l,n===null?$l:n}function xm(){var n=$t.A;return $t.A=rg,n}function ff(){jn=4,tc||(xi&4194048)!==xi&&ma.current!==null||(th=!0),(ec&134217727)===0&&($c&134217727)===0||Yi===null||Zr(Yi,xi,Gr,!1)}function lp(n,s,u){var _=bi;bi|=2;var b=op(),E=xm();(Yi!==n||xi!==s)&&(uf=null,Kc(n,s)),s=!1;var O=jn;t:do try{if(Vi!==0&&_i!==null){var X=_i,_t=Tr;switch(Vi){case 8:hf(),O=6;break t;case 3:case 2:case 9:case 6:ma.current===null&&(s=!0);var Ft=Vi;if(Vi=0,Tr=null,nh(n,X,_t,Ft),u&&th){O=0;break t}break;default:Ft=Vi,Vi=0,Tr=null,nh(n,X,_t,Ft)}}sg(),O=jn;break}catch(Wt){df(n,Wt)}while(!0);return s&&n.shellSuspendCounter++,Nr=ho=null,bi=_,$t.H=b,$t.A=E,_i===null&&(Yi=null,xi=0,Cc()),O}function sg(){for(;_i!==null;)bm(_i)}function og(n,s){var u=bi;bi|=2;var _=op(),b=xm();Yi!==n||xi!==s?(uf=null,Wc=qi()+500,Kc(n,s)):th=jt(n,s);t:do try{if(Vi!==0&&_i!==null){s=_i;var E=Tr;e:switch(Vi){case 1:Vi=0,Tr=null,nh(n,s,E,1);break;case 2:case 9:if(ms(E)){Vi=0,Tr=null,wm(s);break}s=function(){Vi!==2&&Vi!==9||Yi!==n||(Vi=7),Hr(n)},E.then(s,s);break t;case 3:Vi=7;break t;case 4:Vi=5;break t;case 7:ms(E)?(Vi=0,Tr=null,wm(s)):(Vi=0,Tr=null,nh(n,s,E,7));break;case 5:var O=null;switch(_i.tag){case 26:O=_i.memoizedState;case 5:case 27:var X=_i;if(O?Rp(O):X.stateNode.complete){Vi=0,Tr=null;var _t=X.sibling;if(_t!==null)_i=_t;else{var Ft=X.return;Ft!==null?(_i=Ft,pf(Ft)):_i=null}break e}}Vi=0,Tr=null,nh(n,s,E,5);break;case 6:Vi=0,Tr=null,nh(n,s,E,6);break;case 8:hf(),jn=6;break t;default:throw Error(q(462))}}lg();break}catch(Wt){df(n,Wt)}while(!0);return Nr=ho=null,$t.H=_,$t.A=b,bi=u,_i!==null?0:(Yi=null,xi=0,Cc(),jn)}function lg(){for(;_i!==null&&!fn();)bm(_i)}function bm(n){var s=lm(n.alternate,n,So);n.memoizedProps=n.pendingProps,s===null?pf(n):_i=s}function wm(n){var s=n,u=s.alternate;switch(s.tag){case 15:case 0:s=Vf(u,s,s.pendingProps,s.type,void 0,xi);break;case 11:s=Vf(u,s,s.pendingProps,s.type.render,s.ref,xi);break;case 5:Hl(s);default:um(u,s),s=_i=Gd(s,So),s=lm(u,s,So)}n.memoizedProps=n.pendingProps,s===null?pf(n):_i=s}function nh(n,s,u,_){Nr=ho=null,Hl(s),Bs=null,el=0;var b=s.return;try{if(eg(n,b,s,u,xi)){jn=1,Hh(n,ka(u,n.current)),_i=null;return}}catch(E){if(b!==null)throw _i=b,E;jn=1,Hh(n,ka(u,n.current)),_i=null;return}s.flags&32768?(hi||_===1?n=!0:th||(xi&536870912)!==0?n=!1:(tc=n=!0,(_===2||_===9||_===3||_===6)&&(_=ma.current,_!==null&&_.tag===13&&(_.flags|=16384))),Tm(s,n)):pf(s)}function pf(n){var s=n;do{if((s.flags&32768)!==0){Tm(s,tc);return}n=s.return;var u=ng(s.alternate,s,So);if(u!==null){_i=u;return}if(s=s.sibling,s!==null){_i=s;return}_i=s=n}while(s!==null);jn===0&&(jn=5)}function Tm(n,s){do{var u=ag(n.alternate,n);if(u!==null){u.flags&=32767,_i=u;return}if(u=n.return,u!==null&&(u.flags|=32768,u.subtreeFlags=0,u.deletions=null),!s&&(n=n.sibling,n!==null)){_i=n;return}_i=n=u}while(n!==null);jn=6,_i=null}function Sm(n,s,u,_,b,E,O,X,_t){n.cancelPendingCommit=null;do Jc();while(_a!==0);if((bi&6)!==0)throw Error(q(327));if(s!==null){if(s===n.current)throw Error(q(177));if(E=s.lanes|s.childLanes,E|=kl,pn(n,u,E,O,X,_t),n===Yi&&(_i=Yi=null,xi=0),eh=s,ic=n,Eo=u,ip=E,np=b,Qn=_,(s.subtreeFlags&10256)!==0||(s.flags&10256)!==0?(n.callbackNode=null,n.callbackPriority=0,Cm(Wr,function(){return gf(),null})):(n.callbackNode=null,n.callbackPriority=0),_=(s.flags&13878)!==0,(s.subtreeFlags&13878)!==0||_){_=$t.T,$t.T=null,b=de.p,de.p=2,O=bi,bi|=4;try{Yu(n,s,u)}finally{bi=O,de.p=b,$t.T=_}}_a=1,cp(),mf(),up()}}function cp(){if(_a===1){_a=0;var n=ic,s=eh,u=(s.flags&13878)!==0;if((s.subtreeFlags&13878)!==0||u){u=$t.T,$t.T=null;var _=de.p;de.p=2;var b=bi;bi|=4;try{pm(s,n);var E=gd,O=zu(n.containerInfo),X=E.focusedElem,_t=E.selectionRange;if(O!==X&&X&&X.ownerDocument&&Du(X.ownerDocument.documentElement,X)){if(_t!==null&&wc(X)){var Ft=_t.start,Wt=_t.end;if(Wt===void 0&&(Wt=Ft),"selectionStart"in X)X.selectionStart=Ft,X.selectionEnd=Math.min(Wt,X.value.length);else{var ie=X.ownerDocument||document,Vt=ie&&ie.defaultView||window;if(Vt.getSelection){var Gt=Vt.getSelection(),Me=X.textContent.length,Ve=Math.min(_t.start,Me),Gi=_t.end===void 0?Ve:Math.min(_t.end,Me);!Gt.extend&&Ve>Gi&&(O=Gi,Gi=Ve,Ve=O);var Ct=Au(X,Ve),St=Au(X,Gi);if(Ct&&St&&(Gt.rangeCount!==1||Gt.anchorNode!==Ct.node||Gt.anchorOffset!==Ct.offset||Gt.focusNode!==St.node||Gt.focusOffset!==St.offset)){var Ot=ie.createRange();Ot.setStart(Ct.node,Ct.offset),Gt.removeAllRanges(),Ve>Gi?(Gt.addRange(Ot),Gt.extend(St.node,St.offset)):(Ot.setEnd(St.node,St.offset),Gt.addRange(Ot))}}}}for(ie=[],Gt=X;Gt=Gt.parentNode;)Gt.nodeType===1&&ie.push({element:Gt,left:Gt.scrollLeft,top:Gt.scrollTop});for(typeof X.focus=="function"&&X.focus(),X=0;X<ie.length;X++){var te=ie[X];te.element.scrollLeft=te.left,te.element.scrollTop=te.top}}Cf=!!rh,gd=rh=null}finally{bi=b,de.p=_,$t.T=u}}n.current=s,_a=2}}function mf(){if(_a===2){_a=0;var n=ic,s=eh,u=(s.flags&8772)!==0;if((s.subtreeFlags&8772)!==0||u){u=$t.T,$t.T=null;var _=de.p;de.p=2;var b=bi;bi|=4;try{Wf(n,s.alternate,s)}finally{bi=b,de.p=_,$t.T=u}}_a=3}}function up(){if(_a===4||_a===3){_a=0,xa();var n=ic,s=eh,u=Eo,_=Qn;(s.subtreeFlags&10256)!==0||(s.flags&10256)!==0?_a=5:(_a=0,eh=ic=null,pl(n,n.pendingLanes));var b=n.pendingLanes;if(b===0&&(dl=null),ki(u),s=s.stateNode,Ji&&typeof Ji.onCommitFiberRoot=="function")try{Ji.onCommitFiberRoot(za,s,void 0,(s.current.flags&128)===128)}catch{}if(_!==null){s=$t.T,b=de.p,de.p=2,$t.T=null;try{for(var E=n.onRecoverableError,O=0;O<_.length;O++){var X=_[O];E(X.value,{componentStack:X.stack})}}finally{$t.T=s,de.p=b}}(Eo&3)!==0&&Jc(),Hr(n),b=n.pendingLanes,(u&261930)!==0&&(b&42)!==0?n===ap?fl++:(fl=0,ap=n):fl=0,tu(0)}}function pl(n,s){(n.pooledCacheLanes&=s)===0&&(s=n.pooledCache,s!=null&&(n.pooledCache=null,Xn(s)))}function Jc(){return cp(),mf(),up(),gf()}function gf(){if(_a!==5)return!1;var n=ic,s=ip;ip=0;var u=ki(Eo),_=$t.T,b=de.p;try{de.p=32>u?32:u,$t.T=null,u=np,np=null;var E=ic,O=Eo;if(_a=0,eh=ic=null,Eo=0,(bi&6)!==0)throw Error(q(331));var X=bi;if(bi|=4,Qf(E.current),mm(E,E.current,O,u),bi=X,tu(0,!1),Ji&&typeof Ji.onPostCommitFiberRoot=="function")try{Ji.onPostCommitFiberRoot(za,E)}catch{}return!0}finally{de.p=b,$t.T=_,pl(n,s)}}function Em(n,s,u){s=ka(u,s),s=Kd(n.stateNode,s,2),n=xr(n,s,2),n!==null&&(je(n,2),Hr(n))}function Ui(n,s,u){if(n.tag===3)Em(n,n,u);else for(;s!==null;){if(s.tag===3){Em(s,n,u);break}else if(s.tag===1){var _=s.stateNode;if(typeof s.type.getDerivedStateFromError=="function"||typeof _.componentDidCatch=="function"&&(dl===null||!dl.has(_))){n=ka(u,n),u=em(2),_=xr(s,u,2),_!==null&&(Qd(u,_,s,n),je(_,2),Hr(_));break}}s=s.return}}function hp(n,s,u){var _=n.pingCache;if(_===null){_=n.pingCache=new tp;var b=new Set;_.set(s,b)}else b=_.get(s),b===void 0&&(b=new Set,_.set(s,b));b.has(u)||(Hc=!0,b.add(u),n=cg.bind(null,n,s,u),s.then(n,n))}function cg(n,s,u){var _=n.pingCache;_!==null&&_.delete(s),n.pingedLanes|=n.suspendedLanes&u,n.warmLanes&=~u,Yi===n&&(xi&u)===u&&(jn===4||jn===3&&(xi&62914560)===xi&&300>qi()-sd?(bi&2)===0&&Kc(n,0):ep|=u,Xc===xi&&(Xc=0)),Hr(n)}function Mm(n,s){s===0&&(s=ye()),n=oo(n,s),n!==null&&(je(n,s),Hr(n))}function ug(n){var s=n.memoizedState,u=0;s!==null&&(u=s.retryLane),Mm(n,u)}function hg(n,s){var u=0;switch(n.tag){case 31:case 13:var _=n.stateNode,b=n.memoizedState;b!==null&&(u=b.retryLane);break;case 19:_=n.stateNode;break;case 22:_=n.stateNode._retryCache;break;default:throw Error(q(314))}_!==null&&_.delete(s),Mm(n,u)}function Cm(n,s){return ca(n,s)}var od=null,Sr=null,Mo=!1,ld=!1,cd=!1,nc=0;function Hr(n){n!==Sr&&n.next===null&&(Sr===null?od=Sr=n:Sr=Sr.next=n),ld=!0,Mo||(Mo=!0,Am())}function tu(n,s){if(!cd&&ld){cd=!0;do for(var u=!1,_=od;_!==null;){if(n!==0){var b=_.pendingLanes;if(b===0)var E=0;else{var O=_.suspendedLanes,X=_.pingedLanes;E=(1<<31-F(42|n)+1)-1,E&=b&~(O&~X),E=E&201326741?E&201326741|1:E?E|2:0}E!==0&&(u=!0,dp(_,E))}else E=xi,E=Nt(_,_===Yi?E:0,_.cancelPendingCommit!==null||_.timeoutHandle!==-1),(E&3)===0||jt(_,E)||(u=!0,dp(_,E));_=_.next}while(u);cd=!1}}function dg(){_f()}function _f(){ld=Mo=!1;var n=0;nc!==0&&mg()&&(n=nc);for(var s=qi(),u=null,_=od;_!==null;){var b=_.next,E=yf(_,s);E===0?(_.next=null,u===null?od=b:u.next=b,b===null&&(Sr=u)):(u=_,(n!==0||(E&3)!==0)&&(ld=!0)),_=b}_a!==0&&_a!==5||tu(n),nc!==0&&(nc=0)}function yf(n,s){for(var u=n.suspendedLanes,_=n.pingedLanes,b=n.expirationTimes,E=n.pendingLanes&-62914561;0<E;){var O=31-F(E),X=1<<O,_t=b[O];_t===-1?((X&u)===0||(X&_)!==0)&&(b[O]=Ut(X,s)):_t<=s&&(n.expiredLanes|=X),E&=~X}if(s=Yi,u=xi,u=Nt(n,n===s?u:0,n.cancelPendingCommit!==null||n.timeoutHandle!==-1),_=n.callbackNode,u===0||n===s&&(Vi===2||Vi===9)||n.cancelPendingCommit!==null)return _!==null&&_!==null&&Qi(_),n.callbackNode=null,n.callbackPriority=0;if((u&3)===0||jt(n,u)){if(s=u&-u,s===n.callbackPriority)return s;switch(_!==null&&Qi(_),ki(u)){case 2:case 8:u=Sl;break;case 32:u=Wr;break;case 268435456:u=Ts;break;default:u=Wr}return _=eu.bind(null,n),u=ca(u,_),n.callbackPriority=s,n.callbackNode=u,s}return _!==null&&_!==null&&Qi(_),n.callbackPriority=2,n.callbackNode=null,2}function eu(n,s){if(_a!==0&&_a!==5)return n.callbackNode=null,n.callbackPriority=0,null;var u=n.callbackNode;if(Jc()&&n.callbackNode!==u)return null;var _=xi;return _=Nt(n,n===Yi?_:0,n.cancelPendingCommit!==null||n.timeoutHandle!==-1),_===0?null:(ym(n,_,s),yf(n,qi()),n.callbackNode!=null&&n.callbackNode===u?eu.bind(null,n):null)}function dp(n,s){if(Jc())return null;ym(n,s,!0)}function Am(){Ys(function(){(bi&6)!==0?ca(Io,dg):_f()})}function ud(){if(nc===0){var n=fs;n===0&&(n=ut,ut<<=1,(ut&261888)===0&&(ut=256)),nc=n}return nc}function fp(n){return n==null||typeof n=="symbol"||typeof n=="boolean"?null:typeof n=="function"?n:Ia(""+n)}function hd(n,s){var u=s.ownerDocument.createElement("input");return u.name=s.name,u.value=s.value,n.id&&u.setAttribute("form",n.id),s.parentNode.insertBefore(u,s),n=new FormData(n),u.parentNode.removeChild(u),n}function Dm(n,s,u,_,b){if(s==="submit"&&u&&u.stateNode===b){var E=fp((b[me]||null).action),O=_.submitter;O&&(s=(s=O[me]||null)?fp(s.formAction):O.getAttribute("formAction"),s!==null&&(E=s,O=null));var X=new Ze("action","action",null,_,b);n.push({event:X,listeners:[{instance:null,listener:function(){if(_.defaultPrevented){if(nc!==0){var _t=O?hd(b,O):new FormData(b);ys(u,{pending:!0,data:_t,method:b.method,action:E},null,_t)}}else typeof E=="function"&&(X.preventDefault(),_t=O?hd(b,O):new FormData(b),ys(u,{pending:!0,data:_t,method:b.method,action:E},E,_t))},currentTarget:b}]})}}for(var pp=0;pp<Mc.length;pp++){var mp=Mc[pp],fg=mp.toLowerCase(),pg=mp[0].toUpperCase()+mp.slice(1);fa(fg,"on"+pg)}fa(Sc,"onAnimationEnd"),fa(Iu,"onAnimationIteration"),fa(ro,"onAnimationStart"),fa("dblclick","onDoubleClick"),fa("focusin","onFocus"),fa("focusout","onBlur"),fa(Ec,"onTransitionRun"),fa(Ll,"onTransitionStart"),fa(gr,"onTransitionCancel"),fa(Bh,"onTransitionEnd"),Pa("onMouseEnter",["mouseout","mouseover"]),Pa("onMouseLeave",["mouseout","mouseover"]),Pa("onPointerEnter",["pointerout","pointerover"]),Pa("onPointerLeave",["pointerout","pointerover"]),ko("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),ko("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),ko("onBeforeInput",["compositionend","keypress","textInput","paste"]),ko("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),ko("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),ko("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var dd="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),gp=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(dd));function ml(n,s){s=(s&4)!==0;for(var u=0;u<n.length;u++){var _=n[u],b=_.event;_=_.listeners;t:{var E=void 0;if(s)for(var O=_.length-1;0<=O;O--){var X=_[O],_t=X.instance,Ft=X.currentTarget;if(X=X.listener,_t!==E&&b.isPropagationStopped())break t;E=X,b.currentTarget=Ft;try{E(b)}catch(Wt){$o(Wt)}b.currentTarget=null,E=_t}else for(O=0;O<_.length;O++){if(X=_[O],_t=X.instance,Ft=X.currentTarget,X=X.listener,_t!==E&&b.isPropagationStopped())break t;E=X,b.currentTarget=Ft;try{E(b)}catch(Wt){$o(Wt)}b.currentTarget=null,E=_t}}}}function di(n,s){var u=s[ba];u===void 0&&(u=s[ba]=new Set);var _=n+"__bubble";u.has(_)||(_p(s,n,2,!1),u.add(_))}function vf(n,s,u){var _=0;s&&(_|=4),_p(u,n,_,s)}var fd="_reactListening"+Math.random().toString(36).slice(2);function xf(n){if(!n[fd]){n[fd]=!0,Ua.forEach(function(u){u!=="selectionchange"&&(gp.has(u)||vf(u,!1,n),vf(u,!0,n))});var s=n.nodeType===9?n:n.ownerDocument;s===null||s[fd]||(s[fd]=!0,vf("selectionchange",!1,s))}}function _p(n,s,u,_){switch(jm(s)){case 2:var b=Nm;break;case 8:b=Fm;break;default:b=Fp}u=b.bind(null,s,u,n),b=void 0,!aa||s!=="touchstart"&&s!=="touchmove"&&s!=="wheel"||(b=!0),_?b!==void 0?n.addEventListener(s,u,{capture:!0,passive:b}):n.addEventListener(s,u,!0):b!==void 0?n.addEventListener(s,u,{passive:b}):n.addEventListener(s,u,!1)}function bf(n,s,u,_,b){var E=_;if((s&1)===0&&(s&2)===0&&_!==null)t:for(;;){if(_===null)return;var O=_.tag;if(O===3||O===4){var X=_.stateNode.containerInfo;if(X===b)break;if(O===4)for(O=_.return;O!==null;){var _t=O.tag;if((_t===3||_t===4)&&O.stateNode.containerInfo===b)return;O=O.return}for(;X!==null;){if(O=zr(X),O===null)return;if(_t=O.tag,_t===5||_t===6||_t===26||_t===27){_=E=O;continue t}X=X.parentNode}}_=_.return}gc(function(){var Ft=E,Wt=wn(u),ie=[];t:{var Vt=Nh.get(n);if(Vt!==void 0){var Gt=Ze,Me=n;switch(n){case"keypress":if(to(u)===0)break t;case"keydown":case"keyup":Gt=bu;break;case"focusin":Me="focus",Gt=io;break;case"focusout":Me="blur",Gt=io;break;case"beforeblur":case"afterblur":Gt=io;break;case"click":if(u.button===2)break t;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Gt=_c;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Gt=vc;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Gt=wu;break;case Sc:case Iu:case ro:Gt=ns;break;case Bh:Gt=Za;break;case"scroll":case"scrollend":Gt=ci;break;case"wheel":Gt=Fo;break;case"copy":case"cut":case"paste":Gt=vu;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Gt=Rd;break;case"toggle":case"beforetoggle":Gt=xc}var Ve=(s&4)!==0,Gi=!Ve&&(n==="scroll"||n==="scrollend"),Ct=Ve?Vt!==null?Vt+"Capture":null:Vt;Ve=[];for(var St=Ft,Ot;St!==null;){var te=St;if(Ot=te.stateNode,te=te.tag,te!==5&&te!==26&&te!==27||Ot===null||Ct===null||(te=Hn(St,Ct),te!=null&&Ve.push(ac(St,te,Ot))),Gi)break;St=St.return}0<Ve.length&&(Vt=new Gt(Vt,Me,null,u,Wt),ie.push({event:Vt,listeners:Ve}))}}if((s&7)===0){t:{if(Vt=n==="mouseover"||n==="pointerover",Gt=n==="mouseout"||n==="pointerout",Vt&&u!==ts&&(Me=u.relatedTarget||u.fromElement)&&(zr(Me)||Me[Ae]))break t;if((Gt||Vt)&&(Vt=Wt.window===Wt?Wt:(Vt=Wt.ownerDocument)?Vt.defaultView||Vt.parentWindow:window,Gt?(Me=u.relatedTarget||u.toElement,Gt=Ft,Me=Me?zr(Me):null,Me!==null&&(Gi=yt(Me),Ve=Me.tag,Me!==Gi||Ve!==5&&Ve!==27&&Ve!==6)&&(Me=null)):(Gt=null,Me=Ft),Gt!==Me)){if(Ve=_c,te="onMouseLeave",Ct="onMouseEnter",St="mouse",(n==="pointerout"||n==="pointerover")&&(Ve=Rd,te="onPointerLeave",Ct="onPointerEnter",St="pointer"),Gi=Gt==null?Vt:Pr(Gt),Ot=Me==null?Vt:Pr(Me),Vt=new Ve(te,St+"leave",Gt,u,Wt),Vt.target=Gi,Vt.relatedTarget=Ot,te=null,zr(Wt)===Ft&&(Ve=new Ve(Ct,St+"enter",Me,u,Wt),Ve.target=Ot,Ve.relatedTarget=Gi,te=Ve),Gi=te,Gt&&Me)e:{for(Ve=md,Ct=Gt,St=Me,Ot=0,te=Ct;te;te=Ve(te))Ot++;te=0;for(var Oe=St;Oe;Oe=Ve(Oe))te++;for(;0<Ot-te;)Ct=Ve(Ct),Ot--;for(;0<te-Ot;)St=Ve(St),te--;for(;Ot--;){if(Ct===St||St!==null&&Ct===St.alternate){Ve=Ct;break e}Ct=Ve(Ct),St=Ve(St)}Ve=null}else Ve=null;Gt!==null&&yp(ie,Vt,Gt,Ve,!1),Me!==null&&Gi!==null&&yp(ie,Gi,Me,Ve,!0)}}t:{if(Vt=Ft?Pr(Ft):window,Gt=Vt.nodeName&&Vt.nodeName.toLowerCase(),Gt==="select"||Gt==="input"&&Vt.type==="file")var wi=Ph;else if(Eu(Vt))if(Ih)wi=Lh;else{wi=Mu;var De=jd}else Gt=Vt.nodeName,!Gt||Gt.toLowerCase()!=="input"||Vt.type!=="checkbox"&&Vt.type!=="radio"?Ft&&Jr(Ft.elementType)&&(wi=Ph):wi=Rh;if(wi&&(wi=wi(n,Ft))){Dh(ie,wi,u,Wt);break t}De&&De(n,Vt,Ft),n==="focusout"&&Ft&&Vt.type==="number"&&Ft.memoizedProps.value!=null&&pc(Vt,"number",Vt.value)}switch(De=Ft?Pr(Ft):window,n){case"focusin":(Eu(De)||De.contentEditable==="true")&&(no=De,kh=Ft,ui=null);break;case"focusout":ui=kh=no=null;break;case"mousedown":Oh=!0;break;case"contextmenu":case"mouseup":case"dragend":Oh=!1,Ud(ie,u,Wt);break;case"selectionchange":if(Ho)break;case"keydown":case"keyup":Ud(ie,u,Wt)}var ei;if(Ch)t:{switch(n){case"compositionstart":var fi="onCompositionStart";break t;case"compositionend":fi="onCompositionEnd";break t;case"compositionupdate":fi="onCompositionUpdate";break t}fi=void 0}else Uo?Ah(n,u)&&(fi="onCompositionEnd"):n==="keydown"&&u.keyCode===229&&(fi="onCompositionStart");fi&&(Ds&&u.locale!=="ko"&&(Uo||fi!=="onCompositionStart"?fi==="onCompositionEnd"&&Uo&&(ei=Cs()):(Ra=Wt,Ni="value"in Ra?Ra.value:Ra.textContent,Uo=!0)),De=pd(Ft,fi),0<De.length&&(fi=new ra(fi,n,null,u,Wt),ie.push({event:fi,listeners:De}),ei?fi.data=ei:(ei=Vo(u),ei!==null&&(fi.data=ei)))),(ei=bc?Od(n,u):Nf(n,u))&&(fi=pd(Ft,"onBeforeInput"),0<fi.length&&(De=new ra("onBeforeInput","beforeinput",null,u,Wt),ie.push({event:De,listeners:fi}),De.data=ei)),Dm(ie,n,Ft,u,Wt)}ml(ie,s)})}function ac(n,s,u){return{instance:n,listener:s,currentTarget:u}}function pd(n,s){for(var u=s+"Capture",_=[];n!==null;){var b=n,E=b.stateNode;if(b=b.tag,b!==5&&b!==26&&b!==27||E===null||(b=Hn(n,u),b!=null&&_.unshift(ac(n,b,E)),b=Hn(n,s),b!=null&&_.push(ac(n,b,E))),n.tag===3)return _;n=n.return}return[]}function md(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5&&n.tag!==27);return n||null}function yp(n,s,u,_,b){for(var E=s._reactName,O=[];u!==null&&u!==_;){var X=u,_t=X.alternate,Ft=X.stateNode;if(X=X.tag,_t!==null&&_t===_)break;X!==5&&X!==26&&X!==27||Ft===null||(_t=Ft,b?(Ft=Hn(u,E),Ft!=null&&O.unshift(ac(u,Ft,_t))):b||(Ft=Hn(u,E),Ft!=null&&O.push(ac(u,Ft,_t)))),u=u.return}O.length!==0&&n.push({event:s,listeners:O})}var vp=/\r\n?/g,zm=/\u0000|\uFFFD/g;function Er(n){return(typeof n=="string"?n:""+n).replace(vp,`
`).replace(zm,"")}function iu(n,s){return s=Er(s),Er(n)===s}function Pi(n,s,u,_,b,E){switch(u){case"children":typeof _=="string"?s==="body"||s==="textarea"&&_===""||Bo(n,_):(typeof _=="number"||typeof _=="bigint")&&s!=="body"&&Bo(n,""+_);break;case"className":Cl(n,"class",_);break;case"tabIndex":Cl(n,"tabindex",_);break;case"dir":case"role":case"viewBox":case"width":case"height":Cl(n,u,_);break;case"style":zd(n,_,E);break;case"data":if(s!=="object"){Cl(n,"data",_);break}case"src":case"href":if(_===""&&(s!=="a"||u!=="href")){n.removeAttribute(u);break}if(_==null||typeof _=="function"||typeof _=="symbol"||typeof _=="boolean"){n.removeAttribute(u);break}_=Ia(""+_),n.setAttribute(u,_);break;case"action":case"formAction":if(typeof _=="function"){n.setAttribute(u,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof E=="function"&&(u==="formAction"?(s!=="input"&&Pi(n,s,"name",b.name,b,null),Pi(n,s,"formEncType",b.formEncType,b,null),Pi(n,s,"formMethod",b.formMethod,b,null),Pi(n,s,"formTarget",b.formTarget,b,null)):(Pi(n,s,"encType",b.encType,b,null),Pi(n,s,"method",b.method,b,null),Pi(n,s,"target",b.target,b,null)));if(_==null||typeof _=="symbol"||typeof _=="boolean"){n.removeAttribute(u);break}_=Ia(""+_),n.setAttribute(u,_);break;case"onClick":_!=null&&(n.onclick=Xe);break;case"onScroll":_!=null&&di("scroll",n);break;case"onScrollEnd":_!=null&&di("scrollend",n);break;case"dangerouslySetInnerHTML":if(_!=null){if(typeof _!="object"||!("__html"in _))throw Error(q(61));if(u=_.__html,u!=null){if(b.children!=null)throw Error(q(60));n.innerHTML=u}}break;case"multiple":n.multiple=_&&typeof _!="function"&&typeof _!="symbol";break;case"muted":n.muted=_&&typeof _!="function"&&typeof _!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(_==null||typeof _=="function"||typeof _=="boolean"||typeof _=="symbol"){n.removeAttribute("xlink:href");break}u=Ia(""+_),n.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",u);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":_!=null&&typeof _!="function"&&typeof _!="symbol"?n.setAttribute(u,""+_):n.removeAttribute(u);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":_&&typeof _!="function"&&typeof _!="symbol"?n.setAttribute(u,""):n.removeAttribute(u);break;case"capture":case"download":_===!0?n.setAttribute(u,""):_!==!1&&_!=null&&typeof _!="function"&&typeof _!="symbol"?n.setAttribute(u,_):n.removeAttribute(u);break;case"cols":case"rows":case"size":case"span":_!=null&&typeof _!="function"&&typeof _!="symbol"&&!isNaN(_)&&1<=_?n.setAttribute(u,_):n.removeAttribute(u);break;case"rowSpan":case"start":_==null||typeof _=="function"||typeof _=="symbol"||isNaN(_)?n.removeAttribute(u):n.setAttribute(u,_);break;case"popover":di("beforetoggle",n),di("toggle",n),Es(n,"popover",_);break;case"xlinkActuate":Ga(n,"http://www.w3.org/1999/xlink","xlink:actuate",_);break;case"xlinkArcrole":Ga(n,"http://www.w3.org/1999/xlink","xlink:arcrole",_);break;case"xlinkRole":Ga(n,"http://www.w3.org/1999/xlink","xlink:role",_);break;case"xlinkShow":Ga(n,"http://www.w3.org/1999/xlink","xlink:show",_);break;case"xlinkTitle":Ga(n,"http://www.w3.org/1999/xlink","xlink:title",_);break;case"xlinkType":Ga(n,"http://www.w3.org/1999/xlink","xlink:type",_);break;case"xmlBase":Ga(n,"http://www.w3.org/XML/1998/namespace","xml:base",_);break;case"xmlLang":Ga(n,"http://www.w3.org/XML/1998/namespace","xml:lang",_);break;case"xmlSpace":Ga(n,"http://www.w3.org/XML/1998/namespace","xml:space",_);break;case"is":Es(n,"is",_);break;case"innerText":case"textContent":break;default:(!(2<u.length)||u[0]!=="o"&&u[0]!=="O"||u[1]!=="n"&&u[1]!=="N")&&(u=No.get(u)||u,Es(n,u,_))}}function xp(n,s,u,_,b,E){switch(u){case"style":zd(n,_,E);break;case"dangerouslySetInnerHTML":if(_!=null){if(typeof _!="object"||!("__html"in _))throw Error(q(61));if(u=_.__html,u!=null){if(b.children!=null)throw Error(q(60));n.innerHTML=u}}break;case"children":typeof _=="string"?Bo(n,_):(typeof _=="number"||typeof _=="bigint")&&Bo(n,""+_);break;case"onScroll":_!=null&&di("scroll",n);break;case"onScrollEnd":_!=null&&di("scrollend",n);break;case"onClick":_!=null&&(n.onclick=Xe);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Bi.hasOwnProperty(u))t:{if(u[0]==="o"&&u[1]==="n"&&(b=u.endsWith("Capture"),s=u.slice(2,b?u.length-7:void 0),E=n[me]||null,E=E!=null?E[u]:null,typeof E=="function"&&n.removeEventListener(s,E,b),typeof _=="function")){typeof E!="function"&&E!==null&&(u in n?n[u]=null:n.hasAttribute(u)&&n.removeAttribute(u)),n.addEventListener(s,_,b);break t}u in n?n[u]=_:_===!0?n.setAttribute(u,""):Es(n,u,_)}}}function Ma(n,s,u){switch(s){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":di("error",n),di("load",n);var _=!1,b=!1,E;for(E in u)if(u.hasOwnProperty(E)){var O=u[E];if(O!=null)switch(E){case"src":_=!0;break;case"srcSet":b=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(q(137,s));default:Pi(n,s,E,O,u,null)}}b&&Pi(n,s,"srcSet",u.srcSet,u,null),_&&Pi(n,s,"src",u.src,u,null);return;case"input":di("invalid",n);var X=E=O=b=null,_t=null,Ft=null;for(_ in u)if(u.hasOwnProperty(_)){var Wt=u[_];if(Wt!=null)switch(_){case"name":b=Wt;break;case"type":O=Wt;break;case"checked":_t=Wt;break;case"defaultChecked":Ft=Wt;break;case"value":E=Wt;break;case"defaultValue":X=Wt;break;case"children":case"dangerouslySetInnerHTML":if(Wt!=null)throw Error(q(137,s));break;default:Pi(n,s,_,Wt,u,null)}}_u(n,E,X,_t,Ft,O,b,!1);return;case"select":di("invalid",n),_=O=E=null;for(b in u)if(u.hasOwnProperty(b)&&(X=u[b],X!=null))switch(b){case"value":E=X;break;case"defaultValue":O=X;break;case"multiple":_=X;default:Pi(n,s,b,X,u,null)}s=E,u=O,n.multiple=!!_,s!=null?Oo(n,!!_,s,!1):u!=null&&Oo(n,!!_,u,!0);return;case"textarea":di("invalid",n),E=b=_=null;for(O in u)if(u.hasOwnProperty(O)&&(X=u[O],X!=null))switch(O){case"value":_=X;break;case"defaultValue":b=X;break;case"children":E=X;break;case"dangerouslySetInnerHTML":if(X!=null)throw Error(q(91));break;default:Pi(n,s,O,X,u,null)}mc(n,_,b,E);return;case"option":for(_t in u)if(u.hasOwnProperty(_t)&&(_=u[_t],_!=null))switch(_t){case"selected":n.selected=_&&typeof _!="function"&&typeof _!="symbol";break;default:Pi(n,s,_t,_,u,null)}return;case"dialog":di("beforetoggle",n),di("toggle",n),di("cancel",n),di("close",n);break;case"iframe":case"object":di("load",n);break;case"video":case"audio":for(_=0;_<dd.length;_++)di(dd[_],n);break;case"image":di("error",n),di("load",n);break;case"details":di("toggle",n);break;case"embed":case"source":case"link":di("error",n),di("load",n);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(Ft in u)if(u.hasOwnProperty(Ft)&&(_=u[Ft],_!=null))switch(Ft){case"children":case"dangerouslySetInnerHTML":throw Error(q(137,s));default:Pi(n,s,Ft,_,u,null)}return;default:if(Jr(s)){for(Wt in u)u.hasOwnProperty(Wt)&&(_=u[Wt],_!==void 0&&xp(n,s,Wt,_,u,void 0));return}}for(X in u)u.hasOwnProperty(X)&&(_=u[X],_!=null&&Pi(n,s,X,_,u,null))}function Pm(n,s,u,_){switch(s){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var b=null,E=null,O=null,X=null,_t=null,Ft=null,Wt=null;for(Gt in u){var ie=u[Gt];if(u.hasOwnProperty(Gt)&&ie!=null)switch(Gt){case"checked":break;case"value":break;case"defaultValue":_t=ie;default:_.hasOwnProperty(Gt)||Pi(n,s,Gt,null,_,ie)}}for(var Vt in _){var Gt=_[Vt];if(ie=u[Vt],_.hasOwnProperty(Vt)&&(Gt!=null||ie!=null))switch(Vt){case"type":E=Gt;break;case"name":b=Gt;break;case"checked":Ft=Gt;break;case"defaultChecked":Wt=Gt;break;case"value":O=Gt;break;case"defaultValue":X=Gt;break;case"children":case"dangerouslySetInnerHTML":if(Gt!=null)throw Error(q(137,s));break;default:Gt!==ie&&Pi(n,s,Vt,Gt,_,ie)}}gu(n,O,X,_t,Ft,Wt,E,b);return;case"select":Gt=O=X=Vt=null;for(E in u)if(_t=u[E],u.hasOwnProperty(E)&&_t!=null)switch(E){case"value":break;case"multiple":Gt=_t;default:_.hasOwnProperty(E)||Pi(n,s,E,null,_,_t)}for(b in _)if(E=_[b],_t=u[b],_.hasOwnProperty(b)&&(E!=null||_t!=null))switch(b){case"value":Vt=E;break;case"defaultValue":X=E;break;case"multiple":O=E;default:E!==_t&&Pi(n,s,b,E,_,_t)}s=X,u=O,_=Gt,Vt!=null?Oo(n,!!u,Vt,!1):!!_!=!!u&&(s!=null?Oo(n,!!u,s,!0):Oo(n,!!u,u?[]:"",!1));return;case"textarea":Gt=Vt=null;for(X in u)if(b=u[X],u.hasOwnProperty(X)&&b!=null&&!_.hasOwnProperty(X))switch(X){case"value":break;case"children":break;default:Pi(n,s,X,null,_,b)}for(O in _)if(b=_[O],E=u[O],_.hasOwnProperty(O)&&(b!=null||E!=null))switch(O){case"value":Vt=b;break;case"defaultValue":Gt=b;break;case"children":break;case"dangerouslySetInnerHTML":if(b!=null)throw Error(q(91));break;default:b!==E&&Pi(n,s,O,b,_,E)}Kr(n,Vt,Gt);return;case"option":for(var Me in u)if(Vt=u[Me],u.hasOwnProperty(Me)&&Vt!=null&&!_.hasOwnProperty(Me))switch(Me){case"selected":n.selected=!1;break;default:Pi(n,s,Me,null,_,Vt)}for(_t in _)if(Vt=_[_t],Gt=u[_t],_.hasOwnProperty(_t)&&Vt!==Gt&&(Vt!=null||Gt!=null))switch(_t){case"selected":n.selected=Vt&&typeof Vt!="function"&&typeof Vt!="symbol";break;default:Pi(n,s,_t,Vt,_,Gt)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Ve in u)Vt=u[Ve],u.hasOwnProperty(Ve)&&Vt!=null&&!_.hasOwnProperty(Ve)&&Pi(n,s,Ve,null,_,Vt);for(Ft in _)if(Vt=_[Ft],Gt=u[Ft],_.hasOwnProperty(Ft)&&Vt!==Gt&&(Vt!=null||Gt!=null))switch(Ft){case"children":case"dangerouslySetInnerHTML":if(Vt!=null)throw Error(q(137,s));break;default:Pi(n,s,Ft,Vt,_,Gt)}return;default:if(Jr(s)){for(var Gi in u)Vt=u[Gi],u.hasOwnProperty(Gi)&&Vt!==void 0&&!_.hasOwnProperty(Gi)&&xp(n,s,Gi,void 0,_,Vt);for(Wt in _)Vt=_[Wt],Gt=u[Wt],!_.hasOwnProperty(Wt)||Vt===Gt||Vt===void 0&&Gt===void 0||xp(n,s,Wt,Vt,_,Gt);return}}for(var Ct in u)Vt=u[Ct],u.hasOwnProperty(Ct)&&Vt!=null&&!_.hasOwnProperty(Ct)&&Pi(n,s,Ct,null,_,Vt);for(ie in _)Vt=_[ie],Gt=u[ie],!_.hasOwnProperty(ie)||Vt===Gt||Vt==null&&Gt==null||Pi(n,s,ie,Vt,_,Gt)}function bp(n){switch(n){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function ah(){if(typeof performance.getEntriesByType=="function"){for(var n=0,s=0,u=performance.getEntriesByType("resource"),_=0;_<u.length;_++){var b=u[_],E=b.transferSize,O=b.initiatorType,X=b.duration;if(E&&X&&bp(O)){for(O=0,X=b.responseEnd,_+=1;_<u.length;_++){var _t=u[_],Ft=_t.startTime;if(Ft>X)break;var Wt=_t.transferSize,ie=_t.initiatorType;Wt&&bp(ie)&&(_t=_t.responseEnd,O+=Wt*(_t<X?1:(X-Ft)/(_t-Ft)))}if(--_,s+=8*(E+O)/(b.duration/1e3),n++,10<n)break}}if(0<n)return s/n/1e6}return navigator.connection&&(n=navigator.connection.downlink,typeof n=="number")?n:5}var rh=null,gd=null;function sh(n){return n.nodeType===9?n:n.ownerDocument}function wp(n){switch(n){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function wf(n,s){if(n===0)switch(s){case"svg":return 1;case"math":return 2;default:return 0}return n===1&&s==="foreignObject"?0:n}function _d(n,s){return n==="textarea"||n==="noscript"||typeof s.children=="string"||typeof s.children=="number"||typeof s.children=="bigint"||typeof s.dangerouslySetInnerHTML=="object"&&s.dangerouslySetInnerHTML!==null&&s.dangerouslySetInnerHTML.__html!=null}var Tp=null;function mg(){var n=window.event;return n&&n.type==="popstate"?n===Tp?!1:(Tp=n,!0):(Tp=null,!1)}var ya=typeof setTimeout=="function"?setTimeout:void 0,ni=typeof clearTimeout=="function"?clearTimeout:void 0,Co=typeof Promise=="function"?Promise:void 0,Ys=typeof queueMicrotask=="function"?queueMicrotask:typeof Co<"u"?function(n){return Co.resolve(null).then(n).catch(nu)}:ya;function nu(n){setTimeout(function(){throw n})}function Jn(n){return n==="head"}function ta(n,s){var u=s,_=0;do{var b=u.nextSibling;if(n.removeChild(u),b&&b.nodeType===8)if(u=b.data,u==="/$"||u==="/&"){if(_===0){n.removeChild(b),mh(s);return}_--}else if(u==="$"||u==="$?"||u==="$~"||u==="$!"||u==="&")_++;else if(u==="html")lh(n.ownerDocument.documentElement);else if(u==="head"){u=n.ownerDocument.head,lh(u);for(var E=u.firstChild;E;){var O=E.nextSibling,X=E.nodeName;E[ir]||X==="SCRIPT"||X==="STYLE"||X==="LINK"&&E.rel.toLowerCase()==="stylesheet"||u.removeChild(E),E=O}}else u==="body"&&lh(n.ownerDocument.body);u=b}while(u);mh(s)}function ea(n,s){var u=n;n=0;do{var _=u.nextSibling;if(u.nodeType===1?s?(u._stashedDisplay=u.style.display,u.style.display="none"):(u.style.display=u._stashedDisplay||"",u.getAttribute("style")===""&&u.removeAttribute("style")):u.nodeType===3&&(s?(u._stashedText=u.nodeValue,u.nodeValue=""):u.nodeValue=u._stashedText||""),_&&_.nodeType===8)if(u=_.data,u==="/$"){if(n===0)break;n--}else u!=="$"&&u!=="$?"&&u!=="$~"&&u!=="$!"||n++;u=_}while(u)}function Tf(n){var s=n.firstChild;for(s&&s.nodeType===10&&(s=s.nextSibling);s;){var u=s;switch(s=s.nextSibling,u.nodeName){case"HTML":case"HEAD":case"BODY":Tf(u),Js(u);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(u.rel.toLowerCase()==="stylesheet")continue}n.removeChild(u)}}function $r(n,s,u,_){for(;n.nodeType===1;){var b=u;if(n.nodeName.toLowerCase()!==s.toLowerCase()){if(!_&&(n.nodeName!=="INPUT"||n.type!=="hidden"))break}else if(_){if(!n[ir])switch(s){case"meta":if(!n.hasAttribute("itemprop"))break;return n;case"link":if(E=n.getAttribute("rel"),E==="stylesheet"&&n.hasAttribute("data-precedence"))break;if(E!==b.rel||n.getAttribute("href")!==(b.href==null||b.href===""?null:b.href)||n.getAttribute("crossorigin")!==(b.crossOrigin==null?null:b.crossOrigin)||n.getAttribute("title")!==(b.title==null?null:b.title))break;return n;case"style":if(n.hasAttribute("data-precedence"))break;return n;case"script":if(E=n.getAttribute("src"),(E!==(b.src==null?null:b.src)||n.getAttribute("type")!==(b.type==null?null:b.type)||n.getAttribute("crossorigin")!==(b.crossOrigin==null?null:b.crossOrigin))&&E&&n.hasAttribute("async")&&!n.hasAttribute("itemprop"))break;return n;default:return n}}else if(s==="input"&&n.type==="hidden"){var E=b.name==null?null:""+b.name;if(b.type==="hidden"&&n.getAttribute("name")===E)return n}else return n;if(n=Ca(n.nextSibling),n===null)break}return null}function Sp(n,s,u){if(s==="")return null;for(;n.nodeType!==3;)if((n.nodeType!==1||n.nodeName!=="INPUT"||n.type!=="hidden")&&!u||(n=Ca(n.nextSibling),n===null))return null;return n}function Vn(n,s){for(;n.nodeType!==8;)if((n.nodeType!==1||n.nodeName!=="INPUT"||n.type!=="hidden")&&!s||(n=Ca(n.nextSibling),n===null))return null;return n}function oh(n){return n.data==="$?"||n.data==="$~"}function Ep(n){return n.data==="$!"||n.data==="$?"&&n.ownerDocument.readyState!=="loading"}function Im(n,s){var u=n.ownerDocument;if(n.data==="$~")n._reactRetry=s;else if(n.data!=="$?"||u.readyState!=="loading")s();else{var _=function(){s(),u.removeEventListener("DOMContentLoaded",_)};u.addEventListener("DOMContentLoaded",_),n._reactRetry=_}}function Ca(n){for(;n!=null;n=n.nextSibling){var s=n.nodeType;if(s===1||s===3)break;if(s===8){if(s=n.data,s==="$"||s==="$!"||s==="$?"||s==="$~"||s==="&"||s==="F!"||s==="F")break;if(s==="/$"||s==="/&")return null}}return n}var rc=null;function Rm(n){n=n.nextSibling;for(var s=0;n;){if(n.nodeType===8){var u=n.data;if(u==="/$"||u==="/&"){if(s===0)return Ca(n.nextSibling);s--}else u!=="$"&&u!=="$!"&&u!=="$?"&&u!=="$~"&&u!=="&"||s++}n=n.nextSibling}return null}function Mp(n){n=n.previousSibling;for(var s=0;n;){if(n.nodeType===8){var u=n.data;if(u==="$"||u==="$!"||u==="$?"||u==="$~"||u==="&"){if(s===0)return n;s--}else u!=="/$"&&u!=="/&"||s++}n=n.previousSibling}return null}function Cp(n,s,u){switch(s=sh(u),n){case"html":if(n=s.documentElement,!n)throw Error(q(452));return n;case"head":if(n=s.head,!n)throw Error(q(453));return n;case"body":if(n=s.body,!n)throw Error(q(454));return n;default:throw Error(q(451))}}function lh(n){for(var s=n.attributes;s.length;)n.removeAttributeNode(s[0]);Js(n)}var Mr=new Map,Ap=new Set;function Ws(n){return typeof n.getRootNode=="function"?n.getRootNode():n.nodeType===9?n:n.ownerDocument}var dr=de.d;de.d={f:Sf,r:yd,D:He,C:Lm,L:km,m:ch,X:uh,S:gg,M:_g};function Sf(){var n=dr.f(),s=ih();return n||s}function yd(n){var s=wa(n);s!==null&&s.tag===5&&s.type==="form"?or(s):dr.r(n)}var Un=typeof document>"u"?null:document;function ws(n,s,u){var _=Un;if(_&&typeof s=="string"&&s){var b=qa(s);b='link[rel="'+n+'"][href="'+b+'"]',typeof u=="string"&&(b+='[crossorigin="'+u+'"]'),Ap.has(b)||(Ap.add(b),n={rel:n,crossOrigin:u,href:s},_.querySelector(b)===null&&(s=_.createElement("link"),Ma(s,"link",n),mn(s),_.head.appendChild(s)))}}function He(n){dr.D(n),ws("dns-prefetch",n,null)}function Lm(n,s){dr.C(n,s),ws("preconnect",n,s)}function km(n,s,u){dr.L(n,s,u);var _=Un;if(_&&n&&s){var b='link[rel="preload"][as="'+qa(s)+'"]';s==="image"&&u&&u.imageSrcSet?(b+='[imagesrcset="'+qa(u.imageSrcSet)+'"]',typeof u.imageSizes=="string"&&(b+='[imagesizes="'+qa(u.imageSizes)+'"]')):b+='[href="'+qa(n)+'"]';var E=b;switch(s){case"style":E=gl(n);break;case"script":E=oc(n)}Mr.has(E)||(n=Dt({rel:"preload",href:s==="image"&&u&&u.imageSrcSet?void 0:n,as:s},u),Mr.set(E,n),_.querySelector(b)!==null||s==="style"&&_.querySelector(sc(E))||s==="script"&&_.querySelector(au(E))||(s=_.createElement("link"),Ma(s,"link",n),mn(s),_.head.appendChild(s)))}}function ch(n,s){dr.m(n,s);var u=Un;if(u&&n){var _=s&&typeof s.as=="string"?s.as:"script",b='link[rel="modulepreload"][as="'+qa(_)+'"][href="'+qa(n)+'"]',E=b;switch(_){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":E=oc(n)}if(!Mr.has(E)&&(n=Dt({rel:"modulepreload",href:n},s),Mr.set(E,n),u.querySelector(b)===null)){switch(_){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(u.querySelector(au(E)))return}_=u.createElement("link"),Ma(_,"link",n),mn(_),u.head.appendChild(_)}}}function gg(n,s,u){dr.S(n,s,u);var _=Un;if(_&&n){var b=Ir(_).hoistableStyles,E=gl(n);s=s||"default";var O=b.get(E);if(!O){var X={loading:0,preload:null};if(O=_.querySelector(sc(E)))X.loading=5;else{n=Dt({rel:"stylesheet",href:n,"data-precedence":s},u),(u=Mr.get(E))&&ru(n,u);var _t=O=_.createElement("link");mn(_t),Ma(_t,"link",n),_t._p=new Promise(function(Ft,Wt){_t.onload=Ft,_t.onerror=Wt}),_t.addEventListener("load",function(){X.loading|=1}),_t.addEventListener("error",function(){X.loading|=2}),X.loading|=4,lc(O,s,_)}O={type:"stylesheet",instance:O,count:1,state:X},b.set(E,O)}}}function uh(n,s){dr.X(n,s);var u=Un;if(u&&n){var _=Ir(u).hoistableScripts,b=oc(n),E=_.get(b);E||(E=u.querySelector(au(b)),E||(n=Dt({src:n,async:!0},s),(s=Mr.get(b))&&Ef(n,s),E=u.createElement("script"),mn(E),Ma(E,"link",n),u.head.appendChild(E)),E={type:"script",instance:E,count:1,state:null},_.set(b,E))}}function _g(n,s){dr.M(n,s);var u=Un;if(u&&n){var _=Ir(u).hoistableScripts,b=oc(n),E=_.get(b);E||(E=u.querySelector(au(b)),E||(n=Dt({src:n,async:!0,type:"module"},s),(s=Mr.get(b))&&Ef(n,s),E=u.createElement("script"),mn(E),Ma(E,"link",n),u.head.appendChild(E)),E={type:"script",instance:E,count:1,state:null},_.set(b,E))}}function Dp(n,s,u,_){var b=(b=Ie.current)?Ws(b):null;if(!b)throw Error(q(446));switch(n){case"meta":case"title":return null;case"style":return typeof u.precedence=="string"&&typeof u.href=="string"?(s=gl(u.href),u=Ir(b).hoistableStyles,_=u.get(s),_||(_={type:"style",instance:null,count:0,state:null},u.set(s,_)),_):{type:"void",instance:null,count:0,state:null};case"link":if(u.rel==="stylesheet"&&typeof u.href=="string"&&typeof u.precedence=="string"){n=gl(u.href);var E=Ir(b).hoistableStyles,O=E.get(n);if(O||(b=b.ownerDocument||b,O={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},E.set(n,O),(E=b.querySelector(sc(n)))&&!E._p&&(O.instance=E,O.state.loading=5),Mr.has(n)||(u={rel:"preload",as:"style",href:u.href,crossOrigin:u.crossOrigin,integrity:u.integrity,media:u.media,hrefLang:u.hrefLang,referrerPolicy:u.referrerPolicy},Mr.set(n,u),E||zp(b,n,u,O.state))),s&&_===null)throw Error(q(528,""));return O}if(s&&_!==null)throw Error(q(529,""));return null;case"script":return s=u.async,u=u.src,typeof u=="string"&&s&&typeof s!="function"&&typeof s!="symbol"?(s=oc(u),u=Ir(b).hoistableScripts,_=u.get(s),_||(_={type:"script",instance:null,count:0,state:null},u.set(s,_)),_):{type:"void",instance:null,count:0,state:null};default:throw Error(q(444,n))}}function gl(n){return'href="'+qa(n)+'"'}function sc(n){return'link[rel="stylesheet"]['+n+"]"}function vd(n){return Dt({},n,{"data-precedence":n.precedence,precedence:null})}function zp(n,s,u,_){n.querySelector('link[rel="preload"][as="style"]['+s+"]")?_.loading=1:(s=n.createElement("link"),_.preload=s,s.addEventListener("load",function(){return _.loading|=1}),s.addEventListener("error",function(){return _.loading|=2}),Ma(s,"link",u),mn(s),n.head.appendChild(s))}function oc(n){return'[src="'+qa(n)+'"]'}function au(n){return"script[async]"+n}function Pp(n,s,u){if(s.count++,s.instance===null)switch(s.type){case"style":var _=n.querySelector('style[data-href~="'+qa(u.href)+'"]');if(_)return s.instance=_,mn(_),_;var b=Dt({},u,{"data-href":u.href,"data-precedence":u.precedence,href:null,precedence:null});return _=(n.ownerDocument||n).createElement("style"),mn(_),Ma(_,"style",b),lc(_,u.precedence,n),s.instance=_;case"stylesheet":b=gl(u.href);var E=n.querySelector(sc(b));if(E)return s.state.loading|=4,s.instance=E,mn(E),E;_=vd(u),(b=Mr.get(b))&&ru(_,b),E=(n.ownerDocument||n).createElement("link"),mn(E);var O=E;return O._p=new Promise(function(X,_t){O.onload=X,O.onerror=_t}),Ma(E,"link",_),s.state.loading|=4,lc(E,u.precedence,n),s.instance=E;case"script":return E=oc(u.src),(b=n.querySelector(au(E)))?(s.instance=b,mn(b),b):(_=u,(b=Mr.get(E))&&(_=Dt({},u),Ef(_,b)),n=n.ownerDocument||n,b=n.createElement("script"),mn(b),Ma(b,"link",_),n.head.appendChild(b),s.instance=b);case"void":return null;default:throw Error(q(443,s.type))}else s.type==="stylesheet"&&(s.state.loading&4)===0&&(_=s.instance,s.state.loading|=4,lc(_,u.precedence,n));return s.instance}function lc(n,s,u){for(var _=u.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),b=_.length?_[_.length-1]:null,E=b,O=0;O<_.length;O++){var X=_[O];if(X.dataset.precedence===s)E=X;else if(E!==b)break}E?E.parentNode.insertBefore(n,E.nextSibling):(s=u.nodeType===9?u.head:u,s.insertBefore(n,s.firstChild))}function ru(n,s){n.crossOrigin==null&&(n.crossOrigin=s.crossOrigin),n.referrerPolicy==null&&(n.referrerPolicy=s.referrerPolicy),n.title==null&&(n.title=s.title)}function Ef(n,s){n.crossOrigin==null&&(n.crossOrigin=s.crossOrigin),n.referrerPolicy==null&&(n.referrerPolicy=s.referrerPolicy),n.integrity==null&&(n.integrity=s.integrity)}var su=null;function xd(n,s,u){if(su===null){var _=new Map,b=su=new Map;b.set(u,_)}else b=su,_=b.get(u),_||(_=new Map,b.set(u,_));if(_.has(n))return _;for(_.set(n,null),u=u.getElementsByTagName(n),b=0;b<u.length;b++){var E=u[b];if(!(E[ir]||E[Qt]||n==="link"&&E.getAttribute("rel")==="stylesheet")&&E.namespaceURI!=="http://www.w3.org/2000/svg"){var O=E.getAttribute(s)||"";O=n+O;var X=_.get(O);X?X.push(E):_.set(O,[E])}}return _}function Om(n,s,u){n=n.ownerDocument||n,n.head.insertBefore(u,s==="title"?n.querySelector("head > title"):null)}function Ip(n,s,u){if(u===1||s.itemProp!=null)return!1;switch(n){case"meta":case"title":return!0;case"style":if(typeof s.precedence!="string"||typeof s.href!="string"||s.href==="")break;return!0;case"link":if(typeof s.rel!="string"||typeof s.href!="string"||s.href===""||s.onLoad||s.onError)break;switch(s.rel){case"stylesheet":return n=s.disabled,typeof s.precedence=="string"&&n==null;default:return!0}case"script":if(s.async&&typeof s.async!="function"&&typeof s.async!="symbol"&&!s.onLoad&&!s.onError&&s.src&&typeof s.src=="string")return!0}return!1}function Rp(n){return!(n.type==="stylesheet"&&(n.state.loading&3)===0)}function yg(n,s,u,_){if(u.type==="stylesheet"&&(typeof _.media!="string"||matchMedia(_.media).matches!==!1)&&(u.state.loading&4)===0){if(u.instance===null){var b=gl(_.href),E=s.querySelector(sc(b));if(E){s=E._p,s!==null&&typeof s=="object"&&typeof s.then=="function"&&(n.count++,n=Mf.bind(n),s.then(n,n)),u.state.loading|=4,u.instance=E,mn(E);return}E=s.ownerDocument||s,_=vd(_),(b=Mr.get(b))&&ru(_,b),E=E.createElement("link"),mn(E);var O=E;O._p=new Promise(function(X,_t){O.onload=X,O.onerror=_t}),Ma(E,"link",_),u.instance=E}n.stylesheets===null&&(n.stylesheets=new Map),n.stylesheets.set(u,s),(s=u.state.preload)&&(u.state.loading&3)===0&&(n.count++,u=Mf.bind(n),s.addEventListener("load",u),s.addEventListener("error",u))}}var Lp=0;function Bm(n,s){return n.stylesheets&&n.count===0&&bd(n,n.stylesheets),0<n.count||0<n.imgCount?function(u){var _=setTimeout(function(){if(n.stylesheets&&bd(n,n.stylesheets),n.unsuspend){var E=n.unsuspend;n.unsuspend=null,E()}},6e4+s);0<n.imgBytes&&Lp===0&&(Lp=62500*ah());var b=setTimeout(function(){if(n.waitingForImages=!1,n.count===0&&(n.stylesheets&&bd(n,n.stylesheets),n.unsuspend)){var E=n.unsuspend;n.unsuspend=null,E()}},(n.imgBytes>Lp?50:800)+s);return n.unsuspend=u,function(){n.unsuspend=null,clearTimeout(_),clearTimeout(b)}}:null}function Mf(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)bd(this,this.stylesheets);else if(this.unsuspend){var n=this.unsuspend;this.unsuspend=null,n()}}}var cc=null;function bd(n,s){n.stylesheets=null,n.unsuspend!==null&&(n.count++,cc=new Map,s.forEach(vg,n),cc=null,Mf.call(n))}function vg(n,s){if(!(s.state.loading&4)){var u=cc.get(n);if(u)var _=u.get(null);else{u=new Map,cc.set(n,u);for(var b=n.querySelectorAll("link[data-precedence],style[data-precedence]"),E=0;E<b.length;E++){var O=b[E];(O.nodeName==="LINK"||O.getAttribute("media")!=="not all")&&(u.set(O.dataset.precedence,O),_=O)}_&&u.set(null,_)}b=s.instance,O=b.getAttribute("data-precedence"),E=u.get(O)||_,E===_&&u.set(null,b),u.set(O,b),this.count++,_=Mf.bind(this),b.addEventListener("load",_),b.addEventListener("error",_),E?E.parentNode.insertBefore(b,E.nextSibling):(n=n.nodeType===9?n.head:n,n.insertBefore(b,n.firstChild)),s.state.loading|=4}}var ou={$$typeof:At,Provider:null,Consumer:null,_currentValue:Ne,_currentValue2:Ne,_threadCount:0};function kp(n,s,u,_,b,E,O,X,_t){this.tag=1,this.containerInfo=n,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Ce(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Ce(0),this.hiddenUpdates=Ce(null),this.identifierPrefix=_,this.onUncaughtError=b,this.onCaughtError=E,this.onRecoverableError=O,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=_t,this.incompleteTransitions=new Map}function Op(n,s,u,_,b,E,O,X,_t,Ft,Wt,ie){return n=new kp(n,s,u,O,_t,Ft,Wt,ie,X),s=1,E===!0&&(s|=24),E=$a(3,null,null,s),n.current=E,E.stateNode=n,s=Ya(),s.refCount++,n.pooledCache=s,s.refCount++,E.memoizedState={element:_,isDehydrated:u,cache:s},gs(E),n}function lu(n){return n?(n=Ps,n):Ps}function Bp(n,s,u,_,b,E){b=lu(b),_.context===null?_.context=b:_.pendingContext=b,_=mo(s),_.payload={element:u},E=E===void 0?null:E,E!==null&&(_.callback=E),u=xr(n,_,s),u!==null&&(hr(u,n,s),js(u,n,s))}function hh(n,s){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var u=n.retryLane;n.retryLane=u!==0&&u<s?u:s}}function Np(n,s){hh(n,s),(n=n.alternate)&&hh(n,s)}function dh(n){if(n.tag===13||n.tag===31){var s=oo(n,67108864);s!==null&&hr(s,n,67108864),Np(n,67108864)}}function wd(n){if(n.tag===13||n.tag===31){var s=qr();s=ne(s);var u=oo(n,s);u!==null&&hr(u,n,s),Np(n,s)}}var Cf=!0;function Nm(n,s,u,_){var b=$t.T;$t.T=null;var E=de.p;try{de.p=2,Fp(n,s,u,_)}finally{de.p=E,$t.T=b}}function Fm(n,s,u,_){var b=$t.T;$t.T=null;var E=de.p;try{de.p=8,Fp(n,s,u,_)}finally{de.p=E,$t.T=b}}function Fp(n,s,u,_){if(Cf){var b=jp(_);if(b===null)bf(n,s,_,Af,u),Um(n,_);else if(xg(b,n,s,u,_))_.stopPropagation();else if(Um(n,_),s&4&&-1<Vm.indexOf(n)){for(;b!==null;){var E=wa(b);if(E!==null)switch(E.tag){case 3:if(E=E.stateNode,E.current.memoizedState.isDehydrated){var O=wt(E.pendingLanes);if(O!==0){var X=E;for(X.pendingLanes|=2,X.entangledLanes|=2;O;){var _t=1<<31-F(O);X.entanglements[1]|=_t,O&=~_t}Hr(E),(bi&6)===0&&(Wc=qi()+500,tu(0))}}break;case 31:case 13:X=oo(E,2),X!==null&&hr(X,E,2),ih(),Np(E,2)}if(E=jp(_),E===null&&bf(n,s,_,Af,u),E===b)break;b=E}b!==null&&_.stopPropagation()}else bf(n,s,_,null,u)}}function jp(n){return n=wn(n),Vp(n)}var Af=null;function Vp(n){if(Af=null,n=zr(n),n!==null){var s=yt(n);if(s===null)n=null;else{var u=s.tag;if(u===13){if(n=P(s),n!==null)return n;n=null}else if(u===31){if(n=h(s),n!==null)return n;n=null}else if(u===3){if(s.stateNode.current.memoizedState.isDehydrated)return s.tag===3?s.stateNode.containerInfo:null;n=null}else s!==n&&(n=null)}}return Af=n,null}function jm(n){switch(n){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(bn()){case Io:return 2;case Sl:return 8;case Wr:case El:return 32;case Ts:return 268435456;default:return 32}default:return 32}}var Df=!1,Cr=null,Ao=null,_l=null,fh=new Map,Td=new Map,yl=[],Vm="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Um(n,s){switch(n){case"focusin":case"focusout":Cr=null;break;case"dragenter":case"dragleave":Ao=null;break;case"mouseover":case"mouseout":_l=null;break;case"pointerover":case"pointerout":fh.delete(s.pointerId);break;case"gotpointercapture":case"lostpointercapture":Td.delete(s.pointerId)}}function ph(n,s,u,_,b,E){return n===null||n.nativeEvent!==E?(n={blockedOn:s,domEventName:u,eventSystemFlags:_,nativeEvent:E,targetContainers:[b]},s!==null&&(s=wa(s),s!==null&&dh(s)),n):(n.eventSystemFlags|=_,s=n.targetContainers,b!==null&&s.indexOf(b)===-1&&s.push(b),n)}function xg(n,s,u,_,b){switch(s){case"focusin":return Cr=ph(Cr,n,s,u,_,b),!0;case"dragenter":return Ao=ph(Ao,n,s,u,_,b),!0;case"mouseover":return _l=ph(_l,n,s,u,_,b),!0;case"pointerover":var E=b.pointerId;return fh.set(E,ph(fh.get(E)||null,n,s,u,_,b)),!0;case"gotpointercapture":return E=b.pointerId,Td.set(E,ph(Td.get(E)||null,n,s,u,_,b)),!0}return!1}function Gm(n){var s=zr(n.target);if(s!==null){var u=yt(s);if(u!==null){if(s=u.tag,s===13){if(s=P(u),s!==null){n.blockedOn=s,Dn(n.priority,function(){wd(u)});return}}else if(s===31){if(s=h(u),s!==null){n.blockedOn=s,Dn(n.priority,function(){wd(u)});return}}else if(s===3&&u.stateNode.current.memoizedState.isDehydrated){n.blockedOn=u.tag===3?u.stateNode.containerInfo:null;return}}}n.blockedOn=null}function Ks(n){if(n.blockedOn!==null)return!1;for(var s=n.targetContainers;0<s.length;){var u=jp(n.nativeEvent);if(u===null){u=n.nativeEvent;var _=new u.constructor(u.type,u);ts=_,u.target.dispatchEvent(_),ts=null}else return s=wa(u),s!==null&&dh(s),n.blockedOn=u,!1;s.shift()}return!0}function Up(n,s,u){Ks(n)&&u.delete(s)}function qm(){Df=!1,Cr!==null&&Ks(Cr)&&(Cr=null),Ao!==null&&Ks(Ao)&&(Ao=null),_l!==null&&Ks(_l)&&(_l=null),fh.forEach(Up),Td.forEach(Up)}function Sd(n,s){n.blockedOn===s&&(n.blockedOn=null,Df||(Df=!0,B.unstable_scheduleCallback(B.unstable_NormalPriority,qm)))}var Ed=null;function Zm(n){Ed!==n&&(Ed=n,B.unstable_scheduleCallback(B.unstable_NormalPriority,function(){Ed===n&&(Ed=null);for(var s=0;s<n.length;s+=3){var u=n[s],_=n[s+1],b=n[s+2];if(typeof _!="function"){if(Vp(_||u)===null)continue;break}var E=wa(u);E!==null&&(n.splice(s,3),s-=3,ys(E,{pending:!0,data:b,method:u.method,action:_},_,b))}}))}function mh(n){function s(_t){return Sd(_t,n)}Cr!==null&&Sd(Cr,n),Ao!==null&&Sd(Ao,n),_l!==null&&Sd(_l,n),fh.forEach(s),Td.forEach(s);for(var u=0;u<yl.length;u++){var _=yl[u];_.blockedOn===n&&(_.blockedOn=null)}for(;0<yl.length&&(u=yl[0],u.blockedOn===null);)Gm(u),u.blockedOn===null&&yl.shift();if(u=(n.ownerDocument||n).$$reactFormReplay,u!=null)for(_=0;_<u.length;_+=3){var b=u[_],E=u[_+1],O=b[me]||null;if(typeof E=="function")O||Zm(u);else if(O){var X=null;if(E&&E.hasAttribute("formAction")){if(b=E,O=E[me]||null)X=O.formAction;else if(Vp(b)!==null)continue}else X=O.action;typeof X=="function"?u[_+1]=X:(u.splice(_,3),_-=3),Zm(u)}}}function Gp(){function n(E){E.canIntercept&&E.info==="react-transition"&&E.intercept({handler:function(){return new Promise(function(O){return b=O})},focusReset:"manual",scroll:"manual"})}function s(){b!==null&&(b(),b=null),_||setTimeout(u,20)}function u(){if(!_&&!navigation.transition){var E=navigation.currentEntry;E&&E.url!=null&&navigation.navigate(E.url,{state:E.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var _=!1,b=null;return navigation.addEventListener("navigate",n),navigation.addEventListener("navigatesuccess",s),navigation.addEventListener("navigateerror",s),setTimeout(u,100),function(){_=!0,navigation.removeEventListener("navigate",n),navigation.removeEventListener("navigatesuccess",s),navigation.removeEventListener("navigateerror",s),b!==null&&(b(),b=null)}}}function zf(n){this._internalRoot=n}cu.prototype.render=zf.prototype.render=function(n){var s=this._internalRoot;if(s===null)throw Error(q(409));var u=s.current,_=qr();Bp(u,_,n,s,null,null)},cu.prototype.unmount=zf.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var s=n.containerInfo;Bp(n.current,2,null,n,null,null),ih(),s[Ae]=null}};function cu(n){this._internalRoot=n}cu.prototype.unstable_scheduleHydration=function(n){if(n){var s=Oi();n={blockedOn:null,target:n,priority:s};for(var u=0;u<yl.length&&s!==0&&s<yl[u].priority;u++);yl.splice(u,0,n),u===0&&Gm(n)}};var qp=Y.version;if(qp!=="19.2.0")throw Error(q(527,qp,"19.2.0"));de.findDOMNode=function(n){var s=n._reactInternals;if(s===void 0)throw typeof n.render=="function"?Error(q(188)):(n=Object.keys(n).join(","),Error(q(268,n)));return n=ft(s),n=n!==null?Bt(n):null,n=n===null?null:n.stateNode,n};var Pf={bundleType:0,version:"19.2.0",rendererPackageName:"react-dom",currentDispatcherRef:$t,reconcilerVersion:"19.2.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var uu=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!uu.isDisabled&&uu.supportsFiber)try{za=uu.inject(Pf),Ji=uu}catch{}}return $p.createRoot=function(n,s){if(!lt(n))throw Error(q(299));var u=!1,_="",b=qu,E=Zu,O=Wd;return s!=null&&(s.unstable_strictMode===!0&&(u=!0),s.identifierPrefix!==void 0&&(_=s.identifierPrefix),s.onUncaughtError!==void 0&&(b=s.onUncaughtError),s.onCaughtError!==void 0&&(E=s.onCaughtError),s.onRecoverableError!==void 0&&(O=s.onRecoverableError)),s=Op(n,1,!1,null,null,u,_,null,b,E,O,Gp),n[Ae]=s.current,xf(n),new zf(s)},$p.hydrateRoot=function(n,s,u){if(!lt(n))throw Error(q(299));var _=!1,b="",E=qu,O=Zu,X=Wd,_t=null;return u!=null&&(u.unstable_strictMode===!0&&(_=!0),u.identifierPrefix!==void 0&&(b=u.identifierPrefix),u.onUncaughtError!==void 0&&(E=u.onUncaughtError),u.onCaughtError!==void 0&&(O=u.onCaughtError),u.onRecoverableError!==void 0&&(X=u.onRecoverableError),u.formState!==void 0&&(_t=u.formState)),s=Op(n,1,!0,s,u??null,_,b,_t,E,O,X,Gp),s.context=lu(null),u=s.current,_=qr(),_=ne(_),b=mo(_),b.callback=null,xr(u,b,_),u=_,s.current.lanes=u,je(s,u),Hr(s),n[Ae]=s.current,xf(n),new cu(s)},$p.version="19.2.0",$p}var c_;function ny(){if(c_)return Eg.exports;c_=1;function B(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(B)}catch(Y){console.error(Y)}}return B(),Eg.exports=iy(),Eg.exports}var ay=ny();var u_="popstate";function ry(B={}){function Y(lt,yt){let{pathname:P="/",search:h="",hash:et=""}=Dd(lt.location.hash.substring(1));return!P.startsWith("/")&&!P.startsWith(".")&&(P="/"+P),Lg("",{pathname:P,search:h,hash:et},yt.state&&yt.state.usr||null,yt.state&&yt.state.key||"default")}function nt(lt,yt){let P=lt.document.querySelector("base"),h="";if(P&&P.getAttribute("href")){let et=lt.location.href,ft=et.indexOf("#");h=ft===-1?et:et.slice(0,ft)}return h+"#"+(typeof yt=="string"?yt:Kp(yt))}function q(lt,yt){Po(lt.pathname.charAt(0)==="/",`relative pathnames are not supported in hash history.push(${JSON.stringify(yt)})`)}return oy(Y,nt,q,B)}function qn(B,Y){if(B===!1||B===null||typeof B>"u")throw new Error(Y)}function Po(B,Y){if(!B){typeof console<"u"&&console.warn(Y);try{throw new Error(Y)}catch{}}}function sy(){return Math.random().toString(36).substring(2,10)}function h_(B,Y){return{usr:B.state,key:B.key,idx:Y}}function Lg(B,Y,nt=null,q){return{pathname:typeof B=="string"?B:B.pathname,search:"",hash:"",...typeof Y=="string"?Dd(Y):Y,state:nt,key:Y&&Y.key||q||sy()}}function Kp({pathname:B="/",search:Y="",hash:nt=""}){return Y&&Y!=="?"&&(B+=Y.charAt(0)==="?"?Y:"?"+Y),nt&&nt!=="#"&&(B+=nt.charAt(0)==="#"?nt:"#"+nt),B}function Dd(B){let Y={};if(B){let nt=B.indexOf("#");nt>=0&&(Y.hash=B.substring(nt),B=B.substring(0,nt));let q=B.indexOf("?");q>=0&&(Y.search=B.substring(q),B=B.substring(0,q)),B&&(Y.pathname=B)}return Y}function oy(B,Y,nt,q={}){let{window:lt=document.defaultView,v5Compat:yt=!1}=q,P=lt.history,h="POP",et=null,ft=Bt();ft==null&&(ft=0,P.replaceState({...P.state,idx:ft},""));function Bt(){return(P.state||{idx:null}).idx}function Dt(){h="POP";let gt=Bt(),Yt=gt==null?null:gt-ft;ft=gt,et&&et({action:h,location:Kt.location,delta:Yt})}function se(gt,Yt){h="PUSH";let Pt=Lg(Kt.location,gt,Yt);nt&&nt(Pt,gt),ft=Bt()+1;let At=h_(Pt,ft),ce=Kt.createHref(Pt);try{P.pushState(At,"",ce)}catch(ue){if(ue instanceof DOMException&&ue.name==="DataCloneError")throw ue;lt.location.assign(ce)}yt&&et&&et({action:h,location:Kt.location,delta:1})}function he(gt,Yt){h="REPLACE";let Pt=Lg(Kt.location,gt,Yt);nt&&nt(Pt,gt),ft=Bt();let At=h_(Pt,ft),ce=Kt.createHref(Pt);P.replaceState(At,"",ce),yt&&et&&et({action:h,location:Kt.location,delta:0})}function xe(gt){return ly(gt)}let Kt={get action(){return h},get location(){return B(lt,P)},listen(gt){if(et)throw new Error("A history only accepts one active listener");return lt.addEventListener(u_,Dt),et=gt,()=>{lt.removeEventListener(u_,Dt),et=null}},createHref(gt){return Y(lt,gt)},createURL:xe,encodeLocation(gt){let Yt=xe(gt);return{pathname:Yt.pathname,search:Yt.search,hash:Yt.hash}},push:se,replace:he,go(gt){return P.go(gt)}};return Kt}function ly(B,Y=!1){let nt="http://localhost";typeof window<"u"&&(nt=window.location.origin!=="null"?window.location.origin:window.location.href),qn(nt,"No window.location.(origin|href) available to create URL");let q=typeof B=="string"?B:Kp(B);return q=q.replace(/ $/,"%20"),!Y&&q.startsWith("//")&&(q=nt+q),new URL(q,nt)}function __(B,Y,nt="/"){return cy(B,Y,nt,!1)}function cy(B,Y,nt,q){let lt=typeof Y=="string"?Dd(Y):Y,yt=pu(lt.pathname||"/",nt);if(yt==null)return null;let P=y_(B);uy(P);let h=null;for(let et=0;h==null&&et<P.length;++et){let ft=by(yt);h=vy(P[et],ft,q)}return h}function y_(B,Y=[],nt=[],q="",lt=!1){let yt=(P,h,et=lt,ft)=>{let Bt={relativePath:ft===void 0?P.path||"":ft,caseSensitive:P.caseSensitive===!0,childrenIndex:h,route:P};if(Bt.relativePath.startsWith("/")){if(!Bt.relativePath.startsWith(q)&&et)return;qn(Bt.relativePath.startsWith(q),`Absolute route path "${Bt.relativePath}" nested under path "${q}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),Bt.relativePath=Bt.relativePath.slice(q.length)}let Dt=fu([q,Bt.relativePath]),se=nt.concat(Bt);P.children&&P.children.length>0&&(qn(P.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${Dt}".`),y_(P.children,Y,se,Dt,et)),!(P.path==null&&!P.index)&&Y.push({path:Dt,score:_y(Dt,P.index),routesMeta:se})};return B.forEach((P,h)=>{if(P.path===""||!P.path?.includes("?"))yt(P,h);else for(let et of v_(P.path))yt(P,h,!0,et)}),Y}function v_(B){let Y=B.split("/");if(Y.length===0)return[];let[nt,...q]=Y,lt=nt.endsWith("?"),yt=nt.replace(/\?$/,"");if(q.length===0)return lt?[yt,""]:[yt];let P=v_(q.join("/")),h=[];return h.push(...P.map(et=>et===""?yt:[yt,et].join("/"))),lt&&h.push(...P),h.map(et=>B.startsWith("/")&&et===""?"/":et)}function uy(B){B.sort((Y,nt)=>Y.score!==nt.score?nt.score-Y.score:yy(Y.routesMeta.map(q=>q.childrenIndex),nt.routesMeta.map(q=>q.childrenIndex)))}var hy=/^:[\w-]+$/,dy=3,fy=2,py=1,my=10,gy=-2,d_=B=>B==="*";function _y(B,Y){let nt=B.split("/"),q=nt.length;return nt.some(d_)&&(q+=gy),Y&&(q+=fy),nt.filter(lt=>!d_(lt)).reduce((lt,yt)=>lt+(hy.test(yt)?dy:yt===""?py:my),q)}function yy(B,Y){return B.length===Y.length&&B.slice(0,-1).every((q,lt)=>q===Y[lt])?B[B.length-1]-Y[Y.length-1]:0}function vy(B,Y,nt=!1){let{routesMeta:q}=B,lt={},yt="/",P=[];for(let h=0;h<q.length;++h){let et=q[h],ft=h===q.length-1,Bt=yt==="/"?Y:Y.slice(yt.length)||"/",Dt=Qm({path:et.relativePath,caseSensitive:et.caseSensitive,end:ft},Bt),se=et.route;if(!Dt&&ft&&nt&&!q[q.length-1].route.index&&(Dt=Qm({path:et.relativePath,caseSensitive:et.caseSensitive,end:!1},Bt)),!Dt)return null;Object.assign(lt,Dt.params),P.push({params:lt,pathname:fu([yt,Dt.pathname]),pathnameBase:Ey(fu([yt,Dt.pathnameBase])),route:se}),Dt.pathnameBase!=="/"&&(yt=fu([yt,Dt.pathnameBase]))}return P}function Qm(B,Y){typeof B=="string"&&(B={path:B,caseSensitive:!1,end:!0});let[nt,q]=xy(B.path,B.caseSensitive,B.end),lt=Y.match(nt);if(!lt)return null;let yt=lt[0],P=yt.replace(/(.)\/+$/,"$1"),h=lt.slice(1);return{params:q.reduce((ft,{paramName:Bt,isOptional:Dt},se)=>{if(Bt==="*"){let xe=h[se]||"";P=yt.slice(0,yt.length-xe.length).replace(/(.)\/+$/,"$1")}const he=h[se];return Dt&&!he?ft[Bt]=void 0:ft[Bt]=(he||"").replace(/%2F/g,"/"),ft},{}),pathname:yt,pathnameBase:P,pattern:B}}function xy(B,Y=!1,nt=!0){Po(B==="*"||!B.endsWith("*")||B.endsWith("/*"),`Route path "${B}" will be treated as if it were "${B.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${B.replace(/\*$/,"/*")}".`);let q=[],lt="^"+B.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(P,h,et)=>(q.push({paramName:h,isOptional:et!=null}),et?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return B.endsWith("*")?(q.push({paramName:"*"}),lt+=B==="*"||B==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):nt?lt+="\\/*$":B!==""&&B!=="/"&&(lt+="(?:(?=\\/|$))"),[new RegExp(lt,Y?void 0:"i"),q]}function by(B){try{return B.split("/").map(Y=>decodeURIComponent(Y).replace(/\//g,"%2F")).join("/")}catch(Y){return Po(!1,`The URL path "${B}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${Y}).`),B}}function pu(B,Y){if(Y==="/")return B;if(!B.toLowerCase().startsWith(Y.toLowerCase()))return null;let nt=Y.endsWith("/")?Y.length-1:Y.length,q=B.charAt(nt);return q&&q!=="/"?null:B.slice(nt)||"/"}function wy(B,Y="/"){let{pathname:nt,search:q="",hash:lt=""}=typeof B=="string"?Dd(B):B;return{pathname:nt?nt.startsWith("/")?nt:Ty(nt,Y):Y,search:My(q),hash:Cy(lt)}}function Ty(B,Y){let nt=Y.replace(/\/+$/,"").split("/");return B.split("/").forEach(lt=>{lt===".."?nt.length>1&&nt.pop():lt!=="."&&nt.push(lt)}),nt.length>1?nt.join("/"):"/"}function Dg(B,Y,nt,q){return`Cannot include a '${B}' character in a manually specified \`to.${Y}\` field [${JSON.stringify(q)}].  Please separate it out to the \`to.${nt}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function Sy(B){return B.filter((Y,nt)=>nt===0||Y.route.path&&Y.route.path.length>0)}function Fg(B){let Y=Sy(B);return Y.map((nt,q)=>q===Y.length-1?nt.pathname:nt.pathnameBase)}function jg(B,Y,nt,q=!1){let lt;typeof B=="string"?lt=Dd(B):(lt={...B},qn(!lt.pathname||!lt.pathname.includes("?"),Dg("?","pathname","search",lt)),qn(!lt.pathname||!lt.pathname.includes("#"),Dg("#","pathname","hash",lt)),qn(!lt.search||!lt.search.includes("#"),Dg("#","search","hash",lt)));let yt=B===""||lt.pathname==="",P=yt?"/":lt.pathname,h;if(P==null)h=nt;else{let Dt=Y.length-1;if(!q&&P.startsWith("..")){let se=P.split("/");for(;se[0]==="..";)se.shift(),Dt-=1;lt.pathname=se.join("/")}h=Dt>=0?Y[Dt]:"/"}let et=wy(lt,h),ft=P&&P!=="/"&&P.endsWith("/"),Bt=(yt||P===".")&&nt.endsWith("/");return!et.pathname.endsWith("/")&&(ft||Bt)&&(et.pathname+="/"),et}var fu=B=>B.join("/").replace(/\/\/+/g,"/"),Ey=B=>B.replace(/\/+$/,"").replace(/^\/*/,"/"),My=B=>!B||B==="?"?"":B.startsWith("?")?B:"?"+B,Cy=B=>!B||B==="#"?"":B.startsWith("#")?B:"#"+B;function Ay(B){return B!=null&&typeof B.status=="number"&&typeof B.statusText=="string"&&typeof B.internal=="boolean"&&"data"in B}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var x_=["POST","PUT","PATCH","DELETE"];new Set(x_);var Dy=["GET",...x_];new Set(Dy);var kf=Mt.createContext(null);kf.displayName="DataRouter";var Jm=Mt.createContext(null);Jm.displayName="DataRouterState";Mt.createContext(!1);var b_=Mt.createContext({isTransitioning:!1});b_.displayName="ViewTransition";var zy=Mt.createContext(new Map);zy.displayName="Fetchers";var Py=Mt.createContext(null);Py.displayName="Await";var wl=Mt.createContext(null);wl.displayName="Navigation";var Jp=Mt.createContext(null);Jp.displayName="Location";var Tl=Mt.createContext({outlet:null,matches:[],isDataRoute:!1});Tl.displayName="Route";var Vg=Mt.createContext(null);Vg.displayName="RouteError";function Iy(B,{relative:Y}={}){qn(Of(),"useHref() may be used only in the context of a <Router> component.");let{basename:nt,navigator:q}=Mt.useContext(wl),{hash:lt,pathname:yt,search:P}=tm(B,{relative:Y}),h=yt;return nt!=="/"&&(h=yt==="/"?nt:fu([nt,yt])),q.createHref({pathname:h,search:P,hash:lt})}function Of(){return Mt.useContext(Jp)!=null}function yh(){return qn(Of(),"useLocation() may be used only in the context of a <Router> component."),Mt.useContext(Jp).location}var w_="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function T_(B){Mt.useContext(wl).static||Mt.useLayoutEffect(B)}function S_(){let{isDataRoute:B}=Mt.useContext(Tl);return B?Hy():Ry()}function Ry(){qn(Of(),"useNavigate() may be used only in the context of a <Router> component.");let B=Mt.useContext(kf),{basename:Y,navigator:nt}=Mt.useContext(wl),{matches:q}=Mt.useContext(Tl),{pathname:lt}=yh(),yt=JSON.stringify(Fg(q)),P=Mt.useRef(!1);return T_(()=>{P.current=!0}),Mt.useCallback((et,ft={})=>{if(Po(P.current,w_),!P.current)return;if(typeof et=="number"){nt.go(et);return}let Bt=jg(et,JSON.parse(yt),lt,ft.relative==="path");B==null&&Y!=="/"&&(Bt.pathname=Bt.pathname==="/"?Y:fu([Y,Bt.pathname])),(ft.replace?nt.replace:nt.push)(Bt,ft.state,ft)},[Y,nt,yt,lt,B])}Mt.createContext(null);function Ly(){let{matches:B}=Mt.useContext(Tl),Y=B[B.length-1];return Y?Y.params:{}}function tm(B,{relative:Y}={}){let{matches:nt}=Mt.useContext(Tl),{pathname:q}=yh(),lt=JSON.stringify(Fg(nt));return Mt.useMemo(()=>jg(B,JSON.parse(lt),q,Y==="path"),[B,lt,q,Y])}function ky(B,Y){return E_(B,Y)}function E_(B,Y,nt,q,lt){qn(Of(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:yt}=Mt.useContext(wl),{matches:P}=Mt.useContext(Tl),h=P[P.length-1],et=h?h.params:{},ft=h?h.pathname:"/",Bt=h?h.pathnameBase:"/",Dt=h&&h.route;{let Pt=Dt&&Dt.path||"";M_(ft,!Dt||Pt.endsWith("*")||Pt.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${ft}" (under <Route path="${Pt}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${Pt}"> to <Route path="${Pt==="/"?"*":`${Pt}/*`}">.`)}let se=yh(),he;if(Y){let Pt=typeof Y=="string"?Dd(Y):Y;qn(Bt==="/"||Pt.pathname?.startsWith(Bt),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${Bt}" but pathname "${Pt.pathname}" was given in the \`location\` prop.`),he=Pt}else he=se;let xe=he.pathname||"/",Kt=xe;if(Bt!=="/"){let Pt=Bt.replace(/^\//,"").split("/");Kt="/"+xe.replace(/^\//,"").split("/").slice(Pt.length).join("/")}let gt=__(B,{pathname:Kt});Po(Dt||gt!=null,`No routes matched location "${he.pathname}${he.search}${he.hash}" `),Po(gt==null||gt[gt.length-1].route.element!==void 0||gt[gt.length-1].route.Component!==void 0||gt[gt.length-1].route.lazy!==void 0,`Matched leaf route at location "${he.pathname}${he.search}${he.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let Yt=jy(gt&&gt.map(Pt=>Object.assign({},Pt,{params:Object.assign({},et,Pt.params),pathname:fu([Bt,yt.encodeLocation?yt.encodeLocation(Pt.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:Pt.pathname]),pathnameBase:Pt.pathnameBase==="/"?Bt:fu([Bt,yt.encodeLocation?yt.encodeLocation(Pt.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:Pt.pathnameBase])})),P,nt,q,lt);return Y&&Yt?Mt.createElement(Jp.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...he},navigationType:"POP"}},Yt):Yt}function Oy(){let B=Zy(),Y=Ay(B)?`${B.status} ${B.statusText}`:B instanceof Error?B.message:JSON.stringify(B),nt=B instanceof Error?B.stack:null,q="rgba(200,200,200, 0.5)",lt={padding:"0.5rem",backgroundColor:q},yt={padding:"2px 4px",backgroundColor:q},P=null;return console.error("Error handled by React Router default ErrorBoundary:",B),P=Mt.createElement(Mt.Fragment,null,Mt.createElement("p",null," Hey developer "),Mt.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",Mt.createElement("code",{style:yt},"ErrorBoundary")," or"," ",Mt.createElement("code",{style:yt},"errorElement")," prop on your route.")),Mt.createElement(Mt.Fragment,null,Mt.createElement("h2",null,"Unexpected Application Error!"),Mt.createElement("h3",{style:{fontStyle:"italic"}},Y),nt?Mt.createElement("pre",{style:lt},nt):null,P)}var By=Mt.createElement(Oy,null),Ny=class extends Mt.Component{constructor(B){super(B),this.state={location:B.location,revalidation:B.revalidation,error:B.error}}static getDerivedStateFromError(B){return{error:B}}static getDerivedStateFromProps(B,Y){return Y.location!==B.location||Y.revalidation!=="idle"&&B.revalidation==="idle"?{error:B.error,location:B.location,revalidation:B.revalidation}:{error:B.error!==void 0?B.error:Y.error,location:Y.location,revalidation:B.revalidation||Y.revalidation}}componentDidCatch(B,Y){this.props.unstable_onError?this.props.unstable_onError(B,Y):console.error("React Router caught the following error during render",B)}render(){return this.state.error!==void 0?Mt.createElement(Tl.Provider,{value:this.props.routeContext},Mt.createElement(Vg.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function Fy({routeContext:B,match:Y,children:nt}){let q=Mt.useContext(kf);return q&&q.static&&q.staticContext&&(Y.route.errorElement||Y.route.ErrorBoundary)&&(q.staticContext._deepestRenderedBoundaryId=Y.route.id),Mt.createElement(Tl.Provider,{value:B},nt)}function jy(B,Y=[],nt=null,q=null,lt=null){if(B==null){if(!nt)return null;if(nt.errors)B=nt.matches;else if(Y.length===0&&!nt.initialized&&nt.matches.length>0)B=nt.matches;else return null}let yt=B,P=nt?.errors;if(P!=null){let ft=yt.findIndex(Bt=>Bt.route.id&&P?.[Bt.route.id]!==void 0);qn(ft>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(P).join(",")}`),yt=yt.slice(0,Math.min(yt.length,ft+1))}let h=!1,et=-1;if(nt)for(let ft=0;ft<yt.length;ft++){let Bt=yt[ft];if((Bt.route.HydrateFallback||Bt.route.hydrateFallbackElement)&&(et=ft),Bt.route.id){let{loaderData:Dt,errors:se}=nt,he=Bt.route.loader&&!Dt.hasOwnProperty(Bt.route.id)&&(!se||se[Bt.route.id]===void 0);if(Bt.route.lazy||he){h=!0,et>=0?yt=yt.slice(0,et+1):yt=[yt[0]];break}}}return yt.reduceRight((ft,Bt,Dt)=>{let se,he=!1,xe=null,Kt=null;nt&&(se=P&&Bt.route.id?P[Bt.route.id]:void 0,xe=Bt.route.errorElement||By,h&&(et<0&&Dt===0?(M_("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),he=!0,Kt=null):et===Dt&&(he=!0,Kt=Bt.route.hydrateFallbackElement||null)));let gt=Y.concat(yt.slice(0,Dt+1)),Yt=()=>{let Pt;return se?Pt=xe:he?Pt=Kt:Bt.route.Component?Pt=Mt.createElement(Bt.route.Component,null):Bt.route.element?Pt=Bt.route.element:Pt=ft,Mt.createElement(Fy,{match:Bt,routeContext:{outlet:ft,matches:gt,isDataRoute:nt!=null},children:Pt})};return nt&&(Bt.route.ErrorBoundary||Bt.route.errorElement||Dt===0)?Mt.createElement(Ny,{location:nt.location,revalidation:nt.revalidation,component:xe,error:se,children:Yt(),routeContext:{outlet:null,matches:gt,isDataRoute:!0},unstable_onError:q}):Yt()},null)}function Ug(B){return`${B} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function Vy(B){let Y=Mt.useContext(kf);return qn(Y,Ug(B)),Y}function Uy(B){let Y=Mt.useContext(Jm);return qn(Y,Ug(B)),Y}function Gy(B){let Y=Mt.useContext(Tl);return qn(Y,Ug(B)),Y}function Gg(B){let Y=Gy(B),nt=Y.matches[Y.matches.length-1];return qn(nt.route.id,`${B} can only be used on routes that contain a unique "id"`),nt.route.id}function qy(){return Gg("useRouteId")}function Zy(){let B=Mt.useContext(Vg),Y=Uy("useRouteError"),nt=Gg("useRouteError");return B!==void 0?B:Y.errors?.[nt]}function Hy(){let{router:B}=Vy("useNavigate"),Y=Gg("useNavigate"),nt=Mt.useRef(!1);return T_(()=>{nt.current=!0}),Mt.useCallback(async(lt,yt={})=>{Po(nt.current,w_),nt.current&&(typeof lt=="number"?B.navigate(lt):await B.navigate(lt,{fromRouteId:Y,...yt}))},[B,Y])}var f_={};function M_(B,Y,nt){!Y&&!f_[B]&&(f_[B]=!0,Po(!1,nt))}Mt.memo($y);function $y({routes:B,future:Y,state:nt,unstable_onError:q}){return E_(B,void 0,nt,q,Y)}function zg({to:B,replace:Y,state:nt,relative:q}){qn(Of(),"<Navigate> may be used only in the context of a <Router> component.");let{static:lt}=Mt.useContext(wl);Po(!lt,"<Navigate> must not be used on the initial render in a <StaticRouter>. This is a no-op, but you should modify your code so the <Navigate> is only ever rendered in response to some user interaction or state change.");let{matches:yt}=Mt.useContext(Tl),{pathname:P}=yh(),h=S_(),et=jg(B,Fg(yt),P,q==="path"),ft=JSON.stringify(et);return Mt.useEffect(()=>{h(JSON.parse(ft),{replace:Y,state:nt,relative:q})},[h,ft,q,Y,nt]),null}function _h(B){qn(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function Xy({basename:B="/",children:Y=null,location:nt,navigationType:q="POP",navigator:lt,static:yt=!1}){qn(!Of(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let P=B.replace(/^\/*/,"/"),h=Mt.useMemo(()=>({basename:P,navigator:lt,static:yt,future:{}}),[P,lt,yt]);typeof nt=="string"&&(nt=Dd(nt));let{pathname:et="/",search:ft="",hash:Bt="",state:Dt=null,key:se="default"}=nt,he=Mt.useMemo(()=>{let xe=pu(et,P);return xe==null?null:{location:{pathname:xe,search:ft,hash:Bt,state:Dt,key:se},navigationType:q}},[P,et,ft,Bt,Dt,se,q]);return Po(he!=null,`<Router basename="${P}"> is not able to match the URL "${et}${ft}${Bt}" because it does not start with the basename, so the <Router> won't render anything.`),he==null?null:Mt.createElement(wl.Provider,{value:h},Mt.createElement(Jp.Provider,{children:Y,value:he}))}function Yy({children:B,location:Y}){return ky(kg(B),Y)}function kg(B,Y=[]){let nt=[];return Mt.Children.forEach(B,(q,lt)=>{if(!Mt.isValidElement(q))return;let yt=[...Y,lt];if(q.type===Mt.Fragment){nt.push.apply(nt,kg(q.props.children,yt));return}qn(q.type===_h,`[${typeof q.type=="string"?q.type:q.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),qn(!q.props.index||!q.props.children,"An index route cannot have child routes.");let P={id:q.props.id||yt.join("-"),caseSensitive:q.props.caseSensitive,element:q.props.element,Component:q.props.Component,index:q.props.index,path:q.props.path,middleware:q.props.middleware,loader:q.props.loader,action:q.props.action,hydrateFallbackElement:q.props.hydrateFallbackElement,HydrateFallback:q.props.HydrateFallback,errorElement:q.props.errorElement,ErrorBoundary:q.props.ErrorBoundary,hasErrorBoundary:q.props.hasErrorBoundary===!0||q.props.ErrorBoundary!=null||q.props.errorElement!=null,shouldRevalidate:q.props.shouldRevalidate,handle:q.props.handle,lazy:q.props.lazy};q.props.children&&(P.children=kg(q.props.children,yt)),nt.push(P)}),nt}var Ym="get",Wm="application/x-www-form-urlencoded";function tg(B){return B!=null&&typeof B.tagName=="string"}function Wy(B){return tg(B)&&B.tagName.toLowerCase()==="button"}function Ky(B){return tg(B)&&B.tagName.toLowerCase()==="form"}function Qy(B){return tg(B)&&B.tagName.toLowerCase()==="input"}function Jy(B){return!!(B.metaKey||B.altKey||B.ctrlKey||B.shiftKey)}function tv(B,Y){return B.button===0&&(!Y||Y==="_self")&&!Jy(B)}var $m=null;function ev(){if($m===null)try{new FormData(document.createElement("form"),0),$m=!1}catch{$m=!0}return $m}var iv=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function Pg(B){return B!=null&&!iv.has(B)?(Po(!1,`"${B}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${Wm}"`),null):B}function nv(B,Y){let nt,q,lt,yt,P;if(Ky(B)){let h=B.getAttribute("action");q=h?pu(h,Y):null,nt=B.getAttribute("method")||Ym,lt=Pg(B.getAttribute("enctype"))||Wm,yt=new FormData(B)}else if(Wy(B)||Qy(B)&&(B.type==="submit"||B.type==="image")){let h=B.form;if(h==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let et=B.getAttribute("formaction")||h.getAttribute("action");if(q=et?pu(et,Y):null,nt=B.getAttribute("formmethod")||h.getAttribute("method")||Ym,lt=Pg(B.getAttribute("formenctype"))||Pg(h.getAttribute("enctype"))||Wm,yt=new FormData(h,B),!ev()){let{name:ft,type:Bt,value:Dt}=B;if(Bt==="image"){let se=ft?`${ft}.`:"";yt.append(`${se}x`,"0"),yt.append(`${se}y`,"0")}else ft&&yt.append(ft,Dt)}}else{if(tg(B))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');nt=Ym,q=null,lt=Wm,P=B}return yt&&lt==="text/plain"&&(P=yt,yt=void 0),{action:q,method:nt.toLowerCase(),encType:lt,formData:yt,body:P}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function qg(B,Y){if(B===!1||B===null||typeof B>"u")throw new Error(Y)}function av(B,Y,nt){let q=typeof B=="string"?new URL(B,typeof window>"u"?"server://singlefetch/":window.location.origin):B;return q.pathname==="/"?q.pathname=`_root.${nt}`:Y&&pu(q.pathname,Y)==="/"?q.pathname=`${Y.replace(/\/$/,"")}/_root.${nt}`:q.pathname=`${q.pathname.replace(/\/$/,"")}.${nt}`,q}async function rv(B,Y){if(B.id in Y)return Y[B.id];try{let nt=await import(B.module);return Y[B.id]=nt,nt}catch(nt){return console.error(`Error loading route module \`${B.module}\`, reloading page...`),console.error(nt),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function sv(B){return B==null?!1:B.href==null?B.rel==="preload"&&typeof B.imageSrcSet=="string"&&typeof B.imageSizes=="string":typeof B.rel=="string"&&typeof B.href=="string"}async function ov(B,Y,nt){let q=await Promise.all(B.map(async lt=>{let yt=Y.routes[lt.route.id];if(yt){let P=await rv(yt,nt);return P.links?P.links():[]}return[]}));return hv(q.flat(1).filter(sv).filter(lt=>lt.rel==="stylesheet"||lt.rel==="preload").map(lt=>lt.rel==="stylesheet"?{...lt,rel:"prefetch",as:"style"}:{...lt,rel:"prefetch"}))}function p_(B,Y,nt,q,lt,yt){let P=(et,ft)=>nt[ft]?et.route.id!==nt[ft].route.id:!0,h=(et,ft)=>nt[ft].pathname!==et.pathname||nt[ft].route.path?.endsWith("*")&&nt[ft].params["*"]!==et.params["*"];return yt==="assets"?Y.filter((et,ft)=>P(et,ft)||h(et,ft)):yt==="data"?Y.filter((et,ft)=>{let Bt=q.routes[et.route.id];if(!Bt||!Bt.hasLoader)return!1;if(P(et,ft)||h(et,ft))return!0;if(et.route.shouldRevalidate){let Dt=et.route.shouldRevalidate({currentUrl:new URL(lt.pathname+lt.search+lt.hash,window.origin),currentParams:nt[0]?.params||{},nextUrl:new URL(B,window.origin),nextParams:et.params,defaultShouldRevalidate:!0});if(typeof Dt=="boolean")return Dt}return!0}):[]}function lv(B,Y,{includeHydrateFallback:nt}={}){return cv(B.map(q=>{let lt=Y.routes[q.route.id];if(!lt)return[];let yt=[lt.module];return lt.clientActionModule&&(yt=yt.concat(lt.clientActionModule)),lt.clientLoaderModule&&(yt=yt.concat(lt.clientLoaderModule)),nt&&lt.hydrateFallbackModule&&(yt=yt.concat(lt.hydrateFallbackModule)),lt.imports&&(yt=yt.concat(lt.imports)),yt}).flat(1))}function cv(B){return[...new Set(B)]}function uv(B){let Y={},nt=Object.keys(B).sort();for(let q of nt)Y[q]=B[q];return Y}function hv(B,Y){let nt=new Set;return new Set(Y),B.reduce((q,lt)=>{let yt=JSON.stringify(uv(lt));return nt.has(yt)||(nt.add(yt),q.push({key:yt,link:lt})),q},[])}function C_(){let B=Mt.useContext(kf);return qg(B,"You must render this element inside a <DataRouterContext.Provider> element"),B}function dv(){let B=Mt.useContext(Jm);return qg(B,"You must render this element inside a <DataRouterStateContext.Provider> element"),B}var Zg=Mt.createContext(void 0);Zg.displayName="FrameworkContext";function A_(){let B=Mt.useContext(Zg);return qg(B,"You must render this element inside a <HydratedRouter> element"),B}function fv(B,Y){let nt=Mt.useContext(Zg),[q,lt]=Mt.useState(!1),[yt,P]=Mt.useState(!1),{onFocus:h,onBlur:et,onMouseEnter:ft,onMouseLeave:Bt,onTouchStart:Dt}=Y,se=Mt.useRef(null);Mt.useEffect(()=>{if(B==="render"&&P(!0),B==="viewport"){let Kt=Yt=>{Yt.forEach(Pt=>{P(Pt.isIntersecting)})},gt=new IntersectionObserver(Kt,{threshold:.5});return se.current&&gt.observe(se.current),()=>{gt.disconnect()}}},[B]),Mt.useEffect(()=>{if(q){let Kt=setTimeout(()=>{P(!0)},100);return()=>{clearTimeout(Kt)}}},[q]);let he=()=>{lt(!0)},xe=()=>{lt(!1),P(!1)};return nt?B!=="intent"?[yt,se,{}]:[yt,se,{onFocus:Xp(h,he),onBlur:Xp(et,xe),onMouseEnter:Xp(ft,he),onMouseLeave:Xp(Bt,xe),onTouchStart:Xp(Dt,he)}]:[!1,se,{}]}function Xp(B,Y){return nt=>{B&&B(nt),nt.defaultPrevented||Y(nt)}}function pv({page:B,...Y}){let{router:nt}=C_(),q=Mt.useMemo(()=>__(nt.routes,B,nt.basename),[nt.routes,B,nt.basename]);return q?Mt.createElement(gv,{page:B,matches:q,...Y}):null}function mv(B){let{manifest:Y,routeModules:nt}=A_(),[q,lt]=Mt.useState([]);return Mt.useEffect(()=>{let yt=!1;return ov(B,Y,nt).then(P=>{yt||lt(P)}),()=>{yt=!0}},[B,Y,nt]),q}function gv({page:B,matches:Y,...nt}){let q=yh(),{manifest:lt,routeModules:yt}=A_(),{basename:P}=C_(),{loaderData:h,matches:et}=dv(),ft=Mt.useMemo(()=>p_(B,Y,et,lt,q,"data"),[B,Y,et,lt,q]),Bt=Mt.useMemo(()=>p_(B,Y,et,lt,q,"assets"),[B,Y,et,lt,q]),Dt=Mt.useMemo(()=>{if(B===q.pathname+q.search+q.hash)return[];let xe=new Set,Kt=!1;if(Y.forEach(Yt=>{let Pt=lt.routes[Yt.route.id];!Pt||!Pt.hasLoader||(!ft.some(At=>At.route.id===Yt.route.id)&&Yt.route.id in h&&yt[Yt.route.id]?.shouldRevalidate||Pt.hasClientLoader?Kt=!0:xe.add(Yt.route.id))}),xe.size===0)return[];let gt=av(B,P,"data");return Kt&&xe.size>0&&gt.searchParams.set("_routes",Y.filter(Yt=>xe.has(Yt.route.id)).map(Yt=>Yt.route.id).join(",")),[gt.pathname+gt.search]},[P,h,q,lt,ft,Y,B,yt]),se=Mt.useMemo(()=>lv(Bt,lt),[Bt,lt]),he=mv(Bt);return Mt.createElement(Mt.Fragment,null,Dt.map(xe=>Mt.createElement("link",{key:xe,rel:"prefetch",as:"fetch",href:xe,...nt})),se.map(xe=>Mt.createElement("link",{key:xe,rel:"modulepreload",href:xe,...nt})),he.map(({key:xe,link:Kt})=>Mt.createElement("link",{key:xe,nonce:nt.nonce,...Kt})))}function _v(...B){return Y=>{B.forEach(nt=>{typeof nt=="function"?nt(Y):nt!=null&&(nt.current=Y)})}}var D_=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{D_&&(window.__reactRouterVersion="7.9.5")}catch{}function yv({basename:B,children:Y,window:nt}){let q=Mt.useRef();q.current==null&&(q.current=ry({window:nt,v5Compat:!0}));let lt=q.current,[yt,P]=Mt.useState({action:lt.action,location:lt.location}),h=Mt.useCallback(et=>{Mt.startTransition(()=>P(et))},[P]);return Mt.useLayoutEffect(()=>lt.listen(h),[lt,h]),Mt.createElement(Xy,{basename:B,children:Y,location:yt.location,navigationType:yt.action,navigator:lt})}var z_=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,P_=Mt.forwardRef(function({onClick:Y,discover:nt="render",prefetch:q="none",relative:lt,reloadDocument:yt,replace:P,state:h,target:et,to:ft,preventScrollReset:Bt,viewTransition:Dt,...se},he){let{basename:xe}=Mt.useContext(wl),Kt=typeof ft=="string"&&z_.test(ft),gt,Yt=!1;if(typeof ft=="string"&&Kt&&(gt=ft,D_))try{let $e=new URL(window.location.href),Ai=ft.startsWith("//")?new URL($e.protocol+ft):new URL(ft),sn=pu(Ai.pathname,xe);Ai.origin===$e.origin&&sn!=null?ft=sn+Ai.search+Ai.hash:Yt=!0}catch{Po(!1,`<Link to="${ft}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let Pt=Iy(ft,{relative:lt}),[At,ce,ue]=fv(q,se),we=wv(ft,{replace:P,state:h,target:et,preventScrollReset:Bt,relative:lt,viewTransition:Dt});function pe($e){Y&&Y($e),$e.defaultPrevented||we($e)}let pi=Mt.createElement("a",{...se,...ue,href:gt||Pt,onClick:Yt||yt?Y:pe,ref:_v(he,ce),target:et,"data-discover":!Kt&&nt==="render"?"true":void 0});return At&&!Kt?Mt.createElement(Mt.Fragment,null,pi,Mt.createElement(pv,{page:Pt})):pi});P_.displayName="Link";var vv=Mt.forwardRef(function({"aria-current":Y="page",caseSensitive:nt=!1,className:q="",end:lt=!1,style:yt,to:P,viewTransition:h,children:et,...ft},Bt){let Dt=tm(P,{relative:ft.relative}),se=yh(),he=Mt.useContext(Jm),{navigator:xe,basename:Kt}=Mt.useContext(wl),gt=he!=null&&Cv(Dt)&&h===!0,Yt=xe.encodeLocation?xe.encodeLocation(Dt).pathname:Dt.pathname,Pt=se.pathname,At=he&&he.navigation&&he.navigation.location?he.navigation.location.pathname:null;nt||(Pt=Pt.toLowerCase(),At=At?At.toLowerCase():null,Yt=Yt.toLowerCase()),At&&Kt&&(At=pu(At,Kt)||At);const ce=Yt!=="/"&&Yt.endsWith("/")?Yt.length-1:Yt.length;let ue=Pt===Yt||!lt&&Pt.startsWith(Yt)&&Pt.charAt(ce)==="/",we=At!=null&&(At===Yt||!lt&&At.startsWith(Yt)&&At.charAt(Yt.length)==="/"),pe={isActive:ue,isPending:we,isTransitioning:gt},pi=ue?Y:void 0,$e;typeof q=="function"?$e=q(pe):$e=[q,ue?"active":null,we?"pending":null,gt?"transitioning":null].filter(Boolean).join(" ");let Ai=typeof yt=="function"?yt(pe):yt;return Mt.createElement(P_,{...ft,"aria-current":pi,className:$e,ref:Bt,style:Ai,to:P,viewTransition:h},typeof et=="function"?et(pe):et)});vv.displayName="NavLink";var xv=Mt.forwardRef(({discover:B="render",fetcherKey:Y,navigate:nt,reloadDocument:q,replace:lt,state:yt,method:P=Ym,action:h,onSubmit:et,relative:ft,preventScrollReset:Bt,viewTransition:Dt,...se},he)=>{let xe=Ev(),Kt=Mv(h,{relative:ft}),gt=P.toLowerCase()==="get"?"get":"post",Yt=typeof h=="string"&&z_.test(h),Pt=At=>{if(et&&et(At),At.defaultPrevented)return;At.preventDefault();let ce=At.nativeEvent.submitter,ue=ce?.getAttribute("formmethod")||P;xe(ce||At.currentTarget,{fetcherKey:Y,method:ue,navigate:nt,replace:lt,state:yt,relative:ft,preventScrollReset:Bt,viewTransition:Dt})};return Mt.createElement("form",{ref:he,method:gt,action:Kt,onSubmit:q?et:Pt,...se,"data-discover":!Yt&&B==="render"?"true":void 0})});xv.displayName="Form";function bv(B){return`${B} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function I_(B){let Y=Mt.useContext(kf);return qn(Y,bv(B)),Y}function wv(B,{target:Y,replace:nt,state:q,preventScrollReset:lt,relative:yt,viewTransition:P}={}){let h=S_(),et=yh(),ft=tm(B,{relative:yt});return Mt.useCallback(Bt=>{if(tv(Bt,Y)){Bt.preventDefault();let Dt=nt!==void 0?nt:Kp(et)===Kp(ft);h(B,{replace:Dt,state:q,preventScrollReset:lt,relative:yt,viewTransition:P})}},[et,h,ft,nt,q,Y,B,lt,yt,P])}var Tv=0,Sv=()=>`__${String(++Tv)}__`;function Ev(){let{router:B}=I_("useSubmit"),{basename:Y}=Mt.useContext(wl),nt=qy();return Mt.useCallback(async(q,lt={})=>{let{action:yt,method:P,encType:h,formData:et,body:ft}=nv(q,Y);if(lt.navigate===!1){let Bt=lt.fetcherKey||Sv();await B.fetch(Bt,nt,lt.action||yt,{preventScrollReset:lt.preventScrollReset,formData:et,body:ft,formMethod:lt.method||P,formEncType:lt.encType||h,flushSync:lt.flushSync})}else await B.navigate(lt.action||yt,{preventScrollReset:lt.preventScrollReset,formData:et,body:ft,formMethod:lt.method||P,formEncType:lt.encType||h,replace:lt.replace,state:lt.state,fromRouteId:nt,flushSync:lt.flushSync,viewTransition:lt.viewTransition})},[B,Y,nt])}function Mv(B,{relative:Y}={}){let{basename:nt}=Mt.useContext(wl),q=Mt.useContext(Tl);qn(q,"useFormAction must be used inside a RouteContext");let[lt]=q.matches.slice(-1),yt={...tm(B||".",{relative:Y})},P=yh();if(B==null){yt.search=P.search;let h=new URLSearchParams(yt.search),et=h.getAll("index");if(et.some(Bt=>Bt==="")){h.delete("index"),et.filter(Dt=>Dt).forEach(Dt=>h.append("index",Dt));let Bt=h.toString();yt.search=Bt?`?${Bt}`:""}}return(!B||B===".")&&lt.route.index&&(yt.search=yt.search?yt.search.replace(/^\?/,"?index&"):"?index"),nt!=="/"&&(yt.pathname=yt.pathname==="/"?nt:fu([nt,yt.pathname])),Kp(yt)}function Cv(B,{relative:Y}={}){let nt=Mt.useContext(b_);qn(nt!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:q}=I_("useViewTransitionState"),lt=tm(B,{relative:Y});if(!nt.isTransitioning)return!1;let yt=pu(nt.currentLocation.pathname,q)||nt.currentLocation.pathname,P=pu(nt.nextLocation.pathname,q)||nt.nextLocation.pathname;return Qm(lt.pathname,P)!=null||Qm(lt.pathname,yt)!=null}const R_="dots_users_v1",Og="dots_current_user_v1";function L_(){try{const B=localStorage.getItem(R_);return B?JSON.parse(B):[]}catch(B){return console.error(B),[]}}function Av(B){localStorage.setItem(R_,JSON.stringify(B))}function er(){try{const B=localStorage.getItem(Og);return B?JSON.parse(B):null}catch(B){return console.error(B),null}}function Hg(B){B?localStorage.setItem(Og,JSON.stringify(B)):localStorage.removeItem(Og);try{window.dispatchEvent(new Event("authChanged"))}catch(Y){console.debug("auth event dispatch failed",Y)}}function Dv({name:B,email:Y,password:nt}){const q=L_();if(q.find(yt=>yt.email===Y))throw new Error("A user with that email already exists");const lt={id:Date.now(),name:B,email:Y,password:nt};return q.push(lt),Av(q),Hg({id:lt.id,name:lt.name,email:lt.email}),lt}function zv({email:B,password:Y}){const q=L_().find(lt=>lt.email===B&&lt.password===Y);if(!q)throw new Error("Invalid email or password");return Hg({id:q.id,name:q.name,email:q.email}),q}function Pv(){Hg(null)}const Qp="/p94/assets/DotTheWorld-D6bB90Xd.png";function Iv(){const[B,Y]=Mt.useState("login"),[nt,q]=Mt.useState(""),[lt,yt]=Mt.useState(er());Mt.useEffect(()=>{function et(){yt(er())}return window.addEventListener("authChanged",et),window.addEventListener("storage",et),()=>{window.removeEventListener("authChanged",et),window.removeEventListener("storage",et)}},[]);async function P(et){et.preventDefault(),q("");const ft=new FormData(et.target);try{zv({email:ft.get("email"),password:ft.get("password")})}catch(Bt){q(Bt.message);return}yt(er()),window.location.hash="#/map"}async function h(et){et.preventDefault(),q("");const ft=new FormData(et.target),Bt=ft.get("name"),Dt=ft.get("email"),se=ft.get("password");try{Dv({name:Bt,email:Dt,password:se})}catch(he){q(he.message);return}yt(er()),window.location.hash="#/map"}return lt?U.jsx("div",{className:"container py-4",children:U.jsxs("div",{className:"row",children:[U.jsx("div",{className:"col-md-6",children:U.jsxs("div",{className:"p-4 bg-light rounded-3",children:[U.jsxs("h1",{children:["Welcome back, ",lt.name,"!"]}),U.jsx("p",{className:"lead",children:"You're signed in. Visit the Map to start pinning your travels."}),U.jsx("button",{className:"btn btn-primary",onClick:()=>{window.location.hash="#/map"},children:"Open Map"})]})}),U.jsx("div",{className:"col-md-6",children:U.jsxs("div",{className:"p-4",children:[U.jsx("div",{className:"text-center mb-4",children:U.jsx("img",{src:Qp,alt:"Dot the World Logo - circular icon with map pin",style:{width:"200px",height:"200px",marginBottom:"1rem"}})}),U.jsx("h2",{children:"About Dot the World"}),U.jsx("p",{className:"lead",children:"Your personal travel companion for capturing memories around the globe."}),U.jsx("p",{children:"Dot the World is an interactive travel journal that lets you pin your favorite places, share photos, and document your adventures on a beautiful map. Whether it's a hidden restaurant, a breathtaking viewpoint, or a memorable museum visit, every location tells a story."}),U.jsxs("ul",{children:[U.jsx("li",{children:" Drop pins anywhere in the world"}),U.jsx("li",{children:" Add photos and personal notes"}),U.jsx("li",{children:" Organize by custom categories"}),U.jsx("li",{children:" Search and filter your travels"}),U.jsx("li",{children:" Visualize your journey on an interactive map"})]})]})})]})}):U.jsx("div",{className:"container py-4",children:U.jsxs("div",{className:"row",children:[U.jsx("div",{className:"col-md-6",children:U.jsxs("div",{className:"p-4 bg-light rounded-3",children:[U.jsx("h2",{children:B==="login"?"Login":"Sign up"}),nt&&U.jsx("div",{className:"alert alert-danger",children:nt}),B==="login"?U.jsxs("form",{onSubmit:P,children:[U.jsxs("div",{className:"mb-2",children:[U.jsx("label",{className:"form-label",children:"Email"}),U.jsx("input",{name:"email",type:"email",className:"form-control",required:!0})]}),U.jsxs("div",{className:"mb-3",children:[U.jsx("label",{className:"form-label",children:"Password"}),U.jsx("input",{name:"password",type:"password",className:"form-control",required:!0})]}),U.jsxs("div",{className:"d-flex gap-2",children:[U.jsx("button",{className:"btn btn-primary",children:"Login"}),U.jsx("button",{type:"button",className:"btn btn-link",onClick:()=>Y("signup"),children:"Create account"})]})]}):U.jsxs("form",{onSubmit:h,children:[U.jsxs("div",{className:"mb-2",children:[U.jsx("label",{className:"form-label",children:"Name"}),U.jsx("input",{name:"name",className:"form-control",required:!0})]}),U.jsxs("div",{className:"mb-2",children:[U.jsx("label",{className:"form-label",children:"Email"}),U.jsx("input",{name:"email",type:"email",className:"form-control",required:!0})]}),U.jsxs("div",{className:"mb-3",children:[U.jsx("label",{className:"form-label",children:"Password"}),U.jsx("input",{name:"password",type:"password",className:"form-control",required:!0})]}),U.jsxs("div",{className:"d-flex gap-2",children:[U.jsx("button",{className:"btn btn-primary",children:"Sign up"}),U.jsx("button",{type:"button",className:"btn btn-link",onClick:()=>Y("login"),children:"Have an account? Login"})]})]})]})}),U.jsx("div",{className:"col-md-6",children:U.jsxs("div",{className:"p-4",children:[U.jsx("div",{className:"text-center mb-4",children:U.jsx("img",{src:Qp,alt:"Dot the World Logo - circular icon with map pin",style:{width:"200px",height:"200px",marginBottom:"1rem"}})}),U.jsx("h2",{children:"About Dot the World"}),U.jsx("p",{className:"lead",children:"Your personal travel companion for capturing memories around the globe."}),U.jsx("p",{children:"Dot the World is an interactive travel journal that lets you pin your favorite places, share photos, and document your adventures on a beautiful map. Whether it's a hidden restaurant, a breathtaking viewpoint, or a memorable museum visit, every location tells a story."}),U.jsxs("ul",{children:[U.jsx("li",{children:" Drop pins anywhere in the world"}),U.jsx("li",{children:" Add photos and personal notes"}),U.jsx("li",{children:" Organize by custom categories"}),U.jsx("li",{children:" Search and filter your travels"}),U.jsx("li",{children:" Visualize your journey on an interactive map"})]}),U.jsx("p",{className:"text-muted",children:"Start your journey today - sign up and begin dotting the world!"})]})})]})})}function Rv(){return U.jsx("div",{className:"container py-4",children:U.jsxs("div",{className:"row g-4",children:[U.jsx("div",{className:"col-md-4",children:U.jsx("img",{src:"/public/avatar.png",alt:"Avatar",className:"img-fluid rounded-circle"})}),U.jsx("div",{className:"col-md-8",children:U.jsx("h1",{children:"About Me"})})]})})}function Lv(){const[B,Y]=Mt.useState(er()),[nt,q]=Mt.useState(null),[lt,yt]=Mt.useState("Home");Mt.useEffect(()=>{function h(){const et=er();Y(et),et?P(et.email):q(null)}return h(),window.addEventListener("authChanged",h),window.addEventListener("storage",h),()=>{window.removeEventListener("authChanged",h),window.removeEventListener("storage",h)}},[]);function P(h){try{const et=JSON.parse(localStorage.getItem("dots_user_profiles")||"{}");q(et[h]||null)}catch(et){console.error("Error loading profile:",et),q(null)}}return Mt.useEffect(()=>{function h(){const et=window.location.hash;et==="#/"||et===""?yt("Home"):et==="#/map"?yt("Map"):et==="#/profile"?yt("Me"):et==="#/wishlist"?yt("Wishlist"):et==="#/contact"?yt("Contact"):et==="#/projects"&&yt("Projects")}return h(),window.addEventListener("hashchange",h),()=>window.removeEventListener("hashchange",h)},[]),U.jsx("nav",{className:"navbar navbar-expand-lg navbar-dark bg-primary",style:{padding:"0.5rem 1rem"},children:U.jsxs("div",{className:"container-fluid",style:{padding:0},children:[U.jsxs("a",{className:"navbar-brand d-flex align-items-center",href:"#/",style:{margin:0,gap:"0.5rem"},children:[U.jsx("img",{src:Qp,alt:"Logo",style:{width:"32px",height:"32px"}}),U.jsxs("span",{children:["Dot the World ",U.jsxs("span",{style:{fontSize:"0.9rem",opacity:.8},children:["| ",lt]})]})]}),U.jsx("button",{className:"navbar-toggler",type:"button","data-bs-toggle":"collapse","data-bs-target":"#navmenu",children:U.jsx("span",{className:"navbar-toggler-icon"})}),U.jsx("div",{className:"collapse navbar-collapse",id:"navmenu",children:U.jsx("ul",{className:"navbar-nav ms-auto align-items-center",style:{gap:"0.5rem"},children:B?U.jsxs(U.Fragment,{children:[U.jsx("li",{className:"nav-item",children:U.jsx("a",{className:"nav-link",href:"#/",children:"Home"})}),U.jsx("li",{className:"nav-item",children:U.jsx("a",{className:"nav-link",href:"#/map",children:"Map"})}),U.jsx("li",{className:"nav-item",children:U.jsx("a",{className:"nav-link",href:"#/wishlist",children:"Wishlist"})}),U.jsx("li",{className:"nav-item",children:U.jsx("a",{className:"nav-link",href:"#/contact",children:"Contact"})}),U.jsx("li",{className:"nav-item ms-3",children:U.jsxs("span",{className:"text-light",children:["Hi, ",B.name]})}),U.jsx("li",{className:"nav-item ms-2",children:U.jsx("a",{href:"#/profile",style:{textDecoration:"none"},children:U.jsx("img",{src:nt?.profilePic||Qp,alt:"Profile",style:{width:"32px",height:"32px",borderRadius:"50%",objectFit:"cover",border:"2px solid white",cursor:"pointer"}})})}),U.jsx("li",{className:"nav-item ms-2",children:U.jsx("button",{className:"btn btn-sm btn-outline-light",onClick:()=>{window.confirm("Are you sure you want to log out?")&&(Pv(),window.location.hash="#/",window.location.reload())},children:"Logout"})})]}):U.jsx("li",{className:"nav-item",children:U.jsx("a",{className:"nav-link",href:"#/",children:"Home"})})})})]})})}const kv="/p94/assets/ThankYou-DF9xLI-C.png";function Ov(){const[B,Y]=Mt.useState(""),[nt,q]=Mt.useState(""),[lt,yt]=Mt.useState(""),[P,h]=Mt.useState({}),[et,ft]=Mt.useState(!1);function Bt(){const se={};return B.trim()||(se.name="Name is required."),nt.trim()?/^[^@\s]+@[^@\s]+\.[^@\s]+$/.test(nt)||(se.email="Email is invalid."):se.email="Email is required.",lt.trim()||(se.message="Message cannot be empty."),h(se),Object.keys(se).length===0}function Dt(se){se.preventDefault(),Bt()&&(ft(!0),Y(""),q(""),yt(""),setTimeout(()=>ft(!1),4e3))}return U.jsxs("div",{className:"container py-4",children:[U.jsxs("div",{className:"row align-items-center",children:[U.jsxs("div",{className:"col-md-6",children:[U.jsx("h2",{children:"Contact"}),U.jsx("p",{className:"lead mb-4",children:"We'd love to hear from you! Whether you have suggestions, complaints, or just want to get in touch, feel free to submit this form."})]}),U.jsx("div",{className:"col-md-6 text-center mb-4",children:U.jsx("img",{src:kv,alt:"Thank You",style:{maxWidth:"250px",width:"100%",height:"auto"}})})]}),U.jsxs("form",{onSubmit:Dt,noValidate:!0,children:[U.jsxs("div",{className:"mb-3",children:[U.jsx("label",{className:"form-label",children:"Name"}),U.jsx("input",{className:`form-control ${P.name?"is-invalid":""}`,value:B,onChange:se=>Y(se.target.value)}),P.name&&U.jsx("div",{className:"invalid-feedback",children:P.name})]}),U.jsxs("div",{className:"mb-3",children:[U.jsx("label",{className:"form-label",children:"Email"}),U.jsx("input",{className:`form-control ${P.email?"is-invalid":""}`,value:nt,onChange:se=>q(se.target.value)}),P.email&&U.jsx("div",{className:"invalid-feedback",children:P.email})]}),U.jsxs("div",{className:"mb-3",children:[U.jsx("label",{className:"form-label",children:"Message"}),U.jsx("textarea",{className:`form-control ${P.message?"is-invalid":""}`,rows:6,value:lt,onChange:se=>yt(se.target.value)}),P.message&&U.jsx("div",{className:"invalid-feedback",children:P.message})]}),U.jsx("button",{className:"btn btn-primary",type:"submit",children:"Send"}),et&&U.jsx("div",{className:"alert alert-success mt-3",children:"Message sent (simulated)"})]}),U.jsxs("div",{className:"mt-5 pt-4 border-top",children:[U.jsx("p",{className:"text-muted mb-1",children:"You can also reach me directly at:"}),U.jsx("p",{className:"mb-0",children:U.jsx("a",{href:"mailto:Camilla021015@gmail.com",className:"text-decoration-none",children:"Camilla021015@gmail.com"})})]})]})}var Km={exports:{}};var Bv=Km.exports,m_;function Nv(){return m_||(m_=1,(function(B,Y){(function(nt,q){B.exports=q()})(Bv,(function(){var nt={},q={};function lt(P,h,et){if(q[P]=et,P==="index"){var ft="var sharedModule = {}; ("+q.shared+")(sharedModule); ("+q.worker+")(sharedModule);",Bt={};return q.shared(Bt),q.index(nt,Bt),typeof window<"u"&&nt.setWorkerUrl(window.URL.createObjectURL(new Blob([ft],{type:"text/javascript"}))),nt}}lt("shared",["exports"],(function(P){function h(a,t,i,o){return new(i||(i=Promise))((function(l,d){function p(T){try{x(o.next(T))}catch(M){d(M)}}function y(T){try{x(o.throw(T))}catch(M){d(M)}}function x(T){var M;T.done?l(T.value):(M=T.value,M instanceof i?M:new i((function(A){A(M)}))).then(p,y)}x((o=o.apply(a,t||[])).next())}))}function et(a,t){this.x=a,this.y=t}function ft(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}var Bt,Dt;typeof SuppressedError=="function"&&SuppressedError,et.prototype={clone(){return new et(this.x,this.y)},add(a){return this.clone()._add(a)},sub(a){return this.clone()._sub(a)},multByPoint(a){return this.clone()._multByPoint(a)},divByPoint(a){return this.clone()._divByPoint(a)},mult(a){return this.clone()._mult(a)},div(a){return this.clone()._div(a)},rotate(a){return this.clone()._rotate(a)},rotateAround(a,t){return this.clone()._rotateAround(a,t)},matMult(a){return this.clone()._matMult(a)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(a){return this.x===a.x&&this.y===a.y},dist(a){return Math.sqrt(this.distSqr(a))},distSqr(a){const t=a.x-this.x,i=a.y-this.y;return t*t+i*i},angle(){return Math.atan2(this.y,this.x)},angleTo(a){return Math.atan2(this.y-a.y,this.x-a.x)},angleWith(a){return this.angleWithSep(a.x,a.y)},angleWithSep(a,t){return Math.atan2(this.x*t-this.y*a,this.x*a+this.y*t)},_matMult(a){const t=a[2]*this.x+a[3]*this.y;return this.x=a[0]*this.x+a[1]*this.y,this.y=t,this},_add(a){return this.x+=a.x,this.y+=a.y,this},_sub(a){return this.x-=a.x,this.y-=a.y,this},_mult(a){return this.x*=a,this.y*=a,this},_div(a){return this.x/=a,this.y/=a,this},_multByPoint(a){return this.x*=a.x,this.y*=a.y,this},_divByPoint(a){return this.x/=a.x,this.y/=a.y,this},_unit(){return this._div(this.mag()),this},_perp(){const a=this.y;return this.y=this.x,this.x=-a,this},_rotate(a){const t=Math.cos(a),i=Math.sin(a),o=i*this.x+t*this.y;return this.x=t*this.x-i*this.y,this.y=o,this},_rotateAround(a,t){const i=Math.cos(a),o=Math.sin(a),l=t.y+o*(this.x-t.x)+i*(this.y-t.y);return this.x=t.x+i*(this.x-t.x)-o*(this.y-t.y),this.y=l,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:et},et.convert=function(a){if(a instanceof et)return a;if(Array.isArray(a))return new et(+a[0],+a[1]);if(a.x!==void 0&&a.y!==void 0)return new et(+a.x,+a.y);throw new Error("Expected [x, y] or {x, y} point format")};var se=(function(){if(Dt)return Bt;function a(t,i,o,l){this.cx=3*t,this.bx=3*(o-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(l-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=i,this.p2x=o,this.p2y=l}return Dt=1,Bt=a,a.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,i){if(i===void 0&&(i=1e-6),t<0)return 0;if(t>1)return 1;for(var o=t,l=0;l<8;l++){var d=this.sampleCurveX(o)-t;if(Math.abs(d)<i)return o;var p=this.sampleCurveDerivativeX(o);if(Math.abs(p)<1e-6)break;o-=d/p}var y=0,x=1;for(o=t,l=0;l<20&&(d=this.sampleCurveX(o),!(Math.abs(d-t)<i));l++)t>d?y=o:x=o,o=.5*(x-y)+y;return o},solve:function(t,i){return this.sampleCurveY(this.solveCurveX(t,i))}},Bt})(),he=ft(se);let xe,Kt;function gt(){return xe==null&&(xe=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),xe}function Yt(){if(Kt==null&&(Kt=!1,gt())){const t=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(t){for(let o=0;o<25;o++){const l=4*o;t.fillStyle=`rgb(${l},${l+1},${l+2})`,t.fillRect(o%5,Math.floor(o/5),1,1)}const i=t.getImageData(0,0,5,5).data;for(let o=0;o<100;o++)if(o%4!=3&&i[o]!==o){Kt=!0;break}}}return Kt||!1}var Pt=1e-6,At=typeof Float32Array<"u"?Float32Array:Array;function ce(){var a=new At(9);return At!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[5]=0,a[6]=0,a[7]=0),a[0]=1,a[4]=1,a[8]=1,a}function ue(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function we(){var a=new At(3);return At!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a}function pe(a){var t=a[0],i=a[1],o=a[2];return Math.sqrt(t*t+i*i+o*o)}function pi(a,t,i){var o=new At(3);return o[0]=a,o[1]=t,o[2]=i,o}function $e(a,t,i){return a[0]=t[0]+i[0],a[1]=t[1]+i[1],a[2]=t[2]+i[2],a}function Ai(a,t,i){return a[0]=t[0]*i,a[1]=t[1]*i,a[2]=t[2]*i,a}function sn(a,t,i){var o=t[0],l=t[1],d=t[2],p=i[0],y=i[1],x=i[2];return a[0]=l*x-d*y,a[1]=d*p-o*x,a[2]=o*y-l*p,a}var on,va=pe;function On(a,t,i){var o=t[0],l=t[1],d=t[2],p=t[3];return a[0]=i[0]*o+i[4]*l+i[8]*d+i[12]*p,a[1]=i[1]*o+i[5]*l+i[9]*d+i[13]*p,a[2]=i[2]*o+i[6]*l+i[10]*d+i[14]*p,a[3]=i[3]*o+i[7]*l+i[11]*d+i[15]*p,a}function Zn(){var a=new At(4);return At!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a[3]=1,a}function $t(a,t,i,o){var l=arguments.length>4&&arguments[4]!==void 0?arguments[4]:"zyx",d=Math.PI/360;t*=d,o*=d,i*=d;var p=Math.sin(t),y=Math.cos(t),x=Math.sin(i),T=Math.cos(i),M=Math.sin(o),A=Math.cos(o);switch(l){case"xyz":a[0]=p*T*A+y*x*M,a[1]=y*x*A-p*T*M,a[2]=y*T*M+p*x*A,a[3]=y*T*A-p*x*M;break;case"xzy":a[0]=p*T*A-y*x*M,a[1]=y*x*A-p*T*M,a[2]=y*T*M+p*x*A,a[3]=y*T*A+p*x*M;break;case"yxz":a[0]=p*T*A+y*x*M,a[1]=y*x*A-p*T*M,a[2]=y*T*M-p*x*A,a[3]=y*T*A+p*x*M;break;case"yzx":a[0]=p*T*A+y*x*M,a[1]=y*x*A+p*T*M,a[2]=y*T*M-p*x*A,a[3]=y*T*A-p*x*M;break;case"zxy":a[0]=p*T*A-y*x*M,a[1]=y*x*A+p*T*M,a[2]=y*T*M+p*x*A,a[3]=y*T*A-p*x*M;break;case"zyx":a[0]=p*T*A-y*x*M,a[1]=y*x*A+p*T*M,a[2]=y*T*M-p*x*A,a[3]=y*T*A+p*x*M;break;default:throw new Error("Unknown angle order "+l)}return a}function de(){var a=new At(2);return At!=Float32Array&&(a[0]=0,a[1]=0),a}function Ne(a,t){var i=new At(2);return i[0]=a,i[1]=t,i}we(),on=new At(4),At!=Float32Array&&(on[0]=0,on[1]=0,on[2]=0,on[3]=0),we(),pi(1,0,0),pi(0,1,0),Zn(),Zn(),ce(),de();const Re=8192;function si(a,t,i){return t*(Re/(a.tileSize*Math.pow(2,i-a.tileID.overscaledZ)))}function bt(a,t){return(a%t+t)%t}function Ht(a,t,i){return a*(1-i)+t*i}function _e(a){if(a<=0)return 0;if(a>=1)return 1;const t=a*a,i=t*a;return 4*(a<.5?i:3*(a-t)+i-.75)}function Te(a,t,i,o){const l=new he(a,t,i,o);return d=>l.solve(d)}const be=Te(.25,.1,.25,1);function Ie(a,t,i){return Math.min(i,Math.max(t,a))}function Ue(a,t,i){const o=i-t,l=((a-t)%o+o)%o+t;return l===t?i:l}function Ke(a,...t){for(const i of t)for(const o in i)a[o]=i[o];return a}let mi=1;function dn(a,t,i){const o={};for(const l in a)o[l]=t.call(this,a[l],l,a);return o}function Qe(a,t,i){const o={};for(const l in a)t.call(this,a[l],l,a)&&(o[l]=a[l]);return o}function qe(a){return Array.isArray(a)?a.map(qe):typeof a=="object"&&a?dn(a,qe):a}const Ki={};function oi(a){Ki[a]||(typeof console<"u"&&console.warn(a),Ki[a]=!0)}function ia(a,t,i){return(i.y-a.y)*(t.x-a.x)>(t.y-a.y)*(i.x-a.x)}function xn(a){return typeof WorkerGlobalScope<"u"&&a!==void 0&&a instanceof WorkerGlobalScope}let Di=null;function Cn(a){return typeof ImageBitmap<"u"&&a instanceof ImageBitmap}const An="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function ca(a,t,i,o,l){return h(this,void 0,void 0,(function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const d=new VideoFrame(a,{timestamp:0});try{const p=d?.format;if(!p||!p.startsWith("BGR")&&!p.startsWith("RGB"))throw new Error(`Unrecognized format ${p}`);const y=p.startsWith("BGR"),x=new Uint8ClampedArray(o*l*4);if(yield d.copyTo(x,(function(T,M,A,z,I){const R=4*Math.max(-M,0),N=(Math.max(0,A)-A)*z*4+R,V=4*z,$=Math.max(0,M),rt=Math.max(0,A);return{rect:{x:$,y:rt,width:Math.min(T.width,M+z)-$,height:Math.min(T.height,A+I)-rt},layout:[{offset:N,stride:V}]}})(a,t,i,o,l)),y)for(let T=0;T<x.length;T+=4){const M=x[T];x[T]=x[T+2],x[T+2]=M}return x}finally{d.close()}}))}let Qi,fn;function xa(a,t,i,o){return a.addEventListener(t,i,o),{unsubscribe:()=>{a.removeEventListener(t,i,o)}}}function qi(a){return a*Math.PI/180}function bn(a){return a/Math.PI*180}const Io={touchstart:!0,touchmove:!0,touchmoveWindow:!0,touchend:!0,touchcancel:!0},Sl={dblclick:!0,click:!0,mouseover:!0,mouseout:!0,mousedown:!0,mousemove:!0,mousemoveWindow:!0,mouseup:!0,mouseupWindow:!0,contextmenu:!0,wheel:!0},Wr="AbortError";function El(){return new Error(Wr)}const Ts={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function Ml(a){return Ts.REGISTERED_PROTOCOLS[a.substring(0,a.indexOf("://"))]}const Ro="global-dispatcher";class za extends Error{constructor(t,i,o,l){super(`AJAXError: ${i} (${t}): ${o}`),this.status=t,this.statusText=i,this.url=o,this.body=l}}const Ji=()=>xn(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,pt=function(a,t){if(/:\/\//.test(a.url)&&!/^https?:|^file:/.test(a.url)){const o=Ml(a.url);if(o)return o(a,t);if(xn(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:a,targetMapId:Ro},t)}if(!(/^file:/.test(i=a.url)||/^file:/.test(Ji())&&!/^\w+:/.test(i))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return(function(o,l){return h(this,void 0,void 0,(function*(){const d=new Request(o.url,{method:o.method||"GET",body:o.body,credentials:o.credentials,headers:o.headers,cache:o.cache,referrer:Ji(),signal:l.signal});let p,y;o.type!=="json"||d.headers.has("Accept")||d.headers.set("Accept","application/json");try{p=yield fetch(d)}catch(T){throw new za(0,T.message,o.url,new Blob)}if(!p.ok){const T=yield p.blob();throw new za(p.status,p.statusText,o.url,T)}y=o.type==="arrayBuffer"||o.type==="image"?p.arrayBuffer():o.type==="json"?p.json():p.text();const x=yield y;if(l.signal.aborted)throw El();return{data:x,cacheControl:p.headers.get("Cache-Control"),expires:p.headers.get("Expires")}}))})(a,t);if(xn(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:a,mustQueue:!0,targetMapId:Ro},t)}var i;return(function(o,l){return new Promise(((d,p)=>{var y;const x=new XMLHttpRequest;x.open(o.method||"GET",o.url,!0),o.type!=="arrayBuffer"&&o.type!=="image"||(x.responseType="arraybuffer");for(const T in o.headers)x.setRequestHeader(T,o.headers[T]);o.type==="json"&&(x.responseType="text",!((y=o.headers)===null||y===void 0)&&y.Accept||x.setRequestHeader("Accept","application/json")),x.withCredentials=o.credentials==="include",x.onerror=()=>{p(new Error(x.statusText))},x.onload=()=>{if(!l.signal.aborted)if((x.status>=200&&x.status<300||x.status===0)&&x.response!==null){let T=x.response;if(o.type==="json")try{T=JSON.parse(x.response)}catch(M){return void p(M)}d({data:T,cacheControl:x.getResponseHeader("Cache-Control"),expires:x.getResponseHeader("Expires")})}else{const T=new Blob([x.response],{type:x.getResponseHeader("Content-Type")});p(new za(x.status,x.statusText,o.url,T))}},l.signal.addEventListener("abort",(()=>{x.abort(),p(El())})),x.send(o.body)}))})(a,t)};function F(a){if(!a||a.indexOf("://")<=0||a.indexOf("data:image/")===0||a.indexOf("blob:")===0)return!0;const t=new URL(a),i=window.location;return t.protocol===i.protocol&&t.host===i.host}function G(a,t,i){i[a]&&i[a].indexOf(t)!==-1||(i[a]=i[a]||[],i[a].push(t))}function H(a,t,i){if(i&&i[a]){const o=i[a].indexOf(t);o!==-1&&i[a].splice(o,1)}}class ot{constructor(t,i={}){Ke(this,i),this.type=t}}class ut extends ot{constructor(t,i={}){super("error",Ke({error:t},i))}}class Et{on(t,i){return this._listeners=this._listeners||{},G(t,i,this._listeners),{unsubscribe:()=>{this.off(t,i)}}}off(t,i){return H(t,i,this._listeners),H(t,i,this._oneTimeListeners),this}once(t,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},G(t,i,this._oneTimeListeners),this):new Promise((o=>this.once(t,o)))}fire(t,i){typeof t=="string"&&(t=new ot(t,i||{}));const o=t.type;if(this.listens(o)){t.target=this;const l=this._listeners&&this._listeners[o]?this._listeners[o].slice():[];for(const y of l)y.call(this,t);const d=this._oneTimeListeners&&this._oneTimeListeners[o]?this._oneTimeListeners[o].slice():[];for(const y of d)H(o,y,this._oneTimeListeners),y.call(this,t);const p=this._eventedParent;p&&(Ke(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),p.fire(t))}else t instanceof ut&&console.error(t.error);return this}listens(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)}setEventedParent(t,i){return this._eventedParent=t,this._eventedParentData=i,this}}var J={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},"font-faces":{type:"array",value:"fontFaces"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},encoding:{type:"enum",values:{mvt:{},mlt:{}},default:"mvt"},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const wt=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Nt(a,t){const i={};for(const o in a)o!=="ref"&&(i[o]=a[o]);return wt.forEach((o=>{o in t&&(i[o]=t[o])})),i}function jt(a,t){if(Array.isArray(a)){if(!Array.isArray(t)||a.length!==t.length)return!1;for(let i=0;i<a.length;i++)if(!jt(a[i],t[i]))return!1;return!0}if(typeof a=="object"&&a!==null&&t!==null){if(typeof t!="object"||Object.keys(a).length!==Object.keys(t).length)return!1;for(const i in a)if(!jt(a[i],t[i]))return!1;return!0}return a===t}function Ut(a,t){a.push(t)}function ye(a,t,i){Ut(i,{command:"addSource",args:[a,t[a]]})}function Ce(a,t,i){Ut(t,{command:"removeSource",args:[a]}),i[a]=!0}function je(a,t,i,o){Ce(a,i,o),ye(a,t,i)}function pn(a,t,i){let o;for(o in a[i])if(Object.prototype.hasOwnProperty.call(a[i],o)&&o!=="data"&&!jt(a[i][o],t[i][o]))return!1;for(o in t[i])if(Object.prototype.hasOwnProperty.call(t[i],o)&&o!=="data"&&!jt(a[i][o],t[i][o]))return!1;return!0}function Je(a,t,i,o,l,d){a=a||{},t=t||{};for(const p in a)Object.prototype.hasOwnProperty.call(a,p)&&(jt(a[p],t[p])||i.push({command:d,args:[o,p,t[p],l]}));for(const p in t)Object.prototype.hasOwnProperty.call(t,p)&&!Object.prototype.hasOwnProperty.call(a,p)&&(jt(a[p],t[p])||i.push({command:d,args:[o,p,t[p],l]}))}function yi(a){return a.id}function Li(a,t){return a[t.id]=t,a}class ne{constructor(t,i,o,l){this.message=(t?`${t}: `:"")+o,l&&(this.identifier=l),i!=null&&i.__line__&&(this.line=i.__line__)}}function ki(a,...t){for(const i of t)for(const o in i)a[o]=i[o];return a}class Oi extends Error{constructor(t,i){super(i),this.message=i,this.key=t}}class Dn{constructor(t,i=[]){this.parent=t,this.bindings={};for(const[o,l]of i)this.bindings[o]=l}concat(t){return new Dn(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const vi={kind:"null"},Qt={kind:"number"},me={kind:"string"},Ae={kind:"boolean"},ba={kind:"color"},Lo={kind:"projectionDefinition"},na={kind:"object"},Be={kind:"value"},ir={kind:"collator"},Js={kind:"formatted"},zr={kind:"padding"},wa={kind:"colorArray"},Pr={kind:"numberArray"},Ir={kind:"resolvedImage"},mn={kind:"variableAnchorOffsetCollection"};function Ua(a,t){return{kind:"array",itemType:a,N:t}}function Bi(a){if(a.kind==="array"){const t=Bi(a.itemType);return typeof a.N=="number"?`array<${t}, ${a.N}>`:a.itemType.kind==="value"?"array":`array<${t}>`}return a.kind}const ko=[vi,Qt,me,Ae,ba,Lo,Js,na,Ua(Be),zr,Pr,wa,Ir,mn];function Pa(a,t){if(t.kind==="error")return null;if(a.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!Pa(a.itemType,t.itemType))&&(typeof a.N!="number"||a.N===t.N))return null}else{if(a.kind===t.kind)return null;if(a.kind==="value"){for(const i of ko)if(!Pa(i,t))return null}}return`Expected ${Bi(a)} but found ${Bi(t)} instead.`}function dc(a,t){return t.some((i=>i.kind===a.kind))}function tn(a,t){return t.some((i=>i==="null"?a===null:i==="array"?Array.isArray(a):i==="object"?a&&!Array.isArray(a)&&typeof a=="object":i===typeof a))}function Ss(a,t){return a.kind==="array"&&t.kind==="array"?a.itemType.kind===t.itemType.kind&&typeof a.N=="number":a.kind===t.kind}const vh=.96422,Es=.82521,Cl=4/29,Ga=6/29,nr=3*Ga*Ga,xh=Ga*Ga*Ga,Bf=Math.PI/180,mu=180/Math.PI;function bh(a){return(a%=360)<0&&(a+=360),a}function fc([a,t,i,o]){let l,d;const p=qa((.2225045*(a=wh(a))+.7168786*(t=wh(t))+.0606169*(i=wh(i)))/1);a===t&&t===i?l=d=p:(l=qa((.4360747*a+.3850649*t+.1430804*i)/vh),d=qa((.0139322*a+.0971045*t+.7141733*i)/Es));const y=116*p-16;return[y<0?0:y,500*(l-p),200*(p-d),o]}function wh(a){return a<=.04045?a/12.92:Math.pow((a+.055)/1.055,2.4)}function qa(a){return a>xh?Math.pow(a,1/3):a/nr+Cl}function gu([a,t,i,o]){let l=(a+16)/116,d=isNaN(t)?l:l+t/500,p=isNaN(i)?l:l-i/200;return l=1*pc(l),d=vh*pc(d),p=Es*pc(p),[_u(3.1338561*d-1.6168667*l-.4906146*p),_u(-.9787684*d+1.9161415*l+.033454*p),_u(.0719453*d-.2289914*l+1.4052427*p),o]}function _u(a){return(a=a<=.00304?12.92*a:1.055*Math.pow(a,1/2.4)-.055)<0?0:a>1?1:a}function pc(a){return a>Ga?a*a*a:nr*(a-Cl)}const Oo=Object.hasOwn||function(a,t){return Object.prototype.hasOwnProperty.call(a,t)};function Kr(a,t){return Oo(a,t)?a[t]:void 0}function mc(a){return parseInt(a.padEnd(2,a),16)/255}function Bo(a,t){return Qr(t?a/100:a,0,1)}function Qr(a,t,i){return Math.min(Math.max(t,a),i)}function Th(a){return!a.some(Number.isNaN)}const zd={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function Jr(a,t,i){return a+i*(t-a)}function No(a,t,i){return a.map(((o,l)=>Jr(o,t[l],i)))}class ii{constructor(t,i,o,l=1,d=!0){this.r=t,this.g=i,this.b=o,this.a=l,d||(this.r*=l,this.g*=l,this.b*=l,l||this.overwriteGetter("rgb",[t,i,o,l]))}static parse(t){if(t instanceof ii)return t;if(typeof t!="string")return;const i=(function(o){if((o=o.toLowerCase().trim())==="transparent")return[0,0,0,0];const l=Kr(zd,o);if(l){const[p,y,x]=l;return[p/255,y/255,x/255,1]}if(o.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(o)){const p=o.length<6?1:2;let y=1;return[mc(o.slice(y,y+=p)),mc(o.slice(y,y+=p)),mc(o.slice(y,y+=p)),mc(o.slice(y,y+p)||"ff")]}if(o.startsWith("rgb")){const p=o.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(p){const[y,x,T,M,A,z,I,R,N,V,$,rt]=p,K=[M||" ",I||" ",V].join("");if(K==="  "||K==="  /"||K===",,"||K===",,,"){const tt=[T,z,N].join(""),vt=tt==="%%%"?100:tt===""?255:0;if(vt){const xt=[Qr(+x/vt,0,1),Qr(+A/vt,0,1),Qr(+R/vt,0,1),$?Bo(+$,rt):1];if(Th(xt))return xt}}return}}const d=o.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(d){const[p,y,x,T,M,A,z,I,R]=d,N=[x||" ",M||" ",z].join("");if(N==="  "||N==="  /"||N===",,"||N===",,,"){const V=[+y,Qr(+T,0,100),Qr(+A,0,100),I?Bo(+I,R):1];if(Th(V))return(function([$,rt,K,tt]){function vt(xt){const Lt=(xt+$/30)%12,Jt=rt*Math.min(K,1-K);return K-Jt*Math.max(-1,Math.min(Lt-3,9-Lt,1))}return $=bh($),rt/=100,K/=100,[vt(0),vt(8),vt(4),tt]})(V)}}})(t);return i?new ii(...i,!1):void 0}get rgb(){const{r:t,g:i,b:o,a:l}=this,d=l||1/0;return this.overwriteGetter("rgb",[t/d,i/d,o/d,l])}get hcl(){return this.overwriteGetter("hcl",(function(t){const[i,o,l,d]=fc(t),p=Math.sqrt(o*o+l*l);return[Math.round(1e4*p)?bh(Math.atan2(l,o)*mu):NaN,p,i,d]})(this.rgb))}get lab(){return this.overwriteGetter("lab",fc(this.rgb))}overwriteGetter(t,i){return Object.defineProperty(this,t,{value:i}),i}toString(){const[t,i,o,l]=this.rgb;return`rgba(${[t,i,o].map((d=>Math.round(255*d))).join(",")},${l})`}static interpolate(t,i,o,l="rgb"){switch(l){case"rgb":{const[d,p,y,x]=No(t.rgb,i.rgb,o);return new ii(d,p,y,x,!1)}case"hcl":{const[d,p,y,x]=t.hcl,[T,M,A,z]=i.hcl;let I,R;if(isNaN(d)||isNaN(T))isNaN(d)?isNaN(T)?I=NaN:(I=T,y!==1&&y!==0||(R=M)):(I=d,A!==1&&A!==0||(R=p));else{let K=T-d;T>d&&K>180?K-=360:T<d&&d-T>180&&(K+=360),I=d+o*K}const[N,V,$,rt]=(function([K,tt,vt,xt]){return K=isNaN(K)?0:K*Bf,gu([vt,Math.cos(K)*tt,Math.sin(K)*tt,xt])})([I,R??Jr(p,M,o),Jr(y,A,o),Jr(x,z,o)]);return new ii(N,V,$,rt,!1)}case"lab":{const[d,p,y,x]=gu(No(t.lab,i.lab,o));return new ii(d,p,y,x,!1)}}}}ii.black=new ii(0,0,0,1),ii.white=new ii(1,1,1,1),ii.transparent=new ii(0,0,0,0),ii.red=new ii(1,0,0,1);class Ia{constructor(t,i,o){this.sensitivity=t?i?"variant":"case":i?"accent":"base",this.locale=o,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,i){return this.collator.compare(t,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const Xe=["bottom","center","top"];class ts{constructor(t,i,o,l,d,p){this.text=t,this.image=i,this.scale=o,this.fontStack=l,this.textColor=d,this.verticalAlign=p}}class wn{constructor(t){this.sections=t}static fromString(t){return new wn([new ts(t,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some((t=>t.text.length!==0||t.image&&t.image.name.length!==0))}static factory(t){return t instanceof wn?t:wn.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map((t=>t.text)).join("")}}class zn{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof zn)return t;if(typeof t=="number")return new zn([t,t,t,t]);if(Array.isArray(t)&&!(t.length<1||t.length>4)){for(const i of t)if(typeof i!="number")return;switch(t.length){case 1:t=[t[0],t[0],t[0],t[0]];break;case 2:t=[t[0],t[1],t[0],t[1]];break;case 3:t=[t[0],t[1],t[2],t[1]]}return new zn(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,i,o){return new zn(No(t.values,i.values,o))}}class Pn{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof Pn)return t;if(typeof t=="number")return new Pn([t]);if(Array.isArray(t)){for(const i of t)if(typeof i!="number")return;return new Pn(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,i,o){return new Pn(No(t.values,i.values,o))}}class Bn{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof Bn)return t;if(typeof t=="string"){const o=ii.parse(t);return o?new Bn([o]):void 0}if(!Array.isArray(t))return;const i=[];for(const o of t){if(typeof o!="string")return;const l=ii.parse(o);if(!l)return;i.push(l)}return new Bn(i)}toString(){return JSON.stringify(this.values)}static interpolate(t,i,o,l="rgb"){const d=[];if(t.values.length!=i.values.length)throw new Error(`colorArray: Arrays have mismatched length (${t.values.length} vs. ${i.values.length}), cannot interpolate.`);for(let p=0;p<t.values.length;p++)d.push(ii.interpolate(t.values[p],i.values[p],o,l));return new Bn(d)}}class Ii extends Error{constructor(t){super(t),this.name="RuntimeError"}toJSON(){return this.message}}const gc=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Hn{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof Hn)return t;if(Array.isArray(t)&&!(t.length<1)&&t.length%2==0){for(let i=0;i<t.length;i+=2){const o=t[i],l=t[i+1];if(typeof o!="string"||!gc.has(o)||!Array.isArray(l)||l.length!==2||typeof l[0]!="number"||typeof l[1]!="number")return}return new Hn(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,i,o){const l=t.values,d=i.values;if(l.length!==d.length)throw new Ii(`Cannot interpolate values of different length. from: ${t.toString()}, to: ${i.toString()}`);const p=[];for(let y=0;y<l.length;y+=2){if(l[y]!==d[y])throw new Ii(`Cannot interpolate values containing mismatched anchors. from[${y}]: ${l[y]}, to[${y}]: ${d[y]}`);p.push(l[y]);const[x,T]=l[y+1],[M,A]=d[y+1];p.push([Jr(x,M,o),Jr(T,A,o)])}return new Hn(p)}}class Tn{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new Tn({name:t,available:!1}):null}}class aa{constructor(t,i,o){this.from=t,this.to=i,this.transition=o}static interpolate(t,i,o){return new aa(t,i,o)}static parse(t){return t instanceof aa?t:Array.isArray(t)&&t.length===3&&typeof t[0]=="string"&&typeof t[1]=="string"&&typeof t[2]=="number"?new aa(t[0],t[1],t[2]):typeof t=="object"&&typeof t.from=="string"&&typeof t.to=="string"&&typeof t.transition=="number"?new aa(t.from,t.to,t.transition):typeof t=="string"?new aa(t,t,1):void 0}}function Al(a,t,i,o){return typeof a=="number"&&a>=0&&a<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof i=="number"&&i>=0&&i<=255?o===void 0||typeof o=="number"&&o>=0&&o<=1?null:`Invalid rgba value [${[a,t,i,o].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof o=="number"?[a,t,i,o]:[a,t,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Ra(a){if(a===null||typeof a=="string"||typeof a=="boolean"||typeof a=="number"||a instanceof aa||a instanceof ii||a instanceof Ia||a instanceof wn||a instanceof zn||a instanceof Pn||a instanceof Bn||a instanceof Hn||a instanceof Tn)return!0;if(Array.isArray(a)){for(const t of a)if(!Ra(t))return!1;return!0}if(typeof a=="object"){for(const t in a)if(!Ra(a[t]))return!1;return!0}return!1}function Ni(a){if(a===null)return vi;if(typeof a=="string")return me;if(typeof a=="boolean")return Ae;if(typeof a=="number")return Qt;if(a instanceof ii)return ba;if(a instanceof aa)return Lo;if(a instanceof Ia)return ir;if(a instanceof wn)return Js;if(a instanceof zn)return zr;if(a instanceof Pn)return Pr;if(a instanceof Bn)return wa;if(a instanceof Hn)return mn;if(a instanceof Tn)return Ir;if(Array.isArray(a)){const t=a.length;let i;for(const o of a){const l=Ni(o);if(i){if(i===l)continue;i=Be;break}i=l}return Ua(i||Be,t)}return na}function Ms(a){const t=typeof a;return a===null?"":t==="string"||t==="number"||t==="boolean"?String(a):a instanceof ii||a instanceof aa||a instanceof wn||a instanceof zn||a instanceof Pn||a instanceof Bn||a instanceof Hn||a instanceof Tn?a.toString():JSON.stringify(a)}class Cs{constructor(t,i){this.type=t,this.value=i}static parse(t,i){if(t.length!==2)return i.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!Ra(t[1]))return i.error("invalid value");const o=t[1];let l=Ni(o);const d=i.expectedType;return l.kind!=="array"||l.N!==0||!d||d.kind!=="array"||typeof d.N=="number"&&d.N!==0||(l=d),new Cs(l,o)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const to={string:me,number:Qt,boolean:Ae,object:na};class ua{constructor(t,i){this.type=t,this.args=i}static parse(t,i){if(t.length<2)return i.error("Expected at least one argument.");let o,l=1;const d=t[0];if(d==="array"){let y,x;if(t.length>2){const T=t[1];if(typeof T!="string"||!(T in to)||T==="object")return i.error('The item type argument of "array" must be one of string, number, boolean',1);y=to[T],l++}else y=Be;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return i.error('The length argument to "array" must be a positive integer literal',2);x=t[2],l++}o=Ua(y,x)}else{if(!to[d])throw new Error(`Types doesn't contain name = ${d}`);o=to[d]}const p=[];for(;l<t.length;l++){const y=i.parse(t[l],l,Be);if(!y)return null;p.push(y)}return new ua(o,p)}evaluate(t){for(let i=0;i<this.args.length;i++){const o=this.args[i].evaluate(t);if(!Pa(this.type,Ni(o)))return o;if(i===this.args.length-1)throw new Ii(`Expected value to be of type ${Bi(this.type)}, but found ${Bi(Ni(o))} instead.`)}throw new Error}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}}const Zi={"to-boolean":Ae,"to-color":ba,"to-number":Qt,"to-string":me};class gn{constructor(t,i){this.type=t,this.args=i}static parse(t,i){if(t.length<2)return i.error("Expected at least one argument.");const o=t[0];if(!Zi[o])throw new Error(`Can't parse ${o} as it is not part of the known types`);if((o==="to-boolean"||o==="to-string")&&t.length!==2)return i.error("Expected one argument.");const l=Zi[o],d=[];for(let p=1;p<t.length;p++){const y=i.parse(t[p],p,Be);if(!y)return null;d.push(y)}return new gn(l,d)}evaluate(t){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(t);case"color":{let i,o;for(const l of this.args){if(i=l.evaluate(t),o=null,i instanceof ii)return i;if(typeof i=="string"){const d=t.parseColor(i);if(d)return d}else if(Array.isArray(i)&&(o=i.length<3||i.length>4?`Invalid rgba value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:Al(i[0],i[1],i[2],i[3]),!o))return new ii(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new Ii(o||`Could not parse color from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}case"padding":{let i;for(const o of this.args){i=o.evaluate(t);const l=zn.parse(i);if(l)return l}throw new Ii(`Could not parse padding from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}case"numberArray":{let i;for(const o of this.args){i=o.evaluate(t);const l=Pn.parse(i);if(l)return l}throw new Ii(`Could not parse numberArray from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}case"colorArray":{let i;for(const o of this.args){i=o.evaluate(t);const l=Bn.parse(i);if(l)return l}throw new Ii(`Could not parse colorArray from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}case"variableAnchorOffsetCollection":{let i;for(const o of this.args){i=o.evaluate(t);const l=Hn.parse(i);if(l)return l}throw new Ii(`Could not parse variableAnchorOffsetCollection from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}case"number":{let i=null;for(const o of this.args){if(i=o.evaluate(t),i===null)return 0;const l=Number(i);if(!isNaN(l))return l}throw new Ii(`Could not convert ${JSON.stringify(i)} to number.`)}case"formatted":return wn.fromString(Ms(this.args[0].evaluate(t)));case"resolvedImage":return Tn.fromString(Ms(this.args[0].evaluate(t)));case"projectionDefinition":return this.args[0].evaluate(t);default:return Ms(this.args[0].evaluate(t))}}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}}const ti=["Unknown","Point","LineString","Polygon"];class Ze{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?ti[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let i=this._parseColorCache.get(t);return i||(i=ii.parse(t),this._parseColorCache.set(t,i)),i}}class es{constructor(t,i,o=[],l,d=new Dn,p=[]){this.registry=t,this.path=o,this.key=o.map((y=>`[${y}]`)).join(""),this.scope=d,this.errors=p,this.expectedType=l,this._isConstant=i}parse(t,i,o,l,d={}){return i?this.concat(i,o,l)._parse(t,d):this._parse(t,d)}_parse(t,i){function o(l,d,p){return p==="assert"?new ua(d,[l]):p==="coerce"?new gn(d,[l]):l}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const l=t[0];if(typeof l!="string")return this.error(`Expression name must be a string, but found ${typeof l} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const d=this.registry[l];if(d){let p=d.parse(t,this);if(!p)return null;if(this.expectedType){const y=this.expectedType,x=p.type;if(y.kind!=="string"&&y.kind!=="number"&&y.kind!=="boolean"&&y.kind!=="object"&&y.kind!=="array"||x.kind!=="value"){if(y.kind==="projectionDefinition"&&["string","array"].includes(x.kind)||["color","formatted","resolvedImage"].includes(y.kind)&&["value","string"].includes(x.kind)||["padding","numberArray"].includes(y.kind)&&["value","number","array"].includes(x.kind)||y.kind==="colorArray"&&["value","string","array"].includes(x.kind)||y.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(x.kind))p=o(p,y,i.typeAnnotation||"coerce");else if(this.checkSubtype(y,x))return null}else p=o(p,y,i.typeAnnotation||"assert")}if(!(p instanceof Cs)&&p.type.kind!=="resolvedImage"&&this._isConstant(p)){const y=new Ze;try{p=new Cs(p.type,p.evaluate(y))}catch(x){return this.error(x.message),null}}return p}return this.error(`Unknown expression "${l}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,i,o){const l=typeof t=="number"?this.path.concat(t):this.path,d=o?this.scope.concat(o):this.scope;return new es(this.registry,this._isConstant,l,i||null,d,this.errors)}error(t,...i){const o=`${this.key}${i.map((l=>`[${l}]`)).join("")}`;this.errors.push(new Oi(o,t))}checkSubtype(t,i){const o=Pa(t,i);return o&&this.error(o),o}}class ci{constructor(t,i){this.type=i.type,this.bindings=[].concat(t),this.result=i}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const i of this.bindings)t(i[1]);t(this.result)}static parse(t,i){if(t.length<4)return i.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const o=[];for(let d=1;d<t.length-1;d+=2){const p=t[d];if(typeof p!="string")return i.error(`Expected string, but found ${typeof p} instead.`,d);if(/[^a-zA-Z0-9_]/.test(p))return i.error("Variable names must contain only alphanumeric characters or '_'.",d);const y=i.parse(t[d+1],d+1);if(!y)return null;o.push([p,y])}const l=i.parse(t[t.length-1],t.length-1,i.expectedType,o);return l?new ci(o,l):null}outputDefined(){return this.result.outputDefined()}}class eo{constructor(t,i){this.type=i.type,this.name=t,this.boundExpression=i}static parse(t,i){if(t.length!==2||typeof t[1]!="string")return i.error("'var' expression requires exactly one string literal argument.");const o=t[1];return i.scope.has(o)?new eo(o,i.scope.get(o)):i.error(`Unknown variable "${o}". Make sure "${o}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}}class ar{constructor(t,i,o){this.type=t,this.index=i,this.input=o}static parse(t,i){if(t.length!==3)return i.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const o=i.parse(t[1],1,Qt),l=i.parse(t[2],2,Ua(i.expectedType||Be));return o&&l?new ar(l.type.itemType,o,l):null}evaluate(t){const i=this.index.evaluate(t),o=this.input.evaluate(t);if(i<0)throw new Ii(`Array index out of bounds: ${i} < 0.`);if(i>=o.length)throw new Ii(`Array index out of bounds: ${i} > ${o.length-1}.`);if(i!==Math.floor(i))throw new Ii(`Array index must be an integer, but found ${i} instead.`);return o[i]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}}class As{constructor(t,i){this.type=Ae,this.needle=t,this.haystack=i}static parse(t,i){if(t.length!==3)return i.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const o=i.parse(t[1],1,Be),l=i.parse(t[2],2,Be);return o&&l?dc(o.type,[Ae,me,Qt,vi,Be])?new As(o,l):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${Bi(o.type)} instead`):null}evaluate(t){const i=this.needle.evaluate(t),o=this.haystack.evaluate(t);if(!o)return!1;if(!tn(i,["boolean","string","number","null"]))throw new Ii(`Expected first argument to be of type boolean, string, number or null, but found ${Bi(Ni(i))} instead.`);if(!tn(o,["string","array"]))throw new Ii(`Expected second argument to be of type array or string, but found ${Bi(Ni(o))} instead.`);return o.indexOf(i)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}}class is{constructor(t,i,o){this.type=Qt,this.needle=t,this.haystack=i,this.fromIndex=o}static parse(t,i){if(t.length<=2||t.length>=5)return i.error(`Expected 2 or 3 arguments, but found ${t.length-1} instead.`);const o=i.parse(t[1],1,Be),l=i.parse(t[2],2,Be);if(!o||!l)return null;if(!dc(o.type,[Ae,me,Qt,vi,Be]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${Bi(o.type)} instead`);if(t.length===4){const d=i.parse(t[3],3,Qt);return d?new is(o,l,d):null}return new is(o,l)}evaluate(t){const i=this.needle.evaluate(t),o=this.haystack.evaluate(t);if(!tn(i,["boolean","string","number","null"]))throw new Ii(`Expected first argument to be of type boolean, string, number or null, but found ${Bi(Ni(i))} instead.`);let l;if(this.fromIndex&&(l=this.fromIndex.evaluate(t)),tn(o,["string"])){const d=o.indexOf(i,l);return d===-1?-1:[...o.slice(0,d)].length}if(tn(o,["array"]))return o.indexOf(i,l);throw new Ii(`Expected second argument to be of type array or string, but found ${Bi(Ni(o))} instead.`)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}}class _c{constructor(t,i,o,l,d,p){this.inputType=t,this.type=i,this.input=o,this.cases=l,this.outputs=d,this.otherwise=p}static parse(t,i){if(t.length<5)return i.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return i.error("Expected an even number of arguments.");let o,l;i.expectedType&&i.expectedType.kind!=="value"&&(l=i.expectedType);const d={},p=[];for(let T=2;T<t.length-1;T+=2){let M=t[T];const A=t[T+1];Array.isArray(M)||(M=[M]);const z=i.concat(T);if(M.length===0)return z.error("Expected at least one branch label.");for(const R of M){if(typeof R!="number"&&typeof R!="string")return z.error("Branch labels must be numbers or strings.");if(typeof R=="number"&&Math.abs(R)>Number.MAX_SAFE_INTEGER)return z.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof R=="number"&&Math.floor(R)!==R)return z.error("Numeric branch labels must be integer values.");if(o){if(z.checkSubtype(o,Ni(R)))return null}else o=Ni(R);if(d[String(R)]!==void 0)return z.error("Branch labels must be unique.");d[String(R)]=p.length}const I=i.parse(A,T,l);if(!I)return null;l=l||I.type,p.push(I)}const y=i.parse(t[1],1,Be);if(!y)return null;const x=i.parse(t[t.length-1],t.length-1,l);return x?y.type.kind!=="value"&&i.concat(1).checkSubtype(o,y.type)?null:new _c(o,l,y,d,p,x):null}evaluate(t){const i=this.input.evaluate(t);return(Ni(i)===this.inputType&&this.outputs[this.cases[i]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))&&this.otherwise.outputDefined()}}class yc{constructor(t,i,o){this.type=t,this.branches=i,this.otherwise=o}static parse(t,i){if(t.length<4)return i.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return i.error("Expected an odd number of arguments.");let o;i.expectedType&&i.expectedType.kind!=="value"&&(o=i.expectedType);const l=[];for(let p=1;p<t.length-1;p+=2){const y=i.parse(t[p],p,Ae);if(!y)return null;const x=i.parse(t[p+1],p+1,o);if(!x)return null;l.push([y,x]),o=o||x.type}const d=i.parse(t[t.length-1],t.length-1,o);if(!d)return null;if(!o)throw new Error("Can't infer output type");return new yc(o,l,d)}evaluate(t){for(const[i,o]of this.branches)if(i.evaluate(t))return o.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[i,o]of this.branches)t(i),t(o);t(this.otherwise)}outputDefined(){return this.branches.every((([t,i])=>i.outputDefined()))&&this.otherwise.outputDefined()}}class vc{constructor(t,i,o,l){this.type=t,this.input=i,this.beginIndex=o,this.endIndex=l}static parse(t,i){if(t.length<=2||t.length>=5)return i.error(`Expected 2 or 3 arguments, but found ${t.length-1} instead.`);const o=i.parse(t[1],1,Be),l=i.parse(t[2],2,Qt);if(!o||!l)return null;if(!dc(o.type,[Ua(Be),me,Be]))return i.error(`Expected first argument to be of type array or string, but found ${Bi(o.type)} instead`);if(t.length===4){const d=i.parse(t[3],3,Qt);return d?new vc(o.type,o,l,d):null}return new vc(o.type,o,l)}evaluate(t){const i=this.input.evaluate(t),o=this.beginIndex.evaluate(t);let l;if(this.endIndex&&(l=this.endIndex.evaluate(t)),tn(i,["string"]))return[...i].slice(o,l).join("");if(tn(i,["array"]))return i.slice(o,l);throw new Ii(`Expected first argument to be of type array or string, but found ${Bi(Ni(i))} instead.`)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}}function yu(a,t){const i=a.length-1;let o,l,d=0,p=i,y=0;for(;d<=p;)if(y=Math.floor((d+p)/2),o=a[y],l=a[y+1],o<=t){if(y===i||t<l)return y;d=y+1}else{if(!(o>t))throw new Ii("Input is not a number.");p=y-1}return 0}class io{constructor(t,i,o){this.type=t,this.input=i,this.labels=[],this.outputs=[];for(const[l,d]of o)this.labels.push(l),this.outputs.push(d)}static parse(t,i){if(t.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return i.error("Expected an even number of arguments.");const o=i.parse(t[1],1,Qt);if(!o)return null;const l=[];let d=null;i.expectedType&&i.expectedType.kind!=="value"&&(d=i.expectedType);for(let p=1;p<t.length;p+=2){const y=p===1?-1/0:t[p],x=t[p+1],T=p,M=p+1;if(typeof y!="number")return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',T);if(l.length&&l[l.length-1][0]>=y)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',T);const A=i.parse(x,M,d);if(!A)return null;d=d||A.type,l.push([y,A])}return new io(d,o,l)}evaluate(t){const i=this.labels,o=this.outputs;if(i.length===1)return o[0].evaluate(t);const l=this.input.evaluate(t);if(l<=i[0])return o[0].evaluate(t);const d=i.length;return l>=i[d-1]?o[d-1].evaluate(t):o[yu(i,l)].evaluate(t)}eachChild(t){t(this.input);for(const i of this.outputs)t(i)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))}}function Pd(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}var ns,ha,vu=(function(){if(ha)return ns;function a(t,i,o,l){this.cx=3*t,this.bx=3*(o-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(l-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=i,this.p2x=o,this.p2y=l}return ha=1,ns=a,a.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,i){if(i===void 0&&(i=1e-6),t<0)return 0;if(t>1)return 1;for(var o=t,l=0;l<8;l++){var d=this.sampleCurveX(o)-t;if(Math.abs(d)<i)return o;var p=this.sampleCurveDerivativeX(o);if(Math.abs(p)<1e-6)break;o-=d/p}var y=0,x=1;for(o=t,l=0;l<20&&(d=this.sampleCurveX(o),!(Math.abs(d-t)<i));l++)t>d?y=o:x=o,o=.5*(x-y)+y;return o},solve:function(t,i){return this.sampleCurveY(this.solveCurveX(t,i))}},ns})(),Id=Pd(vu);class ra{constructor(t,i,o,l,d){this.type=t,this.operator=i,this.interpolation=o,this.input=l,this.labels=[],this.outputs=[];for(const[p,y]of d)this.labels.push(p),this.outputs.push(y)}static interpolationFactor(t,i,o,l){let d=0;if(t.name==="exponential")d=Nn(i,t.base,o,l);else if(t.name==="linear")d=Nn(i,1,o,l);else if(t.name==="cubic-bezier"){const p=t.controlPoints;d=new Id(p[0],p[1],p[2],p[3]).solve(Nn(i,1,o,l))}return d}static parse(t,i){let[o,l,d,...p]=t;if(!Array.isArray(l)||l.length===0)return i.error("Expected an interpolation type expression.",1);if(l[0]==="linear")l={name:"linear"};else if(l[0]==="exponential"){const T=l[1];if(typeof T!="number")return i.error("Exponential interpolation requires a numeric base.",1,1);l={name:"exponential",base:T}}else{if(l[0]!=="cubic-bezier")return i.error(`Unknown interpolation type ${String(l[0])}`,1,0);{const T=l.slice(1);if(T.length!==4||T.some((M=>typeof M!="number"||M<0||M>1)))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);l={name:"cubic-bezier",controlPoints:T}}}if(t.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(d=i.parse(d,2,Qt),!d)return null;const y=[];let x=null;o!=="interpolate-hcl"&&o!=="interpolate-lab"||i.expectedType==wa?i.expectedType&&i.expectedType.kind!=="value"&&(x=i.expectedType):x=ba;for(let T=0;T<p.length;T+=2){const M=p[T],A=p[T+1],z=T+3,I=T+4;if(typeof M!="number")return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',z);if(y.length&&y[y.length-1][0]>=M)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',z);const R=i.parse(A,I,x);if(!R)return null;x=x||R.type,y.push([M,R])}return Ss(x,Qt)||Ss(x,Lo)||Ss(x,ba)||Ss(x,zr)||Ss(x,Pr)||Ss(x,wa)||Ss(x,mn)||Ss(x,Ua(Qt))?new ra(x,o,l,d,y):i.error(`Type ${Bi(x)} is not interpolatable.`)}evaluate(t){const i=this.labels,o=this.outputs;if(i.length===1)return o[0].evaluate(t);const l=this.input.evaluate(t);if(l<=i[0])return o[0].evaluate(t);const d=i.length;if(l>=i[d-1])return o[d-1].evaluate(t);const p=yu(i,l),y=ra.interpolationFactor(this.interpolation,l,i[p],i[p+1]),x=o[p].evaluate(t),T=o[p+1].evaluate(t);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return Jr(x,T,y);case"color":return ii.interpolate(x,T,y);case"padding":return zn.interpolate(x,T,y);case"colorArray":return Bn.interpolate(x,T,y);case"numberArray":return Pn.interpolate(x,T,y);case"variableAnchorOffsetCollection":return Hn.interpolate(x,T,y);case"array":return No(x,T,y);case"projectionDefinition":return aa.interpolate(x,T,y)}case"interpolate-hcl":switch(this.type.kind){case"color":return ii.interpolate(x,T,y,"hcl");case"colorArray":return Bn.interpolate(x,T,y,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return ii.interpolate(x,T,y,"lab");case"colorArray":return Bn.interpolate(x,T,y,"lab")}}}eachChild(t){t(this.input);for(const i of this.outputs)t(i)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))}}function Nn(a,t,i,o){const l=o-i,d=a-i;return l===0?0:t===1?d/l:(Math.pow(t,d)-1)/(Math.pow(t,l)-1)}const Rr={color:ii.interpolate,number:Jr,padding:zn.interpolate,numberArray:Pn.interpolate,colorArray:Bn.interpolate,variableAnchorOffsetCollection:Hn.interpolate,array:No};class Dl{constructor(t,i){this.type=t,this.args=i}static parse(t,i){if(t.length<2)return i.error("Expected at least one argument.");let o=null;const l=i.expectedType;l&&l.kind!=="value"&&(o=l);const d=[];for(const y of t.slice(1)){const x=i.parse(y,1+d.length,o,void 0,{typeAnnotation:"omit"});if(!x)return null;o=o||x.type,d.push(x)}if(!o)throw new Error("No output type");const p=l&&d.some((y=>Pa(l,y.type)));return new Dl(p?Be:o,d)}evaluate(t){let i,o=null,l=0;for(const d of this.args)if(l++,o=d.evaluate(t),o&&o instanceof Tn&&!o.available&&(i||(i=o.name),o=null,l===this.args.length&&(o=i)),o!==null)break;return o}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}}function Sh(a,t){return a==="=="||a==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function xu(a,t,i,o){return o.compare(t,i)===0}function Lr(a,t,i){const o=a!=="=="&&a!=="!=";return class k_{constructor(d,p,y){this.type=Ae,this.lhs=d,this.rhs=p,this.collator=y,this.hasUntypedArgument=d.type.kind==="value"||p.type.kind==="value"}static parse(d,p){if(d.length!==3&&d.length!==4)return p.error("Expected two or three arguments.");const y=d[0];let x=p.parse(d[1],1,Be);if(!x)return null;if(!Sh(y,x.type))return p.concat(1).error(`"${y}" comparisons are not supported for type '${Bi(x.type)}'.`);let T=p.parse(d[2],2,Be);if(!T)return null;if(!Sh(y,T.type))return p.concat(2).error(`"${y}" comparisons are not supported for type '${Bi(T.type)}'.`);if(x.type.kind!==T.type.kind&&x.type.kind!=="value"&&T.type.kind!=="value")return p.error(`Cannot compare types '${Bi(x.type)}' and '${Bi(T.type)}'.`);o&&(x.type.kind==="value"&&T.type.kind!=="value"?x=new ua(T.type,[x]):x.type.kind!=="value"&&T.type.kind==="value"&&(T=new ua(x.type,[T])));let M=null;if(d.length===4){if(x.type.kind!=="string"&&T.type.kind!=="string"&&x.type.kind!=="value"&&T.type.kind!=="value")return p.error("Cannot use collator to compare non-string types.");if(M=p.parse(d[3],3,ir),!M)return null}return new k_(x,T,M)}evaluate(d){const p=this.lhs.evaluate(d),y=this.rhs.evaluate(d);if(o&&this.hasUntypedArgument){const x=Ni(p),T=Ni(y);if(x.kind!==T.kind||x.kind!=="string"&&x.kind!=="number")throw new Ii(`Expected arguments for "${a}" to be (string, string) or (number, number), but found (${x.kind}, ${T.kind}) instead.`)}if(this.collator&&!o&&this.hasUntypedArgument){const x=Ni(p),T=Ni(y);if(x.kind!=="string"||T.kind!=="string")return t(d,p,y)}return this.collator?i(d,p,y,this.collator.evaluate(d)):t(d,p,y)}eachChild(d){d(this.lhs),d(this.rhs),this.collator&&d(this.collator)}outputDefined(){return!0}}}const bu=Lr("==",(function(a,t,i){return t===i}),xu),Eh=Lr("!=",(function(a,t,i){return t!==i}),(function(a,t,i,o){return!xu(0,t,i,o)})),Rd=Lr("<",(function(a,t,i){return t<i}),(function(a,t,i,o){return o.compare(t,i)<0})),Ld=Lr(">",(function(a,t,i){return t>i}),(function(a,t,i,o){return o.compare(t,i)>0})),wu=Lr("<=",(function(a,t,i){return t<=i}),(function(a,t,i,o){return o.compare(t,i)<=0})),Tu=Lr(">=",(function(a,t,i){return t>=i}),(function(a,t,i,o){return o.compare(t,i)>=0}));class Za{constructor(t,i,o){this.type=ir,this.locale=o,this.caseSensitive=t,this.diacriticSensitive=i}static parse(t,i){if(t.length!==2)return i.error("Expected one argument.");const o=t[1];if(typeof o!="object"||Array.isArray(o))return i.error("Collator options argument must be an object.");const l=i.parse(o["case-sensitive"]!==void 0&&o["case-sensitive"],1,Ae);if(!l)return null;const d=i.parse(o["diacritic-sensitive"]!==void 0&&o["diacritic-sensitive"],1,Ae);if(!d)return null;let p=null;return o.locale&&(p=i.parse(o.locale,1,me),!p)?null:new Za(l,d,p)}evaluate(t){return new Ia(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}}class Su{constructor(t,i,o,l,d){this.type=me,this.number=t,this.locale=i,this.currency=o,this.minFractionDigits=l,this.maxFractionDigits=d}static parse(t,i){if(t.length!==3)return i.error("Expected two arguments.");const o=i.parse(t[1],1,Qt);if(!o)return null;const l=t[2];if(typeof l!="object"||Array.isArray(l))return i.error("NumberFormat options argument must be an object.");let d=null;if(l.locale&&(d=i.parse(l.locale,1,me),!d))return null;let p=null;if(l.currency&&(p=i.parse(l.currency,1,me),!p))return null;let y=null;if(l["min-fraction-digits"]&&(y=i.parse(l["min-fraction-digits"],1,Qt),!y))return null;let x=null;return l["max-fraction-digits"]&&(x=i.parse(l["max-fraction-digits"],1,Qt),!x)?null:new Su(o,d,p,y,x)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}}class Fo{constructor(t){this.type=Js,this.sections=t}static parse(t,i){if(t.length<2)return i.error("Expected at least one argument.");const o=t[1];if(!Array.isArray(o)&&typeof o=="object")return i.error("First argument must be an image or text section.");const l=[];let d=!1;for(let p=1;p<=t.length-1;++p){const y=t[p];if(d&&typeof y=="object"&&!Array.isArray(y)){d=!1;let x=null;if(y["font-scale"]&&(x=i.parse(y["font-scale"],1,Qt),!x))return null;let T=null;if(y["text-font"]&&(T=i.parse(y["text-font"],1,Ua(me)),!T))return null;let M=null;if(y["text-color"]&&(M=i.parse(y["text-color"],1,ba),!M))return null;let A=null;if(y["vertical-align"]){if(typeof y["vertical-align"]=="string"&&!Xe.includes(y["vertical-align"]))return i.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${y["vertical-align"]}' instead.`);if(A=i.parse(y["vertical-align"],1,me),!A)return null}const z=l[l.length-1];z.scale=x,z.font=T,z.textColor=M,z.verticalAlign=A}else{const x=i.parse(t[p],1,Be);if(!x)return null;const T=x.type.kind;if(T!=="string"&&T!=="value"&&T!=="null"&&T!=="resolvedImage")return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");d=!0,l.push({content:x,scale:null,font:null,textColor:null,verticalAlign:null})}}return new Fo(l)}evaluate(t){return new wn(this.sections.map((i=>{const o=i.content.evaluate(t);return Ni(o)===Ir?new ts("",o,null,null,null,i.verticalAlign?i.verticalAlign.evaluate(t):null):new ts(Ms(o),null,i.scale?i.scale.evaluate(t):null,i.font?i.font.evaluate(t).join(","):null,i.textColor?i.textColor.evaluate(t):null,i.verticalAlign?i.verticalAlign.evaluate(t):null)})))}eachChild(t){for(const i of this.sections)t(i.content),i.scale&&t(i.scale),i.font&&t(i.font),i.textColor&&t(i.textColor),i.verticalAlign&&t(i.verticalAlign)}outputDefined(){return!1}}class Mh{constructor(t){this.type=Ir,this.input=t}static parse(t,i){if(t.length!==2)return i.error("Expected two arguments.");const o=i.parse(t[1],1,me);return o?new Mh(o):i.error("No image name provided.")}evaluate(t){const i=this.input.evaluate(t),o=Tn.fromString(i);return o&&t.availableImages&&(o.available=t.availableImages.indexOf(i)>-1),o}eachChild(t){t(this.input)}outputDefined(){return!1}}class xc{constructor(t){this.type=Qt,this.input=t}static parse(t,i){if(t.length!==2)return i.error(`Expected 1 argument, but found ${t.length-1} instead.`);const o=i.parse(t[1],1);return o?o.type.kind!=="array"&&o.type.kind!=="string"&&o.type.kind!=="value"?i.error(`Expected argument of type string or array, but found ${Bi(o.type)} instead.`):new xc(o):null}evaluate(t){const i=this.input.evaluate(t);if(typeof i=="string")return[...i].length;if(Array.isArray(i))return i.length;throw new Ii(`Expected value to be of type string or array, but found ${Bi(Ni(i))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}}const as=8192;function Ch(a,t){const i=(180+a[0])/360,o=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a[1]*Math.PI/360)))/360,l=Math.pow(2,t.z);return[Math.round(i*l*as),Math.round(o*l*as)]}function jo(a,t){const i=Math.pow(2,t.z);return[(l=(a[0]/as+t.x)/i,360*l-180),(o=(a[1]/as+t.y)/i,360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90)];var o,l}function bc(a,t){a[0]=Math.min(a[0],t[0]),a[1]=Math.min(a[1],t[1]),a[2]=Math.max(a[2],t[0]),a[3]=Math.max(a[3],t[1])}function Ds(a,t){return!(a[0]<=t[0]||a[2]>=t[2]||a[1]<=t[1]||a[3]>=t[3])}function kd(a,t,i){const o=a[0]-t[0],l=a[1]-t[1],d=a[0]-i[0],p=a[1]-i[1];return o*p-d*l==0&&o*d<=0&&l*p<=0}function zl(a,t,i,o){return(l=[o[0]-i[0],o[1]-i[1]])[0]*(d=[t[0]-a[0],t[1]-a[1]])[1]-l[1]*d[0]!=0&&!(!Bd(a,t,i,o)||!Bd(i,o,a,t));var l,d}function Ah(a,t,i){for(const o of i)for(let l=0;l<o.length-1;++l)if(zl(a,t,o[l],o[l+1]))return!0;return!1}function Vo(a,t,i=!1){let o=!1;for(const y of t)for(let x=0;x<y.length-1;x++){if(kd(a,y[x],y[x+1]))return i;(d=y[x])[1]>(l=a)[1]!=(p=y[x+1])[1]>l[1]&&l[0]<(p[0]-d[0])*(l[1]-d[1])/(p[1]-d[1])+d[0]&&(o=!o)}var l,d,p;return o}function Uo(a,t){for(const i of t)if(Vo(a,i))return!0;return!1}function Od(a,t){for(const i of a)if(!Vo(i,t))return!1;for(let i=0;i<a.length-1;++i)if(Ah(a[i],a[i+1],t))return!1;return!0}function Nf(a,t){for(const i of t)if(Od(a,i))return!0;return!1}function Bd(a,t,i,o){const l=o[0]-i[0],d=o[1]-i[1],p=(a[0]-i[0])*d-l*(a[1]-i[1]),y=(t[0]-i[0])*d-l*(t[1]-i[1]);return p>0&&y<0||p<0&&y>0}function Eu(a,t,i){const o=[];for(let l=0;l<a.length;l++){const d=[];for(let p=0;p<a[l].length;p++){const y=Ch(a[l][p],i);bc(t,y),d.push(y)}o.push(d)}return o}function Dh(a,t,i){const o=[];for(let l=0;l<a.length;l++){const d=Eu(a[l],t,i);o.push(d)}return o}function Go(a,t,i,o){if(a[0]<i[0]||a[0]>i[2]){const l=.5*o;let d=a[0]-i[0]>l?-o:i[0]-a[0]>l?o:0;d===0&&(d=a[0]-i[2]>l?-o:i[2]-a[0]>l?o:0),a[0]+=d}bc(t,a)}function qo(a,t,i,o){const l=Math.pow(2,o.z)*as,d=[o.x*as,o.y*as],p=[];for(const y of a)for(const x of y){const T=[x.x+d[0],x.y+d[1]];Go(T,t,i,l),p.push(T)}return p}function zh(a,t,i,o){const l=Math.pow(2,o.z)*as,d=[o.x*as,o.y*as],p=[];for(const x of a){const T=[];for(const M of x){const A=[M.x+d[0],M.y+d[1]];bc(t,A),T.push(A)}p.push(T)}if(t[2]-t[0]<=l/2){(y=t)[0]=y[1]=1/0,y[2]=y[3]=-1/0;for(const x of p)for(const T of x)Go(T,t,i,l)}var y;return p}class rs{constructor(t,i){this.type=Ae,this.geojson=t,this.geometries=i}static parse(t,i){if(t.length!==2)return i.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Ra(t[1])){const o=t[1];if(o.type==="FeatureCollection"){const l=[];for(const d of o.features){const{type:p,coordinates:y}=d.geometry;p==="Polygon"&&l.push(y),p==="MultiPolygon"&&l.push(...y)}if(l.length)return new rs(o,{type:"MultiPolygon",coordinates:l})}else if(o.type==="Feature"){const l=o.geometry.type;if(l==="Polygon"||l==="MultiPolygon")return new rs(o,o.geometry)}else if(o.type==="Polygon"||o.type==="MultiPolygon")return new rs(o,o)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return(function(i,o){const l=[1/0,1/0,-1/0,-1/0],d=[1/0,1/0,-1/0,-1/0],p=i.canonicalID();if(o.type==="Polygon"){const y=Eu(o.coordinates,d,p),x=qo(i.geometry(),l,d,p);if(!Ds(l,d))return!1;for(const T of x)if(!Vo(T,y))return!1}if(o.type==="MultiPolygon"){const y=Dh(o.coordinates,d,p),x=qo(i.geometry(),l,d,p);if(!Ds(l,d))return!1;for(const T of x)if(!Uo(T,y))return!1}return!0})(t,this.geometries);if(t.geometryType()==="LineString")return(function(i,o){const l=[1/0,1/0,-1/0,-1/0],d=[1/0,1/0,-1/0,-1/0],p=i.canonicalID();if(o.type==="Polygon"){const y=Eu(o.coordinates,d,p),x=zh(i.geometry(),l,d,p);if(!Ds(l,d))return!1;for(const T of x)if(!Od(T,y))return!1}if(o.type==="MultiPolygon"){const y=Dh(o.coordinates,d,p),x=zh(i.geometry(),l,d,p);if(!Ds(l,d))return!1;for(const T of x)if(!Nf(T,y))return!1}return!0})(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let Ph=class{constructor(a=[],t=(i,o)=>i<o?-1:i>o?1:0){if(this.data=a,this.length=this.data.length,this.compare=t,this.length>0)for(let i=(this.length>>1)-1;i>=0;i--)this._down(i)}push(a){this.data.push(a),this._up(this.length++)}pop(){if(this.length===0)return;const a=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),a}peek(){return this.data[0]}_up(a){const{data:t,compare:i}=this,o=t[a];for(;a>0;){const l=a-1>>1,d=t[l];if(i(o,d)>=0)break;t[a]=d,a=l}t[a]=o}_down(a){const{data:t,compare:i}=this,o=this.length>>1,l=t[a];for(;a<o;){let d=1+(a<<1);const p=d+1;if(p<this.length&&i(t[p],t[d])<0&&(d=p),i(t[d],l)>=0)break;t[a]=t[d],a=d}t[a]=l}};function Ih(a,t,i=0,o=a.length-1,l=Pl){for(;o>i;){if(o-i>600){const x=o-i+1,T=t-i+1,M=Math.log(x),A=.5*Math.exp(2*M/3),z=.5*Math.sqrt(M*A*(x-A)/x)*(T-x/2<0?-1:1);Ih(a,t,Math.max(i,Math.floor(t-T*A/x+z)),Math.min(o,Math.floor(t+(x-T)*A/x+z)),l)}const d=a[t];let p=i,y=o;for(Zo(a,i,t),l(a[o],d)>0&&Zo(a,i,o);p<y;){for(Zo(a,p,y),p++,y--;l(a[p],d)<0;)p++;for(;l(a[y],d)>0;)y--}l(a[i],d)===0?Zo(a,i,y):(y++,Zo(a,y,o)),y<=t&&(i=y+1),t<=y&&(o=y-1)}}function Zo(a,t,i){const o=a[t];a[t]=a[i],a[i]=o}function Pl(a,t){return a<t?-1:a>t?1:0}function Il(a,t){if(a.length<=1)return[a];const i=[];let o,l;for(const d of a){const p=Fd(d);p!==0&&(d.area=Math.abs(p),l===void 0&&(l=p<0),l===p<0?(o&&i.push(o),o=[d]):o.push(d))}if(o&&i.push(o),t>1)for(let d=0;d<i.length;d++)i[d].length<=t||(Ih(i[d],t,1,i[d].length-1,Nd),i[d]=i[d].slice(0,t));return i}function Nd(a,t){return t.area-a.area}function Fd(a){let t=0;for(let i,o,l=0,d=a.length,p=d-1;l<d;p=l++)i=a[l],o=a[p],t+=(o.x-i.x)*(i.y+o.y);return t}const jd=1/298.257223563,Mu=jd*(2-jd),Rh=Math.PI/180;class Lh{constructor(t){const i=6378.137*Rh*1e3,o=Math.cos(t*Rh),l=1/(1-Mu*(1-o*o)),d=Math.sqrt(l);this.kx=i*d*o,this.ky=i*d*l*(1-Mu)}distance(t,i){const o=this.wrap(t[0]-i[0])*this.kx,l=(t[1]-i[1])*this.ky;return Math.sqrt(o*o+l*l)}pointOnLine(t,i){let o,l,d,p,y=1/0;for(let x=0;x<t.length-1;x++){let T=t[x][0],M=t[x][1],A=this.wrap(t[x+1][0]-T)*this.kx,z=(t[x+1][1]-M)*this.ky,I=0;A===0&&z===0||(I=(this.wrap(i[0]-T)*this.kx*A+(i[1]-M)*this.ky*z)/(A*A+z*z),I>1?(T=t[x+1][0],M=t[x+1][1]):I>0&&(T+=A/this.kx*I,M+=z/this.ky*I)),A=this.wrap(i[0]-T)*this.kx,z=(i[1]-M)*this.ky;const R=A*A+z*z;R<y&&(y=R,o=T,l=M,d=x,p=I)}return{point:[o,l],index:d,t:Math.max(0,Math.min(1,p))}}wrap(t){for(;t<-180;)t+=360;for(;t>180;)t-=360;return t}}function Vd(a,t){return t[0]-a[0]}function da(a){return a[1]-a[0]+1}function Ha(a,t){return a[1]>=a[0]&&a[1]<t}function Cu(a,t){if(a[0]>a[1])return[null,null];const i=da(a);if(t){if(i===2)return[a,null];const l=Math.floor(i/2);return[[a[0],a[0]+l],[a[0]+l,a[1]]]}if(i===1)return[a,null];const o=Math.floor(i/2)-1;return[[a[0],a[0]+o],[a[0]+o+1,a[1]]]}function Au(a,t){if(!Ha(t,a.length))return[1/0,1/0,-1/0,-1/0];const i=[1/0,1/0,-1/0,-1/0];for(let o=t[0];o<=t[1];++o)bc(i,a[o]);return i}function Du(a){const t=[1/0,1/0,-1/0,-1/0];for(const i of a)for(const o of i)bc(t,o);return t}function zu(a){return a[0]!==-1/0&&a[1]!==-1/0&&a[2]!==1/0&&a[3]!==1/0}function wc(a,t,i){if(!zu(a)||!zu(t))return NaN;let o=0,l=0;return a[2]<t[0]&&(o=t[0]-a[2]),a[0]>t[2]&&(o=a[0]-t[2]),a[1]>t[3]&&(l=a[1]-t[3]),a[3]<t[1]&&(l=t[1]-a[3]),i.distance([0,0],[o,l])}function Ho(a,t,i){const o=i.pointOnLine(t,a);return i.distance(a,o.point)}function no(a,t,i,o,l){const d=Math.min(Ho(a,[i,o],l),Ho(t,[i,o],l)),p=Math.min(Ho(i,[a,t],l),Ho(o,[a,t],l));return Math.min(d,p)}function kh(a,t,i,o,l){if(!Ha(t,a.length)||!Ha(o,i.length))return 1/0;let d=1/0;for(let p=t[0];p<t[1];++p){const y=a[p],x=a[p+1];for(let T=o[0];T<o[1];++T){const M=i[T],A=i[T+1];if(zl(y,x,M,A))return 0;d=Math.min(d,no(y,x,M,A,l))}}return d}function ui(a,t,i,o,l){if(!Ha(t,a.length)||!Ha(o,i.length))return NaN;let d=1/0;for(let p=t[0];p<=t[1];++p)for(let y=o[0];y<=o[1];++y)if(d=Math.min(d,l.distance(a[p],i[y])),d===0)return d;return d}function Oh(a,t,i){if(Vo(a,t,!0))return 0;let o=1/0;for(const l of t){const d=l[0],p=l[l.length-1];if(d!==p&&(o=Math.min(o,Ho(a,[p,d],i)),o===0))return o;const y=i.pointOnLine(l,a);if(o=Math.min(o,i.distance(a,y.point)),o===0)return o}return o}function Ud(a,t,i,o){if(!Ha(t,a.length))return NaN;for(let d=t[0];d<=t[1];++d)if(Vo(a[d],i,!0))return 0;let l=1/0;for(let d=t[0];d<t[1];++d){const p=a[d],y=a[d+1];for(const x of i)for(let T=0,M=x.length,A=M-1;T<M;A=T++){const z=x[A],I=x[T];if(zl(p,y,z,I))return 0;l=Math.min(l,no(p,y,z,I,o))}}return l}function ao(a,t){for(const i of a)for(const o of i)if(Vo(o,t,!0))return!0;return!1}function Rl(a,t,i,o=1/0){const l=Du(a),d=Du(t);if(o!==1/0&&wc(l,d,i)>=o)return o;if(Ds(l,d)){if(ao(a,t))return 0}else if(ao(t,a))return 0;let p=1/0;for(const y of a)for(let x=0,T=y.length,M=T-1;x<T;M=x++){const A=y[M],z=y[x];for(const I of t)for(let R=0,N=I.length,V=N-1;R<N;V=R++){const $=I[V],rt=I[R];if(zl(A,z,$,rt))return 0;p=Math.min(p,no(A,z,$,rt,i))}}return p}function Pu(a,t,i,o,l,d){if(!d)return;const p=wc(Au(o,d),l,i);p<t&&a.push([p,d,[0,0]])}function Tc(a,t,i,o,l,d,p){if(!d||!p)return;const y=wc(Au(o,d),Au(l,p),i);y<t&&a.push([y,d,p])}function ss(a,t,i,o,l=1/0){let d=Math.min(o.distance(a[0],i[0][0]),l);if(d===0)return d;const p=new Ph([[0,[0,a.length-1],[0,0]]],Vd),y=Du(i);for(;p.length>0;){const x=p.pop();if(x[0]>=d)continue;const T=x[1],M=t?50:100;if(da(T)<=M){if(!Ha(T,a.length))return NaN;if(t){const A=Ud(a,T,i,o);if(isNaN(A)||A===0)return A;d=Math.min(d,A)}else for(let A=T[0];A<=T[1];++A){const z=Oh(a[A],i,o);if(d=Math.min(d,z),d===0)return 0}}else{const A=Cu(T,t);Pu(p,d,o,a,y,A[0]),Pu(p,d,o,a,y,A[1])}}return d}function Sc(a,t,i,o,l,d=1/0){let p=Math.min(d,l.distance(a[0],i[0]));if(p===0)return p;const y=new Ph([[0,[0,a.length-1],[0,i.length-1]]],Vd);for(;y.length>0;){const x=y.pop();if(x[0]>=p)continue;const T=x[1],M=x[2],A=t?50:100,z=o?50:100;if(da(T)<=A&&da(M)<=z){if(!Ha(T,a.length)&&Ha(M,i.length))return NaN;let I;if(t&&o)I=kh(a,T,i,M,l),p=Math.min(p,I);else if(t&&!o){const R=a.slice(T[0],T[1]+1);for(let N=M[0];N<=M[1];++N)if(I=Ho(i[N],R,l),p=Math.min(p,I),p===0)return p}else if(!t&&o){const R=i.slice(M[0],M[1]+1);for(let N=T[0];N<=T[1];++N)if(I=Ho(a[N],R,l),p=Math.min(p,I),p===0)return p}else I=ui(a,T,i,M,l),p=Math.min(p,I)}else{const I=Cu(T,t),R=Cu(M,o);Tc(y,p,l,a,i,I[0],R[0]),Tc(y,p,l,a,i,I[0],R[1]),Tc(y,p,l,a,i,I[1],R[0]),Tc(y,p,l,a,i,I[1],R[1])}}return p}function Iu(a){return a.type==="MultiPolygon"?a.coordinates.map((t=>({type:"Polygon",coordinates:t}))):a.type==="MultiLineString"?a.coordinates.map((t=>({type:"LineString",coordinates:t}))):a.type==="MultiPoint"?a.coordinates.map((t=>({type:"Point",coordinates:t}))):[a]}class ro{constructor(t,i){this.type=Qt,this.geojson=t,this.geometries=i}static parse(t,i){if(t.length!==2)return i.error(`'distance' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Ra(t[1])){const o=t[1];if(o.type==="FeatureCollection")return new ro(o,o.features.map((l=>Iu(l.geometry))).flat());if(o.type==="Feature")return new ro(o,Iu(o.geometry));if("type"in o&&"coordinates"in o)return new ro(o,Iu(o))}return i.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return(function(i,o){const l=i.geometry(),d=l.flat().map((x=>jo([x.x,x.y],i.canonical)));if(l.length===0)return NaN;const p=new Lh(d[0][1]);let y=1/0;for(const x of o){switch(x.type){case"Point":y=Math.min(y,Sc(d,!1,[x.coordinates],!1,p,y));break;case"LineString":y=Math.min(y,Sc(d,!1,x.coordinates,!0,p,y));break;case"Polygon":y=Math.min(y,ss(d,!1,x.coordinates,p,y))}if(y===0)return y}return y})(t,this.geometries);if(t.geometryType()==="LineString")return(function(i,o){const l=i.geometry(),d=l.flat().map((x=>jo([x.x,x.y],i.canonical)));if(l.length===0)return NaN;const p=new Lh(d[0][1]);let y=1/0;for(const x of o){switch(x.type){case"Point":y=Math.min(y,Sc(d,!0,[x.coordinates],!1,p,y));break;case"LineString":y=Math.min(y,Sc(d,!0,x.coordinates,!0,p,y));break;case"Polygon":y=Math.min(y,ss(d,!0,x.coordinates,p,y))}if(y===0)return y}return y})(t,this.geometries);if(t.geometryType()==="Polygon")return(function(i,o){const l=i.geometry();if(l.length===0||l[0].length===0)return NaN;const d=Il(l,0).map((x=>x.map((T=>T.map((M=>jo([M.x,M.y],i.canonical))))))),p=new Lh(d[0][0][0][1]);let y=1/0;for(const x of o)for(const T of d){switch(x.type){case"Point":y=Math.min(y,ss([x.coordinates],!1,T,p,y));break;case"LineString":y=Math.min(y,ss(x.coordinates,!0,T,p,y));break;case"Polygon":y=Math.min(y,Rl(T,x.coordinates,p,y))}if(y===0)return y}return y})(t,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class Ec{constructor(t){this.type=Be,this.key=t}static parse(t,i){if(t.length!==2)return i.error(`Expected 1 argument, but found ${t.length-1} instead.`);const o=t[1];return o==null?i.error("Global state property must be defined."):typeof o!="string"?i.error(`Global state property must be string, but found ${typeof t[1]} instead.`):new Ec(o)}evaluate(t){var i;const o=(i=t.globals)===null||i===void 0?void 0:i.globalState;return o&&Object.keys(o).length!==0?Kr(o,this.key):null}eachChild(){}outputDefined(){return!1}}const Ll={"==":bu,"!=":Eh,">":Ld,"<":Rd,">=":Tu,"<=":wu,array:ua,at:ar,boolean:ua,case:yc,coalesce:Dl,collator:Za,format:Fo,image:Mh,in:As,"index-of":is,interpolate:ra,"interpolate-hcl":ra,"interpolate-lab":ra,length:xc,let:ci,literal:Cs,match:_c,number:ua,"number-format":Su,object:ua,slice:vc,step:io,string:ua,"to-boolean":gn,"to-color":gn,"to-number":gn,"to-string":gn,var:eo,within:rs,distance:ro,"global-state":Ec};class gr{constructor(t,i,o,l){this.name=t,this.type=i,this._evaluate=o,this.args=l}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}static parse(t,i){const o=t[0],l=gr.definitions[o];if(!l)return i.error(`Unknown expression "${o}". If you wanted a literal array, use ["literal", [...]].`,0);const d=Array.isArray(l)?l[0]:l.type,p=Array.isArray(l)?[[l[1],l[2]]]:l.overloads,y=p.filter((([T])=>!Array.isArray(T)||T.length===t.length-1));let x=null;for(const[T,M]of y){x=new es(i.registry,$o,i.path,null,i.scope);const A=[];let z=!1;for(let I=1;I<t.length;I++){const R=t[I],N=Array.isArray(T)?T[I-1]:T.type,V=x.parse(R,1+A.length,N);if(!V){z=!0;break}A.push(V)}if(!z)if(Array.isArray(T)&&T.length!==A.length)x.error(`Expected ${T.length} arguments, but found ${A.length} instead.`);else{for(let I=0;I<A.length;I++){const R=Array.isArray(T)?T[I]:T.type,N=A[I];x.concat(I+1).checkSubtype(R,N.type)}if(x.errors.length===0)return new gr(o,d,M,A)}}if(y.length===1)i.errors.push(...x.errors);else{const T=(y.length?y:p).map((([A])=>{return z=A,Array.isArray(z)?`(${z.map(Bi).join(", ")})`:`(${Bi(z.type)}...)`;var z})).join(" | "),M=[];for(let A=1;A<t.length;A++){const z=i.parse(t[A],1+M.length);if(!z)return null;M.push(Bi(z.type))}i.error(`Expected arguments of type ${T}, but found (${M.join(", ")}) instead.`)}return null}static register(t,i){gr.definitions=i;for(const o in i)t[o]=gr}}function Bh(a,[t,i,o,l]){t=t.evaluate(a),i=i.evaluate(a),o=o.evaluate(a);const d=l?l.evaluate(a):1,p=Al(t,i,o,d);if(p)throw new Ii(p);return new ii(t/255,i/255,o/255,d,!1)}function Nh(a,t){return a in t}function Mc(a,t){const i=t[a];return i===void 0?null:i}function fa(a){return{type:a}}function $o(a){if(a instanceof eo)return $o(a.boundExpression);if(a instanceof gr&&a.name==="error"||a instanceof Za||a instanceof rs||a instanceof ro||a instanceof Ec)return!1;const t=a instanceof gn||a instanceof ua;let i=!0;return a.eachChild((o=>{i=t?i&&$o(o):i&&o instanceof Cs})),!!i&&La(a)&&kl(a,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"])}function La(a){if(a instanceof gr&&(a.name==="get"&&a.args.length===1||a.name==="feature-state"||a.name==="has"&&a.args.length===1||a.name==="properties"||a.name==="geometry-type"||a.name==="id"||/^filter-/.test(a.name))||a instanceof rs||a instanceof ro)return!1;let t=!0;return a.eachChild((i=>{t&&!La(i)&&(t=!1)})),t}function os(a){if(a instanceof gr&&a.name==="feature-state")return!1;let t=!0;return a.eachChild((i=>{t&&!os(i)&&(t=!1)})),t}function kl(a,t){if(a instanceof gr&&t.indexOf(a.name)>=0)return!1;let i=!0;return a.eachChild((o=>{i&&!kl(o,t)&&(i=!1)})),i}function Cc(a){return{result:"success",value:a}}function zs(a){return{result:"error",value:a}}function so(a){return a["property-type"]==="data-driven"||a["property-type"]==="cross-faded-data-driven"}function oo(a){return!!a.expression&&a.expression.parameters.indexOf("zoom")>-1}function Ru(a){return!!a.expression&&a.expression.interpolated}function Ye(a){return a instanceof Number?"number":a instanceof String?"string":a instanceof Boolean?"boolean":Array.isArray(a)?"array":a===null?"null":typeof a}function Ps(a){return typeof a=="object"&&a!==null&&!Array.isArray(a)&&Ni(a)===na}function Ff(a){return a}function $a(a,t){const i=a.stops&&typeof a.stops[0][0]=="object",o=i||!(i||a.property!==void 0),l=a.type||(Ru(t)?"exponential":"interval"),d=(function(M){switch(M.type){case"color":return ii.parse;case"padding":return zn.parse;case"numberArray":return Pn.parse;case"colorArray":return Bn.parse;default:return null}})(t);if(d&&((a=ki({},a)).stops&&(a.stops=a.stops.map((M=>[M[0],d(M[1])]))),a.default=d(a.default?a.default:t.default)),a.colorSpace&&(p=a.colorSpace)!=="rgb"&&p!=="hcl"&&p!=="lab")throw new Error(`Unknown color space: "${a.colorSpace}"`);var p;const y=(function(M){switch(M){case"exponential":return Ac;case"interval":return Gd;case"categorical":return kr;case"identity":return Yo;default:throw new Error(`Unknown function type "${M}"`)}})(l);let x,T;if(l==="categorical"){x=Object.create(null);for(const M of a.stops)x[M[0]]=M[1];T=typeof a.stops[0][0]}if(i){const M={},A=[];for(let R=0;R<a.stops.length;R++){const N=a.stops[R],V=N[0].zoom;M[V]===void 0&&(M[V]={zoom:V,type:a.type,property:a.property,default:a.default,stops:[]},A.push(V)),M[V].stops.push([N[0].value,N[1]])}const z=[];for(const R of A)z.push([M[R].zoom,$a(M[R],t)]);const I={name:"linear"};return{kind:"composite",interpolationType:I,interpolationFactor:ra.interpolationFactor.bind(void 0,I),zoomStops:z.map((R=>R[0])),evaluate:({zoom:R},N)=>Ac({stops:z,base:a.base},t,R).evaluate(R,N)}}if(o){const M=l==="exponential"?{name:"exponential",base:a.base!==void 0?a.base:1}:null;return{kind:"camera",interpolationType:M,interpolationFactor:ra.interpolationFactor.bind(void 0,M),zoomStops:a.stops.map((A=>A[0])),evaluate:({zoom:A})=>y(a,t,A,x,T)}}return{kind:"source",evaluate(M,A){const z=A&&A.properties?A.properties[a.property]:void 0;return z===void 0?Xo(a.default,t.default):y(a,t,z,x,T)}}}function Xo(a,t,i){return a!==void 0?a:t!==void 0?t:i!==void 0?i:void 0}function kr(a,t,i,o,l){return Xo(typeof i===l?o[i]:void 0,a.default,t.default)}function Gd(a,t,i){if(Ye(i)!=="number")return Xo(a.default,t.default);const o=a.stops.length;if(o===1||i<=a.stops[0][0])return a.stops[0][1];if(i>=a.stops[o-1][0])return a.stops[o-1][1];const l=yu(a.stops.map((d=>d[0])),i);return a.stops[l][1]}function Ac(a,t,i){const o=a.base!==void 0?a.base:1;if(Ye(i)!=="number")return Xo(a.default,t.default);const l=a.stops.length;if(l===1||i<=a.stops[0][0])return a.stops[0][1];if(i>=a.stops[l-1][0])return a.stops[l-1][1];const d=yu(a.stops.map((M=>M[0])),i),p=(function(M,A,z,I){const R=I-z,N=M-z;return R===0?0:A===1?N/R:(Math.pow(A,N)-1)/(Math.pow(A,R)-1)})(i,o,a.stops[d][0],a.stops[d+1][0]),y=a.stops[d][1],x=a.stops[d+1][1],T=Rr[t.type]||Ff;return typeof y.evaluate=="function"?{evaluate(...M){const A=y.evaluate.apply(void 0,M),z=x.evaluate.apply(void 0,M);if(A!==void 0&&z!==void 0)return T(A,z,p,a.colorSpace)}}:T(y,x,p,a.colorSpace)}function Yo(a,t,i){switch(t.type){case"color":i=ii.parse(i);break;case"formatted":i=wn.fromString(i.toString());break;case"resolvedImage":i=Tn.fromString(i.toString());break;case"padding":i=zn.parse(i);break;case"colorArray":i=Bn.parse(i);break;case"numberArray":i=Pn.parse(i);break;default:Ye(i)===t.type||t.type==="enum"&&t.values[i]||(i=void 0)}return Xo(i,a.default,t.default)}gr.register(Ll,{error:[{kind:"error"},[me],(a,[t])=>{throw new Ii(t.evaluate(a))}],typeof:[me,[Be],(a,[t])=>Bi(Ni(t.evaluate(a)))],"to-rgba":[Ua(Qt,4),[ba],(a,[t])=>{const[i,o,l,d]=t.evaluate(a).rgb;return[255*i,255*o,255*l,d]}],rgb:[ba,[Qt,Qt,Qt],Bh],rgba:[ba,[Qt,Qt,Qt,Qt],Bh],has:{type:Ae,overloads:[[[me],(a,[t])=>Nh(t.evaluate(a),a.properties())],[[me,na],(a,[t,i])=>Nh(t.evaluate(a),i.evaluate(a))]]},get:{type:Be,overloads:[[[me],(a,[t])=>Mc(t.evaluate(a),a.properties())],[[me,na],(a,[t,i])=>Mc(t.evaluate(a),i.evaluate(a))]]},"feature-state":[Be,[me],(a,[t])=>Mc(t.evaluate(a),a.featureState||{})],properties:[na,[],a=>a.properties()],"geometry-type":[me,[],a=>a.geometryType()],id:[Be,[],a=>a.id()],zoom:[Qt,[],a=>a.globals.zoom],"heatmap-density":[Qt,[],a=>a.globals.heatmapDensity||0],elevation:[Qt,[],a=>a.globals.elevation||0],"line-progress":[Qt,[],a=>a.globals.lineProgress||0],accumulated:[Be,[],a=>a.globals.accumulated===void 0?null:a.globals.accumulated],"+":[Qt,fa(Qt),(a,t)=>{let i=0;for(const o of t)i+=o.evaluate(a);return i}],"*":[Qt,fa(Qt),(a,t)=>{let i=1;for(const o of t)i*=o.evaluate(a);return i}],"-":{type:Qt,overloads:[[[Qt,Qt],(a,[t,i])=>t.evaluate(a)-i.evaluate(a)],[[Qt],(a,[t])=>-t.evaluate(a)]]},"/":[Qt,[Qt,Qt],(a,[t,i])=>t.evaluate(a)/i.evaluate(a)],"%":[Qt,[Qt,Qt],(a,[t,i])=>t.evaluate(a)%i.evaluate(a)],ln2:[Qt,[],()=>Math.LN2],pi:[Qt,[],()=>Math.PI],e:[Qt,[],()=>Math.E],"^":[Qt,[Qt,Qt],(a,[t,i])=>Math.pow(t.evaluate(a),i.evaluate(a))],sqrt:[Qt,[Qt],(a,[t])=>Math.sqrt(t.evaluate(a))],log10:[Qt,[Qt],(a,[t])=>Math.log(t.evaluate(a))/Math.LN10],ln:[Qt,[Qt],(a,[t])=>Math.log(t.evaluate(a))],log2:[Qt,[Qt],(a,[t])=>Math.log(t.evaluate(a))/Math.LN2],sin:[Qt,[Qt],(a,[t])=>Math.sin(t.evaluate(a))],cos:[Qt,[Qt],(a,[t])=>Math.cos(t.evaluate(a))],tan:[Qt,[Qt],(a,[t])=>Math.tan(t.evaluate(a))],asin:[Qt,[Qt],(a,[t])=>Math.asin(t.evaluate(a))],acos:[Qt,[Qt],(a,[t])=>Math.acos(t.evaluate(a))],atan:[Qt,[Qt],(a,[t])=>Math.atan(t.evaluate(a))],min:[Qt,fa(Qt),(a,t)=>Math.min(...t.map((i=>i.evaluate(a))))],max:[Qt,fa(Qt),(a,t)=>Math.max(...t.map((i=>i.evaluate(a))))],abs:[Qt,[Qt],(a,[t])=>Math.abs(t.evaluate(a))],round:[Qt,[Qt],(a,[t])=>{const i=t.evaluate(a);return i<0?-Math.round(-i):Math.round(i)}],floor:[Qt,[Qt],(a,[t])=>Math.floor(t.evaluate(a))],ceil:[Qt,[Qt],(a,[t])=>Math.ceil(t.evaluate(a))],"filter-==":[Ae,[me,Be],(a,[t,i])=>a.properties()[t.value]===i.value],"filter-id-==":[Ae,[Be],(a,[t])=>a.id()===t.value],"filter-type-==":[Ae,[me],(a,[t])=>a.geometryType()===t.value],"filter-<":[Ae,[me,Be],(a,[t,i])=>{const o=a.properties()[t.value],l=i.value;return typeof o==typeof l&&o<l}],"filter-id-<":[Ae,[Be],(a,[t])=>{const i=a.id(),o=t.value;return typeof i==typeof o&&i<o}],"filter->":[Ae,[me,Be],(a,[t,i])=>{const o=a.properties()[t.value],l=i.value;return typeof o==typeof l&&o>l}],"filter-id->":[Ae,[Be],(a,[t])=>{const i=a.id(),o=t.value;return typeof i==typeof o&&i>o}],"filter-<=":[Ae,[me,Be],(a,[t,i])=>{const o=a.properties()[t.value],l=i.value;return typeof o==typeof l&&o<=l}],"filter-id-<=":[Ae,[Be],(a,[t])=>{const i=a.id(),o=t.value;return typeof i==typeof o&&i<=o}],"filter->=":[Ae,[me,Be],(a,[t,i])=>{const o=a.properties()[t.value],l=i.value;return typeof o==typeof l&&o>=l}],"filter-id->=":[Ae,[Be],(a,[t])=>{const i=a.id(),o=t.value;return typeof i==typeof o&&i>=o}],"filter-has":[Ae,[Be],(a,[t])=>t.value in a.properties()],"filter-has-id":[Ae,[],a=>a.id()!==null&&a.id()!==void 0],"filter-type-in":[Ae,[Ua(me)],(a,[t])=>t.value.indexOf(a.geometryType())>=0],"filter-id-in":[Ae,[Ua(Be)],(a,[t])=>t.value.indexOf(a.id())>=0],"filter-in-small":[Ae,[me,Ua(Be)],(a,[t,i])=>i.value.indexOf(a.properties()[t.value])>=0],"filter-in-large":[Ae,[me,Ua(Be)],(a,[t,i])=>(function(o,l,d,p){for(;d<=p;){const y=d+p>>1;if(l[y]===o)return!0;l[y]>o?p=y-1:d=y+1}return!1})(a.properties()[t.value],i.value,0,i.value.length-1)],all:{type:Ae,overloads:[[[Ae,Ae],(a,[t,i])=>t.evaluate(a)&&i.evaluate(a)],[fa(Ae),(a,t)=>{for(const i of t)if(!i.evaluate(a))return!1;return!0}]]},any:{type:Ae,overloads:[[[Ae,Ae],(a,[t,i])=>t.evaluate(a)||i.evaluate(a)],[fa(Ae),(a,t)=>{for(const i of t)if(i.evaluate(a))return!0;return!1}]]},"!":[Ae,[Ae],(a,[t])=>!t.evaluate(a)],"is-supported-script":[Ae,[me],(a,[t])=>{const i=a.globals&&a.globals.isSupportedScript;return!i||i(t.evaluate(a))}],upcase:[me,[me],(a,[t])=>t.evaluate(a).toUpperCase()],downcase:[me,[me],(a,[t])=>t.evaluate(a).toLowerCase()],concat:[me,fa(Be),(a,t)=>t.map((i=>Ms(i.evaluate(a)))).join("")],"resolved-locale":[me,[ir],(a,[t])=>t.evaluate(a).resolvedLocale()]});class Ol{constructor(t,i,o){this.expression=t,this._warningHistory={},this._evaluator=new Ze,this._defaultValue=i?(function(l){if(l.type==="color"&&Ps(l.default))return new ii(0,0,0,0);switch(l.type){case"color":return ii.parse(l.default)||null;case"padding":return zn.parse(l.default)||null;case"numberArray":return Pn.parse(l.default)||null;case"colorArray":return Bn.parse(l.default)||null;case"variableAnchorOffsetCollection":return Hn.parse(l.default)||null;case"projectionDefinition":return aa.parse(l.default)||null;default:return l.default===void 0?null:l.default}})(i):null,this._enumValues=i&&i.type==="enum"?i.values:null,this._globalState=o}evaluateWithoutErrorHandling(t,i,o,l,d,p){return this._globalState&&(t=pa(t,this._globalState)),this._evaluator.globals=t,this._evaluator.feature=i,this._evaluator.featureState=o,this._evaluator.canonical=l,this._evaluator.availableImages=d||null,this._evaluator.formattedSection=p,this.expression.evaluate(this._evaluator)}evaluate(t,i,o,l,d,p){this._globalState&&(t=pa(t,this._globalState)),this._evaluator.globals=t,this._evaluator.feature=i||null,this._evaluator.featureState=o||null,this._evaluator.canonical=l,this._evaluator.availableImages=d||null,this._evaluator.formattedSection=p||null;try{const y=this.expression.evaluate(this._evaluator);if(y==null||typeof y=="number"&&y!=y)return this._defaultValue;if(this._enumValues&&!(y in this._enumValues))throw new Ii(`Expected value to be one of ${Object.keys(this._enumValues).map((x=>JSON.stringify(x))).join(", ")}, but found ${JSON.stringify(y)} instead.`);return y}catch(y){return this._warningHistory[y.message]||(this._warningHistory[y.message]=!0,typeof console<"u"&&console.warn(y.message)),this._defaultValue}}}function Dc(a){return Array.isArray(a)&&a.length>0&&typeof a[0]=="string"&&a[0]in Ll}function Bl(a,t,i){const o=new es(Ll,$o,[],t?(function(d){const p={color:ba,string:me,number:Qt,enum:me,boolean:Ae,formatted:Js,padding:zr,numberArray:Pr,colorArray:wa,projectionDefinition:Lo,resolvedImage:Ir,variableAnchorOffsetCollection:mn};return d.type==="array"?Ua(p[d.value]||Be,d.length):p[d.type]})(t):void 0),l=o.parse(a,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return l?Cc(new Ol(l,t,i)):zs(o.errors)}class lo{constructor(t,i,o){this.kind=t,this._styleExpression=i,this.isStateDependent=t!=="constant"&&!os(i.expression),this.globalStateRefs=co(i.expression),this._globalState=o}evaluateWithoutErrorHandling(t,i,o,l,d,p){return this._globalState&&(t=pa(t,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(t,i,o,l,d,p)}evaluate(t,i,o,l,d,p){return this._globalState&&(t=pa(t,this._globalState)),this._styleExpression.evaluate(t,i,o,l,d,p)}}class ka{constructor(t,i,o,l,d){this.kind=t,this.zoomStops=o,this._styleExpression=i,this.isStateDependent=t!=="camera"&&!os(i.expression),this.globalStateRefs=co(i.expression),this.interpolationType=l,this._globalState=d}evaluateWithoutErrorHandling(t,i,o,l,d,p){return this._globalState&&(t=pa(t,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(t,i,o,l,d,p)}evaluate(t,i,o,l,d,p){return this._globalState&&(t=pa(t,this._globalState)),this._styleExpression.evaluate(t,i,o,l,d,p)}interpolationFactor(t,i,o){return this.interpolationType?ra.interpolationFactor(this.interpolationType,t,i,o):0}}function Wo(a,t,i){const o=Bl(a,t,i);if(o.result==="error")return o;const l=o.value.expression,d=La(l);if(!d&&!so(t))return zs([new Oi("","data expressions not supported")]);const p=kl(l,["zoom"]);if(!p&&!oo(t))return zs([new Oi("","zoom expressions not supported")]);const y=Ko(l);return y||p?y instanceof Oi?zs([y]):y instanceof ra&&!Ru(t)?zs([new Oi("",'"interpolate" expressions cannot be used with this property')]):Cc(y?new ka(d?"camera":"composite",o.value,y.labels,y instanceof ra?y.interpolation:void 0,i):new lo(d?"constant":"source",o.value,i)):zs([new Oi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Is{constructor(t,i){this._parameters=t,this._specification=i,ki(this,$a(this._parameters,this._specification))}static deserialize(t){return new Is(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function Ko(a){let t=null;if(a instanceof ci)t=Ko(a.result);else if(a instanceof Dl){for(const i of a.args)if(t=Ko(i),t)break}else(a instanceof io||a instanceof ra)&&a.input instanceof gr&&a.input.name==="zoom"&&(t=a);return t instanceof Oi||a.eachChild((i=>{const o=Ko(i);o instanceof Oi?t=o:!t&&o?t=new Oi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&o&&t!==o&&(t=new Oi("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),t}function co(a,t=new Set){return a instanceof Ec&&t.add(a.key),a.eachChild((i=>{co(i,t)})),t}function pa(a,t){const{zoom:i,heatmapDensity:o,elevation:l,lineProgress:d,isSupportedScript:p,accumulated:y}=a??{};return{zoom:i,heatmapDensity:o,elevation:l,lineProgress:d,isSupportedScript:p,accumulated:y,globalState:t}}function Oa(a){if(a===!0||a===!1)return!0;if(!Array.isArray(a)||a.length===0)return!1;switch(a[0]){case"has":return a.length>=2&&a[1]!=="$id"&&a[1]!=="$type";case"in":return a.length>=3&&(typeof a[1]!="string"||Array.isArray(a[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return a.length!==3||Array.isArray(a[1])||Array.isArray(a[2]);case"any":case"all":for(const t of a.slice(1))if(!Oa(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}const Rs={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Xa(a,t){if(a==null)return{filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set};Oa(a)||(a=Nl(a));const i=Bl(a,Rs,t);if(i.result==="error")throw new Error(i.value.map((o=>`${o.key}: ${o.message}`)).join(", "));return{filter:(o,l,d)=>i.value.evaluate(o,l,{},d),needGeometry:Or(a),getGlobalStateRefs:()=>co(i.value.expression)}}function ls(a,t){return a<t?-1:a>t?1:0}function Or(a){if(!Array.isArray(a))return!1;if(a[0]==="within"||a[0]==="distance")return!0;for(let t=1;t<a.length;t++)if(Or(a[t]))return!0;return!1}function Nl(a){if(!a)return!0;const t=a[0];return a.length<=1?t!=="any":t==="=="?Fl(a[1],a[2],"=="):t==="!="?Fn(Fl(a[1],a[2],"==")):t==="<"||t===">"||t==="<="||t===">="?Fl(a[1],a[2],t):t==="any"?(i=a.slice(1),["any"].concat(i.map(Nl))):t==="all"?["all"].concat(a.slice(1).map(Nl)):t==="none"?["all"].concat(a.slice(1).map(Nl).map(Fn)):t==="in"?Lu(a[1],a.slice(2)):t==="!in"?Fn(Lu(a[1],a.slice(2))):t==="has"?Fh(a[1]):t!=="!has"||Fn(Fh(a[1]));var i}function Fl(a,t,i){switch(a){case"$type":return[`filter-type-${i}`,t];case"$id":return[`filter-id-${i}`,t];default:return[`filter-${i}`,a,t]}}function Lu(a,t){if(t.length===0)return!1;switch(a){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some((i=>typeof i!=typeof t[0]))?["filter-in-large",a,["literal",t.sort(ls)]]:["filter-in-small",a,["literal",t]]}}function Fh(a){switch(a){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",a]}}function Fn(a){return["!",a]}function Hi(a){const t=typeof a;if(t==="number"||t==="boolean"||t==="string"||a==null)return JSON.stringify(a);if(Array.isArray(a)){let l="[";for(const d of a)l+=`${Hi(d)},`;return`${l}]`}const i=Object.keys(a).sort();let o="{";for(let l=0;l<i.length;l++)o+=`${JSON.stringify(i[l])}:${Hi(a[i[l]])},`;return`${o}}`}function hi(a){let t="";for(const i of wt)t+=`/${Hi(a[i])}`;return t}function cs(a){const t=a.value;return t?[new ne(a.key,t,"constants have been deprecated as of v8")]:[]}function gi(a){return a instanceof Number||a instanceof String||a instanceof Boolean?a.valueOf():a}function Br(a){if(Array.isArray(a))return a.map(Br);if(a instanceof Object&&!(a instanceof Number||a instanceof String||a instanceof Boolean)){const t={};for(const i in a)t[i]=Br(a[i]);return t}return gi(a)}function In(a){const t=a.key,i=a.value,o=a.valueSpec||{},l=a.objectElementValidators||{},d=a.style,p=a.styleSpec,y=a.validateSpec;let x=[];const T=Ye(i);if(T!=="object")return[new ne(t,i,`object expected, ${T} found`)];for(const M in i){const A=M.split(".")[0],z=Kr(o,A)||o["*"];let I;if(Kr(l,A))I=l[A];else if(Kr(o,A))I=y;else if(l["*"])I=l["*"];else{if(!o["*"]){x.push(new ne(t,i[M],`unknown property "${M}"`));continue}I=y}x=x.concat(I({key:(t&&`${t}.`)+M,value:i[M],valueSpec:z,style:d,styleSpec:p,object:i,objectKey:M,validateSpec:y},i))}for(const M in o)l[M]||o[M].required&&o[M].default===void 0&&i[M]===void 0&&x.push(new ne(t,i,`missing required property "${M}"`));return x}function jl(a){const t=a.value,i=a.valueSpec,o=a.style,l=a.styleSpec,d=a.key,p=a.arrayElementValidator||a.validateSpec;if(Ye(t)!=="array")return[new ne(d,t,`array expected, ${Ye(t)} found`)];if(i.length&&t.length!==i.length)return[new ne(d,t,`array length ${i.length} expected, length ${t.length} found`)];if(i["min-length"]&&t.length<i["min-length"])return[new ne(d,t,`array length at least ${i["min-length"]} expected, length ${t.length} found`)];let y={type:i.value,values:i.values};l.$version<7&&(y.function=i.function),Ye(i.value)==="object"&&(y=i.value);let x=[];for(let T=0;T<t.length;T++)x=x.concat(p({array:t,arrayIndex:T,value:t[T],valueSpec:y,validateSpec:a.validateSpec,style:o,styleSpec:l,key:`${d}[${T}]`}));return x}function uo(a){const t=a.key,i=a.value,o=a.valueSpec;let l=Ye(i);return l==="number"&&i!=i&&(l="NaN"),l!=="number"?[new ne(t,i,`number expected, ${l} found`)]:"minimum"in o&&i<o.minimum?[new ne(t,i,`${i} is less than the minimum value ${o.minimum}`)]:"maximum"in o&&i>o.maximum?[new ne(t,i,`${i} is greater than the maximum value ${o.maximum}`)]:[]}function Qo(a){const t=a.valueSpec,i=gi(a.value.type);let o,l,d,p={};const y=i!=="categorical"&&a.value.property===void 0,x=!y,T=Ye(a.value.stops)==="array"&&Ye(a.value.stops[0])==="array"&&Ye(a.value.stops[0][0])==="object",M=In({key:a.key,value:a.value,valueSpec:a.styleSpec.function,validateSpec:a.validateSpec,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{stops:function(I){if(i==="identity")return[new ne(I.key,I.value,'identity function may not have a "stops" property')];let R=[];const N=I.value;return R=R.concat(jl({key:I.key,value:N,valueSpec:I.valueSpec,validateSpec:I.validateSpec,style:I.style,styleSpec:I.styleSpec,arrayElementValidator:A})),Ye(N)==="array"&&N.length===0&&R.push(new ne(I.key,N,"array must have at least one stop")),R},default:function(I){return I.validateSpec({key:I.key,value:I.value,valueSpec:t,validateSpec:I.validateSpec,style:I.style,styleSpec:I.styleSpec})}}});return i==="identity"&&y&&M.push(new ne(a.key,a.value,'missing required property "property"')),i==="identity"||a.value.stops||M.push(new ne(a.key,a.value,'missing required property "stops"')),i==="exponential"&&a.valueSpec.expression&&!Ru(a.valueSpec)&&M.push(new ne(a.key,a.value,"exponential functions not supported")),a.styleSpec.$version>=8&&(x&&!so(a.valueSpec)?M.push(new ne(a.key,a.value,"property functions not supported")):y&&!oo(a.valueSpec)&&M.push(new ne(a.key,a.value,"zoom functions not supported"))),i!=="categorical"&&!T||a.value.property!==void 0||M.push(new ne(a.key,a.value,'"property" property is required')),M;function A(I){let R=[];const N=I.value,V=I.key;if(Ye(N)!=="array")return[new ne(V,N,`array expected, ${Ye(N)} found`)];if(N.length!==2)return[new ne(V,N,`array length 2 expected, length ${N.length} found`)];if(T){if(Ye(N[0])!=="object")return[new ne(V,N,`object expected, ${Ye(N[0])} found`)];if(N[0].zoom===void 0)return[new ne(V,N,"object stop key must have zoom")];if(N[0].value===void 0)return[new ne(V,N,"object stop key must have value")];if(d&&d>gi(N[0].zoom))return[new ne(V,N[0].zoom,"stop zoom values must appear in ascending order")];gi(N[0].zoom)!==d&&(d=gi(N[0].zoom),l=void 0,p={}),R=R.concat(In({key:`${V}[0]`,value:N[0],valueSpec:{zoom:{}},validateSpec:I.validateSpec,style:I.style,styleSpec:I.styleSpec,objectElementValidators:{zoom:uo,value:z}}))}else R=R.concat(z({key:`${V}[0]`,value:N[0],validateSpec:I.validateSpec,style:I.style,styleSpec:I.styleSpec},N));return Dc(Br(N[1]))?R.concat([new ne(`${V}[1]`,N[1],"expressions are not allowed in function stops.")]):R.concat(I.validateSpec({key:`${V}[1]`,value:N[1],valueSpec:t,validateSpec:I.validateSpec,style:I.style,styleSpec:I.styleSpec}))}function z(I,R){const N=Ye(I.value),V=gi(I.value),$=I.value!==null?I.value:R;if(o){if(N!==o)return[new ne(I.key,$,`${N} stop domain type must match previous stop domain type ${o}`)]}else o=N;if(N!=="number"&&N!=="string"&&N!=="boolean")return[new ne(I.key,$,"stop domain value must be a number, string, or boolean")];if(N!=="number"&&i!=="categorical"){let rt=`number expected, ${N} found`;return so(t)&&i===void 0&&(rt+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new ne(I.key,$,rt)]}return i!=="categorical"||N!=="number"||isFinite(V)&&Math.floor(V)===V?i!=="categorical"&&N==="number"&&l!==void 0&&V<l?[new ne(I.key,$,"stop domain values must appear in ascending order")]:(l=V,i==="categorical"&&V in p?[new ne(I.key,$,"stop domain values must be unique")]:(p[V]=!0,[])):[new ne(I.key,$,`integer expected, found ${V}`)]}}function _r(a){const t=(a.expressionContext==="property"?Wo:Bl)(Br(a.value),a.valueSpec);if(t.result==="error")return t.value.map((o=>new ne(`${a.key}${o.key}`,a.value,o.message)));const i=t.value.expression||t.value._styleExpression.expression;if(a.expressionContext==="property"&&a.propertyKey==="text-font"&&!i.outputDefined())return[new ne(a.key,a.value,`Invalid data expression for "${a.propertyKey}". Output values must be contained as literals within the expression.`)];if(a.expressionContext==="property"&&a.propertyType==="layout"&&!os(i))return[new ne(a.key,a.value,'"feature-state" data expressions are not supported with layout properties.')];if(a.expressionContext==="filter"&&!os(i))return[new ne(a.key,a.value,'"feature-state" data expressions are not supported with filters.')];if(a.expressionContext&&a.expressionContext.indexOf("cluster")===0){if(!kl(i,["zoom","feature-state"]))return[new ne(a.key,a.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(a.expressionContext==="cluster-initial"&&!La(i))return[new ne(a.key,a.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function zc(a){const t=a.key,i=a.value,o=Ye(i);return o!=="string"?[new ne(t,i,`color expected, ${o} found`)]:ii.parse(String(i))?[]:[new ne(t,i,`color expected, "${i}" found`)]}function Ls(a){const t=a.key,i=a.value,o=a.valueSpec,l=[];return Array.isArray(o.values)?o.values.indexOf(gi(i))===-1&&l.push(new ne(t,i,`expected one of [${o.values.join(", ")}], ${JSON.stringify(i)} found`)):Object.keys(o.values).indexOf(gi(i))===-1&&l.push(new ne(t,i,`expected one of [${Object.keys(o.values).join(", ")}], ${JSON.stringify(i)} found`)),l}function Pc(a){return Oa(Br(a.value))?_r(ki({},a,{expressionContext:"filter",valueSpec:{value:"boolean"}})):ho(a)}function ho(a){const t=a.value,i=a.key;if(Ye(t)!=="array")return[new ne(i,t,`array expected, ${Ye(t)} found`)];const o=a.styleSpec;let l,d=[];if(t.length<1)return[new ne(i,t,"filter array must have at least 1 element")];switch(d=d.concat(Ls({key:`${i}[0]`,value:t[0],valueSpec:o.filter_operator,style:a.style,styleSpec:a.styleSpec})),gi(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&gi(t[1])==="$type"&&d.push(new ne(i,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&d.push(new ne(i,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(l=Ye(t[1]),l!=="string"&&d.push(new ne(`${i}[1]`,t[1],`string expected, ${l} found`)));for(let p=2;p<t.length;p++)l=Ye(t[p]),gi(t[1])==="$type"?d=d.concat(Ls({key:`${i}[${p}]`,value:t[p],valueSpec:o.geometry_type,style:a.style,styleSpec:a.styleSpec})):l!=="string"&&l!=="number"&&l!=="boolean"&&d.push(new ne(`${i}[${p}]`,t[p],`string, number, or boolean expected, ${l} found`));break;case"any":case"all":case"none":for(let p=1;p<t.length;p++)d=d.concat(ho({key:`${i}[${p}]`,value:t[p],style:a.style,styleSpec:a.styleSpec}));break;case"has":case"!has":l=Ye(t[1]),t.length!==2?d.push(new ne(i,t,`filter array for "${t[0]}" operator must have 2 elements`)):l!=="string"&&d.push(new ne(`${i}[1]`,t[1],`string expected, ${l} found`))}return d}function Nr(a,t){const i=a.key,o=a.validateSpec,l=a.style,d=a.styleSpec,p=a.value,y=a.objectKey,x=d[`${t}_${a.layerType}`];if(!x)return[];const T=y.match(/^(.*)-transition$/);if(t==="paint"&&T&&x[T[1]]&&x[T[1]].transition)return o({key:i,value:p,valueSpec:d.transition,style:l,styleSpec:d});const M=a.valueSpec||x[y];if(!M)return[new ne(i,p,`unknown property "${y}"`)];let A;if(Ye(p)==="string"&&so(M)&&!M.tokens&&(A=/^{([^}]+)}$/.exec(p)))return[new ne(i,p,`"${y}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(A[1])} }\`.`)];const z=[];return a.layerType==="symbol"&&y==="text-font"&&Ps(Br(p))&&gi(p.type)==="identity"&&z.push(new ne(i,p,'"text-font" does not support identity functions')),z.concat(o({key:a.key,value:p,valueSpec:M,style:l,styleSpec:d,expressionContext:"property",propertyType:t,propertyKey:y}))}function us(a){return Nr(a,"paint")}function rr(a){return Nr(a,"layout")}function ku(a){let t=[];const i=a.value,o=a.key,l=a.style,d=a.styleSpec;if(Ye(i)!=="object")return[new ne(o,i,`object expected, ${Ye(i)} found`)];i.type||i.ref||t.push(new ne(o,i,'either "type" or "ref" is required'));let p=gi(i.type);const y=gi(i.ref);if(i.id){const x=gi(i.id);for(let T=0;T<a.arrayIndex;T++){const M=l.layers[T];gi(M.id)===x&&t.push(new ne(o,i.id,`duplicate layer id "${i.id}", previously used at line ${M.id.__line__}`))}}if("ref"in i){let x;["type","source","source-layer","filter","layout"].forEach((T=>{T in i&&t.push(new ne(o,i[T],`"${T}" is prohibited for ref layers`))})),l.layers.forEach((T=>{gi(T.id)===y&&(x=T)})),x?x.ref?t.push(new ne(o,i.ref,"ref cannot reference another ref layer")):p=gi(x.type):t.push(new ne(o,i.ref,`ref layer "${y}" not found`))}else if(p!=="background")if(i.source){const x=l.sources&&l.sources[i.source],T=x&&gi(x.type);x?T==="vector"&&p==="raster"?t.push(new ne(o,i.source,`layer "${i.id}" requires a raster source`)):T!=="raster-dem"&&p==="hillshade"||T!=="raster-dem"&&p==="color-relief"?t.push(new ne(o,i.source,`layer "${i.id}" requires a raster-dem source`)):T==="raster"&&p!=="raster"?t.push(new ne(o,i.source,`layer "${i.id}" requires a vector source`)):T!=="vector"||i["source-layer"]?T==="raster-dem"&&p!=="hillshade"&&p!=="color-relief"?t.push(new ne(o,i.source,"raster-dem source can only be used with layer type 'hillshade' or 'color-relief'.")):p!=="line"||!i.paint||!i.paint["line-gradient"]||T==="geojson"&&x.lineMetrics||t.push(new ne(o,i,`layer "${i.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new ne(o,i,`layer "${i.id}" must specify a "source-layer"`)):t.push(new ne(o,i.source,`source "${i.source}" not found`))}else t.push(new ne(o,i,'missing required property "source"'));return t=t.concat(In({key:o,value:i,valueSpec:d.layer,style:a.style,styleSpec:a.styleSpec,validateSpec:a.validateSpec,objectElementValidators:{"*":()=>[],type:()=>a.validateSpec({key:`${o}.type`,value:i.type,valueSpec:d.layer.type,style:a.style,styleSpec:a.styleSpec,validateSpec:a.validateSpec,object:i,objectKey:"type"}),filter:Pc,layout:x=>In({layer:i,key:x.key,value:x.value,style:x.style,styleSpec:x.styleSpec,validateSpec:x.validateSpec,objectElementValidators:{"*":T=>rr(ki({layerType:p},T))}}),paint:x=>In({layer:i,key:x.key,value:x.value,style:x.style,styleSpec:x.styleSpec,validateSpec:x.validateSpec,objectElementValidators:{"*":T=>us(ki({layerType:p},T))}})}})),t}function hs(a){const t=a.value,i=a.key,o=Ye(t);return o!=="string"?[new ne(i,t,`string expected, ${o} found`)]:[]}const fo={promoteId:function({key:a,value:t}){if(Ye(t)==="string")return hs({key:a,value:t});{const i=[];for(const o in t)i.push(...hs({key:`${a}.${o}`,value:t[o]}));return i}}};function Ic(a){const t=a.value,i=a.key,o=a.styleSpec,l=a.style,d=a.validateSpec;if(!t.type)return[new ne(i,t,'"type" is required')];const p=gi(t.type);let y;switch(p){case"vector":case"raster":return y=In({key:i,value:t,valueSpec:o[`source_${p.replace("-","_")}`],style:a.style,styleSpec:o,objectElementValidators:fo,validateSpec:d}),y;case"raster-dem":return y=(function(x){var T;const M=(T=x.sourceName)!==null&&T!==void 0?T:"",A=x.value,z=x.styleSpec,I=z.source_raster_dem,R=x.style;let N=[];const V=Ye(A);if(A===void 0)return N;if(V!=="object")return N.push(new ne("source_raster_dem",A,`object expected, ${V} found`)),N;const $=gi(A.encoding)==="custom",rt=["redFactor","greenFactor","blueFactor","baseShift"],K=x.value.encoding?`"${x.value.encoding}"`:"Default";for(const tt in A)!$&&rt.includes(tt)?N.push(new ne(tt,A[tt],`In "${M}": "${tt}" is only valid when "encoding" is set to "custom". ${K} encoding found`)):I[tt]?N=N.concat(x.validateSpec({key:tt,value:A[tt],valueSpec:I[tt],validateSpec:x.validateSpec,style:R,styleSpec:z})):N.push(new ne(tt,A[tt],`unknown property "${tt}"`));return N})({sourceName:i,value:t,style:a.style,styleSpec:o,validateSpec:d}),y;case"geojson":if(y=In({key:i,value:t,valueSpec:o.source_geojson,style:l,styleSpec:o,validateSpec:d,objectElementValidators:fo}),t.cluster)for(const x in t.clusterProperties){const[T,M]=t.clusterProperties[x],A=typeof T=="string"?[T,["accumulated"],["get",x]]:T;y.push(..._r({key:`${i}.${x}.map`,value:M,expressionContext:"cluster-map"})),y.push(..._r({key:`${i}.${x}.reduce`,value:A,expressionContext:"cluster-reduce"}))}return y;case"video":return In({key:i,value:t,valueSpec:o.source_video,style:l,validateSpec:d,styleSpec:o});case"image":return In({key:i,value:t,valueSpec:o.source_image,style:l,validateSpec:d,styleSpec:o});case"canvas":return[new ne(i,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Ls({key:`${i}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function ks(a){const t=a.value,i=a.styleSpec,o=i.light,l=a.style;let d=[];const p=Ye(t);if(t===void 0)return d;if(p!=="object")return d=d.concat([new ne("light",t,`object expected, ${p} found`)]),d;for(const y in t){const x=y.match(/^(.*)-transition$/);d=d.concat(x&&o[x[1]]&&o[x[1]].transition?a.validateSpec({key:y,value:t[y],valueSpec:i.transition,validateSpec:a.validateSpec,style:l,styleSpec:i}):o[y]?a.validateSpec({key:y,value:t[y],valueSpec:o[y],validateSpec:a.validateSpec,style:l,styleSpec:i}):[new ne(y,t[y],`unknown property "${y}"`)])}return d}function $n(a){const t=a.value,i=a.styleSpec,o=i.sky,l=a.style,d=Ye(t);if(t===void 0)return[];if(d!=="object")return[new ne("sky",t,`object expected, ${d} found`)];let p=[];for(const y in t)p=p.concat(o[y]?a.validateSpec({key:y,value:t[y],valueSpec:o[y],style:l,styleSpec:i}):[new ne(y,t[y],`unknown property "${y}"`)]);return p}function Os(a){const t=a.value,i=a.styleSpec,o=i.terrain,l=a.style;let d=[];const p=Ye(t);if(t===void 0)return d;if(p!=="object")return d=d.concat([new ne("terrain",t,`object expected, ${p} found`)]),d;for(const y in t)d=d.concat(o[y]?a.validateSpec({key:y,value:t[y],valueSpec:o[y],validateSpec:a.validateSpec,style:l,styleSpec:i}):[new ne(y,t[y],`unknown property "${y}"`)]);return d}function jh(a){let t=[];const i=a.value,o=a.key;if(Array.isArray(i)){const l=[],d=[];for(const p in i)i[p].id&&l.includes(i[p].id)&&t.push(new ne(o,i,`all the sprites' ids must be unique, but ${i[p].id} is duplicated`)),l.push(i[p].id),i[p].url&&d.includes(i[p].url)&&t.push(new ne(o,i,`all the sprites' URLs must be unique, but ${i[p].url} is duplicated`)),d.push(i[p].url),t=t.concat(In({key:`${o}[${p}]`,value:i[p],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:a.validateSpec}));return t}return hs({key:o,value:i})}function qd(a){return t=a.value,t&&t.constructor===Object?[]:[new ne(a.key,a.value,`object expected, ${Ye(a.value)} found`)];var t}const Zd={"*":()=>[],array:jl,boolean:function(a){const t=a.value,i=a.key,o=Ye(t);return o!=="boolean"?[new ne(i,t,`boolean expected, ${o} found`)]:[]},number:uo,color:zc,constants:cs,enum:Ls,filter:Pc,function:Qo,layer:ku,object:In,source:Ic,light:ks,sky:$n,terrain:Os,projection:function(a){const t=a.value,i=a.styleSpec,o=i.projection,l=a.style,d=Ye(t);if(t===void 0)return[];if(d!=="object")return[new ne("projection",t,`object expected, ${d} found`)];let p=[];for(const y in t)p=p.concat(o[y]?a.validateSpec({key:y,value:t[y],valueSpec:o[y],style:l,styleSpec:i}):[new ne(y,t[y],`unknown property "${y}"`)]);return p},projectionDefinition:function(a){const t=a.key;let i=a.value;i=i instanceof String?i.valueOf():i;const o=Ye(i);return o!=="array"||(function(l){return Array.isArray(l)&&l.length===3&&typeof l[0]=="string"&&typeof l[1]=="string"&&typeof l[2]=="number"})(i)||(function(l){return!!["interpolate","step","literal"].includes(l[0])})(i)?["array","string"].includes(o)?[]:[new ne(t,i,`projection expected, invalid type "${o}" found`)]:[new ne(t,i,`projection expected, invalid array ${JSON.stringify(i)} found`)]},string:hs,formatted:function(a){return hs(a).length===0?[]:_r(a)},resolvedImage:function(a){return hs(a).length===0?[]:_r(a)},padding:function(a){const t=a.key,i=a.value;if(Ye(i)==="array"){if(i.length<1||i.length>4)return[new ne(t,i,`padding requires 1 to 4 values; ${i.length} values found`)];const o={type:"number"};let l=[];for(let d=0;d<i.length;d++)l=l.concat(a.validateSpec({key:`${t}[${d}]`,value:i[d],validateSpec:a.validateSpec,valueSpec:o}));return l}return uo({key:t,value:i,valueSpec:{}})},numberArray:function(a){const t=a.key,i=a.value;if(Ye(i)==="array"){const o={type:"number"};if(i.length<1)return[new ne(t,i,"array length at least 1 expected, length 0 found")];let l=[];for(let d=0;d<i.length;d++)l=l.concat(a.validateSpec({key:`${t}[${d}]`,value:i[d],validateSpec:a.validateSpec,valueSpec:o}));return l}return uo({key:t,value:i,valueSpec:{}})},colorArray:function(a){const t=a.key,i=a.value;if(Ye(i)==="array"){if(i.length<1)return[new ne(t,i,"array length at least 1 expected, length 0 found")];let o=[];for(let l=0;l<i.length;l++)o=o.concat(zc({key:`${t}[${l}]`,value:i[l]}));return o}return zc({key:t,value:i})},variableAnchorOffsetCollection:function(a){const t=a.key,i=a.value,o=Ye(i),l=a.styleSpec;if(o!=="array"||i.length<1||i.length%2!=0)return[new ne(t,i,"variableAnchorOffsetCollection requires a non-empty array of even length")];let d=[];for(let p=0;p<i.length;p+=2)d=d.concat(Ls({key:`${t}[${p}]`,value:i[p],valueSpec:l.layout_symbol["text-anchor"]})),d=d.concat(jl({key:`${t}[${p+1}]`,value:i[p+1],valueSpec:{length:2,value:"number"},validateSpec:a.validateSpec,style:a.style,styleSpec:l}));return d},sprite:jh,state:qd};function Ou(a){const t=a.value,i=a.valueSpec,o=a.styleSpec;return a.validateSpec=Ou,i.expression&&Ps(gi(t))?Qo(a):i.expression&&Dc(Br(t))?_r(a):i.type&&Zd[i.type]?Zd[i.type](a):In(ki({},a,{valueSpec:i.type?o[i.type]:i}))}function Rn(a){const t=a.value,i=a.key,o=hs(a);return o.length||(t.indexOf("{fontstack}")===-1&&o.push(new ne(i,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&o.push(new ne(i,t,'"glyphs" url must include a "{range}" token'))),o}function Ya(a,t=J){let i=[];return i=i.concat(Ou({key:"",value:a,valueSpec:t.$root,styleSpec:t,style:a,validateSpec:Ou,objectElementValidators:{glyphs:Rn,"*":()=>[]}})),a.constants&&(i=i.concat(cs({key:"constants",value:a.constants}))),ds(i)}function Xn(a){return function(t){return a(Object.assign({},t,{validateSpec:Ou}))}}function ds(a){return[].concat(a).sort(((t,i)=>t.line-i.line))}function en(a){return function(...t){return ds(a.apply(this,t))}}Ya.source=en(Xn(Ic)),Ya.sprite=en(Xn(jh)),Ya.glyphs=en(Xn(Rn)),Ya.light=en(Xn(ks)),Ya.sky=en(Xn($n)),Ya.terrain=en(Xn(Os)),Ya.state=en(Xn(qd)),Ya.layer=en(Xn(ku)),Ya.filter=en(Xn(Pc)),Ya.paintProperty=en(Xn(us)),Ya.layoutProperty=en(Xn(rr));const fs=J,yr=Ya,jf=yr.light,Hd=yr.sky,Rc=yr.paintProperty,Vh=yr.layoutProperty;function ps(a,t){let i=!1;if(t&&t.length)for(const o of t)a.fire(new ut(new Error(o.message))),i=!0;return i}class Jo{constructor(t,i,o){const l=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;const p=new Int32Array(this.arrayBuffer);t=p[0],this.d=(i=p[1])+2*(o=p[2]);for(let x=0;x<this.d*this.d;x++){const T=p[3+x],M=p[3+x+1];l.push(T===M?null:p.subarray(T,M))}const y=p[3+l.length+1];this.keys=p.subarray(p[3+l.length],y),this.bboxes=p.subarray(y),this.insert=this._insertReadonly}else{this.d=i+2*o;for(let p=0;p<this.d*this.d;p++)l.push([]);this.keys=[],this.bboxes=[]}this.n=i,this.extent=t,this.padding=o,this.scale=i/t,this.uid=0;const d=o/i*t;this.min=-d,this.max=t+d}insert(t,i,o,l,d){this._forEachCell(i,o,l,d,this._insertCell,this.uid++,void 0,void 0),this.keys.push(t),this.bboxes.push(i),this.bboxes.push(o),this.bboxes.push(l),this.bboxes.push(d)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(t,i,o,l,d,p){this.cells[d].push(p)}query(t,i,o,l,d){const p=this.min,y=this.max;if(t<=p&&i<=p&&y<=o&&y<=l&&!d)return Array.prototype.slice.call(this.keys);{const x=[];return this._forEachCell(t,i,o,l,this._queryCell,x,{},d),x}}_queryCell(t,i,o,l,d,p,y,x){const T=this.cells[d];if(T!==null){const M=this.keys,A=this.bboxes;for(let z=0;z<T.length;z++){const I=T[z];if(y[I]===void 0){const R=4*I;(x?x(A[R+0],A[R+1],A[R+2],A[R+3]):t<=A[R+2]&&i<=A[R+3]&&o>=A[R+0]&&l>=A[R+1])?(y[I]=!0,p.push(M[I])):y[I]=!1}}}}_forEachCell(t,i,o,l,d,p,y,x){const T=this._convertToCellCoord(t),M=this._convertToCellCoord(i),A=this._convertToCellCoord(o),z=this._convertToCellCoord(l);for(let I=T;I<=A;I++)for(let R=M;R<=z;R++){const N=this.d*R+I;if((!x||x(this._convertFromCellCoord(I),this._convertFromCellCoord(R),this._convertFromCellCoord(I+1),this._convertFromCellCoord(R+1)))&&d.call(this,t,i,o,l,N,p,y,x))return}}_convertFromCellCoord(t){return(t-this.padding)/this.scale}_convertToCellCoord(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const t=this.cells,i=3+this.cells.length+1+1;let o=0;for(let p=0;p<this.cells.length;p++)o+=this.cells[p].length;const l=new Int32Array(i+o+this.keys.length+this.bboxes.length);l[0]=this.extent,l[1]=this.n,l[2]=this.padding;let d=i;for(let p=0;p<t.length;p++){const y=t[p];l[3+p]=d,l.set(y,d),d+=y.length}return l[3+t.length]=d,l.set(this.keys,d),d+=this.keys.length,l[3+t.length+1]=d,l.set(this.bboxes,d),d+=this.bboxes.length,l.buffer}static serialize(t,i){const o=t.toArrayBuffer();return i&&i.push(o),{buffer:o}}static deserialize(t){return new Jo(t.buffer)}}const Wa={};function ge(a,t,i={}){if(Wa[a])throw new Error(`${a} is already registered.`);Object.defineProperty(t,"_classRegistryKey",{value:a,writeable:!1}),Wa[a]={klass:t,omit:i.omit||[],shallow:i.shallow||[]}}ge("Object",Object),ge("Set",Set),ge("TransferableGridIndex",Jo),ge("Color",ii),ge("Error",Error),ge("AJAXError",za),ge("ResolvedImage",Tn),ge("StylePropertyFunction",Is),ge("StyleExpression",Ol,{omit:["_evaluator"]}),ge("ZoomDependentExpression",ka),ge("ZoomConstantExpression",lo),ge("CompoundExpression",gr,{omit:["_evaluate"]});for(const a in Ll)Ll[a]._classRegistryKey||ge(`Expression_${a}`,Ll[a]);function Fr(a){return a&&typeof ArrayBuffer<"u"&&(a instanceof ArrayBuffer||a.constructor&&a.constructor.name==="ArrayBuffer")}function Lc(a){return a.$name||a.constructor._classRegistryKey}function kc(a){return!(function(t){if(t===null||typeof t!="object")return!1;const i=Lc(t);return!(!i||i==="Object")})(a)&&(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp||a instanceof Blob||a instanceof Error||Fr(a)||Cn(a)||ArrayBuffer.isView(a)||a instanceof ImageData)}function po(a,t){if(kc(a))return(Fr(a)||Cn(a))&&t&&t.push(a),ArrayBuffer.isView(a)&&t&&t.push(a.buffer),a instanceof ImageData&&t&&t.push(a.data.buffer),a;if(Array.isArray(a)){const d=[];for(const p of a)d.push(po(p,t));return d}if(typeof a!="object")throw new Error("can't serialize object of type "+typeof a);const i=Lc(a);if(!i)throw new Error(`can't serialize object of unregistered class ${a.constructor.name}`);if(!Wa[i])throw new Error(`${i} is not registered.`);const{klass:o}=Wa[i],l=o.serialize?o.serialize(a,t):{};if(o.serialize){if(t&&l===t[t.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const d in a){if(!a.hasOwnProperty(d)||Wa[i].omit.indexOf(d)>=0)continue;const p=a[d];l[d]=Wa[i].shallow.indexOf(d)>=0?p:po(p,t)}a instanceof Error&&(l.message=a.message)}if(l.$name)throw new Error("$name property is reserved for worker serialization logic.");return i!=="Object"&&(l.$name=i),l}function ms(a){if(kc(a))return a;if(Array.isArray(a))return a.map(ms);if(typeof a!="object")throw new Error("can't deserialize object of type "+typeof a);const t=Lc(a)||"Object";if(!Wa[t])throw new Error(`can't deserialize unregistered class ${t}`);const{klass:i}=Wa[t];if(!i)throw new Error(`can't deserialize unregistered class ${t}`);if(i.deserialize)return i.deserialize(a);const o=Object.create(i.prototype);for(const l of Object.keys(a)){if(l==="$name")continue;const d=a[l];o[l]=Wa[t].shallow.indexOf(l)>=0?d:ms(d)}return o}class Bu{constructor(){this.first=!0}update(t,i){const o=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=o,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=o,!0):(this.lastFloorZoom>o?(this.lastIntegerZoom=o+1,this.lastIntegerZoomTime=i):this.lastFloorZoom<o&&(this.lastIntegerZoom=o,this.lastIntegerZoomTime=i),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=o,!0))}}function tl(a){return/[\u02EA\u02EB\u2E80-\u2FDF\u2FF0-\u303F\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FD-\u30FF\u3105-\u312F\u31A0-\u4DBF\u4E00-\uA48C\uA490-\uA4C6\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE4F\uFF00-\uFFEF]|\uD81B[\uDFE0-\uDFFF]|[\uD81C-\uD822\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFFF]|\uD82C[\uDC00-\uDEFB]|\uD83C[\uDE00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(a))}function vr(a){return/[\u02EA\u02EB\u1100-\u11FF\u1400-\u167F\u18B0-\u18F5\u2E80-\u2E99\u2E9B-\u2EF3\u2F00-\u2FD5\u2FF0-\u3007\u3012\u3013\u3020-\u302F\u3031-\u303F\u3041-\u3096\u309D-\u30FB\u30FD-\u30FF\u3105-\u312F\u3131-\u318E\u3190-\uA48C\uA490-\uA4C6\uA960-\uA97C\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE48\uFE50-\uFE57\uFE5F-\uFE62\uFE67-\uFE6F\uFF00-\uFF07\uFF0A-\uFF0C\uFF0E-\uFF19\uFF1F-\uFF3A\uFF3C\uFF3E\uFF40-\uFF5A\uFFE0-\uFFE2\uFFE4-\uFFE7]|\uD802[\uDD80-\uDD9F]|\uD805[\uDD80-\uDDFF]|\uD806[\uDE00-\uDEBF]|\uD811[\uDC00-\uDE7F]|\uD81B[\uDFE0-\uDFE4\uDFF0-\uDFF6]|[\uD81C-\uD822\uD83D\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFF3\uDFF5-\uDFFB\uDFFD\uDFFE]|\uD82C[\uDC00-\uDD22\uDD30-\uDEFB]|\uD833[\uDEC0-\uDFCF]|\uD834[\uDC00-\uDDFF\uDEE0-\uDF7F]|\uD836[\uDC00-\uDEAF]|\uD83C[\uDC00-\uDE00\uDF00-\uDFFF]|\uD83E[\uDD00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(a))}function Uh(a){return/\s/u.test(String.fromCodePoint(a))}function Vl(a){for(const t of a)if(vr(t.codePointAt(0)))return!0;return!1}function Bs(a){for(const t of a)if(!Ul(t.codePointAt(0)))return!1;return!0}function el(a){const t=a.map((i=>{try{return new RegExp(`\\p{sc=${i}}`,"u").source}catch{return null}})).filter((i=>i));return new RegExp(t.join("|"),"u")}const Oc=el(["Arab","Dupl","Mong","Ougr","Syrc"]);function Ul(a){return!Oc.test(String.fromCodePoint(a))}function Gl(a){return!(vr(a)||(t=a,/[\xA7\xA9\xAE\xB1\xBC-\xBE\xD7\xF7\u2016\u2020\u2021\u2030\u2031\u203B\u203C\u2042\u2047-\u2049\u2051\u2100-\u218F\u221E\u2234\u2235\u2300-\u2307\u230C-\u231F\u2324-\u2328\u232B\u237D-\u239A\u23BE-\u23CD\u23CF\u23D1-\u23DB\u23E2-\u2422\u2424-\u24FF\u25A0-\u2619\u2620-\u2767\u2776-\u2793\u2B12-\u2B2F\u2B50-\u2B59\u2BB8-\u2BEB\u3000-\u303F\u30A0-\u30FF\uE000-\uF8FF\uFE30-\uFE6F\uFF00-\uFFEF\uFFFC\uFFFD]|[\uDB80-\uDBFF][\uDC00-\uDFFF]/gim.test(String.fromCodePoint(t))));var t}const Nu=el(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function Ns(a){return Nu.test(String.fromCodePoint(a))}function $d(a,t){return!(!t&&Ns(a)||/[\u0900-\u0DFF\u0F00-\u109F\u1780-\u17FF]/gim.test(String.fromCodePoint(a)))}function Fs(a){for(const t of a)if(Ns(t.codePointAt(0)))return!0;return!1}const gs=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(a){this.pluginStatus=a.pluginStatus,this.pluginURL=a.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(a){if(gs.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=a.applyArabicShaping,this.processBidirectionalText=a.processBidirectionalText,this.processStyledBidirectionalText=a.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(a,t){return h(this,void 0,void 0,(function*(){if(this.isParsed())return this.getState();if(a.pluginStatus!=="loading")return this.setState(a),a;const i=a.pluginURL,o=new Promise((d=>{this.loadScriptResolve=d}));t(i);const l=new Promise((d=>setTimeout((()=>d()),this.TIMEOUT)));if(yield Promise.race([o,l]),this.isParsed()){const d={pluginStatus:"loaded",pluginURL:i};return this.setState(d),d}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${i}`)}))}};class Mi{constructor(t,i){this.isSupportedScript=mo,this.zoom=t,i?(this.now=i.now||0,this.fadeDuration=i.fadeDuration||0,this.zoomHistory=i.zoomHistory||new Bu,this.transition=i.transition||{}):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Bu,this.transition={})}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const t=this.zoom,i=t-Math.floor(t),o=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:i+(1-i)*o}:{fromScale:.5,toScale:1,t:1-(1-o)*i}}}function mo(a){return(function(t,i){for(const o of t)if(!$d(o.codePointAt(0),i))return!1;return!0})(a,gs.getRTLTextPluginStatus()==="loaded")}const xr="-transition";class js{constructor(t,i,o){this.property=t,this.value=i,this.expression=(function(l,d,p){if(Ps(l))return new Is(l,d);if(Dc(l)){const y=Wo(l,d,p);if(y.result==="error")throw new Error(y.value.map((x=>`${x.key}: ${x.message}`)).join(", "));return y.value}{let y=l;return d.type==="color"&&typeof l=="string"?y=ii.parse(l):d.type!=="padding"||typeof l!="number"&&!Array.isArray(l)?d.type!=="numberArray"||typeof l!="number"&&!Array.isArray(l)?d.type!=="colorArray"||typeof l!="string"&&!Array.isArray(l)?d.type==="variableAnchorOffsetCollection"&&Array.isArray(l)?y=Hn.parse(l):d.type==="projectionDefinition"&&typeof l=="string"&&(y=aa.parse(l)):y=Bn.parse(l):y=Pn.parse(l):y=zn.parse(l),{globalStateRefs:new Set,_globalState:null,kind:"constant",evaluate:()=>y}}})(i===void 0?t.specification.default:i,t.specification,o)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}getGlobalStateRefs(){return this.expression.globalStateRefs||new Set}possiblyEvaluate(t,i,o){return this.property.possiblyEvaluate(this,t,i,o)}}class Bc{constructor(t,i){this.property=t,this.value=new js(t,void 0,i)}transitioned(t,i){return new il(this.property,this.value,i,Ke({},t.transition,this.transition),t.now)}untransitioned(){return new il(this.property,this.value,null,{},0)}}class Fu{constructor(t,i){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues),this._globalState=i}getValue(t){return qe(this._values[t].value.value)}setValue(t,i){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new Bc(this._values[t].property,this._globalState)),this._values[t].value=new js(this._values[t].property,i===null?void 0:qe(i),this._globalState)}getTransition(t){return qe(this._values[t].transition)}setTransition(t,i){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new Bc(this._values[t].property,this._globalState)),this._values[t].transition=qe(i)||void 0}serialize(){const t={};for(const i of Object.keys(this._values)){const o=this.getValue(i);o!==void 0&&(t[i]=o);const l=this.getTransition(i);l!==void 0&&(t[`${i}${xr}`]=l)}return t}transitioned(t,i){const o=new nl(this._properties);for(const l of Object.keys(this._values))o._values[l]=this._values[l].transitioned(t,i._values[l]);return o}untransitioned(){const t=new nl(this._properties);for(const i of Object.keys(this._values))t._values[i]=this._values[i].untransitioned();return t}}class il{constructor(t,i,o,l,d){this.property=t,this.value=i,this.begin=d+l.delay||0,this.end=this.begin+l.duration||0,t.specification.transition&&(l.delay||l.duration)&&(this.prior=o)}possiblyEvaluate(t,i,o){const l=t.now||0,d=this.value.possiblyEvaluate(t,i,o),p=this.prior;if(p){if(l>this.end)return this.prior=null,d;if(this.value.isDataDriven())return this.prior=null,d;if(l<this.begin)return p.possiblyEvaluate(t,i,o);{const y=(l-this.begin)/(this.end-this.begin);return this.property.interpolate(p.possiblyEvaluate(t,i,o),d,_e(y))}}return d}}class nl{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,i,o){const l=new wr(this._properties);for(const d of Object.keys(this._values))l._values[d]=this._values[d].possiblyEvaluate(t,i,o);return l}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class Gh{constructor(t,i){this._properties=t,this._values=Object.create(t.defaultPropertyValues),this._globalState=i}hasValue(t){return this._values[t].value!==void 0}getValue(t){return qe(this._values[t].value)}setValue(t,i){this._values[t]=new js(this._values[t].property,i===null?void 0:qe(i),this._globalState)}serialize(){const t={};for(const i of Object.keys(this._values)){const o=this.getValue(i);o!==void 0&&(t[i]=o)}return t}possiblyEvaluate(t,i,o){const l=new wr(this._properties);for(const d of Object.keys(this._values))l._values[d]=this._values[d].possiblyEvaluate(t,i,o);return l}}class br{constructor(t,i,o){this.property=t,this.value=i,this.parameters=o}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,i,o,l){return this.property.evaluate(this.value,this.parameters,t,i,o,l)}}class wr{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class Se{constructor(t){this.specification=t}possiblyEvaluate(t,i){if(t.isDataDriven())throw new Error("Value should not be data driven");return t.expression.evaluate(i)}interpolate(t,i,o){const l=Rr[this.specification.type];return l?l(t,i,o):t}}class Le{constructor(t,i){this.specification=t,this.overrides=i}possiblyEvaluate(t,i,o,l){return new br(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(i,null,{},o,l)}:t.expression,i)}interpolate(t,i,o){if(t.value.kind!=="constant"||i.value.kind!=="constant")return t;if(t.value.value===void 0||i.value.value===void 0)return new br(this,{kind:"constant",value:void 0},t.parameters);const l=Rr[this.specification.type];if(l){const d=l(t.value.value,i.value.value,o);return new br(this,{kind:"constant",value:d},t.parameters)}return t}evaluate(t,i,o,l,d,p){return t.kind==="constant"?t.value:t.evaluate(i,o,l,d,p)}}class al extends Le{possiblyEvaluate(t,i,o,l){if(t.value===void 0)return new br(this,{kind:"constant",value:void 0},i);if(t.expression.kind==="constant"){const d=t.expression.evaluate(i,null,{},o,l),p=t.property.specification.type==="resolvedImage"&&typeof d!="string"?d.name:d,y=this._calculate(p,p,p,i);return new br(this,{kind:"constant",value:y},i)}if(t.expression.kind==="camera"){const d=this._calculate(t.expression.evaluate({zoom:i.zoom-1}),t.expression.evaluate({zoom:i.zoom}),t.expression.evaluate({zoom:i.zoom+1}),i);return new br(this,{kind:"constant",value:d},i)}return new br(this,t.expression,i)}evaluate(t,i,o,l,d,p){if(t.kind==="source"){const y=t.evaluate(i,o,l,d,p);return this._calculate(y,y,y,i)}return t.kind==="composite"?this._calculate(t.evaluate({zoom:Math.floor(i.zoom)-1},o,l),t.evaluate({zoom:Math.floor(i.zoom)},o,l),t.evaluate({zoom:Math.floor(i.zoom)+1},o,l),i):t.value}_calculate(t,i,o,l){return l.zoom>l.zoomHistory.lastIntegerZoom?{from:t,to:i}:{from:o,to:i}}interpolate(t){return t}}class ju{constructor(t){this.specification=t}possiblyEvaluate(t,i,o,l){if(t.value!==void 0){if(t.expression.kind==="constant"){const d=t.expression.evaluate(i,null,{},o,l);return this._calculate(d,d,d,i)}return this._calculate(t.expression.evaluate(new Mi(Math.floor(i.zoom-1),i)),t.expression.evaluate(new Mi(Math.floor(i.zoom),i)),t.expression.evaluate(new Mi(Math.floor(i.zoom+1),i)),i)}}_calculate(t,i,o,l){return l.zoom>l.zoomHistory.lastIntegerZoom?{from:t,to:i}:{from:o,to:i}}interpolate(t){return t}}class ma{constructor(t){this.specification=t}possiblyEvaluate(t,i,o,l){return!!t.expression.evaluate(i,null,{},o,l)}interpolate(){return!1}}class $i{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const i in t){const o=t[i];o.specification.overridable&&this.overridableProperties.push(i);const l=this.defaultPropertyValues[i]=new js(o,void 0,void 0),d=this.defaultTransitionablePropertyValues[i]=new Bc(o,void 0);this.defaultTransitioningPropertyValues[i]=d.untransitioned(),this.defaultPossiblyEvaluatedValues[i]=l.possiblyEvaluate({})}}}ge("DataDrivenProperty",Le),ge("DataConstantProperty",Se),ge("CrossFadedDataDrivenProperty",al),ge("CrossFadedProperty",ju),ge("ColorRampProperty",ma);class Yn extends Et{constructor(t,i,o){if(super(),this.id=t.id,this.type=t.type,this._globalState=o,this._featureFilter={filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set},t.type!=="custom"&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type!=="background"&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter,this._featureFilter=Xa(t.filter,o)),i.layout&&(this._unevaluatedLayout=new Gh(i.layout,o)),i.paint)){this._transitionablePaint=new Fu(i.paint,o);for(const l in t.paint)this.setPaintProperty(l,t.paint[l],{validate:!1});for(const l in t.layout)this.setLayoutProperty(l,t.layout[l],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new wr(i.paint)}}setFilter(t){this.filter=t,this._featureFilter=Xa(t,this._globalState)}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}getLayoutAffectingGlobalStateRefs(){const t=new Set;if(this._unevaluatedLayout)for(const i in this._unevaluatedLayout._values){const o=this._unevaluatedLayout._values[i];for(const l of o.getGlobalStateRefs())t.add(l)}for(const i of this._featureFilter.getGlobalStateRefs())t.add(i);return t}getPaintAffectingGlobalStateRefs(){var t;const i=new globalThis.Map;if(this._transitionablePaint)for(const o in this._transitionablePaint._values){const l=this._transitionablePaint._values[o].value;for(const d of l.getGlobalStateRefs()){const p=(t=i.get(d))!==null&&t!==void 0?t:[];p.push({name:o,value:l.value}),i.set(d,p)}}return i}setLayoutProperty(t,i,o={}){i!=null&&this._validate(Vh,`layers.${this.id}.layout.${t}`,t,i,o)||(t!=="visibility"?this._unevaluatedLayout.setValue(t,i):this.visibility=i)}getPaintProperty(t){return t.endsWith(xr)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,i,o={}){if(i!=null&&this._validate(Rc,`layers.${this.id}.paint.${t}`,t,i,o))return!1;if(t.endsWith(xr))return this._transitionablePaint.setTransition(t.slice(0,-11),i||void 0),!1;{const l=this._transitionablePaint._values[t],d=l.property.specification["property-type"]==="cross-faded-data-driven",p=l.value.isDataDriven(),y=l.value;this._transitionablePaint.setValue(t,i),this._handleSpecialPaintPropertyUpdate(t);const x=this._transitionablePaint._values[t].value;return x.isDataDriven()||p||d||this._handleOverridablePaintPropertyUpdate(t,y,x)}}_handleSpecialPaintPropertyUpdate(t){}_handleOverridablePaintPropertyUpdate(t,i,o){return!1}isHidden(t,i=!1){return!!(this.minzoom&&t<(i?Math.floor(this.minzoom):this.minzoom))||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,i){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,i)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,i)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),Qe(t,((i,o)=>!(i===void 0||o==="layout"&&!Object.keys(i).length||o==="paint"&&!Object.keys(i).length)))}_validate(t,i,o,l,d={}){return(!d||d.validate!==!1)&&ps(this,t.call(yr,{key:i,layerType:this.type,objectKey:o,value:l,styleSpec:J,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const i=this.paint.get(t);if(i instanceof br&&so(i.property.specification)&&(i.value.kind==="source"||i.value.kind==="composite")&&i.value.isStateDependent)return!0}return!1}}let Vu;var Xd={get paint(){return Vu=Vu||new $i({"raster-opacity":new Se(J.paint_raster["raster-opacity"]),"raster-hue-rotate":new Se(J.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Se(J.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Se(J.paint_raster["raster-brightness-max"]),"raster-saturation":new Se(J.paint_raster["raster-saturation"]),"raster-contrast":new Se(J.paint_raster["raster-contrast"]),"raster-resampling":new Se(J.paint_raster["raster-resampling"]),"raster-fade-duration":new Se(J.paint_raster["raster-fade-duration"])})}};class go extends Yn{constructor(t,i){super(t,Xd,i)}}const sr={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class nn{constructor(t,i){this._structArray=t,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Ti{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,i){return t._trim(),i&&(t.isTransferred=!0,i.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const i=Object.create(this.prototype);return i.arrayBuffer=t.arrayBuffer,i.length=t.length,i.capacity=t.arrayBuffer.byteLength/i.bytesPerElement,i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function zi(a,t=1){let i=0,o=0;return{members:a.map((l=>{const d=sr[l.type].BYTES_PER_ELEMENT,p=i=We(i,Math.max(t,d)),y=l.components||1;return o=Math.max(o,d),i+=d*y,{name:l.name,type:l.type,components:y,offset:p}})),size:We(i,Math.max(o,t)),alignment:t}}function We(a,t){return Math.ceil(a/t)*t}class Si extends Ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i){const o=this.length;return this.resize(o+1),this.emplace(o,t,i)}emplace(t,i,o){const l=2*t;return this.int16[l+0]=i,this.int16[l+1]=o,t}}Si.prototype.bytesPerElement=4,ge("StructArrayLayout2i4",Si);class ln extends Ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,o){const l=this.length;return this.resize(l+1),this.emplace(l,t,i,o)}emplace(t,i,o,l){const d=3*t;return this.int16[d+0]=i,this.int16[d+1]=o,this.int16[d+2]=l,t}}ln.prototype.bytesPerElement=6,ge("StructArrayLayout3i6",ln);class ql extends Ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,o,l){const d=this.length;return this.resize(d+1),this.emplace(d,t,i,o,l)}emplace(t,i,o,l,d){const p=4*t;return this.int16[p+0]=i,this.int16[p+1]=o,this.int16[p+2]=l,this.int16[p+3]=d,t}}ql.prototype.bytesPerElement=8,ge("StructArrayLayout4i8",ql);class _o extends Ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,o,l,d,p){const y=this.length;return this.resize(y+1),this.emplace(y,t,i,o,l,d,p)}emplace(t,i,o,l,d,p,y){const x=6*t;return this.int16[x+0]=i,this.int16[x+1]=o,this.int16[x+2]=l,this.int16[x+3]=d,this.int16[x+4]=p,this.int16[x+5]=y,t}}_o.prototype.bytesPerElement=12,ge("StructArrayLayout2i4i12",_o);class Ba extends Ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,o,l,d,p){const y=this.length;return this.resize(y+1),this.emplace(y,t,i,o,l,d,p)}emplace(t,i,o,l,d,p,y){const x=4*t,T=8*t;return this.int16[x+0]=i,this.int16[x+1]=o,this.uint8[T+4]=l,this.uint8[T+5]=d,this.uint8[T+6]=p,this.uint8[T+7]=y,t}}Ba.prototype.bytesPerElement=8,ge("StructArrayLayout2i4ub8",Ba);class Vs extends Ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i){const o=this.length;return this.resize(o+1),this.emplace(o,t,i)}emplace(t,i,o){const l=2*t;return this.float32[l+0]=i,this.float32[l+1]=o,t}}Vs.prototype.bytesPerElement=8,ge("StructArrayLayout2f8",Vs);class Us extends Ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,o,l,d,p,y,x,T,M){const A=this.length;return this.resize(A+1),this.emplace(A,t,i,o,l,d,p,y,x,T,M)}emplace(t,i,o,l,d,p,y,x,T,M,A){const z=10*t;return this.uint16[z+0]=i,this.uint16[z+1]=o,this.uint16[z+2]=l,this.uint16[z+3]=d,this.uint16[z+4]=p,this.uint16[z+5]=y,this.uint16[z+6]=x,this.uint16[z+7]=T,this.uint16[z+8]=M,this.uint16[z+9]=A,t}}Us.prototype.bytesPerElement=20,ge("StructArrayLayout10ui20",Us);class Gs extends Ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,o,l,d,p,y,x){const T=this.length;return this.resize(T+1),this.emplace(T,t,i,o,l,d,p,y,x)}emplace(t,i,o,l,d,p,y,x,T){const M=8*t;return this.uint16[M+0]=i,this.uint16[M+1]=o,this.uint16[M+2]=l,this.uint16[M+3]=d,this.uint16[M+4]=p,this.uint16[M+5]=y,this.uint16[M+6]=x,this.uint16[M+7]=T,t}}Gs.prototype.bytesPerElement=16,ge("StructArrayLayout8ui16",Gs);class Nc extends Ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,o,l,d,p,y,x,T,M,A,z){const I=this.length;return this.resize(I+1),this.emplace(I,t,i,o,l,d,p,y,x,T,M,A,z)}emplace(t,i,o,l,d,p,y,x,T,M,A,z,I){const R=12*t;return this.int16[R+0]=i,this.int16[R+1]=o,this.int16[R+2]=l,this.int16[R+3]=d,this.uint16[R+4]=p,this.uint16[R+5]=y,this.uint16[R+6]=x,this.uint16[R+7]=T,this.int16[R+8]=M,this.int16[R+9]=A,this.int16[R+10]=z,this.int16[R+11]=I,t}}Nc.prototype.bytesPerElement=24,ge("StructArrayLayout4i4ui4i24",Nc);class cn extends Ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,o){const l=this.length;return this.resize(l+1),this.emplace(l,t,i,o)}emplace(t,i,o,l){const d=3*t;return this.float32[d+0]=i,this.float32[d+1]=o,this.float32[d+2]=l,t}}cn.prototype.bytesPerElement=12,ge("StructArrayLayout3f12",cn);class yo extends Ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const i=this.length;return this.resize(i+1),this.emplace(i,t)}emplace(t,i){return this.uint32[1*t+0]=i,t}}yo.prototype.bytesPerElement=4,ge("StructArrayLayout1ul4",yo);class qs extends Ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,o,l,d,p,y,x,T){const M=this.length;return this.resize(M+1),this.emplace(M,t,i,o,l,d,p,y,x,T)}emplace(t,i,o,l,d,p,y,x,T,M){const A=10*t,z=5*t;return this.int16[A+0]=i,this.int16[A+1]=o,this.int16[A+2]=l,this.int16[A+3]=d,this.int16[A+4]=p,this.int16[A+5]=y,this.uint32[z+3]=x,this.uint16[A+8]=T,this.uint16[A+9]=M,t}}qs.prototype.bytesPerElement=20,ge("StructArrayLayout6i1ul2ui20",qs);class Uu extends Ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,o,l,d,p){const y=this.length;return this.resize(y+1),this.emplace(y,t,i,o,l,d,p)}emplace(t,i,o,l,d,p,y){const x=6*t;return this.int16[x+0]=i,this.int16[x+1]=o,this.int16[x+2]=l,this.int16[x+3]=d,this.int16[x+4]=p,this.int16[x+5]=y,t}}Uu.prototype.bytesPerElement=12,ge("StructArrayLayout2i2i2i12",Uu);class Fc extends Ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,o,l,d){const p=this.length;return this.resize(p+1),this.emplace(p,t,i,o,l,d)}emplace(t,i,o,l,d,p){const y=4*t,x=8*t;return this.float32[y+0]=i,this.float32[y+1]=o,this.float32[y+2]=l,this.int16[x+6]=d,this.int16[x+7]=p,t}}Fc.prototype.bytesPerElement=16,ge("StructArrayLayout2f1f2i16",Fc);class rl extends Ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,o,l,d,p){const y=this.length;return this.resize(y+1),this.emplace(y,t,i,o,l,d,p)}emplace(t,i,o,l,d,p,y){const x=16*t,T=4*t,M=8*t;return this.uint8[x+0]=i,this.uint8[x+1]=o,this.float32[T+1]=l,this.float32[T+2]=d,this.int16[M+6]=p,this.int16[M+7]=y,t}}rl.prototype.bytesPerElement=16,ge("StructArrayLayout2ub2f2i16",rl);class Zl extends Ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,o){const l=this.length;return this.resize(l+1),this.emplace(l,t,i,o)}emplace(t,i,o,l){const d=3*t;return this.uint16[d+0]=i,this.uint16[d+1]=o,this.uint16[d+2]=l,t}}Zl.prototype.bytesPerElement=6,ge("StructArrayLayout3ui6",Zl);class jc extends Ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,o,l,d,p,y,x,T,M,A,z,I,R,N,V,$){const rt=this.length;return this.resize(rt+1),this.emplace(rt,t,i,o,l,d,p,y,x,T,M,A,z,I,R,N,V,$)}emplace(t,i,o,l,d,p,y,x,T,M,A,z,I,R,N,V,$,rt){const K=24*t,tt=12*t,vt=48*t;return this.int16[K+0]=i,this.int16[K+1]=o,this.uint16[K+2]=l,this.uint16[K+3]=d,this.uint32[tt+2]=p,this.uint32[tt+3]=y,this.uint32[tt+4]=x,this.uint16[K+10]=T,this.uint16[K+11]=M,this.uint16[K+12]=A,this.float32[tt+7]=z,this.float32[tt+8]=I,this.uint8[vt+36]=R,this.uint8[vt+37]=N,this.uint8[vt+38]=V,this.uint32[tt+10]=$,this.int16[K+22]=rt,t}}jc.prototype.bytesPerElement=48,ge("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",jc);class Hl extends Ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,o,l,d,p,y,x,T,M,A,z,I,R,N,V,$,rt,K,tt,vt,xt,Lt,Jt,qt,ee,fe,oe){const le=this.length;return this.resize(le+1),this.emplace(le,t,i,o,l,d,p,y,x,T,M,A,z,I,R,N,V,$,rt,K,tt,vt,xt,Lt,Jt,qt,ee,fe,oe)}emplace(t,i,o,l,d,p,y,x,T,M,A,z,I,R,N,V,$,rt,K,tt,vt,xt,Lt,Jt,qt,ee,fe,oe,le){const Zt=32*t,ze=16*t;return this.int16[Zt+0]=i,this.int16[Zt+1]=o,this.int16[Zt+2]=l,this.int16[Zt+3]=d,this.int16[Zt+4]=p,this.int16[Zt+5]=y,this.int16[Zt+6]=x,this.int16[Zt+7]=T,this.uint16[Zt+8]=M,this.uint16[Zt+9]=A,this.uint16[Zt+10]=z,this.uint16[Zt+11]=I,this.uint16[Zt+12]=R,this.uint16[Zt+13]=N,this.uint16[Zt+14]=V,this.uint16[Zt+15]=$,this.uint16[Zt+16]=rt,this.uint16[Zt+17]=K,this.uint16[Zt+18]=tt,this.uint16[Zt+19]=vt,this.uint16[Zt+20]=xt,this.uint16[Zt+21]=Lt,this.uint16[Zt+22]=Jt,this.uint32[ze+12]=qt,this.float32[ze+13]=ee,this.float32[ze+14]=fe,this.uint16[Zt+30]=oe,this.uint16[Zt+31]=le,t}}Hl.prototype.bytesPerElement=64,ge("StructArrayLayout8i15ui1ul2f2ui64",Hl);class sa extends Ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const i=this.length;return this.resize(i+1),this.emplace(i,t)}emplace(t,i){return this.float32[1*t+0]=i,t}}sa.prototype.bytesPerElement=4,ge("StructArrayLayout1f4",sa);class m extends Ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,o){const l=this.length;return this.resize(l+1),this.emplace(l,t,i,o)}emplace(t,i,o,l){const d=3*t;return this.uint16[6*t+0]=i,this.float32[d+1]=o,this.float32[d+2]=l,t}}m.prototype.bytesPerElement=12,ge("StructArrayLayout1ui2f12",m);class e extends Ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,o){const l=this.length;return this.resize(l+1),this.emplace(l,t,i,o)}emplace(t,i,o,l){const d=4*t;return this.uint32[2*t+0]=i,this.uint16[d+2]=o,this.uint16[d+3]=l,t}}e.prototype.bytesPerElement=8,ge("StructArrayLayout1ul2ui8",e);class r extends Ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i){const o=this.length;return this.resize(o+1),this.emplace(o,t,i)}emplace(t,i,o){const l=2*t;return this.uint16[l+0]=i,this.uint16[l+1]=o,t}}r.prototype.bytesPerElement=4,ge("StructArrayLayout2ui4",r);class c extends Ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const i=this.length;return this.resize(i+1),this.emplace(i,t)}emplace(t,i){return this.uint16[1*t+0]=i,t}}c.prototype.bytesPerElement=2,ge("StructArrayLayout1ui2",c);class f extends Ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,o,l){const d=this.length;return this.resize(d+1),this.emplace(d,t,i,o,l)}emplace(t,i,o,l,d){const p=4*t;return this.float32[p+0]=i,this.float32[p+1]=o,this.float32[p+2]=l,this.float32[p+3]=d,t}}f.prototype.bytesPerElement=16,ge("StructArrayLayout4f16",f);class g extends nn{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new et(this.anchorPointX,this.anchorPointY)}}g.prototype.size=20;class v extends qs{get(t){return new g(this,t)}}ge("CollisionBoxArray",v);class w extends nn{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(t){this._structArray.uint8[this._pos1+37]=t}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(t){this._structArray.uint8[this._pos1+38]=t}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(t){this._structArray.uint32[this._pos4+10]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}w.prototype.size=48;class S extends jc{get(t){return new w(this,t)}}ge("PlacedSymbolArray",S);class C extends nn{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(t){this._structArray.uint32[this._pos4+12]=t}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}C.prototype.size=64;class D extends Hl{get(t){return new C(this,t)}}ge("SymbolInstanceArray",D);class k extends sa{getoffsetX(t){return this.float32[1*t+0]}}ge("GlyphOffsetArray",k);class L extends ln{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}ge("SymbolLineVertexArray",L);class j extends nn{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}j.prototype.size=12;class Z extends m{get(t){return new j(this,t)}}ge("TextAnchorOffsetArray",Z);class W extends nn{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}W.prototype.size=8;class Q extends e{get(t){return new W(this,t)}}ge("FeatureIndexArray",Q);class it extends Si{}class st extends Si{}class ht extends Si{}class at extends _o{}class dt extends Ba{}class mt extends Vs{}class ct extends Us{}class Tt extends Gs{}class kt extends Nc{}class zt extends cn{}class It extends yo{}class Rt extends Uu{}class ae extends rl{}class re extends Zl{}class Xt extends r{}const ve=zi([{name:"a_pos",components:2,type:"Int16"}],4),{members:Ge}=ve;class Fe{constructor(t=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=t}prepareSegment(t,i,o,l){const d=this.segments[this.segments.length-1];return t>Fe.MAX_VERTEX_ARRAY_LENGTH&&oi(`Max vertices per segment is ${Fe.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${Fe.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!d||d.vertexLength+t>Fe.MAX_VERTEX_ARRAY_LENGTH||d.sortKey!==l?this.createNewSegment(i,o,l):d}createNewSegment(t,i,o){const l={vertexOffset:t.length,primitiveOffset:i.length,vertexLength:0,primitiveLength:0,vaos:{}};return o!==void 0&&(l.sortKey=o),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(l),l}getOrCreateLatestSegment(t,i,o){return this.prepareSegment(0,t,i,o)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(const t of this.segments)for(const i in t.vaos)t.vaos[i].destroy()}static simpleSegment(t,i,o,l){return new Fe([{vertexOffset:t,primitiveOffset:i,vertexLength:o,primitiveLength:l,vaos:{},sortKey:0}])}}function Xi(a,t){return 256*(a=Ie(Math.floor(a),0,255))+Ie(Math.floor(t),0,255)}Fe.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,ge("SegmentVector",Fe);const Fi=zi([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),an=zi([{name:"a_dasharray_from",components:4,type:"Uint16"},{name:"a_dasharray_to",components:4,type:"Uint16"}]);var Ri,Ln,Wi,_n={exports:{}},yn={exports:{}},Sn={exports:{}},Ta=(function(){if(Wi)return _n.exports;Wi=1;var a=(Ri||(Ri=1,yn.exports=function(i,o){var l,d,p,y,x,T,M,A;for(d=i.length-(l=3&i.length),p=o,x=3432918353,T=461845907,A=0;A<d;)M=255&i.charCodeAt(A)|(255&i.charCodeAt(++A))<<8|(255&i.charCodeAt(++A))<<16|(255&i.charCodeAt(++A))<<24,++A,p=27492+(65535&(y=5*(65535&(p=(p^=M=(65535&(M=(M=(65535&M)*x+(((M>>>16)*x&65535)<<16)&4294967295)<<15|M>>>17))*T+(((M>>>16)*T&65535)<<16)&4294967295)<<13|p>>>19))+((5*(p>>>16)&65535)<<16)&4294967295))+((58964+(y>>>16)&65535)<<16);switch(M=0,l){case 3:M^=(255&i.charCodeAt(A+2))<<16;case 2:M^=(255&i.charCodeAt(A+1))<<8;case 1:p^=M=(65535&(M=(M=(65535&(M^=255&i.charCodeAt(A)))*x+(((M>>>16)*x&65535)<<16)&4294967295)<<15|M>>>17))*T+(((M>>>16)*T&65535)<<16)&4294967295}return p^=i.length,p=2246822507*(65535&(p^=p>>>16))+((2246822507*(p>>>16)&65535)<<16)&4294967295,p=3266489909*(65535&(p^=p>>>13))+((3266489909*(p>>>16)&65535)<<16)&4294967295,(p^=p>>>16)>>>0}),yn.exports),t=(Ln||(Ln=1,Sn.exports=function(i,o){for(var l,d=i.length,p=o^d,y=0;d>=4;)l=1540483477*(65535&(l=255&i.charCodeAt(y)|(255&i.charCodeAt(++y))<<8|(255&i.charCodeAt(++y))<<16|(255&i.charCodeAt(++y))<<24))+((1540483477*(l>>>16)&65535)<<16),p=1540483477*(65535&p)+((1540483477*(p>>>16)&65535)<<16)^(l=1540483477*(65535&(l^=l>>>24))+((1540483477*(l>>>16)&65535)<<16)),d-=4,++y;switch(d){case 3:p^=(255&i.charCodeAt(y+2))<<16;case 2:p^=(255&i.charCodeAt(y+1))<<8;case 1:p=1540483477*(65535&(p^=255&i.charCodeAt(y)))+((1540483477*(p>>>16)&65535)<<16)}return p=1540483477*(65535&(p^=p>>>13))+((1540483477*(p>>>16)&65535)<<16),(p^=p>>>15)>>>0}),Sn.exports);return _n.exports=a,_n.exports.murmur3=a,_n.exports.murmur2=t,_n.exports})(),_s=ft(Ta);class jr{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,i,o,l){this.ids.push(vo(t)),this.positions.push(i,o,l)}getPositions(t){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const i=vo(t);let o=0,l=this.ids.length-1;for(;o<l;){const p=o+l>>1;this.ids[p]>=i?l=p:o=p+1}const d=[];for(;this.ids[o]===i;)d.push({index:this.positions[3*o],start:this.positions[3*o+1],end:this.positions[3*o+2]}),o++;return d}static serialize(t,i){const o=new Float64Array(t.ids),l=new Uint32Array(t.positions);return ys(o,l,0,o.length-1),i&&i.push(o.buffer,l.buffer),{ids:o,positions:l}}static deserialize(t){const i=new jr;return i.ids=t.ids,i.positions=t.positions,i.indexed=!0,i}}function vo(a){const t=+a;return!isNaN(t)&&t<=Number.MAX_SAFE_INTEGER?t:_s(String(a))}function ys(a,t,i,o){for(;i<o;){const l=a[i+o>>1];let d=i-1,p=o+1;for(;;){do d++;while(a[d]<l);do p--;while(a[p]>l);if(d>=p)break;xo(a,d,p),xo(t,3*d,3*p),xo(t,3*d+1,3*p+1),xo(t,3*d+2,3*p+2)}p-i<o-p?(ys(a,t,i,p),i=p+1):(ys(a,t,p+1,o),o=p)}}function xo(a,t,i){const o=a[t];a[t]=a[i],a[i]=o}ge("FeaturePositionMap",jr);class or{constructor(t,i){this.gl=t.gl,this.location=i}}class Vr extends or{constructor(t,i){super(t,i),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class Ka extends or{constructor(t,i){super(t,i),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class vs extends or{constructor(t,i){super(t,i),this.current=ii.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}const sl=new Float32Array(16);function ol(a){return[Xi(255*a.r,255*a.g),Xi(255*a.b,255*a.a)]}class un{constructor(t,i,o){this.value=t,this.uniformNames=i.map((l=>`u_${l}`)),this.type=o}setUniform(t,i,o){t.set(o.constantOr(this.value))}getBinding(t,i,o){return this.type==="color"?new vs(t,i):new Vr(t,i)}}class ji{constructor(t,i){this.uniformNames=i.map((o=>`u_${o}`)),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,i){this.pixelRatioFrom=i.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=i.tlbr,this.patternTo=t.tlbr}setConstantDashPositions(t,i){this.dashTo=[0,t.y,t.height,t.width],this.dashFrom=[0,i.y,i.height,i.width]}setUniform(t,i,o,l){let d=null;l==="u_pattern_to"?d=this.patternTo:l==="u_pattern_from"?d=this.patternFrom:l==="u_dasharray_to"?d=this.dashTo:l==="u_dasharray_from"?d=this.dashFrom:l==="u_pixel_ratio_to"?d=this.pixelRatioTo:l==="u_pixel_ratio_from"&&(d=this.pixelRatioFrom),d!==null&&t.set(d)}getBinding(t,i,o){return o.substr(0,9)==="u_pattern"||o.substr(0,12)==="u_dasharray_"?new Ka(t,i):new Vr(t,i)}}class En{constructor(t,i,o,l){this.expression=t,this.type=o,this.maxValue=0,this.paintVertexAttributes=i.map((d=>({name:`a_${d}`,type:"Float32",components:o==="color"?2:1,offset:0}))),this.paintVertexArray=new l}populatePaintArray(t,i,o){const l=this.paintVertexArray.length,d=this.expression.evaluate(new Mi(0,o),i,{},o.canonical,[],o.formattedSection);this.paintVertexArray.resize(t),this._setPaintValue(l,t,d)}updatePaintArray(t,i,o,l,d){const p=this.expression.evaluate(new Mi(0,d),o,l);this._setPaintValue(t,i,p)}_setPaintValue(t,i,o){if(this.type==="color"){const l=ol(o);for(let d=t;d<i;d++)this.paintVertexArray.emplace(d,l[0],l[1])}else{for(let l=t;l<i;l++)this.paintVertexArray.emplace(l,o);this.maxValue=Math.max(this.maxValue,Math.abs(o))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ci{constructor(t,i,o,l,d,p){this.expression=t,this.uniformNames=i.map((y=>`u_${y}_t`)),this.type=o,this.useIntegerZoom=l,this.zoom=d,this.maxValue=0,this.paintVertexAttributes=i.map((y=>({name:`a_${y}`,type:"Float32",components:o==="color"?4:2,offset:0}))),this.paintVertexArray=new p}populatePaintArray(t,i,o){const l=this.expression.evaluate(new Mi(this.zoom,o),i,{},o.canonical,[],o.formattedSection),d=this.expression.evaluate(new Mi(this.zoom+1,o),i,{},o.canonical,[],o.formattedSection),p=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(p,t,l,d)}updatePaintArray(t,i,o,l,d){const p=this.expression.evaluate(new Mi(this.zoom,d),o,l),y=this.expression.evaluate(new Mi(this.zoom+1,d),o,l);this._setPaintValue(t,i,p,y)}_setPaintValue(t,i,o,l){if(this.type==="color"){const d=ol(o),p=ol(l);for(let y=t;y<i;y++)this.paintVertexArray.emplace(y,d[0],d[1],p[0],p[1])}else{for(let d=t;d<i;d++)this.paintVertexArray.emplace(d,o,l);this.maxValue=Math.max(this.maxValue,Math.abs(o),Math.abs(l))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,i){const o=this.useIntegerZoom?Math.floor(i.zoom):i.zoom,l=Ie(this.expression.interpolationFactor(o,this.zoom,this.zoom+1),0,1);t.set(l)}getBinding(t,i,o){return new Vr(t,i)}}class Zs{constructor(t,i,o,l,d,p){this.expression=t,this.type=i,this.useIntegerZoom=o,this.zoom=l,this.layerId=p,this.zoomInPaintVertexArray=new d,this.zoomOutPaintVertexArray=new d}populatePaintArray(t,i,o){const l=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(l,t,this.getPositionIds(i),o)}updatePaintArray(t,i,o,l,d){this._setPaintValues(t,i,this.getPositionIds(o),d)}_setPaintValues(t,i,o,l){const d=this.getPositions(l);if(!d||!o)return;const p=d[o.min],y=d[o.mid],x=d[o.max];if(p&&y&&x)for(let T=t;T<i;T++)this.emplace(this.zoomInPaintVertexArray,T,y,p),this.emplace(this.zoomOutPaintVertexArray,T,y,x)}upload(t){if(this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer){const i=this.getVertexAttributes();this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,i,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,i,this.expression.isStateDependent)}}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class qh extends Zs{getPositions(t){return t.imagePositions}getPositionIds(t){return t.patterns&&t.patterns[this.layerId]}getVertexAttributes(){return Fi.members}emplace(t,i,o,l){t.emplace(i,o.tlbr[0],o.tlbr[1],o.tlbr[2],o.tlbr[3],l.tlbr[0],l.tlbr[1],l.tlbr[2],l.tlbr[3],o.pixelRatio,l.pixelRatio)}}class $l extends Zs{getPositions(t){return t.dashPositions}getPositionIds(t){return t.dashes&&t.dashes[this.layerId]}getVertexAttributes(){return an.members}emplace(t,i,o,l){t.emplace(i,0,o.y,o.height,o.width,0,l.y,l.height,l.width)}}class Zh{constructor(t,i,o){this.binders={},this._buffers=[];const l=[];for(const d in t.paint._values){if(!o(d))continue;const p=t.paint.get(d);if(!(p instanceof br&&so(p.property.specification)))continue;const y=Yd(d,t.type),x=p.value,T=p.property.specification.type,M=p.property.useIntegerZoom,A=p.property.specification["property-type"],z=A==="cross-faded"||A==="cross-faded-data-driven";if(x.kind==="constant")this.binders[d]=z?new ji(x.value,y):new un(x.value,y,T),l.push(`/u_${d}`);else if(x.kind==="source"||z){const I=xs(d,T,"source");this.binders[d]=z?d==="line-dasharray"?new $l(x,T,M,i,I,t.id):new qh(x,T,M,i,I,t.id):new En(x,y,T,I),l.push(`/a_${d}`)}else{const I=xs(d,T,"composite");this.binders[d]=new Ci(x,y,T,M,i,I),l.push(`/z_${d}`)}}this.cacheKey=l.sort().join("")}getMaxValue(t){const i=this.binders[t];return i instanceof En||i instanceof Ci?i.maxValue:0}populatePaintArrays(t,i,o){for(const l in this.binders){const d=this.binders[l];(d instanceof En||d instanceof Ci||d instanceof Zs)&&d.populatePaintArray(t,i,o)}}setConstantPatternPositions(t,i){for(const o in this.binders){const l=this.binders[o];l instanceof ji&&l.setConstantPatternPositions(t,i)}}setConstantDashPositions(t,i){for(const o in this.binders){const l=this.binders[o];l instanceof ji&&l.setConstantDashPositions(t,i)}}updatePaintArrays(t,i,o,l,d){let p=!1;for(const y in t){const x=i.getPositions(y);for(const T of x){const M=o.feature(T.index);for(const A in this.binders){const z=this.binders[A];if((z instanceof En||z instanceof Ci||z instanceof Zs)&&z.expression.isStateDependent===!0){const I=l.paint.get(A);z.expression=I.value,z.updatePaintArray(T.start,T.end,M,t[y],d),p=!0}}}}return p}defines(){const t=[];for(const i in this.binders){const o=this.binders[i];(o instanceof un||o instanceof ji)&&t.push(...o.uniformNames.map((l=>`#define HAS_UNIFORM_${l}`)))}return t}getBinderAttributes(){const t=[];for(const i in this.binders){const o=this.binders[i];if(o instanceof En||o instanceof Ci)for(let l=0;l<o.paintVertexAttributes.length;l++)t.push(o.paintVertexAttributes[l].name);else if(o instanceof Zs){const l=o.getVertexAttributes();for(const d of l)t.push(d.name)}}return t}getBinderUniforms(){const t=[];for(const i in this.binders){const o=this.binders[i];if(o instanceof un||o instanceof ji||o instanceof Ci)for(const l of o.uniformNames)t.push(l)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,i){const o=[];for(const l in this.binders){const d=this.binders[l];if(d instanceof un||d instanceof ji||d instanceof Ci){for(const p of d.uniformNames)if(i[p]){const y=d.getBinding(t,i[p],p);o.push({name:p,property:l,binding:y})}}}return o}setUniforms(t,i,o,l){for(const{name:d,property:p,binding:y}of i)this.binders[p].setUniform(y,l,o.get(p),d)}updatePaintBuffers(t){this._buffers=[];for(const i in this.binders){const o=this.binders[i];if(t&&o instanceof Zs){const l=t.fromScale===2?o.zoomInPaintVertexBuffer:o.zoomOutPaintVertexBuffer;l&&this._buffers.push(l)}else(o instanceof En||o instanceof Ci)&&o.paintVertexBuffer&&this._buffers.push(o.paintVertexBuffer)}}upload(t){for(const i in this.binders){const o=this.binders[i];(o instanceof En||o instanceof Ci||o instanceof Zs)&&o.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const i=this.binders[t];(i instanceof En||i instanceof Ci||i instanceof Zs)&&i.destroy()}}}class Hs{constructor(t,i,o=()=>!0){this.programConfigurations={};for(const l of t)this.programConfigurations[l.id]=new Zh(l,i,o);this.needsUpload=!1,this._featureMap=new jr,this._bufferOffset=0}populatePaintArrays(t,i,o,l){for(const d in this.programConfigurations)this.programConfigurations[d].populatePaintArrays(t,i,l);i.id!==void 0&&this._featureMap.add(i.id,o,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,i,o,l){for(const d of o)this.needsUpload=this.programConfigurations[d.id].updatePaintArrays(t,this._featureMap,i,d,l)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const i in this.programConfigurations)this.programConfigurations[i].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}function Yd(a,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-dasharray":["dasharray_to","dasharray_from"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[a]||[a.replace(`${t}-`,"").replace(/-/g,"_")]}function xs(a,t,i){const o={color:{source:Vs,composite:f},number:{source:sa,composite:Vs}},l=(function(d){return{"line-pattern":{source:ct,composite:ct},"fill-pattern":{source:ct,composite:ct},"fill-extrusion-pattern":{source:ct,composite:ct},"line-dasharray":{source:Tt,composite:Tt}}[d]})(a);return l&&l[i]||o[t][i]}ge("ConstantBinder",un),ge("CrossFadedConstantBinder",ji),ge("SourceExpressionBinder",En),ge("CrossFadedPatternBinder",qh),ge("CrossFadedDasharrayBinder",$l),ge("CompositeExpressionBinder",Ci),ge("ProgramConfiguration",Zh,{omit:["_buffers"]}),ge("ProgramConfigurationSet",Hs);const Xl=Math.pow(2,14)-1,Gu=-Xl-1;function $s(a){const t=Re/a.extent,i=a.loadGeometry();for(let o=0;o<i.length;o++){const l=i[o];for(let d=0;d<l.length;d++){const p=l[d],y=Math.round(p.x*t),x=Math.round(p.y*t);p.x=Ie(y,Gu,Xl),p.y=Ie(x,Gu,Xl),(y<p.x||y>p.x+1||x<p.y||x>p.y+1)&&oi("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return i}function Na(a,t){return{type:a.type,id:a.id,properties:a.properties,geometry:t?$s(a):[]}}const qu=-32768;function Zu(a,t,i,o,l){a.emplaceBack(qu+8*t+o,qu+8*i+l)}class Wd{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((i=>i.id)),this.index=t.index,this.hasDependencies=!1,this.layoutVertexArray=new st,this.indexArray=new re,this.segments=new Fe,this.programConfigurations=new Hs(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id))}populate(t,i,o){const l=this.layers[0],d=[];let p=null,y=!1,x=l.type==="heatmap";if(l.type==="circle"){const M=l;p=M.layout.get("circle-sort-key"),y=!p.isConstant(),x=x||M.paint.get("circle-pitch-alignment")==="map"}const T=x?i.subdivisionGranularity.circle:1;for(const{feature:M,id:A,index:z,sourceLayerIndex:I}of t){const R=this.layers[0]._featureFilter.needGeometry,N=Na(M,R);if(!this.layers[0]._featureFilter.filter(new Mi(this.zoom),N,o))continue;const V=y?p.evaluate(N,{},o):void 0,$={id:A,properties:M.properties,type:M.type,sourceLayerIndex:I,index:z,geometry:R?N.geometry:$s(M),patterns:{},sortKey:V};d.push($)}y&&d.sort(((M,A)=>M.sortKey-A.sortKey));for(const M of d){const{geometry:A,index:z,sourceLayerIndex:I}=M,R=t[z].feature;this.addFeature(M,A,z,o,T),i.featureIndex.insert(R,A,z,I,this.index)}}update(t,i,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,i,this.stateDependentLayers,{imagePositions:o})}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Ge),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,i,o,l,d=1){let p;switch(d){case 1:p=[0,7];break;case 3:p=[0,2,5,7];break;case 5:p=[0,1,3,4,6,7];break;case 7:p=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${d}; valid values are 1, 3, 5, 7.`)}const y=p.length;for(const x of i)for(const T of x){const M=T.x,A=T.y;if(M<0||M>=Re||A<0||A>=Re)continue;const z=this.segments.prepareSegment(y*y,this.layoutVertexArray,this.indexArray,t.sortKey),I=z.vertexLength;for(let R=0;R<y;R++)for(let N=0;N<y;N++)Zu(this.layoutVertexArray,M,A,p[N],p[R]);for(let R=0;R<y-1;R++)for(let N=0;N<y-1;N++){const V=I+R*y+N,$=I+(R+1)*y+N;this.indexArray.emplaceBack(V,$+1,V+1),this.indexArray.emplaceBack(V,$,$+1)}z.vertexLength+=y*y,z.primitiveLength+=(y-1)*(y-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,{imagePositions:{},canonical:l})}}function Hh(a,t){for(let i=0;i<a.length;i++)if(Vc(t,a[i]))return!0;for(let i=0;i<t.length;i++)if(Vc(a,t[i]))return!0;return!!Qd(a,t)}function $h(a,t,i){return!!Vc(a,t)||!!Xh(t,a,i)}function Kd(a,t){if(a.length===1)return Sa(t,a[0]);for(let i=0;i<t.length;i++){const o=t[i];for(let l=0;l<o.length;l++)if(Vc(a,o[l]))return!0}for(let i=0;i<a.length;i++)if(Sa(t,a[i]))return!0;for(let i=0;i<t.length;i++)if(Qd(a,t[i]))return!0;return!1}function em(a,t,i){if(a.length>1){if(Qd(a,t))return!0;for(let o=0;o<t.length;o++)if(Xh(t[o],a,i))return!0}for(let o=0;o<a.length;o++)if(Xh(a[o],t,i))return!0;return!1}function Qd(a,t){if(a.length===0||t.length===0)return!1;for(let i=0;i<a.length-1;i++){const o=a[i],l=a[i+1];for(let d=0;d<t.length-1;d++)if(eg(o,l,t[d],t[d+1]))return!0}return!1}function eg(a,t,i,o){return ia(a,i,o)!==ia(t,i,o)&&ia(a,t,i)!==ia(a,t,o)}function Xh(a,t,i){const o=i*i;if(t.length===1)return a.distSqr(t[0])<o;for(let l=1;l<t.length;l++)if(Wn(a,t[l-1],t[l])<o)return!0;return!1}function Wn(a,t,i){const o=t.distSqr(i);if(o===0)return a.distSqr(t);const l=((a.x-t.x)*(i.x-t.x)+(a.y-t.y)*(i.y-t.y))/o;return a.distSqr(l<0?t:l>1?i:i.sub(t)._mult(l)._add(t))}function Sa(a,t){let i,o,l,d=!1;for(let p=0;p<a.length;p++){i=a[p];for(let y=0,x=i.length-1;y<i.length;x=y++)o=i[y],l=i[x],o.y>t.y!=l.y>t.y&&t.x<(l.x-o.x)*(t.y-o.y)/(l.y-o.y)+o.x&&(d=!d)}return d}function Vc(a,t){let i=!1;for(let o=0,l=a.length-1;o<a.length;l=o++){const d=a[o],p=a[l];d.y>t.y!=p.y>t.y&&t.x<(p.x-d.x)*(t.y-d.y)/(p.y-d.y)+d.x&&(i=!i)}return i}function im(a,t,i){const o=i[0],l=i[2];if(a.x<o.x&&t.x<o.x||a.x>l.x&&t.x>l.x||a.y<o.y&&t.y<o.y||a.y>l.y&&t.y>l.y)return!1;const d=ia(a,t,i[0]);return d!==ia(a,t,i[1])||d!==ia(a,t,i[2])||d!==ia(a,t,i[3])}function Uc(a,t,i){const o=t.paint.get(a).value;return o.kind==="constant"?o.value:i.programConfigurations.get(t.id).getMaxValue(a)}function Yh(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])}function Yl(a,t,i,o,l){if(!t[0]&&!t[1])return a;const d=et.convert(t)._mult(l);i==="viewport"&&d._rotate(-o);const p=[];for(let y=0;y<a.length;y++)p.push(a[y].sub(d));return p}function nm({queryGeometry:a,size:t},i){return $h(a,i,t)}function Jd({queryGeometry:a,size:t,transform:i,unwrappedTileID:o,getElevation:l},d){return $h(a,d,t*(i.projectTileCoordinates(d.x,d.y,o,l).signedDistanceFromCamera/i.cameraToCenterDistance))}function am({queryGeometry:a,size:t,transform:i,unwrappedTileID:o,getElevation:l},d){const p=i.projectTileCoordinates(d.x,d.y,o,l).signedDistanceFromCamera,y=t*(i.cameraToCenterDistance/p);return $h(a,Kh(d,i,o,l),y)}function ig({queryGeometry:a,size:t,transform:i,unwrappedTileID:o,getElevation:l},d){return $h(a,Kh(d,i,o,l),t)}function Wh({queryGeometry:a,size:t,transform:i,unwrappedTileID:o,getElevation:l,pitchAlignment:d="map",pitchScale:p="map"},y){const x=d==="map"?p==="map"?nm:Jd:p==="map"?am:ig,T={queryGeometry:a,size:t,transform:i,unwrappedTileID:o,getElevation:l};for(const M of y)for(const A of M)if(x(T,A))return!0;return!1}function Kh(a,t,i,o){const l=t.projectTileCoordinates(a.x,a.y,i,o).point;return new et((.5*l.x+.5)*t.width,(.5*-l.y+.5)*t.height)}let Vf,Uf;ge("CircleBucket",Wd,{omit:["layers"]});var rm={get paint(){return Uf=Uf||new $i({"circle-radius":new Le(J.paint_circle["circle-radius"]),"circle-color":new Le(J.paint_circle["circle-color"]),"circle-blur":new Le(J.paint_circle["circle-blur"]),"circle-opacity":new Le(J.paint_circle["circle-opacity"]),"circle-translate":new Se(J.paint_circle["circle-translate"]),"circle-translate-anchor":new Se(J.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Se(J.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Se(J.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Le(J.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Le(J.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Le(J.paint_circle["circle-stroke-opacity"])})},get layout(){return Vf=Vf||new $i({"circle-sort-key":new Le(J.layout_circle["circle-sort-key"])})}};class Gf extends Yn{constructor(t,i){super(t,rm,i)}createBucket(t){return new Wd(t)}queryRadius(t){const i=t;return Uc("circle-radius",this,i)+Uc("circle-stroke-width",this,i)+Yh(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:t,feature:i,featureState:o,geometry:l,transform:d,pixelsToTileUnits:p,unwrappedTileID:y,getElevation:x}){const T=Yl(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-d.bearingInRadians,p),M=this.paint.get("circle-radius").evaluate(i,o)+this.paint.get("circle-stroke-width").evaluate(i,o),A=this.paint.get("circle-pitch-scale"),z=this.paint.get("circle-pitch-alignment");let I,R;return z==="map"?(I=T,R=M*p):(I=(function(N,V,$,rt){return N.map((K=>Kh(K,V,$,rt)))})(T,d,y,x),R=M),Wh({queryGeometry:I,size:R,transform:d,unwrappedTileID:y,getElevation:x,pitchAlignment:z,pitchScale:A},l)}}class tf extends Wd{}let ef;ge("HeatmapBucket",tf,{omit:["layers"]});var sm={get paint(){return ef=ef||new $i({"heatmap-radius":new Le(J.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Le(J.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Se(J.paint_heatmap["heatmap-intensity"]),"heatmap-color":new ma(J.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Se(J.paint_heatmap["heatmap-opacity"])})}};function Qh(a,{width:t,height:i},o,l){if(l){if(l instanceof Uint8ClampedArray)l=new Uint8Array(l.buffer);else if(l.length!==t*i*o)throw new RangeError(`mismatched image size. expected: ${l.length} but got: ${t*i*o}`)}else l=new Uint8Array(t*i*o);return a.width=t,a.height=i,a.data=l,a}function Jh(a,{width:t,height:i},o){if(t===a.width&&i===a.height)return;const l=Qh({},{width:t,height:i},o);td(a,l,{x:0,y:0},{x:0,y:0},{width:Math.min(a.width,t),height:Math.min(a.height,i)},o),a.width=t,a.height=i,a.data=l.data}function td(a,t,i,o,l,d){if(l.width===0||l.height===0)return t;if(l.width>a.width||l.height>a.height||i.x>a.width-l.width||i.y>a.height-l.height)throw new RangeError("out of range source coordinates for image copy");if(l.width>t.width||l.height>t.height||o.x>t.width-l.width||o.y>t.height-l.height)throw new RangeError("out of range destination coordinates for image copy");const p=a.data,y=t.data;if(p===y)throw new Error("srcData equals dstData, so image is already copied");for(let x=0;x<l.height;x++){const T=((i.y+x)*a.width+i.x)*d,M=((o.y+x)*t.width+o.x)*d;for(let A=0;A<l.width*d;A++)y[M+A]=p[T+A]}return t}class Hu{constructor(t,i){Qh(this,t,1,i)}resize(t){Jh(this,t,1)}clone(){return new Hu({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,i,o,l,d){td(t,i,o,l,d,1)}}class Fa{constructor(t,i){Qh(this,t,4,i)}resize(t){Jh(this,t,4)}replace(t,i){i?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new Fa({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,i,o,l,d){td(t,i,o,l,d,4)}setPixel(t,i,o){const l=4*(t*this.width+i);this.data[l+0]=Math.round(255*o.r/o.a),this.data[l+1]=Math.round(255*o.g/o.a),this.data[l+2]=Math.round(255*o.b/o.a),this.data[l+3]=Math.round(255*o.a)}}function qf(a){const t={},i=a.resolution||256,o=a.clips?a.clips.length:1,l=a.image||new Fa({width:i,height:o});if(Math.log(i)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${i}`);const d=(p,y,x)=>{t[a.evaluationKey]=x;const T=a.expression.evaluate(t);l.setPixel(p/4/i,y/4,T)};if(a.clips)for(let p=0,y=0;p<o;++p,y+=4*i)for(let x=0,T=0;x<i;x++,T+=4){const M=x/(i-1),{start:A,end:z}=a.clips[p];d(y,T,A*(1-M)+z*M)}else for(let p=0,y=0;p<i;p++,y+=4)d(0,y,p/(i-1));return l}ge("AlphaImage",Hu),ge("RGBAImage",Fa);const Xs="big-fb";class Zf extends Yn{createBucket(t){return new tf(t)}constructor(t,i){super(t,sm,i),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=qf({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(Xs)&&this.heatmapFbos.delete(Xs)}queryRadius(t){return Uc("heatmap-radius",this,t)}queryIntersectsFeature({queryGeometry:t,feature:i,featureState:o,geometry:l,transform:d,pixelsToTileUnits:p,unwrappedTileID:y,getElevation:x}){return Wh({queryGeometry:t,size:this.paint.get("heatmap-radius").evaluate(i,o)*p,transform:d,unwrappedTileID:y,getElevation:x},l)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let om;var lm={get paint(){return om=om||new $i({"hillshade-illumination-direction":new Se(J.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-altitude":new Se(J.paint_hillshade["hillshade-illumination-altitude"]),"hillshade-illumination-anchor":new Se(J.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Se(J.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Se(J.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Se(J.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Se(J.paint_hillshade["hillshade-accent-color"]),"hillshade-method":new Se(J.paint_hillshade["hillshade-method"])})}};class ll extends Yn{constructor(t,i){super(t,lm,i),this.recalculate({zoom:0,zoomHistory:{}},void 0)}getIlluminationProperties(){let t=this.paint.get("hillshade-illumination-direction").values,i=this.paint.get("hillshade-illumination-altitude").values,o=this.paint.get("hillshade-highlight-color").values,l=this.paint.get("hillshade-shadow-color").values;const d=Math.max(t.length,i.length,o.length,l.length);t=t.concat(Array(d-t.length).fill(t.at(-1))),i=i.concat(Array(d-i.length).fill(i.at(-1))),o=o.concat(Array(d-o.length).fill(o.at(-1))),l=l.concat(Array(d-l.length).fill(l.at(-1)));const p=i.map(qi);return{directionRadians:t.map(qi),altitudeRadians:p,shadowColor:l,highlightColor:o}}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}let nf;var cm={get paint(){return nf=nf||new $i({"color-relief-opacity":new Se(J["paint_color-relief"]["color-relief-opacity"]),"color-relief-color":new ma(J["paint_color-relief"]["color-relief-color"])})}};class $u{constructor(t,i,o,l){this.context=t,this.format=o,this.texture=t.gl.createTexture(),this.update(i,l)}update(t,i,o){const{width:l,height:d}=t,p=!(this.size&&this.size[0]===l&&this.size[1]===d||o),{context:y}=this,{gl:x}=y;if(this.useMipmap=!!(i&&i.useMipmap),x.bindTexture(x.TEXTURE_2D,this.texture),y.pixelStoreUnpackFlipY.set(!1),y.pixelStoreUnpack.set(1),y.pixelStoreUnpackPremultiplyAlpha.set(this.format===x.RGBA&&(!i||i.premultiply!==!1)),p)this.size=[l,d],t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||Cn(t)?x.texImage2D(x.TEXTURE_2D,0,this.format,this.format,x.UNSIGNED_BYTE,t):x.texImage2D(x.TEXTURE_2D,0,this.format,l,d,0,this.format,x.UNSIGNED_BYTE,t.data);else{const{x:T,y:M}=o||{x:0,y:0};t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||Cn(t)?x.texSubImage2D(x.TEXTURE_2D,0,T,M,x.RGBA,x.UNSIGNED_BYTE,t):x.texSubImage2D(x.TEXTURE_2D,0,T,M,l,d,x.RGBA,x.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&x.generateMipmap(x.TEXTURE_2D),y.pixelStoreUnpackFlipY.setDefault(),y.pixelStoreUnpack.setDefault(),y.pixelStoreUnpackPremultiplyAlpha.setDefault()}bind(t,i,o){const{context:l}=this,{gl:d}=l;d.bindTexture(d.TEXTURE_2D,this.texture),o!==d.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(o=d.LINEAR),t!==this.filter&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,t),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,o||t),this.filter=t),i!==this.wrap&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,i),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,i),this.wrap=i)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}class Xu{constructor(t,i,o,l=1,d=1,p=1,y=0){if(this.uid=t,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(o&&!["mapbox","terrarium","custom"].includes(o))return void oi(`"${o}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=i.height;const x=this.dim=i.height-2;switch(this.data=new Uint32Array(i.data.buffer),o){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=l,this.greenFactor=d,this.blueFactor=p,this.baseShift=y;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let T=0;T<x;T++)this.data[this._idx(-1,T)]=this.data[this._idx(0,T)],this.data[this._idx(x,T)]=this.data[this._idx(x-1,T)],this.data[this._idx(T,-1)]=this.data[this._idx(T,0)],this.data[this._idx(T,x)]=this.data[this._idx(T,x-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(x,-1)]=this.data[this._idx(x-1,0)],this.data[this._idx(-1,x)]=this.data[this._idx(0,x-1)],this.data[this._idx(x,x)]=this.data[this._idx(x-1,x-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let T=0;T<x;T++)for(let M=0;M<x;M++){const A=this.get(T,M);A>this.max&&(this.max=A),A<this.min&&(this.min=A)}}get(t,i){const o=new Uint8Array(this.data.buffer),l=4*this._idx(t,i);return this.unpack(o[l],o[l+1],o[l+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(t,i){if(t<-1||t>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(i+1)*this.stride+(t+1)}unpack(t,i,o){return t*this.redFactor+i*this.greenFactor+o*this.blueFactor-this.baseShift}pack(t){return hn(t,this.getUnpackVector())}getPixels(){return new Fa({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(t,i,o){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let l=i*this.dim,d=i*this.dim+this.dim,p=o*this.dim,y=o*this.dim+this.dim;switch(i){case-1:l=d-1;break;case 1:d=l+1}switch(o){case-1:p=y-1;break;case 1:y=p+1}const x=-i*this.dim,T=-o*this.dim;for(let M=p;M<y;M++)for(let A=l;A<d;A++)this.data[this._idx(A,M)]=t.data[this._idx(A+x,M+T)]}}function hn(a,t){const i=t[0],o=t[1],l=t[2],d=t[3],p=Math.min(i,o,l),y=Math.round((a+d)/p);return{r:Math.floor(y*p/i)%256,g:Math.floor(y*p/o)%256,b:Math.floor(y*p/l)%256}}ge("DEMData",Xu);class ng extends Yn{constructor(t,i){super(t,cm,i)}_createColorRamp(t){const i={elevationStops:[],colorStops:[]},o=this._transitionablePaint._values["color-relief-color"].value.expression;if(o instanceof lo&&o._styleExpression.expression instanceof ra){this.colorRampExpression=o;const p=o._styleExpression.expression;i.elevationStops=p.labels,i.colorStops=[];for(const y of i.elevationStops)i.colorStops.push(p.evaluate({globals:{elevation:y}}))}if(i.elevationStops.length<1&&(i.elevationStops=[0],i.colorStops=[ii.transparent]),i.elevationStops.length<2&&(i.elevationStops.push(i.elevationStops[0]+1),i.colorStops.push(i.colorStops[0])),i.elevationStops.length<=t)return i;const l={elevationStops:[],colorStops:[]},d=(i.elevationStops.length-1)/(t-1);for(let p=0;p<i.elevationStops.length-.5;p+=d)l.elevationStops.push(i.elevationStops[Math.round(p)]),l.colorStops.push(i.colorStops[Math.round(p)]);return oi(`Too many colors in specification of ${this.id} color-relief layer, may not render properly. Max possible colors: ${t}, provided: ${i.elevationStops.length}`),l}_colorRampChanged(){return this.colorRampExpression!=this._transitionablePaint._values["color-relief-color"].value.expression}getColorRampTextures(t,i,o){if(this.colorRampTextures&&!this._colorRampChanged())return this.colorRampTextures;const l=this._createColorRamp(i),d=new Fa({width:l.colorStops.length,height:1}),p=new Fa({width:l.colorStops.length,height:1});for(let y=0;y<l.elevationStops.length;y++){const x=hn(l.elevationStops[y],o);p.setPixel(0,y,new ii(x.r/255,x.g/255,x.b/255,1)),d.setPixel(0,y,l.colorStops[y])}return this.colorRampTextures={elevationTexture:new $u(t,p,t.gl.RGBA),colorTexture:new $u(t,d,t.gl.RGBA)},this.colorRampTextures}hasOffscreenPass(){return this.visibility!=="none"&&!!this.colorRampTextures}}const ag=zi([{name:"a_pos",components:2,type:"Int16"}],4),{members:um}=ag;function Wl(a,t,i){const o=i.patternDependencies;let l=!1;for(const d of t){const p=d.paint.get(`${a}-pattern`);p.isConstant()||(l=!0);const y=p.constantOr(null);y&&(l=!0,o[y.to]=!0,o[y.from]=!0)}return l}function bo(a,t,i,o,l){const{zoom:d}=o,p=l.patternDependencies;for(const y of t){const x=y.paint.get(`${a}-pattern`).value;if(x.kind!=="constant"){let T=x.evaluate({zoom:d-1},i,{},l.availableImages),M=x.evaluate({zoom:d},i,{},l.availableImages),A=x.evaluate({zoom:d+1},i,{},l.availableImages);T=T&&T.name?T.name:T,M=M&&M.name?M.name:M,A=A&&A.name?A.name:A,p[T]=!0,p[M]=!0,p[A]=!0,i.patterns[y.id]={min:T,mid:M,max:A}}}return i}function Hf(a,t,i,o,l){let d;if(l===(function(p,y,x,T){let M=0;for(let A=y,z=x-T;A<x;A+=T)M+=(p[z]-p[A])*(p[A+1]+p[z+1]),z=A;return M})(a,t,i,o)>0)for(let p=t;p<i;p+=o)d=Kf(p/o|0,a[p],a[p+1],d);else for(let p=i-o;p>=t;p-=o)d=Kf(p/o|0,a[p],a[p+1],d);return d&&Yu(d,d.next)&&(Wu(d),d=d.next),d}function Kl(a,t){if(!a)return a;t||(t=a);let i,o=a;do if(i=!1,o.steiner||!Yu(o,o.next)&&li(o.prev,o,o.next)!==0)o=o.next;else{if(Wu(o),o=t=o.prev,o===o.next)break;i=!0}while(i||o!==t);return t}function cl(a,t,i,o,l,d,p){if(!a)return;!p&&d&&(function(x,T,M,A){let z=x;do z.z===0&&(z.z=rf(z.x,z.y,T,M,A)),z.prevZ=z.prev,z.nextZ=z.next,z=z.next;while(z!==x);z.prevZ.nextZ=null,z.prevZ=null,(function(I){let R,N=1;do{let V,$=I;I=null;let rt=null;for(R=0;$;){R++;let K=$,tt=0;for(let xt=0;xt<N&&(tt++,K=K.nextZ,K);xt++);let vt=N;for(;tt>0||vt>0&&K;)tt!==0&&(vt===0||!K||$.z<=K.z)?(V=$,$=$.nextZ,tt--):(V=K,K=K.nextZ,vt--),rt?rt.nextZ=V:I=V,V.prevZ=rt,rt=V;$=K}rt.nextZ=null,N*=2}while(R>1)})(z)})(a,o,l,d);let y=a;for(;a.prev!==a.next;){const x=a.prev,T=a.next;if(d?hm(a,o,l,d):wo(a))t.push(x.i,a.i,T.i),Wu(a),a=T.next,y=T.next;else if((a=T)===y){p?p===1?cl(a=$f(Kl(a),t),t,i,o,l,d,2):p===2&&dm(a,t,i,o,l,d):cl(Kl(a),t,i,o,l,d,1);break}}}function wo(a){const t=a.prev,i=a,o=a.next;if(li(t,i,o)>=0)return!1;const l=t.x,d=i.x,p=o.x,y=t.y,x=i.y,T=o.y,M=Math.min(l,d,p),A=Math.min(y,x,T),z=Math.max(l,d,p),I=Math.max(y,x,T);let R=o.next;for(;R!==t;){if(R.x>=M&&R.x<=z&&R.y>=A&&R.y<=I&&Gc(l,y,d,x,p,T,R.x,R.y)&&li(R.prev,R,R.next)>=0)return!1;R=R.next}return!0}function hm(a,t,i,o){const l=a.prev,d=a,p=a.next;if(li(l,d,p)>=0)return!1;const y=l.x,x=d.x,T=p.x,M=l.y,A=d.y,z=p.y,I=Math.min(y,x,T),R=Math.min(M,A,z),N=Math.max(y,x,T),V=Math.max(M,A,z),$=rf(I,R,t,i,o),rt=rf(N,V,t,i,o);let K=a.prevZ,tt=a.nextZ;for(;K&&K.z>=$&&tt&&tt.z<=rt;){if(K.x>=I&&K.x<=N&&K.y>=R&&K.y<=V&&K!==l&&K!==p&&Gc(y,M,x,A,T,z,K.x,K.y)&&li(K.prev,K,K.next)>=0||(K=K.prevZ,tt.x>=I&&tt.x<=N&&tt.y>=R&&tt.y<=V&&tt!==l&&tt!==p&&Gc(y,M,x,A,T,z,tt.x,tt.y)&&li(tt.prev,tt,tt.next)>=0))return!1;tt=tt.nextZ}for(;K&&K.z>=$;){if(K.x>=I&&K.x<=N&&K.y>=R&&K.y<=V&&K!==l&&K!==p&&Gc(y,M,x,A,T,z,K.x,K.y)&&li(K.prev,K,K.next)>=0)return!1;K=K.prevZ}for(;tt&&tt.z<=rt;){if(tt.x>=I&&tt.x<=N&&tt.y>=R&&tt.y<=V&&tt!==l&&tt!==p&&Gc(y,M,x,A,T,z,tt.x,tt.y)&&li(tt.prev,tt,tt.next)>=0)return!1;tt=tt.nextZ}return!0}function $f(a,t){let i=a;do{const o=i.prev,l=i.next.next;!Yu(o,l)&&Wf(o,i,i.next,l)&&Ea(o,l)&&Ea(l,o)&&(t.push(o.i,i.i,l.i),Wu(i),Wu(i.next),i=a=l),i=i.next}while(i!==a);return Kl(i)}function dm(a,t,i,o,l,d){let p=a;do{let y=p.next.next;for(;y!==p.prev;){if(p.i!==y.i&&fm(p,y)){let x=To(p,y);return p=Kl(p,p.next),x=Kl(x,x.next),cl(p,t,i,o,l,d,0),void cl(x,t,i,o,l,d,0)}y=y.next}p=p.next}while(p!==a)}function Xf(a,t){let i=a.x-t.x;return i===0&&(i=a.y-t.y,i===0)&&(i=(a.next.y-a.y)/(a.next.x-a.x)-(t.next.y-t.y)/(t.next.x-t.x)),i}function Yf(a,t){const i=(function(l,d){let p=d;const y=l.x,x=l.y;let T,M=-1/0;if(Yu(l,p))return p;do{if(Yu(l,p.next))return p.next;if(x<=p.y&&x>=p.next.y&&p.next.y!==p.y){const N=p.x+(x-p.y)*(p.next.x-p.x)/(p.next.y-p.y);if(N<=y&&N>M&&(M=N,T=p.x<p.next.x?p:p.next,N===y))return T}p=p.next}while(p!==d);if(!T)return null;const A=T,z=T.x,I=T.y;let R=1/0;p=T;do{if(y>=p.x&&p.x>=z&&y!==p.x&&Kn(x<I?y:M,x,z,I,x<I?M:y,x,p.x,p.y)){const N=Math.abs(x-p.y)/(y-p.x);Ea(p,l)&&(N<R||N===R&&(p.x>T.x||p.x===T.x&&af(T,p)))&&(T=p,R=N)}p=p.next}while(p!==A);return T})(a,t);if(!i)return t;const o=To(i,a);return Kl(o,o.next),Kl(i,i.next)}function af(a,t){return li(a.prev,a,t.prev)<0&&li(t.next,a,a.next)<0}function rf(a,t,i,o,l){return(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=(a-i)*l|0)|a<<8))|a<<4))|a<<2))|a<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-o)*l|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function ul(a){let t=a,i=a;do(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next;while(t!==a);return i}function Kn(a,t,i,o,l,d,p,y){return(l-p)*(t-y)>=(a-p)*(d-y)&&(a-p)*(o-y)>=(i-p)*(t-y)&&(i-p)*(d-y)>=(l-p)*(o-y)}function Gc(a,t,i,o,l,d,p,y){return!(a===p&&t===y)&&Kn(a,t,i,o,l,d,p,y)}function fm(a,t){return a.next.i!==t.i&&a.prev.i!==t.i&&!(function(i,o){let l=i;do{if(l.i!==i.i&&l.next.i!==i.i&&l.i!==o.i&&l.next.i!==o.i&&Wf(l,l.next,i,o))return!0;l=l.next}while(l!==i);return!1})(a,t)&&(Ea(a,t)&&Ea(t,a)&&(function(i,o){let l=i,d=!1;const p=(i.x+o.x)/2,y=(i.y+o.y)/2;do l.y>y!=l.next.y>y&&l.next.y!==l.y&&p<(l.next.x-l.x)*(y-l.y)/(l.next.y-l.y)+l.x&&(d=!d),l=l.next;while(l!==i);return d})(a,t)&&(li(a.prev,a,t.prev)||li(a,t.prev,t))||Yu(a,t)&&li(a.prev,a,a.next)>0&&li(t.prev,t,t.next)>0)}function li(a,t,i){return(t.y-a.y)*(i.x-t.x)-(t.x-a.x)*(i.y-t.y)}function Yu(a,t){return a.x===t.x&&a.y===t.y}function Wf(a,t,i,o){const l=rn(li(a,t,i)),d=rn(li(a,t,o)),p=rn(li(i,o,a)),y=rn(li(i,o,t));return l!==d&&p!==y||!(l!==0||!ed(a,i,t))||!(d!==0||!ed(a,o,t))||!(p!==0||!ed(i,a,o))||!(y!==0||!ed(i,t,o))}function ed(a,t,i){return t.x<=Math.max(a.x,i.x)&&t.x>=Math.min(a.x,i.x)&&t.y<=Math.max(a.y,i.y)&&t.y>=Math.min(a.y,i.y)}function rn(a){return a>0?1:a<0?-1:0}function Ea(a,t){return li(a.prev,a,a.next)<0?li(a,t,a.next)>=0&&li(a,a.prev,t)>=0:li(a,t,a.prev)<0||li(a,a.next,t)<0}function To(a,t){const i=sf(a.i,a.x,a.y),o=sf(t.i,t.x,t.y),l=a.next,d=t.prev;return a.next=t,t.prev=a,i.next=l,l.prev=i,o.next=i,i.prev=o,d.next=o,o.prev=d,o}function Kf(a,t,i,o){const l=sf(a,t,i);return o?(l.next=o.next,l.prev=o,o.next.prev=l,o.next=l):(l.prev=l,l.next=l),l}function Wu(a){a.next.prev=a.prev,a.prev.next=a.next,a.prevZ&&(a.prevZ.nextZ=a.nextZ),a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function sf(a,t,i){return{i:a,x:t,y:i,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class Ku{constructor(t,i){if(i>t)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=t,this._minGranularity=i}getGranularityForZoomLevel(t){return Math.max(Math.floor(this._baseZoomGranularity/(1<<t)),this._minGranularity,1)}}class qc{constructor(t){this.fill=t.fill,this.line=t.line,this.tile=t.tile,this.stencil=t.stencil,this.circle=t.circle}}qc.noSubdivision=new qc({fill:new Ku(0,0),line:new Ku(0,0),tile:new Ku(0,0),stencil:new Ku(0,0),circle:1}),ge("SubdivisionGranularityExpression",Ku),ge("SubdivisionGranularitySetting",qc);const ga=-32768,lr=32767;class pm{constructor(t,i){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=t,this._granularityCellSize=Re/t,this._canonical=i}_getKey(t,i){return(t+=32768)<<16|i+32768}_vertexToIndex(t,i){if(t<-32768||i<-32768||t>32767||i>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");const o=0|Math.round(t),l=0|Math.round(i),d=this._getKey(o,l);if(this._vertexDictionary.has(d))return this._vertexDictionary.get(d);const p=this._vertexBuffer.length/2;return this._vertexDictionary.set(d,p),this._vertexBuffer.push(o,l),p}_subdivideTrianglesScanline(t){if(this._granularity<2)return(function(l,d){const p=[];for(let y=0;y<d.length;y+=3){const x=d[y],T=d[y+1],M=d[y+2],A=l[2*x],z=l[2*x+1];(l[2*T]-A)*(l[2*M+1]-z)-(l[2*T+1]-z)*(l[2*M]-A)>0?(p.push(x),p.push(M),p.push(T)):(p.push(x),p.push(T),p.push(M))}return p})(this._vertexBuffer,t);const i=[],o=t.length;for(let l=0;l<o;l+=3){const d=[t[l+0],t[l+1],t[l+2]],p=[this._vertexBuffer[2*t[l+0]+0],this._vertexBuffer[2*t[l+0]+1],this._vertexBuffer[2*t[l+1]+0],this._vertexBuffer[2*t[l+1]+1],this._vertexBuffer[2*t[l+2]+0],this._vertexBuffer[2*t[l+2]+1]];let y=1/0,x=1/0,T=-1/0,M=-1/0;for(let N=0;N<3;N++){const V=p[2*N],$=p[2*N+1];y=Math.min(y,V),T=Math.max(T,V),x=Math.min(x,$),M=Math.max(M,$)}if(y===T||x===M)continue;const A=Math.floor(y/this._granularityCellSize),z=Math.ceil(T/this._granularityCellSize),I=Math.floor(x/this._granularityCellSize),R=Math.ceil(M/this._granularityCellSize);if(A!==z||I!==R)for(let N=I;N<R;N++){const V=this._scanlineGenerateVertexRingForCellRow(N,p,d);hl(this._vertexBuffer,V,i)}else i.push(...d)}return i}_scanlineGenerateVertexRingForCellRow(t,i,o){const l=t*this._granularityCellSize,d=l+this._granularityCellSize,p=[];for(let y=0;y<3;y++){const x=i[2*y],T=i[2*y+1],M=i[2*(y+1)%6],A=i[(2*(y+1)+1)%6],z=i[2*(y+2)%6],I=i[(2*(y+2)+1)%6],R=M-x,N=A-T,V=R===0,$=N===0,rt=(l-T)/N,K=(d-T)/N,tt=Math.min(rt,K),vt=Math.max(rt,K);if(!$&&(tt>=1||vt<=0)||$&&(T<l||T>d)){A>=l&&A<=d&&p.push(o[(y+1)%3]);continue}!$&&tt>0&&p.push(this._vertexToIndex(x+R*tt,T+N*tt));const xt=x+R*Math.max(tt,0),Lt=x+R*Math.min(vt,1);V||this._generateIntraEdgeVertices(p,x,T,M,A,xt,Lt),!$&&vt<1&&p.push(this._vertexToIndex(x+R*vt,T+N*vt)),($||A>=l&&A<=d)&&p.push(o[(y+1)%3]),!$&&(A<=l||A>=d)&&this._generateInterEdgeVertices(p,x,T,M,A,z,I,Lt,l,d)}return p}_generateIntraEdgeVertices(t,i,o,l,d,p,y){const x=l-i,T=d-o,M=T===0,A=M?Math.min(i,l):Math.min(p,y),z=M?Math.max(i,l):Math.max(p,y),I=Math.floor(A/this._granularityCellSize)+1,R=Math.ceil(z/this._granularityCellSize)-1;if(M?i<l:p<y)for(let N=I;N<=R;N++){const V=N*this._granularityCellSize;t.push(this._vertexToIndex(V,o+T*(V-i)/x))}else for(let N=R;N>=I;N--){const V=N*this._granularityCellSize;t.push(this._vertexToIndex(V,o+T*(V-i)/x))}}_generateInterEdgeVertices(t,i,o,l,d,p,y,x,T,M){const A=d-o,z=p-l,I=y-d,R=(T-d)/I,N=(M-d)/I,V=Math.min(R,N),$=Math.max(R,N),rt=l+z*V;let K=Math.floor(Math.min(rt,x)/this._granularityCellSize)+1,tt=Math.ceil(Math.max(rt,x)/this._granularityCellSize)-1,vt=x<rt;const xt=I===0;if(xt&&(y===T||y===M))return;if(xt||V>=1||$<=0){const Jt=o-y,qt=p+(i-p)*Math.min((T-y)/Jt,(M-y)/Jt);K=Math.floor(Math.min(qt,x)/this._granularityCellSize)+1,tt=Math.ceil(Math.max(qt,x)/this._granularityCellSize)-1,vt=x<qt}const Lt=A>0?M:T;if(vt)for(let Jt=K;Jt<=tt;Jt++)t.push(this._vertexToIndex(Jt*this._granularityCellSize,Lt));else for(let Jt=tt;Jt>=K;Jt--)t.push(this._vertexToIndex(Jt*this._granularityCellSize,Lt))}_generateOutline(t){const i=[];for(const o of t){const l=Ql(o,this._granularity,!0),d=this._pointArrayToIndices(l),p=[];for(let y=1;y<d.length;y++)p.push(d[y-1]),p.push(d[y]);i.push(p)}return i}_handlePoles(t){let i=!1,o=!1;this._canonical&&(this._canonical.y===0&&(i=!0),this._canonical.y===(1<<this._canonical.z)-1&&(o=!0)),(i||o)&&this._fillPoles(t,i,o)}_ensureNoPoleVertices(){const t=this._vertexBuffer;for(let i=0;i<t.length;i+=2){const o=t[i+1];o===ga&&(t[i+1]=-32767),o===lr&&(t[i+1]=32766)}}_generatePoleQuad(t,i,o,l,d,p){l>d!=(p===ga)?(t.push(i),t.push(o),t.push(this._vertexToIndex(l,p)),t.push(o),t.push(this._vertexToIndex(d,p)),t.push(this._vertexToIndex(l,p))):(t.push(o),t.push(i),t.push(this._vertexToIndex(l,p)),t.push(this._vertexToIndex(d,p)),t.push(o),t.push(this._vertexToIndex(l,p)))}_fillPoles(t,i,o){const l=this._vertexBuffer,d=Re,p=t.length;for(let y=2;y<p;y+=3){const x=t[y-2],T=t[y-1],M=t[y],A=l[2*x],z=l[2*x+1],I=l[2*T],R=l[2*T+1],N=l[2*M],V=l[2*M+1];i&&(z===0&&R===0&&this._generatePoleQuad(t,x,T,A,I,ga),R===0&&V===0&&this._generatePoleQuad(t,T,M,I,N,ga),V===0&&z===0&&this._generatePoleQuad(t,M,x,N,A,ga)),o&&(z===d&&R===d&&this._generatePoleQuad(t,x,T,A,I,lr),R===d&&V===d&&this._generatePoleQuad(t,T,M,I,N,lr),V===d&&z===d&&this._generatePoleQuad(t,M,x,N,A,lr))}}_initializeVertices(t){for(let i=0;i<t.length;i+=2)this._vertexToIndex(t[i],t[i+1])}subdividePolygonInternal(t,i){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;const{flattened:o,holeIndices:l}=(function(y){const x=[],T=[];for(const M of y)if(M.length!==0){M!==y[0]&&x.push(T.length/2);for(let A=0;A<M.length;A++)T.push(M[A].x),T.push(M[A].y)}return{flattened:T,holeIndices:x}})(t);let d;this._initializeVertices(o);try{const y=(function(T,M,A=2){const z=M&&M.length,I=z?M[0]*A:T.length;let R=Hf(T,0,I,A,!0);const N=[];if(!R||R.next===R.prev)return N;let V,$,rt;if(z&&(R=(function(K,tt,vt,xt){const Lt=[];for(let Jt=0,qt=tt.length;Jt<qt;Jt++){const ee=Hf(K,tt[Jt]*xt,Jt<qt-1?tt[Jt+1]*xt:K.length,xt,!1);ee===ee.next&&(ee.steiner=!0),Lt.push(ul(ee))}Lt.sort(Xf);for(let Jt=0;Jt<Lt.length;Jt++)vt=Yf(Lt[Jt],vt);return vt})(T,M,R,A)),T.length>80*A){V=T[0],$=T[1];let K=V,tt=$;for(let vt=A;vt<I;vt+=A){const xt=T[vt],Lt=T[vt+1];xt<V&&(V=xt),Lt<$&&($=Lt),xt>K&&(K=xt),Lt>tt&&(tt=Lt)}rt=Math.max(K-V,tt-$),rt=rt!==0?32767/rt:0}return cl(R,N,A,V,$,rt,0),N})(o,l),x=this._convertIndices(o,y);d=this._subdivideTrianglesScanline(x)}catch(y){console.error(y)}let p=[];return i&&(p=this._generateOutline(t)),this._ensureNoPoleVertices(),this._handlePoles(d),{verticesFlattened:this._vertexBuffer,indicesTriangles:d,indicesLineList:p}}_convertIndices(t,i){const o=[];for(let l=0;l<i.length;l++)o.push(this._vertexToIndex(t[2*i[l]],t[2*i[l]+1]));return o}_pointArrayToIndices(t){const i=[];for(let o=0;o<t.length;o++){const l=t[o];i.push(this._vertexToIndex(l.x,l.y))}return i}}function cr(a,t,i,o=!0){return new pm(i,t).subdividePolygonInternal(a,o)}function Ql(a,t,i=!1){if(!a||a.length<1)return[];if(a.length<2)return[];const o=a[0],l=a[a.length-1],d=i&&(o.x!==l.x||o.y!==l.y);if(t<2)return d?[...a,a[0]]:[...a];const p=Math.floor(Re/t),y=[];y.push(new et(a[0].x,a[0].y));const x=a.length,T=d?x:x-1;for(let M=0;M<T;M++){const A=a[M],z=M<x-1?a[M+1]:a[0],I=A.x,R=A.y,N=z.x,V=z.y,$=I!==N,rt=R!==V;if(!$&&!rt)continue;const K=N-I,tt=V-R,vt=Math.abs(K),xt=Math.abs(tt);let Lt=I,Jt=R;for(;;){const ee=K>0?(Math.floor(Lt/p)+1)*p:(Math.ceil(Lt/p)-1)*p,fe=tt>0?(Math.floor(Jt/p)+1)*p:(Math.ceil(Jt/p)-1)*p,oe=Math.abs(Lt-ee),le=Math.abs(Jt-fe),Zt=Math.abs(Lt-N),ze=Math.abs(Jt-V),Pe=$?oe/vt:Number.POSITIVE_INFINITY,ke=rt?le/xt:Number.POSITIVE_INFINITY;if((Zt<=oe||!$)&&(ze<=le||!rt))break;if(Pe<ke&&$||!rt){Lt=ee,Jt+=tt*Pe;const Ee=new et(Lt,Math.round(Jt));y[y.length-1].x===Ee.x&&y[y.length-1].y===Ee.y||y.push(Ee)}else{Lt+=K*ke,Jt=fe;const Ee=new et(Math.round(Lt),Jt);y[y.length-1].x===Ee.x&&y[y.length-1].y===Ee.y||y.push(Ee)}}const qt=new et(N,V);y[y.length-1].x===qt.x&&y[y.length-1].y===qt.y||y.push(qt)}return y}function hl(a,t,i){if(t.length===0)throw new Error("Subdivision vertex ring is empty.");let o=0,l=a[2*t[0]];for(let x=1;x<t.length;x++){const T=a[2*t[x]];T<l&&(l=T,o=x)}const d=t.length;let p=o,y=(p+1)%d;for(;;){const x=p-1>=0?p-1:d-1,T=(y+1)%d,M=a[2*t[x]],A=a[2*t[T]],z=a[2*t[p]],I=a[2*t[p]+1],R=a[2*t[y]+1];let N=!1;if(M<A)N=!0;else if(M>A)N=!1;else{const V=R-I,$=-(a[2*t[y]]-z),rt=I<R?1:-1;((M-z)*V+(a[2*t[x]+1]-I)*$)*rt>((A-z)*V+(a[2*t[T]+1]-I)*$)*rt&&(N=!0)}if(N){const V=t[x],$=t[p],rt=t[y];V!==$&&V!==rt&&$!==rt&&i.push(rt,$,V),p--,p<0&&(p=d-1)}else{const V=t[T],$=t[p],rt=t[y];V!==$&&V!==rt&&$!==rt&&i.push(rt,$,V),y++,y>=d&&(y=0)}if(x===T)break}}function Jl(a,t,i,o,l,d,p,y,x){const T=l.length/2,M=p&&y&&x;if(T<Fe.MAX_VERTEX_ARRAY_LENGTH){const A=t.prepareSegment(T,i,o),z=A.vertexLength;for(let N=0;N<d.length;N+=3)o.emplaceBack(z+d[N],z+d[N+1],z+d[N+2]);let I,R;A.vertexLength+=T,A.primitiveLength+=d.length/3,M&&(R=p.prepareSegment(T,i,y),I=R.vertexLength,R.vertexLength+=T);for(let N=0;N<l.length;N+=2)a(l[N],l[N+1]);if(M)for(let N=0;N<x.length;N++){const V=x[N];for(let $=1;$<V.length;$+=2)y.emplaceBack(I+V[$-1],I+V[$]);R.primitiveLength+=V.length/2}}else(function(A,z,I,R,N,V){const $=[];for(let xt=0;xt<R.length/2;xt++)$.push(-1);const rt={count:0};let K=0,tt=A.getOrCreateLatestSegment(z,I),vt=tt.vertexLength;for(let xt=2;xt<N.length;xt+=3){const Lt=N[xt-2],Jt=N[xt-1],qt=N[xt];let ee=$[Lt]<K,fe=$[Jt]<K,oe=$[qt]<K;tt.vertexLength+((ee?1:0)+(fe?1:0)+(oe?1:0))>Fe.MAX_VERTEX_ARRAY_LENGTH&&(tt=A.createNewSegment(z,I),K=rt.count,ee=!0,fe=!0,oe=!0,vt=0);const le=Ur($,R,V,rt,Lt,ee,tt),Zt=Ur($,R,V,rt,Jt,fe,tt),ze=Ur($,R,V,rt,qt,oe,tt);I.emplaceBack(vt+le-K,vt+Zt-K,vt+ze-K),tt.primitiveLength++}})(t,i,o,l,d,a),M&&(function(A,z,I,R,N,V){const $=[];for(let xt=0;xt<R.length/2;xt++)$.push(-1);const rt={count:0};let K=0,tt=A.getOrCreateLatestSegment(z,I),vt=tt.vertexLength;for(let xt=0;xt<N.length;xt++){const Lt=N[xt];for(let Jt=1;Jt<N[xt].length;Jt+=2){const qt=Lt[Jt-1],ee=Lt[Jt];let fe=$[qt]<K,oe=$[ee]<K;tt.vertexLength+((fe?1:0)+(oe?1:0))>Fe.MAX_VERTEX_ARRAY_LENGTH&&(tt=A.createNewSegment(z,I),K=rt.count,fe=!0,oe=!0,vt=0);const le=Ur($,R,V,rt,qt,fe,tt),Zt=Ur($,R,V,rt,ee,oe,tt);I.emplaceBack(vt+le-K,vt+Zt-K),tt.primitiveLength++}}})(p,i,y,l,x,a),t.forceNewSegmentOnNextPrepare(),p?.forceNewSegmentOnNextPrepare()}function Ur(a,t,i,o,l,d,p){if(d){const y=o.count;return i(t[2*l],t[2*l+1]),a[l]=o.count,o.count++,p.vertexLength++,y}return a[l]}class id{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((i=>i.id)),this.index=t.index,this.hasDependencies=!1,this.patternFeatures=[],this.layoutVertexArray=new ht,this.indexArray=new re,this.indexArray2=new Xt,this.programConfigurations=new Hs(t.layers,t.zoom),this.segments=new Fe,this.segments2=new Fe,this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id))}populate(t,i,o){this.hasDependencies=Wl("fill",this.layers,i);const l=this.layers[0].layout.get("fill-sort-key"),d=!l.isConstant(),p=[];for(const{feature:y,id:x,index:T,sourceLayerIndex:M}of t){const A=this.layers[0]._featureFilter.needGeometry,z=Na(y,A);if(!this.layers[0]._featureFilter.filter(new Mi(this.zoom),z,o))continue;const I=d?l.evaluate(z,{},o,i.availableImages):void 0,R={id:x,properties:y.properties,type:y.type,sourceLayerIndex:M,index:T,geometry:A?z.geometry:$s(y),patterns:{},sortKey:I};p.push(R)}d&&p.sort(((y,x)=>y.sortKey-x.sortKey));for(const y of p){const{geometry:x,index:T,sourceLayerIndex:M}=y;if(this.hasDependencies){const A=bo("fill",this.layers,y,{zoom:this.zoom},i);this.patternFeatures.push(A)}else this.addFeature(y,x,T,o,{},i.subdivisionGranularity);i.featureIndex.insert(t[T].feature,x,T,M,this.index)}}update(t,i,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,i,this.stateDependentLayers,{imagePositions:o})}addFeatures(t,i,o){for(const l of this.patternFeatures)this.addFeature(l,l.geometry,l.index,i,o,t.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,um),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,i,o,l,d,p){for(const y of Il(i,500)){const x=cr(y,l,p.fill.getGranularityForZoomLevel(l.z)),T=this.layoutVertexArray;Jl(((M,A)=>{T.emplaceBack(M,A)}),this.segments,this.layoutVertexArray,this.indexArray,x.verticesFlattened,x.indicesTriangles,this.segments2,this.indexArray2,x.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,{imagePositions:d,canonical:l})}}let of,bs;ge("FillBucket",id,{omit:["layers","patternFeatures"]});var mm={get paint(){return bs=bs||new $i({"fill-antialias":new Se(J.paint_fill["fill-antialias"]),"fill-opacity":new Le(J.paint_fill["fill-opacity"]),"fill-color":new Le(J.paint_fill["fill-color"]),"fill-outline-color":new Le(J.paint_fill["fill-outline-color"]),"fill-translate":new Se(J.paint_fill["fill-translate"]),"fill-translate-anchor":new Se(J.paint_fill["fill-translate-anchor"]),"fill-pattern":new al(J.paint_fill["fill-pattern"])})},get layout(){return of=of||new $i({"fill-sort-key":new Le(J.layout_fill["fill-sort-key"])})}};class Qu extends Yn{constructor(t,i){super(t,mm,i)}recalculate(t,i){super.recalculate(t,i);const o=this.paint._values["fill-outline-color"];o.value.kind==="constant"&&o.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new id(t)}queryRadius(){return Yh(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:t,geometry:i,transform:o,pixelsToTileUnits:l}){return Kd(Yl(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-o.bearingInRadians,l),i)}isTileClipped(){return!0}}const nd=zi([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),ad=zi([{name:"a_centroid",components:2,type:"Int16"}],4),{members:Ju}=nd;class Zc{constructor(t,i,o,l,d){this.properties={},this.extent=o,this.type=0,this.id=void 0,this._pbf=t,this._geometry=-1,this._keys=l,this._values=d,t.readFields(gm,this,i)}loadGeometry(){const t=this._pbf;t.pos=this._geometry;const i=t.readVarint()+t.pos,o=[];let l,d=1,p=0,y=0,x=0;for(;t.pos<i;){if(p<=0){const T=t.readVarint();d=7&T,p=T>>3}if(p--,d===1||d===2)y+=t.readSVarint(),x+=t.readSVarint(),d===1&&(l&&o.push(l),l=[]),l&&l.push(new et(y,x));else{if(d!==7)throw new Error(`unknown command ${d}`);l&&l.push(l[0].clone())}}return l&&o.push(l),o}bbox(){const t=this._pbf;t.pos=this._geometry;const i=t.readVarint()+t.pos;let o=1,l=0,d=0,p=0,y=1/0,x=-1/0,T=1/0,M=-1/0;for(;t.pos<i;){if(l<=0){const A=t.readVarint();o=7&A,l=A>>3}if(l--,o===1||o===2)d+=t.readSVarint(),p+=t.readSVarint(),d<y&&(y=d),d>x&&(x=d),p<T&&(T=p),p>M&&(M=p);else if(o!==7)throw new Error(`unknown command ${o}`)}return[y,T,x,M]}toGeoJSON(t,i,o){const l=this.extent*Math.pow(2,o),d=this.extent*t,p=this.extent*i,y=this.loadGeometry();function x(z){return[360*(z.x+d)/l-180,360/Math.PI*Math.atan(Math.exp((1-2*(z.y+p)/l)*Math.PI))-90]}function T(z){return z.map(x)}let M;if(this.type===1){const z=[];for(const R of y)z.push(R[0]);const I=T(z);M=z.length===1?{type:"Point",coordinates:I[0]}:{type:"MultiPoint",coordinates:I}}else if(this.type===2){const z=y.map(T);M=z.length===1?{type:"LineString",coordinates:z[0]}:{type:"MultiLineString",coordinates:z}}else{if(this.type!==3)throw new Error("unknown feature type");{const z=(function(R){const N=R.length;if(N<=1)return[R];const V=[];let $,rt;for(let K=0;K<N;K++){const tt=rd(R[K]);tt!==0&&(rt===void 0&&(rt=tt<0),rt===tt<0?($&&V.push($),$=[R[K]]):$&&$.push(R[K]))}return $&&V.push($),V})(y),I=[];for(const R of z)I.push(R.map(T));M=I.length===1?{type:"Polygon",coordinates:I[0]}:{type:"MultiPolygon",coordinates:I}}}const A={type:"Feature",geometry:M,properties:this.properties};return this.id!=null&&(A.id=this.id),A}}function gm(a,t,i){a===1?t.id=i.readVarint():a===2?(function(o,l){const d=o.readVarint()+o.pos;for(;o.pos<d;){const p=l._keys[o.readVarint()],y=l._values[o.readVarint()];l.properties[p]=y}})(i,t):a===3?t.type=i.readVarint():a===4&&(t._geometry=i.pos)}function rd(a){let t=0;for(let i,o,l=0,d=a.length,p=d-1;l<d;p=l++)i=a[l],o=a[p],t+=(o.x-i.x)*(i.y+o.y);return t}Zc.types=["Unknown","Point","LineString","Polygon"];class Qf{constructor(t,i){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(lf,this,i),this.length=this._features.length}feature(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];const i=this._pbf.readVarint()+this._pbf.pos;return new Zc(this._pbf,i,this.extent,this._keys,this._values)}}function lf(a,t,i){a===15?t.version=i.readVarint():a===1?t.name=i.readString():a===5?t.extent=i.readVarint():a===2?t._features.push(i.pos):a===3?t._keys.push(i.readString()):a===4&&t._values.push((function(o){let l=null;const d=o.readVarint()+o.pos;for(;o.pos<d;){const p=o.readVarint()>>3;l=p===1?o.readString():p===2?o.readFloat():p===3?o.readDouble():p===4?o.readVarint64():p===5?o.readVarint():p===6?o.readSVarint():p===7?o.readBoolean():null}if(l==null)throw new Error("unknown feature value");return l})(i))}class Jf{constructor(t,i){this.layers=t.readFields(rg,{},i)}}function rg(a,t,i){if(a===3){const o=new Qf(i,i.readVarint()+i.pos);o.length&&(t[o.name]=o)}}const tp=Math.pow(2,13);function bi(a,t,i,o,l,d,p,y){a.emplaceBack(t,i,2*Math.floor(o*tp)+p,l*tp*2,d*tp*2,Math.round(y))}class Yi{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((i=>i.id)),this.index=t.index,this.hasDependencies=!1,this.layoutVertexArray=new at,this.centroidVertexArray=new it,this.indexArray=new re,this.programConfigurations=new Hs(t.layers,t.zoom),this.segments=new Fe,this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id))}populate(t,i,o){this.features=[],this.hasDependencies=Wl("fill-extrusion",this.layers,i);for(const{feature:l,id:d,index:p,sourceLayerIndex:y}of t){const x=this.layers[0]._featureFilter.needGeometry,T=Na(l,x);if(!this.layers[0]._featureFilter.filter(new Mi(this.zoom),T,o))continue;const M={id:d,sourceLayerIndex:y,index:p,geometry:x?T.geometry:$s(l),properties:l.properties,type:l.type,patterns:{}};this.hasDependencies?this.features.push(bo("fill-extrusion",this.layers,M,{zoom:this.zoom},i)):this.addFeature(M,M.geometry,p,o,{},i.subdivisionGranularity),i.featureIndex.insert(l,M.geometry,p,y,this.index,!0)}}addFeatures(t,i,o){for(const l of this.features){const{geometry:d}=l;this.addFeature(l,d,l.index,i,o,t.subdivisionGranularity)}}update(t,i,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,i,this.stateDependentLayers,{imagePositions:o})}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Ju),this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,ad.members,!0),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(t,i,o,l,d,p){for(const y of Il(i,500)){const x={x:0,y:0,sampleCount:0},T=this.layoutVertexArray.length;this.processPolygon(x,l,t,y,p);const M=this.layoutVertexArray.length-T,A=Math.floor(x.x/x.sampleCount),z=Math.floor(x.y/x.sampleCount);for(let I=0;I<M;I++)this.centroidVertexArray.emplaceBack(A,z)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,{imagePositions:d,canonical:l})}processPolygon(t,i,o,l,d){if(l.length<1||Vi(l[0]))return;for(const A of l)A.length!==0&&_i(t,A);const p={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},y=d.fill.getGranularityForZoomLevel(i.z),x=Zc.types[o.type]==="Polygon";for(const A of l){if(A.length===0||Vi(A))continue;const z=Ql(A,y,x);this._generateSideFaces(z,p)}if(!x)return;const T=cr(l,i,y,!1),M=this.layoutVertexArray;Jl(((A,z)=>{bi(M,A,z,0,0,1,1,0)}),this.segments,this.layoutVertexArray,this.indexArray,T.verticesFlattened,T.indicesTriangles)}_generateSideFaces(t,i){let o=0;for(let l=1;l<t.length;l++){const d=t[l],p=t[l-1];if(xi(d,p))continue;i.segment.vertexLength+4>Fe.MAX_VERTEX_ARRAY_LENGTH&&(i.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const y=d.sub(p)._perp()._unit(),x=p.dist(d);o+x>32768&&(o=0),bi(this.layoutVertexArray,d.x,d.y,y.x,y.y,0,0,o),bi(this.layoutVertexArray,d.x,d.y,y.x,y.y,0,1,o),o+=x,bi(this.layoutVertexArray,p.x,p.y,y.x,y.y,0,0,o),bi(this.layoutVertexArray,p.x,p.y,y.x,y.y,0,1,o);const T=i.segment.vertexLength;this.indexArray.emplaceBack(T,T+2,T+1),this.indexArray.emplaceBack(T+1,T+2,T+3),i.segment.vertexLength+=4,i.segment.primitiveLength+=2}}}function _i(a,t){for(let i=0;i<t.length;i++){const o=t[i];i===t.length-1&&t[0].x===o.x&&t[0].y===o.y||(a.x+=o.x,a.y+=o.y,a.sampleCount++)}}function xi(a,t){return a.x===t.x&&(a.x<0||a.x>Re)||a.y===t.y&&(a.y<0||a.y>Re)}function Vi(a){return a.every((t=>t.x<0))||a.every((t=>t.x>Re))||a.every((t=>t.y<0))||a.every((t=>t.y>Re))}let Tr;ge("FillExtrusionBucket",Yi,{omit:["layers","features"]});var tc={get paint(){return Tr=Tr||new $i({"fill-extrusion-opacity":new Se(J["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Le(J["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Se(J["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Se(J["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new al(J["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Le(J["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Le(J["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Se(J["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class th extends Yn{constructor(t,i){super(t,tc,i)}createBucket(t){return new Yi(t)}queryRadius(){return Yh(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:t,feature:i,featureState:o,geometry:l,transform:d,pixelsToTileUnits:p,pixelPosMatrix:y}){const x=Yl(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-d.bearingInRadians,p),T=this.paint.get("fill-extrusion-height").evaluate(i,o),M=this.paint.get("fill-extrusion-base").evaluate(i,o),A=(function(I,R){const N=[];for(const V of I){const $=[V.x,V.y,0,1];On($,$,R),N.push(new et($[0]/$[3],$[1]/$[3]))}return N})(x,y),z=(function(I,R,N,V){const $=[],rt=[],K=V[8]*R,tt=V[9]*R,vt=V[10]*R,xt=V[11]*R,Lt=V[8]*N,Jt=V[9]*N,qt=V[10]*N,ee=V[11]*N;for(const fe of I){const oe=[],le=[];for(const Zt of fe){const ze=Zt.x,Pe=Zt.y,ke=V[0]*ze+V[4]*Pe+V[12],Ee=V[1]*ze+V[5]*Pe+V[13],ai=V[2]*ze+V[6]*Pe+V[14],vn=V[3]*ze+V[7]*Pe+V[15],oa=ai+vt,Qa=vn+xt,Do=ke+Lt,Ar=Ee+Jt,ja=ai+qt,Ja=vn+ee,Gn=new et((ke+K)/Qa,(Ee+tt)/Qa);Gn.z=oa/Qa,oe.push(Gn);const Va=new et(Do/Ja,Ar/Ja);Va.z=ja/Ja,le.push(Va)}$.push(oe),rt.push(le)}return[$,rt]})(l,M,T,y);return(function(I,R,N){let V=1/0;Kd(N,R)&&(V=So(N,R[0]));for(let $=0;$<R.length;$++){const rt=R[$],K=I[$];for(let tt=0;tt<rt.length-1;tt++){const vt=rt[tt],xt=[vt,rt[tt+1],K[tt+1],K[tt],vt];Hh(N,xt)&&(V=Math.min(V,So(N,xt)))}}return V!==1/0&&V})(z[0],z[1],A)}}function Hc(a,t){return a.x*t.x+a.y*t.y}function So(a,t){if(a.length===1){let i=0;const o=t[i++];let l;for(;!l||o.equals(l);)if(l=t[i++],!l)return 1/0;for(;i<t.length;i++){const d=t[i],p=a[0],y=l.sub(o),x=d.sub(o),T=p.sub(o),M=Hc(y,y),A=Hc(y,x),z=Hc(x,x),I=Hc(T,y),R=Hc(T,x),N=M*z-A*A,V=(z*I-A*R)/N,$=(M*R-A*I)/N,rt=o.z*(1-V-$)+l.z*V+d.z*$;if(isFinite(rt))return rt}return 1/0}{let i=1/0;for(const o of t)i=Math.min(i,o.z);return i}}const jn=zi([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:ec}=jn,$c=zi([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:ep}=$c,Gr=Math.cos(Math.PI/180*37.5),Xc=Math.pow(2,14)/.5;class Yc{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((i=>i.id)),this.index=t.index,this.hasDependencies=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((i=>{this.gradients[i.id]={}})),this.layoutVertexArray=new dt,this.layoutVertexArray2=new mt,this.indexArray=new re,this.programConfigurations=new Hs(t.layers,t.zoom),this.segments=new Fe,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id))}populate(t,i,o){this.hasDependencies=Wl("line",this.layers,i)||this.hasLineDasharray(this.layers);const l=this.layers[0].layout.get("line-sort-key"),d=!l.isConstant(),p=[];for(const{feature:y,id:x,index:T,sourceLayerIndex:M}of t){const A=this.layers[0]._featureFilter.needGeometry,z=Na(y,A);if(!this.layers[0]._featureFilter.filter(new Mi(this.zoom),z,o))continue;const I=d?l.evaluate(z,{},o):void 0,R={id:x,properties:y.properties,type:y.type,sourceLayerIndex:M,index:T,geometry:A?z.geometry:$s(y),patterns:{},dashes:{},sortKey:I};p.push(R)}d&&p.sort(((y,x)=>y.sortKey-x.sortKey));for(const y of p){const{geometry:x,index:T,sourceLayerIndex:M}=y;this.hasDependencies?(Wl("line",this.layers,i)?bo("line",this.layers,y,{zoom:this.zoom},i):this.hasLineDasharray(this.layers)&&this.addLineDashDependencies(this.layers,y,this.zoom,i),this.patternFeatures.push(y)):this.addFeature(y,x,T,o,{},{},i.subdivisionGranularity),i.featureIndex.insert(t[T].feature,x,T,M,this.index)}}update(t,i,o,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,i,this.stateDependentLayers,{imagePositions:o,dashPositions:l})}addFeatures(t,i,o,l){for(const d of this.patternFeatures)this.addFeature(d,d.geometry,d.index,i,o,l,t.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,ep)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,ec),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,i,o,l,d,p,y){const x=this.layers[0].layout,T=x.get("line-join").evaluate(t,{}),M=x.get("line-cap"),A=x.get("line-miter-limit"),z=x.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const I of i)this.addLine(I,t,T,M,A,z,l,y);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,{imagePositions:d,dashPositions:p,canonical:l})}addLine(t,i,o,l,d,p,y,x){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,t=Ql(t,y?x.line.getGranularityForZoomLevel(y.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let K=0;K<t.length-1;K++)this.totalDistance+=t[K].dist(t[K+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const T=Zc.types[i.type]==="Polygon";let M=t.length;for(;M>=2&&t[M-1].equals(t[M-2]);)M--;let A=0;for(;A<M-1&&t[A].equals(t[A+1]);)A++;if(M<(T?3:2))return;o==="bevel"&&(d=1.05);const z=this.overscaling<=16?122880/(512*this.overscaling):0,I=this.segments.prepareSegment(10*M,this.layoutVertexArray,this.indexArray);let R,N,V,$,rt;this.e1=this.e2=-1,T&&(R=t[M-2],rt=t[A].sub(R)._unit()._perp());for(let K=A;K<M;K++){if(V=K===M-1?T?t[A+1]:void 0:t[K+1],V&&t[K].equals(V))continue;rt&&($=rt),R&&(N=R),R=t[K],rt=V?V.sub(R)._unit()._perp():$,$=$||rt;let tt=$.add(rt);tt.x===0&&tt.y===0||tt._unit();const vt=$.x*rt.x+$.y*rt.y,xt=tt.x*rt.x+tt.y*rt.y,Lt=xt!==0?1/xt:1/0,Jt=2*Math.sqrt(2-2*xt),qt=xt<Gr&&N&&V,ee=$.x*rt.y-$.y*rt.x>0;if(qt&&K>A){const le=R.dist(N);if(le>2*z){const Zt=R.sub(R.sub(N)._mult(z/le)._round());this.updateDistance(N,Zt),this.addCurrentVertex(Zt,$,0,0,I),N=Zt}}const fe=N&&V;let oe=fe?o:T?"butt":l;if(fe&&oe==="round"&&(Lt<p?oe="miter":Lt<=2&&(oe="fakeround")),oe==="miter"&&Lt>d&&(oe="bevel"),oe==="bevel"&&(Lt>2&&(oe="flipbevel"),Lt<d&&(oe="miter")),N&&this.updateDistance(N,R),oe==="miter")tt._mult(Lt),this.addCurrentVertex(R,tt,0,0,I);else if(oe==="flipbevel"){if(Lt>100)tt=rt.mult(-1);else{const le=Lt*$.add(rt).mag()/$.sub(rt).mag();tt._perp()._mult(le*(ee?-1:1))}this.addCurrentVertex(R,tt,0,0,I),this.addCurrentVertex(R,tt.mult(-1),0,0,I)}else if(oe==="bevel"||oe==="fakeround"){const le=-Math.sqrt(Lt*Lt-1),Zt=ee?le:0,ze=ee?0:le;if(N&&this.addCurrentVertex(R,$,Zt,ze,I),oe==="fakeround"){const Pe=Math.round(180*Jt/Math.PI/20);for(let ke=1;ke<Pe;ke++){let Ee=ke/Pe;if(Ee!==.5){const vn=Ee-.5;Ee+=Ee*vn*(Ee-1)*((1.0904+vt*(vt*(3.55645-1.43519*vt)-3.2452))*vn*vn+(.848013+vt*(.215638*vt-1.06021)))}const ai=rt.sub($)._mult(Ee)._add($)._unit()._mult(ee?-1:1);this.addHalfVertex(R,ai.x,ai.y,!1,ee,0,I)}}V&&this.addCurrentVertex(R,rt,-Zt,-ze,I)}else if(oe==="butt")this.addCurrentVertex(R,tt,0,0,I);else if(oe==="square"){const le=N?1:-1;this.addCurrentVertex(R,tt,le,le,I)}else oe==="round"&&(N&&(this.addCurrentVertex(R,$,0,0,I),this.addCurrentVertex(R,$,1,1,I,!0)),V&&(this.addCurrentVertex(R,rt,-1,-1,I,!0),this.addCurrentVertex(R,rt,0,0,I)));if(qt&&K<M-1){const le=R.dist(V);if(le>2*z){const Zt=R.add(V.sub(R)._mult(z/le)._round());this.updateDistance(R,Zt),this.addCurrentVertex(Zt,rt,0,0,I),R=Zt}}}}addCurrentVertex(t,i,o,l,d,p=!1){const y=i.y*l-i.x,x=-i.y-i.x*l;this.addHalfVertex(t,i.x+i.y*o,i.y-i.x*o,p,!1,o,d),this.addHalfVertex(t,y,x,p,!0,-l,d),this.distance>Xc/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(t,i,o,l,d,p))}addHalfVertex({x:t,y:i},o,l,d,p,y,x){const T=.5*(this.lineClips?this.scaledDistance*(Xc-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t<<1)+(d?1:0),(i<<1)+(p?1:0),Math.round(63*o)+128,Math.round(63*l)+128,1+(y===0?0:y<0?-1:1)|(63&T)<<2,T>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const M=x.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,M,this.e2),x.primitiveLength++),p?this.e2=M:this.e1=M}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(t,i){this.distance+=t.dist(i),this.updateScaledDistance()}hasLineDasharray(t){for(const i of t){const o=i.paint.get("line-dasharray");if(o&&!o.isConstant())return!0}return!1}addLineDashDependencies(t,i,o,l){for(const d of t){const p=d.paint.get("line-dasharray");if(!p||p.value.kind==="constant")continue;const y=d.layout.get("line-cap")==="round",x={dasharray:p.value.evaluate({zoom:o-1},i,{}),round:y},T={dasharray:p.value.evaluate({zoom:o},i,{}),round:y},M={dasharray:p.value.evaluate({zoom:o+1},i,{}),round:y},A=`${x.dasharray.join(",")},${x.round}`,z=`${T.dasharray.join(",")},${T.round}`,I=`${M.dasharray.join(",")},${M.round}`;l.dashDependencies[A]=x,l.dashDependencies[z]=T,l.dashDependencies[I]=M,i.dashes[d.id]={min:A,mid:z,max:I}}}}let ur,cf;ge("LineBucket",Yc,{omit:["layers","patternFeatures"]});var sd={get paint(){return cf=cf||new $i({"line-opacity":new Le(J.paint_line["line-opacity"]),"line-color":new Le(J.paint_line["line-color"]),"line-translate":new Se(J.paint_line["line-translate"]),"line-translate-anchor":new Se(J.paint_line["line-translate-anchor"]),"line-width":new Le(J.paint_line["line-width"]),"line-gap-width":new Le(J.paint_line["line-gap-width"]),"line-offset":new Le(J.paint_line["line-offset"]),"line-blur":new Le(J.paint_line["line-blur"]),"line-dasharray":new al(J.paint_line["line-dasharray"]),"line-pattern":new al(J.paint_line["line-pattern"]),"line-gradient":new ma(J.paint_line["line-gradient"])})},get layout(){return ur=ur||new $i({"line-cap":new Se(J.layout_line["line-cap"]),"line-join":new Le(J.layout_line["line-join"]),"line-miter-limit":new Se(J.layout_line["line-miter-limit"]),"line-round-limit":new Se(J.layout_line["line-round-limit"]),"line-sort-key":new Le(J.layout_line["line-sort-key"])})}};class _m extends Le{possiblyEvaluate(t,i){return i=new Mi(Math.floor(i.zoom),{now:i.now,fadeDuration:i.fadeDuration,zoomHistory:i.zoomHistory,transition:i.transition}),super.possiblyEvaluate(t,i)}evaluate(t,i,o,l){return i=Ke({},i,{zoom:Math.floor(i.zoom)}),super.evaluate(t,i,o,l)}}let Wc;class uf extends Yn{constructor(t,i){super(t,sd,i),this.gradientVersion=0,Wc||(Wc=new _m(sd.paint.properties["line-width"].specification),Wc.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){const i=this.gradientExpression();this.stepInterpolant=!!(function(o){return o._styleExpression!==void 0})(i)&&i._styleExpression.expression instanceof io,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,i){super.recalculate(t,i),this.paint._values["line-floorwidth"]=Wc.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new Yc(t)}queryRadius(t){const i=t,o=dl(Uc("line-width",this,i),Uc("line-gap-width",this,i)),l=Uc("line-offset",this,i);return o/2+Math.abs(l)+Yh(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:t,feature:i,featureState:o,geometry:l,transform:d,pixelsToTileUnits:p}){const y=Yl(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-d.bearingInRadians,p),x=p/2*dl(this.paint.get("line-width").evaluate(i,o),this.paint.get("line-gap-width").evaluate(i,o)),T=this.paint.get("line-offset").evaluate(i,o);return T&&(l=(function(M,A){const z=[];for(let I=0;I<M.length;I++){const R=M[I],N=[];for(let V=0;V<R.length;V++){const $=R[V-1],rt=R[V],K=R[V+1],tt=V===0?new et(0,0):rt.sub($)._unit()._perp(),vt=V===R.length-1?new et(0,0):K.sub(rt)._unit()._perp(),xt=tt._add(vt)._unit(),Lt=xt.x*vt.x+xt.y*vt.y;Lt!==0&&xt._mult(1/Lt),N.push(xt._mult(A)._add(rt))}z.push(N)}return z})(l,T*p)),(function(M,A,z){for(let I=0;I<A.length;I++){const R=A[I];if(M.length>=3){for(let N=0;N<R.length;N++)if(Vc(M,R[N]))return!0}if(em(M,R,z))return!0}return!1})(y,l,x)}isTileClipped(){return!0}}function dl(a,t){return t>0?t+2*a:a}const _a=zi([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),ic=zi([{name:"a_projected_pos",components:3,type:"Float32"}],4);zi([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const eh=zi([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);zi([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Eo=zi([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),ip=zi([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function np(a,t,i){return a.sections.forEach((o=>{o.text=(function(l,d,p){const y=d.layout.get("text-transform").evaluate(p,{});return y==="uppercase"?l=l.toLocaleUpperCase():y==="lowercase"&&(l=l.toLocaleLowerCase()),gs.applyArabicShaping&&(l=gs.applyArabicShaping(l)),l})(o.text,t,i)})),a}zi([{name:"triangle",components:3,type:"Uint16"}]),zi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),zi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),zi([{type:"Float32",name:"offsetX"}]),zi([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),zi([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);var Qn=24;const fl={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""},ap={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},qr={40:!0};function rp(a,t,i,o,l,d){if("fontStack"in t){const p=i[t.fontStack],y=p&&p[a];return y?y.metrics.advance*t.scale+l:0}{const p=o[t.imageName];return p?p.displaySize[0]*t.scale*Qn/d+l:0}}function hr(a,t,i,o){const l=Math.pow(a-t,2);return o?a<t?l/2:2*l:l+Math.abs(i)*i}function ym(a,t,i){let o=0;return a===10&&(o-=1e4),i&&(o+=150),a!==40&&a!==65288||(o+=50),t!==41&&t!==65289||(o+=50),o}function sp(a,t,i,o,l,d){let p=null,y=hr(t,i,l,d);for(const x of o){const T=hr(t-x.x,i,l,d)+x.badness;T<=y&&(p=x,y=T)}return{index:a,x:t,priorBreak:p,badness:y}}function vm(a){return a?vm(a.priorBreak).concat(a.index):[]}class Zr{constructor(t="",i=[],o=[]){this.text=t,this.sections=i,this.sectionIndex=o,this.imageSectionID=null}static fromFeature(t,i){const o=new Zr;for(let l=0;l<t.sections.length;l++){const d=t.sections[l];d.image?o.addImageSection(d):o.addTextSection(d,i)}return o}length(){return[...this.text].length}getSection(t){return this.sections[this.sectionIndex[t]]}getSectionIndex(t){return this.sectionIndex[t]}verticalizePunctuation(){this.text=(function(t){let i="",o={premature:!0,value:void 0};const l=t[Symbol.iterator]();let d=l.next();const p=t[Symbol.iterator]();p.next();let y=p.next();for(;!d.done;)i+=!y.done&&Gl(y.value.codePointAt(0))&&!fl[y.value]||!o.premature&&Gl(o.value.codePointAt(0))&&!fl[o.value]||!fl[d.value]?d.value:fl[d.value],o={value:d.value,premature:!1},d=l.next(),y=p.next();return i})(this.text)}hasZeroWidthSpaces(){return this.text.includes("")}trim(){const t=this.text.match(/^\s*/),i=t?t[0].length:0,o=this.text.match(/\S\s*$/),l=o?o[0].length-1:0;this.text=this.text.substring(i,this.text.length-l),this.sectionIndex=this.sectionIndex.slice(i,this.sectionIndex.length-l)}substring(t,i){const o=[...this.text].slice(t,i).join(""),l=this.sectionIndex.slice(t,i);return new Zr(o,this.sections,l)}toCodeUnitIndex(t){return[...this.text].slice(0,t).join("").length}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((t,i)=>Math.max(t,this.sections[i].scale)),0)}getMaxImageSize(t){let i=0,o=0;for(let l=0;l<this.length();l++){const d=this.getSection(l);if("imageName"in d){const p=t[d.imageName];if(!p)continue;const y=p.displaySize;i=Math.max(i,y[0]),o=Math.max(o,y[1])}}return{maxImageWidth:i,maxImageHeight:o}}addTextSection(t,i){this.text+=t.text,this.sections.push({scale:t.scale||1,verticalAlign:t.verticalAlign||"bottom",fontStack:t.fontStack||i});const o=this.sections.length-1;this.sectionIndex.push(...[...t.text].map((()=>o)))}addImageSection(t){const i=t.image?t.image.name:"";if(i.length===0)return void oi("Can't add FormattedSection with an empty image.");const o=this.getNextImageSectionCharCode();o?(this.text+=String.fromCharCode(o),this.sections.push({scale:1,verticalAlign:t.verticalAlign||"bottom",imageName:i}),this.sectionIndex.push(this.sections.length-1)):oi("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}determineLineBreaks(t,i,o,l,d){const p=[],y=this.determineAverageLineWidth(t,i,o,l,d),x=this.hasZeroWidthSpaces();let T=0,M=0;const A=this.text[Symbol.iterator]();let z=A.next();const I=this.text[Symbol.iterator]();I.next();let R=I.next();const N=this.text[Symbol.iterator]();N.next(),N.next();let V=N.next();for(;!z.done;){const $=this.getSection(M),rt=z.value.codePointAt(0);if(Uh(rt)||(T+=rp(rt,$,o,l,t,d)),!R.done){const K=tl(rt),tt=R.value.codePointAt(0);(ap[rt]||K||"imageName"in $||!V.done&&qr[tt])&&p.push(sp(M+1,T,y,p,ym(rt,tt,K&&x),!1))}M++,z=A.next(),R=I.next(),V=N.next()}return vm(sp(this.length(),T,y,p,0,!0))}determineAverageLineWidth(t,i,o,l,d){let p=0,y=0;for(const x of this.text){const T=this.getSection(y);p+=rp(x.codePointAt(0),T,o,l,t,d),y++}return p/Math.max(1,Math.ceil(p/i))}}const ih=4294967296,hf=1/ih,Kc=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");class df{constructor(t=new Uint8Array(16)){this.buf=ArrayBuffer.isView(t)?t:new Uint8Array(t),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(t,i,o=this.length){for(;this.pos<o;){const l=this.readVarint(),d=l>>3,p=this.pos;this.type=7&l,t(d,i,this),this.pos===p&&this.skip(l)}return i}readMessage(t,i){return this.readFields(t,i,this.readVarint()+this.pos)}readFixed32(){const t=this.dataView.getUint32(this.pos,!0);return this.pos+=4,t}readSFixed32(){const t=this.dataView.getInt32(this.pos,!0);return this.pos+=4,t}readFixed64(){const t=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*ih;return this.pos+=8,t}readSFixed64(){const t=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*ih;return this.pos+=8,t}readFloat(){const t=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,t}readDouble(){const t=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,t}readVarint(t){const i=this.buf;let o,l;return l=i[this.pos++],o=127&l,l<128?o:(l=i[this.pos++],o|=(127&l)<<7,l<128?o:(l=i[this.pos++],o|=(127&l)<<14,l<128?o:(l=i[this.pos++],o|=(127&l)<<21,l<128?o:(l=i[this.pos],o|=(15&l)<<28,(function(d,p,y){const x=y.buf;let T,M;if(M=x[y.pos++],T=(112&M)>>4,M<128||(M=x[y.pos++],T|=(127&M)<<3,M<128)||(M=x[y.pos++],T|=(127&M)<<10,M<128)||(M=x[y.pos++],T|=(127&M)<<17,M<128)||(M=x[y.pos++],T|=(127&M)<<24,M<128)||(M=x[y.pos++],T|=(1&M)<<31,M<128))return Qc(d,T,p);throw new Error("Expected varint not more than 10 bytes")})(o,t,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const t=this.readVarint();return t%2==1?(t+1)/-2:t/2}readBoolean(){return!!this.readVarint()}readString(){const t=this.readVarint()+this.pos,i=this.pos;return this.pos=t,t-i>=12&&Kc?Kc.decode(this.buf.subarray(i,t)):(function(o,l,d){let p="",y=l;for(;y<d;){const x=o[y];let T,M,A,z=null,I=x>239?4:x>223?3:x>191?2:1;if(y+I>d)break;I===1?x<128&&(z=x):I===2?(T=o[y+1],(192&T)==128&&(z=(31&x)<<6|63&T,z<=127&&(z=null))):I===3?(T=o[y+1],M=o[y+2],(192&T)==128&&(192&M)==128&&(z=(15&x)<<12|(63&T)<<6|63&M,(z<=2047||z>=55296&&z<=57343)&&(z=null))):I===4&&(T=o[y+1],M=o[y+2],A=o[y+3],(192&T)==128&&(192&M)==128&&(192&A)==128&&(z=(15&x)<<18|(63&T)<<12|(63&M)<<6|63&A,(z<=65535||z>=1114112)&&(z=null))),z===null?(z=65533,I=1):z>65535&&(z-=65536,p+=String.fromCharCode(z>>>10&1023|55296),z=56320|1023&z),p+=String.fromCharCode(z),y+=I}return p})(this.buf,i,t)}readBytes(){const t=this.readVarint()+this.pos,i=this.buf.subarray(this.pos,t);return this.pos=t,i}readPackedVarint(t=[],i){const o=this.readPackedEnd();for(;this.pos<o;)t.push(this.readVarint(i));return t}readPackedSVarint(t=[]){const i=this.readPackedEnd();for(;this.pos<i;)t.push(this.readSVarint());return t}readPackedBoolean(t=[]){const i=this.readPackedEnd();for(;this.pos<i;)t.push(this.readBoolean());return t}readPackedFloat(t=[]){const i=this.readPackedEnd();for(;this.pos<i;)t.push(this.readFloat());return t}readPackedDouble(t=[]){const i=this.readPackedEnd();for(;this.pos<i;)t.push(this.readDouble());return t}readPackedFixed32(t=[]){const i=this.readPackedEnd();for(;this.pos<i;)t.push(this.readFixed32());return t}readPackedSFixed32(t=[]){const i=this.readPackedEnd();for(;this.pos<i;)t.push(this.readSFixed32());return t}readPackedFixed64(t=[]){const i=this.readPackedEnd();for(;this.pos<i;)t.push(this.readFixed64());return t}readPackedSFixed64(t=[]){const i=this.readPackedEnd();for(;this.pos<i;)t.push(this.readSFixed64());return t}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(t){const i=7&t;if(i===0)for(;this.buf[this.pos++]>127;);else if(i===2)this.pos=this.readVarint()+this.pos;else if(i===5)this.pos+=4;else{if(i!==1)throw new Error(`Unimplemented type: ${i}`);this.pos+=8}}writeTag(t,i){this.writeVarint(t<<3|i)}realloc(t){let i=this.length||16;for(;i<this.pos+t;)i*=2;if(i!==this.length){const o=new Uint8Array(i);o.set(this.buf),this.buf=o,this.dataView=new DataView(o.buffer),this.length=i}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(t){this.realloc(4),this.dataView.setInt32(this.pos,t,!0),this.pos+=4}writeSFixed32(t){this.realloc(4),this.dataView.setInt32(this.pos,t,!0),this.pos+=4}writeFixed64(t){this.realloc(8),this.dataView.setInt32(this.pos,-1&t,!0),this.dataView.setInt32(this.pos+4,Math.floor(t*hf),!0),this.pos+=8}writeSFixed64(t){this.realloc(8),this.dataView.setInt32(this.pos,-1&t,!0),this.dataView.setInt32(this.pos+4,Math.floor(t*hf),!0),this.pos+=8}writeVarint(t){(t=+t||0)>268435455||t<0?(function(i,o){let l,d;if(i>=0?(l=i%4294967296|0,d=i/4294967296|0):(l=~(-i%4294967296),d=~(-i/4294967296),4294967295^l?l=l+1|0:(l=0,d=d+1|0)),i>=18446744073709552e3||i<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");o.realloc(10),(function(p,y,x){x.buf[x.pos++]=127&p|128,p>>>=7,x.buf[x.pos++]=127&p|128,p>>>=7,x.buf[x.pos++]=127&p|128,p>>>=7,x.buf[x.pos++]=127&p|128,x.buf[x.pos]=127&(p>>>=7)})(l,0,o),(function(p,y){const x=(7&p)<<4;y.buf[y.pos++]|=x|((p>>>=3)?128:0),p&&(y.buf[y.pos++]=127&p|((p>>>=7)?128:0),p&&(y.buf[y.pos++]=127&p|((p>>>=7)?128:0),p&&(y.buf[y.pos++]=127&p|((p>>>=7)?128:0),p&&(y.buf[y.pos++]=127&p|((p>>>=7)?128:0),p&&(y.buf[y.pos++]=127&p)))))})(d,o)})(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))}writeSVarint(t){this.writeVarint(t<0?2*-t-1:2*t)}writeBoolean(t){this.writeVarint(+t)}writeString(t){t=String(t),this.realloc(4*t.length),this.pos++;const i=this.pos;this.pos=(function(l,d,p){for(let y,x,T=0;T<d.length;T++){if(y=d.charCodeAt(T),y>55295&&y<57344){if(!x){y>56319||T+1===d.length?(l[p++]=239,l[p++]=191,l[p++]=189):x=y;continue}if(y<56320){l[p++]=239,l[p++]=191,l[p++]=189,x=y;continue}y=x-55296<<10|y-56320|65536,x=null}else x&&(l[p++]=239,l[p++]=191,l[p++]=189,x=null);y<128?l[p++]=y:(y<2048?l[p++]=y>>6|192:(y<65536?l[p++]=y>>12|224:(l[p++]=y>>18|240,l[p++]=y>>12&63|128),l[p++]=y>>6&63|128),l[p++]=63&y|128)}return p})(this.buf,t,this.pos);const o=this.pos-i;o>=128&&op(i,o,this),this.pos=i-1,this.writeVarint(o),this.pos+=o}writeFloat(t){this.realloc(4),this.dataView.setFloat32(this.pos,t,!0),this.pos+=4}writeDouble(t){this.realloc(8),this.dataView.setFloat64(this.pos,t,!0),this.pos+=8}writeBytes(t){const i=t.length;this.writeVarint(i),this.realloc(i);for(let o=0;o<i;o++)this.buf[this.pos++]=t[o]}writeRawMessage(t,i){this.pos++;const o=this.pos;t(i,this);const l=this.pos-o;l>=128&&op(o,l,this),this.pos=o-1,this.writeVarint(l),this.pos+=l}writeMessage(t,i,o){this.writeTag(t,2),this.writeRawMessage(i,o)}writePackedVarint(t,i){i.length&&this.writeMessage(t,xm,i)}writePackedSVarint(t,i){i.length&&this.writeMessage(t,ff,i)}writePackedBoolean(t,i){i.length&&this.writeMessage(t,og,i)}writePackedFloat(t,i){i.length&&this.writeMessage(t,lp,i)}writePackedDouble(t,i){i.length&&this.writeMessage(t,sg,i)}writePackedFixed32(t,i){i.length&&this.writeMessage(t,lg,i)}writePackedSFixed32(t,i){i.length&&this.writeMessage(t,bm,i)}writePackedFixed64(t,i){i.length&&this.writeMessage(t,wm,i)}writePackedSFixed64(t,i){i.length&&this.writeMessage(t,nh,i)}writeBytesField(t,i){this.writeTag(t,2),this.writeBytes(i)}writeFixed32Field(t,i){this.writeTag(t,5),this.writeFixed32(i)}writeSFixed32Field(t,i){this.writeTag(t,5),this.writeSFixed32(i)}writeFixed64Field(t,i){this.writeTag(t,1),this.writeFixed64(i)}writeSFixed64Field(t,i){this.writeTag(t,1),this.writeSFixed64(i)}writeVarintField(t,i){this.writeTag(t,0),this.writeVarint(i)}writeSVarintField(t,i){this.writeTag(t,0),this.writeSVarint(i)}writeStringField(t,i){this.writeTag(t,2),this.writeString(i)}writeFloatField(t,i){this.writeTag(t,5),this.writeFloat(i)}writeDoubleField(t,i){this.writeTag(t,1),this.writeDouble(i)}writeBooleanField(t,i){this.writeVarintField(t,+i)}}function Qc(a,t,i){return i?4294967296*t+(a>>>0):4294967296*(t>>>0)+(a>>>0)}function op(a,t,i){const o=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));i.realloc(o);for(let l=i.pos-1;l>=a;l--)i.buf[l+o]=i.buf[l]}function xm(a,t){for(let i=0;i<a.length;i++)t.writeVarint(a[i])}function ff(a,t){for(let i=0;i<a.length;i++)t.writeSVarint(a[i])}function lp(a,t){for(let i=0;i<a.length;i++)t.writeFloat(a[i])}function sg(a,t){for(let i=0;i<a.length;i++)t.writeDouble(a[i])}function og(a,t){for(let i=0;i<a.length;i++)t.writeBoolean(a[i])}function lg(a,t){for(let i=0;i<a.length;i++)t.writeFixed32(a[i])}function bm(a,t){for(let i=0;i<a.length;i++)t.writeSFixed32(a[i])}function wm(a,t){for(let i=0;i<a.length;i++)t.writeFixed64(a[i])}function nh(a,t){for(let i=0;i<a.length;i++)t.writeSFixed64(a[i])}function pf(a,t,i){a===1&&i.readMessage(Tm,t)}function Tm(a,t,i){if(a===3){const{id:o,bitmap:l,width:d,height:p,left:y,top:x,advance:T}=i.readMessage(Sm,{});t.push({id:o,bitmap:new Hu({width:d+6,height:p+6},l),metrics:{width:d,height:p,left:y,top:x,advance:T}})}}function Sm(a,t,i){a===1?t.id=i.readVarint():a===2?t.bitmap=i.readBytes():a===3?t.width=i.readVarint():a===4?t.height=i.readVarint():a===5?t.left=i.readSVarint():a===6?t.top=i.readSVarint():a===7&&(t.advance=i.readVarint())}function cp(a){let t=0,i=0;for(const p of a)t+=p.w*p.h,i=Math.max(i,p.w);a.sort(((p,y)=>y.h-p.h));const o=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),i),h:1/0}];let l=0,d=0;for(const p of a)for(let y=o.length-1;y>=0;y--){const x=o[y];if(!(p.w>x.w||p.h>x.h)){if(p.x=x.x,p.y=x.y,d=Math.max(d,p.y+p.h),l=Math.max(l,p.x+p.w),p.w===x.w&&p.h===x.h){const T=o.pop();T&&y<o.length&&(o[y]=T)}else p.h===x.h?(x.x+=p.w,x.w-=p.w):p.w===x.w?(x.y+=p.h,x.h-=p.h):(o.push({x:x.x+p.w,y:x.y,w:x.w-p.w,h:p.h}),x.y+=p.h,x.h-=p.h);break}}return{w:l,h:d,fill:t/(l*d)||0}}class mf{constructor(t,{pixelRatio:i,version:o,stretchX:l,stretchY:d,content:p,textFitWidth:y,textFitHeight:x}){this.paddedRect=t,this.pixelRatio=i,this.stretchX=l,this.stretchY=d,this.content=p,this.version=o,this.textFitWidth=y,this.textFitHeight=x}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class up{constructor(t,i){const o={},l={};this.haveRenderCallbacks=[];const d=[];this.addImages(t,o,d),this.addImages(i,l,d);const{w:p,h:y}=cp(d),x=new Fa({width:p||1,height:y||1});for(const T in t){const M=t[T],A=o[T].paddedRect;Fa.copy(M.data,x,{x:0,y:0},{x:A.x+1,y:A.y+1},M.data)}for(const T in i){const M=i[T],A=l[T].paddedRect,z=A.x+1,I=A.y+1,R=M.data.width,N=M.data.height;Fa.copy(M.data,x,{x:0,y:0},{x:z,y:I},M.data),Fa.copy(M.data,x,{x:0,y:N-1},{x:z,y:I-1},{width:R,height:1}),Fa.copy(M.data,x,{x:0,y:0},{x:z,y:I+N},{width:R,height:1}),Fa.copy(M.data,x,{x:R-1,y:0},{x:z-1,y:I},{width:1,height:N}),Fa.copy(M.data,x,{x:0,y:0},{x:z+R,y:I},{width:1,height:N})}this.image=x,this.iconPositions=o,this.patternPositions=l}addImages(t,i,o){for(const l in t){const d=t[l],p={x:0,y:0,w:d.data.width+2,h:d.data.height+2};o.push(p),i[l]=new mf(p,d),d.hasRenderCallback&&this.haveRenderCallbacks.push(l)}}patchUpdatedImages(t,i){t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const o in t.updatedImages)this.patchUpdatedImage(this.iconPositions[o],t.getImage(o),i),this.patchUpdatedImage(this.patternPositions[o],t.getImage(o),i)}patchUpdatedImage(t,i,o){if(!t||!i||t.version===i.version)return;t.version=i.version;const[l,d]=t.tl;o.update(i.data,void 0,{x:l,y:d})}}var pl;function Jc(a,t,i,o,l,d,p,y,x,T,M,A,z,I,R){const N=Zr.fromFeature(a,l);let V;A===P.ay.vertical&&N.verticalizePunctuation();let $=N.determineLineBreaks(T,d,t,o,I);const{processBidirectionalText:rt,processStyledBidirectionalText:K}=gs;if(rt&&N.sections.length===1){V=[],$=$.map((Lt=>N.toCodeUnitIndex(Lt)));const xt=rt(N.toString(),$);for(const Lt of xt){const Jt=[...Lt].map((()=>0));V.push(new Zr(Lt,N.sections,Jt))}}else if(K){V=[],$=$.map((qt=>N.toCodeUnitIndex(qt)));let xt=0;const Lt=[];for(const qt of N.text)Lt.push(...Array(qt.length).fill(N.sectionIndex[xt])),xt++;const Jt=K(N.text,Lt,$);for(const qt of Jt){const ee=[];let fe="";for(const oe of qt[0])ee.push(qt[1][fe.length]),fe+=oe;V.push(new Zr(qt[0],N.sections,ee))}}else V=(function(xt,Lt){const Jt=[];let qt=0;for(const ee of Lt)Jt.push(xt.substring(qt,ee)),qt=ee;return qt<xt.length()&&Jt.push(xt.substring(qt,xt.length())),Jt})(N,$);const tt=[],vt={positionedLines:tt,text:N.toString(),top:M[1],bottom:M[1],left:M[0],right:M[0],writingMode:A,iconsInText:!1,verticalizable:!1};return(function(xt,Lt,Jt,qt,ee,fe,oe,le,Zt,ze,Pe,ke){let Ee=0,ai=0,vn=0,oa=0;const Qa=le==="right"?1:le==="left"?0:.5,Do=Qn/ke;let Ar=0;for(const Gn of ee){Gn.trim();const Va=Gn.getMaxScale(),fr={positionedGlyphs:[],lineOffset:0};xt.positionedLines[Ar]=fr;const pr=fr.positionedGlyphs;let Xr=0;if(!Gn.length()){ai+=fe,++Ar;continue}const tr=Em(qt,Gn,Do);let Yr=0;for(const Aa of Gn.text){const Mn=Gn.getSection(Yr),la=Aa.codePointAt(0),kn=hp(Zt,Pe,la),Da={glyph:la,imageName:null,x:Ee,y:ai+-17,vertical:kn,scale:1,fontStack:"",sectionIndex:Gn.getSectionIndex(Yr),metrics:null,rect:null};let hu;if("fontStack"in Mn){if(hu=cg(Mn,la,kn,tr,Lt,Jt),!hu)continue;Da.fontStack=Mn.fontStack}else{if(xt.iconsInText=!0,Mn.scale*=Do,hu=Mm(Mn,kn,Va,tr,qt),!hu)continue;Xr=Math.max(Xr,hu.imageOffset),Da.imageName=Mn.imageName}const{rect:vl,metrics:Zp,baselineOffset:gh}=hu;Da.y+=gh,Da.scale=Mn.scale,Da.metrics=Zp,Da.rect=vl,pr.push(Da),kn?(xt.verticalizable=!0,Ee+=("imageName"in Mn?Zp.advance:Qn)*Mn.scale+ze):Ee+=Zp.advance*Mn.scale+ze,Yr++}pr.length!==0&&(vn=Math.max(Ee-ze,vn),ug(pr,0,pr.length-1,Qa)),Ee=0,fr.lineOffset=Math.max(Xr,(Va-1)*Qn);const zo=fe*Va+Xr;ai+=zo,oa=Math.max(zo,oa),++Ar}const{horizontalAlign:ja,verticalAlign:Ja}=gf(oe);(function(Gn,Va,fr,pr,Xr,tr,Yr,zo,Aa){const Mn=(Va-fr)*Xr;let la=0;la=tr!==Yr?-zo*pr- -17:-pr*Aa*Yr+.5*Yr;for(const kn of Gn)for(const Da of kn.positionedGlyphs)Da.x+=Mn,Da.y+=la})(xt.positionedLines,Qa,ja,Ja,vn,oa,fe,ai,ee.length),xt.top+=-Ja*ai,xt.bottom=xt.top+ai,xt.left+=-ja*vn,xt.right=xt.left+vn})(vt,t,i,o,V,p,y,x,A,T,z,R),!(function(xt){for(const Lt of xt)if(Lt.positionedGlyphs.length!==0)return!1;return!0})(tt)&&vt}function gf(a){let t=.5,i=.5;switch(a){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(a){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:t,verticalAlign:i}}function Em(a,t,i){const o=t.getMaxScale()*Qn,{maxImageWidth:l,maxImageHeight:d}=t.getMaxImageSize(a),p=Math.max(o,d*i);return{verticalLineContentWidth:Math.max(o,l*i),horizontalLineContentHeight:p}}function Ui(a){switch(a){case"top":return 0;case"center":return .5;default:return 1}}function hp(a,t,i){return!(a===P.ay.horizontal||!t&&!vr(i)||t&&(Uh(i)||(o=i,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(o)))));var o}function cg(a,t,i,o,l,d){const p=d[a.fontStack],y=(function(T,M,A,z){if(T&&T.rect)return T;const I=M[A.fontStack],R=I&&I[z];return R?{rect:null,metrics:R.metrics}:null})(p&&p[t],l,a,t);if(y===null)return null;let x;if(i)x=o.verticalLineContentWidth-a.scale*Qn;else{const T=Ui(a.verticalAlign);x=(o.horizontalLineContentHeight-a.scale*Qn)*T}return{rect:y.rect,metrics:y.metrics,baselineOffset:x}}function Mm(a,t,i,o,l){const d=l[a.imageName];if(!d)return null;const p=d.paddedRect,y=d.displaySize,x={width:y[0],height:y[1],left:1,top:-3,advance:t?y[1]:y[0]};let T;if(t)T=o.verticalLineContentWidth-y[1]*a.scale;else{const M=Ui(a.verticalAlign);T=(o.horizontalLineContentHeight-y[1]*a.scale)*M}return{rect:p,metrics:x,baselineOffset:T,imageOffset:(t?y[0]:y[1])*a.scale-Qn*i}}function ug(a,t,i,o){if(o===0)return;const l=a[i],d=(a[i].x+l.metrics.advance*l.scale)*o;for(let p=t;p<=i;p++)a[p].x-=d}function hg(a,t,i){const{horizontalAlign:o,verticalAlign:l}=gf(i),d=t[0]-a.displaySize[0]*o,p=t[1]-a.displaySize[1]*l;return{image:a,top:p,bottom:p+a.displaySize[1],left:d,right:d+a.displaySize[0]}}function Cm(a){var t,i;let o=a.left,l=a.top,d=a.right-o,p=a.bottom-l;const y=(t=a.image.textFitWidth)!==null&&t!==void 0?t:"stretchOrShrink",x=(i=a.image.textFitHeight)!==null&&i!==void 0?i:"stretchOrShrink",T=(a.image.content[2]-a.image.content[0])/(a.image.content[3]-a.image.content[1]);if(x==="proportional"){if(y==="stretchOnly"&&d/p<T||y==="proportional"){const M=Math.ceil(p*T);o*=M/d,d=M}}else if(y==="proportional"&&x==="stretchOnly"&&T!==0&&d/p>T){const M=Math.ceil(d/T);l*=M/p,p=M}return{x1:o,y1:l,x2:o+d,y2:l+p}}function od(a,t,i,o,l,d){const p=a.image;let y;if(p.content){const V=p.content,$=p.pixelRatio||1;y=[V[0]/$,V[1]/$,p.displaySize[0]-V[2]/$,p.displaySize[1]-V[3]/$]}const x=t.left*d,T=t.right*d;let M,A,z,I;i==="width"||i==="both"?(I=l[0]+x-o[3],A=l[0]+T+o[1]):(I=l[0]+(x+T-p.displaySize[0])/2,A=I+p.displaySize[0]);const R=t.top*d,N=t.bottom*d;return i==="height"||i==="both"?(M=l[1]+R-o[0],z=l[1]+N+o[2]):(M=l[1]+(R+N-p.displaySize[1])/2,z=M+p.displaySize[1]),{image:p,top:M,right:A,bottom:z,left:I,collisionPadding:y}}ge("ImagePosition",mf),ge("ImageAtlas",up),P.ay=void 0,(pl=P.ay||(P.ay={}))[pl.none=0]="none",pl[pl.horizontal=1]="horizontal",pl[pl.vertical=2]="vertical",pl[pl.horizontalOnly=3]="horizontalOnly";const Sr=128,Mo=32640;function ld(a,t){const{expression:i}=t;if(i.kind==="constant")return{kind:"constant",layoutSize:i.evaluate(new Mi(a+1))};if(i.kind==="source")return{kind:"source"};{const{zoomStops:o,interpolationType:l}=i;let d=0;for(;d<o.length&&o[d]<=a;)d++;d=Math.max(0,d-1);let p=d;for(;p<o.length&&o[p]<a+1;)p++;p=Math.min(o.length-1,p);const y=o[d],x=o[p];return i.kind==="composite"?{kind:"composite",minZoom:y,maxZoom:x,interpolationType:l}:{kind:"camera",minZoom:y,maxZoom:x,minSize:i.evaluate(new Mi(y)),maxSize:i.evaluate(new Mi(x)),interpolationType:l}}}function cd(a,t,i){let o="never";const l=a.get(t);return l?o=l:a.get(i)&&(o="always"),o}const nc=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Hr(a,t,i,o,l,d,p,y,x,T,M,A,z){const I=y?Math.min(Mo,Math.round(y[0])):0,R=y?Math.min(Mo,Math.round(y[1])):0;a.emplaceBack(t,i,Math.round(32*o),Math.round(32*l),d,p,(I<<1)+(x?1:0),R,16*T,16*M,256*A,256*z)}function tu(a,t,i){a.emplaceBack(t.x,t.y,i),a.emplaceBack(t.x,t.y,i),a.emplaceBack(t.x,t.y,i),a.emplaceBack(t.x,t.y,i)}function dg(a){for(const t of a.sections)if(Fs(t.text))return!0;return!1}class _f{constructor(t){this.layoutVertexArray=new kt,this.indexArray=new re,this.programConfigurations=t,this.segments=new Fe,this.dynamicLayoutVertexArray=new zt,this.opacityVertexArray=new It,this.hasVisibleVertices=!1,this.placedSymbolArray=new S}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(t,i,o,l){this.isEmpty()||(o&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,_a.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,ic.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,nc,!0),this.opacityVertexBuffer.itemSize=1),(o||l)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}ge("SymbolBuffers",_f);class yf{constructor(t,i,o){this.layoutVertexArray=new t,this.layoutAttributes=i,this.indexArray=new o,this.segments=new Fe,this.collisionVertexArray=new ae}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,eh.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}ge("CollisionBuffers",yf);class eu{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((p=>p.id)),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasDependencies=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];const i=this.layers[0]._unevaluatedLayout._values;this.textSizeData=ld(this.zoom,i["text-size"]),this.iconSizeData=ld(this.zoom,i["icon-size"]);const o=this.layers[0].layout,l=o.get("symbol-sort-key"),d=o.get("symbol-z-order");this.canOverlap=cd(o,"text-overlap","text-allow-overlap")!=="never"||cd(o,"icon-overlap","icon-allow-overlap")!=="never"||o.get("text-ignore-placement")||o.get("icon-ignore-placement"),this.sortFeaturesByKey=d!=="viewport-y"&&!l.isConstant(),this.sortFeaturesByY=(d==="viewport-y"||d==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,o.get("symbol-placement")==="point"&&(this.writingModes=o.get("text-writing-mode").map((p=>P.ay[p]))),this.stateDependentLayerIds=this.layers.filter((p=>p.isStateDependent())).map((p=>p.id)),this.sourceID=t.sourceID}createArrays(){this.text=new _f(new Hs(this.layers,this.zoom,(t=>/^text/.test(t)))),this.icon=new _f(new Hs(this.layers,this.zoom,(t=>/^icon/.test(t)))),this.glyphOffsetArray=new k,this.lineVertexArray=new L,this.symbolInstances=new D,this.textAnchorOffsets=new Z}calculateGlyphDependencies(t,i,o,l,d){for(const p of t)if(i[p.codePointAt(0)]=!0,(o||l)&&d){const y=fl[p];y&&(i[y.codePointAt(0)]=!0)}}populate(t,i,o){const l=this.layers[0],d=l.layout,p=d.get("text-font"),y=d.get("text-field"),x=d.get("icon-image"),T=(y.value.kind!=="constant"||y.value.value instanceof wn&&!y.value.value.isEmpty()||y.value.value.toString().length>0)&&(p.value.kind!=="constant"||p.value.value.length>0),M=x.value.kind!=="constant"||!!x.value.value||Object.keys(x.parameters).length>0,A=d.get("symbol-sort-key");if(this.features=[],!T&&!M)return;const z=i.iconDependencies,I=i.glyphDependencies,R=i.availableImages,N=new Mi(this.zoom);for(const{feature:V,id:$,index:rt,sourceLayerIndex:K}of t){const tt=l._featureFilter.needGeometry,vt=Na(V,tt);if(!l._featureFilter.filter(N,vt,o))continue;let xt,Lt;if(tt||(vt.geometry=$s(V)),T){const qt=l.getValueAndResolveTokens("text-field",vt,o,R),ee=wn.factory(qt),fe=this.hasRTLText=this.hasRTLText||dg(ee);(!fe||gs.getRTLTextPluginStatus()==="unavailable"||fe&&gs.isParsed())&&(xt=np(ee,l,vt))}if(M){const qt=l.getValueAndResolveTokens("icon-image",vt,o,R);Lt=qt instanceof Tn?qt:Tn.fromString(qt)}if(!xt&&!Lt)continue;const Jt=this.sortFeaturesByKey?A.evaluate(vt,{},o):void 0;if(this.features.push({id:$,text:xt,icon:Lt,index:rt,sourceLayerIndex:K,geometry:vt.geometry,properties:V.properties,type:Zc.types[V.type],sortKey:Jt}),Lt&&(z[Lt.name]=!0),xt){const qt=p.evaluate(vt,{},o).join(","),ee=d.get("text-rotation-alignment")!=="viewport"&&d.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(P.ay.vertical)>=0;for(const fe of xt.sections)if(fe.image)z[fe.image.name]=!0;else{const oe=Vl(xt.toString()),le=fe.fontStack||qt,Zt=I[le]=I[le]||{};this.calculateGlyphDependencies(fe.text,Zt,ee,this.allowVerticalPlacement,oe)}}}d.get("symbol-placement")==="line"&&(this.features=(function(V){const $={},rt={},K=[];let tt=0;function vt(qt){K.push(V[qt]),tt++}function xt(qt,ee,fe){const oe=rt[qt];return delete rt[qt],rt[ee]=oe,K[oe].geometry[0].pop(),K[oe].geometry[0]=K[oe].geometry[0].concat(fe[0]),oe}function Lt(qt,ee,fe){const oe=$[ee];return delete $[ee],$[qt]=oe,K[oe].geometry[0].shift(),K[oe].geometry[0]=fe[0].concat(K[oe].geometry[0]),oe}function Jt(qt,ee,fe){const oe=fe?ee[0][ee[0].length-1]:ee[0][0];return`${qt}:${oe.x}:${oe.y}`}for(let qt=0;qt<V.length;qt++){const ee=V[qt],fe=ee.geometry,oe=ee.text?ee.text.toString():null;if(!oe){vt(qt);continue}const le=Jt(oe,fe),Zt=Jt(oe,fe,!0);if(le in rt&&Zt in $&&rt[le]!==$[Zt]){const ze=Lt(le,Zt,fe),Pe=xt(le,Zt,K[ze].geometry);delete $[le],delete rt[Zt],rt[Jt(oe,K[Pe].geometry,!0)]=Pe,K[ze].geometry=null}else le in rt?xt(le,Zt,fe):Zt in $?Lt(le,Zt,fe):(vt(qt),$[le]=tt-1,rt[Zt]=tt-1)}return K.filter((qt=>qt.geometry))})(this.features)),this.sortFeaturesByKey&&this.features.sort(((V,$)=>V.sortKey-$.sortKey))}update(t,i,o){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,i,this.layers,{imagePositions:o}),this.icon.programConfigurations.updatePaintArrays(t,i,this.layers,{imagePositions:o}))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,i){const o=this.lineVertexArray.length;if(t.segment!==void 0){let l=t.dist(i[t.segment+1]),d=t.dist(i[t.segment]);const p={};for(let y=t.segment+1;y<i.length;y++)p[y]={x:i[y].x,y:i[y].y,tileUnitDistanceFromAnchor:l},y<i.length-1&&(l+=i[y+1].dist(i[y]));for(let y=t.segment||0;y>=0;y--)p[y]={x:i[y].x,y:i[y].y,tileUnitDistanceFromAnchor:d},y>0&&(d+=i[y-1].dist(i[y]));for(let y=0;y<i.length;y++){const x=p[y];this.lineVertexArray.emplaceBack(x.x,x.y,x.tileUnitDistanceFromAnchor)}}return{lineStartIndex:o,lineLength:this.lineVertexArray.length-o}}addSymbols(t,i,o,l,d,p,y,x,T,M,A,z){const I=t.indexArray,R=t.layoutVertexArray,N=t.segments.prepareSegment(4*i.length,R,I,this.canOverlap?p.sortKey:void 0),V=this.glyphOffsetArray.length,$=N.vertexLength,rt=this.allowVerticalPlacement&&y===P.ay.vertical?Math.PI/2:0,K=p.text&&p.text.sections;for(let tt=0;tt<i.length;tt++){const{tl:vt,tr:xt,bl:Lt,br:Jt,tex:qt,pixelOffsetTL:ee,pixelOffsetBR:fe,minFontScaleX:oe,minFontScaleY:le,glyphOffset:Zt,isSDF:ze,sectionIndex:Pe}=i[tt],ke=N.vertexLength,Ee=Zt[1];Hr(R,x.x,x.y,vt.x,Ee+vt.y,qt.x,qt.y,o,ze,ee.x,ee.y,oe,le),Hr(R,x.x,x.y,xt.x,Ee+xt.y,qt.x+qt.w,qt.y,o,ze,fe.x,ee.y,oe,le),Hr(R,x.x,x.y,Lt.x,Ee+Lt.y,qt.x,qt.y+qt.h,o,ze,ee.x,fe.y,oe,le),Hr(R,x.x,x.y,Jt.x,Ee+Jt.y,qt.x+qt.w,qt.y+qt.h,o,ze,fe.x,fe.y,oe,le),tu(t.dynamicLayoutVertexArray,x,rt),I.emplaceBack(ke,ke+2,ke+1),I.emplaceBack(ke+1,ke+2,ke+3),N.vertexLength+=4,N.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Zt[0]),tt!==i.length-1&&Pe===i[tt+1].sectionIndex||t.programConfigurations.populatePaintArrays(R.length,p,p.index,{imagePositions:{},canonical:z,formattedSection:K&&K[Pe]})}t.placedSymbolArray.emplaceBack(x.x,x.y,V,this.glyphOffsetArray.length-V,$,T,M,x.segment,o?o[0]:0,o?o[1]:0,l[0],l[1],y,0,!1,0,A)}_addCollisionDebugVertex(t,i,o,l,d,p){return i.emplaceBack(0,0),t.emplaceBack(o.x,o.y,l,d,Math.round(p.x),Math.round(p.y))}addCollisionDebugVertices(t,i,o,l,d,p,y){const x=d.segments.prepareSegment(4,d.layoutVertexArray,d.indexArray),T=x.vertexLength,M=d.layoutVertexArray,A=d.collisionVertexArray,z=y.anchorX,I=y.anchorY;this._addCollisionDebugVertex(M,A,p,z,I,new et(t,i)),this._addCollisionDebugVertex(M,A,p,z,I,new et(o,i)),this._addCollisionDebugVertex(M,A,p,z,I,new et(o,l)),this._addCollisionDebugVertex(M,A,p,z,I,new et(t,l)),x.vertexLength+=4;const R=d.indexArray;R.emplaceBack(T,T+1),R.emplaceBack(T+1,T+2),R.emplaceBack(T+2,T+3),R.emplaceBack(T+3,T),x.primitiveLength+=4}addDebugCollisionBoxes(t,i,o,l){for(let d=t;d<i;d++){const p=this.collisionBoxArray.get(d);this.addCollisionDebugVertices(p.x1,p.y1,p.x2,p.y2,l?this.textCollisionBox:this.iconCollisionBox,p.anchorPoint,o)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new yf(Rt,Eo.members,Xt),this.iconCollisionBox=new yf(Rt,Eo.members,Xt);for(let t=0;t<this.symbolInstances.length;t++){const i=this.symbolInstances.get(t);this.addDebugCollisionBoxes(i.textBoxStartIndex,i.textBoxEndIndex,i,!0),this.addDebugCollisionBoxes(i.verticalTextBoxStartIndex,i.verticalTextBoxEndIndex,i,!0),this.addDebugCollisionBoxes(i.iconBoxStartIndex,i.iconBoxEndIndex,i,!1),this.addDebugCollisionBoxes(i.verticalIconBoxStartIndex,i.verticalIconBoxEndIndex,i,!1)}}_deserializeCollisionBoxesForSymbol(t,i,o,l,d,p,y,x,T){const M={};for(let A=i;A<o;A++){const z=t.get(A);M.textBox={x1:z.x1,y1:z.y1,x2:z.x2,y2:z.y2,anchorPointX:z.anchorPointX,anchorPointY:z.anchorPointY},M.textFeatureIndex=z.featureIndex;break}for(let A=l;A<d;A++){const z=t.get(A);M.verticalTextBox={x1:z.x1,y1:z.y1,x2:z.x2,y2:z.y2,anchorPointX:z.anchorPointX,anchorPointY:z.anchorPointY},M.verticalTextFeatureIndex=z.featureIndex;break}for(let A=p;A<y;A++){const z=t.get(A);M.iconBox={x1:z.x1,y1:z.y1,x2:z.x2,y2:z.y2,anchorPointX:z.anchorPointX,anchorPointY:z.anchorPointY},M.iconFeatureIndex=z.featureIndex;break}for(let A=x;A<T;A++){const z=t.get(A);M.verticalIconBox={x1:z.x1,y1:z.y1,x2:z.x2,y2:z.y2,anchorPointX:z.anchorPointX,anchorPointY:z.anchorPointY},M.verticalIconFeatureIndex=z.featureIndex;break}return M}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){const o=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,o.textBoxStartIndex,o.textBoxEndIndex,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o.iconBoxStartIndex,o.iconBoxEndIndex,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,i){const o=t.placedSymbolArray.get(i),l=o.vertexStartIndex+4*o.numGlyphs;for(let d=o.vertexStartIndex;d<l;d+=4)t.indexArray.emplaceBack(d,d+2,d+1),t.indexArray.emplaceBack(d+1,d+2,d+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const i=Math.sin(t),o=Math.cos(t),l=[],d=[],p=[];for(let y=0;y<this.symbolInstances.length;++y){p.push(y);const x=this.symbolInstances.get(y);l.push(0|Math.round(i*x.anchorX+o*x.anchorY)),d.push(x.featureIndex)}return p.sort(((y,x)=>l[y]-l[x]||d[x]-d[y])),p}addToSortKeyRanges(t,i){const o=this.sortKeyRanges[this.sortKeyRanges.length-1];o&&o.sortKey===i?o.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const i of this.symbolInstanceIndexes){const o=this.symbolInstances.get(i);this.featureSortOrder.push(o.featureIndex),[o.rightJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.leftJustifiedTextSymbolIndex].forEach(((l,d,p)=>{l>=0&&p.indexOf(l)===d&&this.addIndicesForPlacedSymbol(this.text,l)})),o.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,o.verticalPlacedTextSymbolIndex),o.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.placedIconSymbolIndex),o.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let dp,Am;ge("SymbolBucket",eu,{omit:["layers","collisionBoxArray","features","compareText"]}),eu.MAX_GLYPHS=65535,eu.addDynamicAttributes=tu;var ud={get paint(){return Am=Am||new $i({"icon-opacity":new Le(J.paint_symbol["icon-opacity"]),"icon-color":new Le(J.paint_symbol["icon-color"]),"icon-halo-color":new Le(J.paint_symbol["icon-halo-color"]),"icon-halo-width":new Le(J.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Le(J.paint_symbol["icon-halo-blur"]),"icon-translate":new Se(J.paint_symbol["icon-translate"]),"icon-translate-anchor":new Se(J.paint_symbol["icon-translate-anchor"]),"text-opacity":new Le(J.paint_symbol["text-opacity"]),"text-color":new Le(J.paint_symbol["text-color"],{runtimeType:ba,getOverride:a=>a.textColor,hasOverride:a=>!!a.textColor}),"text-halo-color":new Le(J.paint_symbol["text-halo-color"]),"text-halo-width":new Le(J.paint_symbol["text-halo-width"]),"text-halo-blur":new Le(J.paint_symbol["text-halo-blur"]),"text-translate":new Se(J.paint_symbol["text-translate"]),"text-translate-anchor":new Se(J.paint_symbol["text-translate-anchor"])})},get layout(){return dp=dp||new $i({"symbol-placement":new Se(J.layout_symbol["symbol-placement"]),"symbol-spacing":new Se(J.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Se(J.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Le(J.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Se(J.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Se(J.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Se(J.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Se(J.layout_symbol["icon-ignore-placement"]),"icon-optional":new Se(J.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Se(J.layout_symbol["icon-rotation-alignment"]),"icon-size":new Le(J.layout_symbol["icon-size"]),"icon-text-fit":new Se(J.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Se(J.layout_symbol["icon-text-fit-padding"]),"icon-image":new Le(J.layout_symbol["icon-image"]),"icon-rotate":new Le(J.layout_symbol["icon-rotate"]),"icon-padding":new Le(J.layout_symbol["icon-padding"]),"icon-keep-upright":new Se(J.layout_symbol["icon-keep-upright"]),"icon-offset":new Le(J.layout_symbol["icon-offset"]),"icon-anchor":new Le(J.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Se(J.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Se(J.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Se(J.layout_symbol["text-rotation-alignment"]),"text-field":new Le(J.layout_symbol["text-field"]),"text-font":new Le(J.layout_symbol["text-font"]),"text-size":new Le(J.layout_symbol["text-size"]),"text-max-width":new Le(J.layout_symbol["text-max-width"]),"text-line-height":new Se(J.layout_symbol["text-line-height"]),"text-letter-spacing":new Le(J.layout_symbol["text-letter-spacing"]),"text-justify":new Le(J.layout_symbol["text-justify"]),"text-radial-offset":new Le(J.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Se(J.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Le(J.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Le(J.layout_symbol["text-anchor"]),"text-max-angle":new Se(J.layout_symbol["text-max-angle"]),"text-writing-mode":new Se(J.layout_symbol["text-writing-mode"]),"text-rotate":new Le(J.layout_symbol["text-rotate"]),"text-padding":new Se(J.layout_symbol["text-padding"]),"text-keep-upright":new Se(J.layout_symbol["text-keep-upright"]),"text-transform":new Le(J.layout_symbol["text-transform"]),"text-offset":new Le(J.layout_symbol["text-offset"]),"text-allow-overlap":new Se(J.layout_symbol["text-allow-overlap"]),"text-overlap":new Se(J.layout_symbol["text-overlap"]),"text-ignore-placement":new Se(J.layout_symbol["text-ignore-placement"]),"text-optional":new Se(J.layout_symbol["text-optional"])})}};class fp{constructor(t){if(t.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=t.property.overrides?t.property.overrides.runtimeType:vi,this.defaultValue=t}evaluate(t){if(t.formattedSection){const i=this.defaultValue.property.overrides;if(i&&i.hasOverride(t.formattedSection))return i.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}ge("FormatSectionOverride",fp,{omit:["defaultValue"]});class hd extends Yn{constructor(t,i){super(t,ud,i)}recalculate(t,i){if(super.recalculate(t,i),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const o=this.layout.get("text-writing-mode");if(o){const l=[];for(const d of o)l.indexOf(d)<0&&l.push(d);this.layout._values["text-writing-mode"]=l}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(t,i,o,l){const d=this.layout.get(t).evaluate(i,{},o,l),p=this._unevaluatedLayout._values[t];return p.isDataDriven()||Dc(p.value)||!d?d:(function(y,x){return x.replace(/{([^{}]+)}/g,((T,M)=>y&&M in y?String(y[M]):""))})(i.properties,d)}createBucket(t){return new eu(t)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const t of ud.paint.overridableProperties){if(!hd.hasPaintOverride(this.layout,t))continue;const i=this.paint.get(t),o=new fp(i),l=new Ol(o,i.property.specification);let d=null;d=i.value.kind==="constant"||i.value.kind==="source"?new lo("source",l):new ka("composite",l,i.value.zoomStops),this.paint._values[t]=new br(i.property,d,i.parameters)}}_handleOverridablePaintPropertyUpdate(t,i,o){return!(!this.layout||i.isDataDriven()||o.isDataDriven())&&hd.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,i){const o=t.get("text-field"),l=ud.paint.properties[i];let d=!1;const p=y=>{for(const x of y)if(l.overrides&&l.overrides.hasOverride(x))return void(d=!0)};if(o.value.kind==="constant"&&o.value.value instanceof wn)p(o.value.value.sections);else if(o.value.kind==="source"||o.value.kind==="composite"){const y=T=>{d||(T instanceof Cs&&Ni(T.value)===Js?p(T.value.sections):T instanceof Fo?p(T.sections):T.eachChild(y))},x=o.value;x._styleExpression&&y(x._styleExpression.expression)}return d}}let Dm;var pp={get paint(){return Dm=Dm||new $i({"background-color":new Se(J.paint_background["background-color"]),"background-pattern":new ju(J.paint_background["background-pattern"]),"background-opacity":new Se(J.paint_background["background-opacity"])})}};class mp extends Yn{constructor(t,i){super(t,pp,i)}}class fg extends Yn{constructor(t,i){super(t,{},i),this.onAdd=o=>{this.implementation.onAdd&&this.implementation.onAdd(o,o.painter.context.gl)},this.onRemove=o=>{this.implementation.onRemove&&this.implementation.onRemove(o,o.painter.context.gl)},this.implementation=t}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class pg{constructor(t){this._methodToThrottle=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._methodToThrottle()}),0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const dd={once:!0},gp=63710088e-1;class ml{constructor(t,i){if(isNaN(t)||isNaN(i))throw new Error(`Invalid LngLat object: (${t}, ${i})`);if(this.lng=+t,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new ml(Ue(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const i=Math.PI/180,o=this.lat*i,l=t.lat*i,d=Math.sin(o)*Math.sin(l)+Math.cos(o)*Math.cos(l)*Math.cos((t.lng-this.lng)*i);return gp*Math.acos(Math.min(d,1))}static convert(t){if(t instanceof ml)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new ml(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new ml(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const di=2*Math.PI*gp;function vf(a){return di*Math.cos(a*Math.PI/180)}function fd(a){return(180+a)/360}function xf(a){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a*Math.PI/360)))/360}function _p(a,t){return a/vf(t)}function bf(a){return 360*a-180}function ac(a){return 360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90}function pd(a,t){return a*vf(ac(t))}class md{constructor(t,i,o=0){this.x=+t,this.y=+i,this.z=+o}static fromLngLat(t,i=0){const o=ml.convert(t);return new md(fd(o.lng),xf(o.lat),_p(i,o.lat))}toLngLat(){return new ml(bf(this.x),ac(this.y))}toAltitude(){return pd(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/di*(t=ac(this.y),1/Math.cos(t*Math.PI/180));var t}}function yp(a,t,i){var o=2*Math.PI*6378137/256/Math.pow(2,i);return[a*o-2*Math.PI*6378137/2,t*o-2*Math.PI*6378137/2]}class vp{constructor(t,i,o){if(!(function(l,d,p){return!(l<0||l>25||p<0||p>=Math.pow(2,l)||d<0||d>=Math.pow(2,l))})(t,i,o))throw new Error(`x=${i}, y=${o}, z=${t} outside of bounds. 0<=x<${Math.pow(2,t)}, 0<=y<${Math.pow(2,t)} 0<=z<=25 `);this.z=t,this.x=i,this.y=o,this.key=iu(0,t,t,i,o)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,i,o){const l=(p=this.y,y=this.z,x=yp(256*(d=this.x),256*(p=Math.pow(2,y)-p-1),y),T=yp(256*(d+1),256*(p+1),y),x[0]+","+x[1]+","+T[0]+","+T[1]);var d,p,y,x,T;const M=(function(A,z,I){let R,N="";for(let V=A;V>0;V--)R=1<<V-1,N+=(z&R?1:0)+(I&R?2:0);return N})(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(o==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,i>1?"@2x":"").replace(/{quadkey}/g,M).replace(/{bbox-epsg-3857}/g,l)}isChildOf(t){const i=this.z-t.z;return i>0&&t.x===this.x>>i&&t.y===this.y>>i}getTilePoint(t){const i=Math.pow(2,this.z);return new et((t.x*i-this.x)*Re,(t.y*i-this.y)*Re)}toString(){return`${this.z}/${this.x}/${this.y}`}}class zm{constructor(t,i){this.wrap=t,this.canonical=i,this.key=iu(t,i.z,i.z,i.x,i.y)}}class Er{constructor(t,i,o,l,d){if(this.terrainRttPosMatrix32f=null,t<o)throw new Error(`overscaledZ should be >= z; overscaledZ = ${t}; z = ${o}`);this.overscaledZ=t,this.wrap=i,this.canonical=new vp(o,+l,+d),this.key=iu(i,t,o,l,d)}clone(){return new Er(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const i=this.canonical.z-t;return t>this.canonical.z?new Er(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Er(t,this.wrap,t,this.canonical.x>>i,this.canonical.y>>i)}isOverscaled(){return this.overscaledZ>this.canonical.z}calculateScaledKey(t,i){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const o=this.canonical.z-t;return t>this.canonical.z?iu(this.wrap*+i,t,this.canonical.z,this.canonical.x,this.canonical.y):iu(this.wrap*+i,t,t,this.canonical.x>>o,this.canonical.y>>o)}isChildOf(t){if(t.wrap!==this.wrap||this.overscaledZ-t.overscaledZ<=0)return!1;if(t.overscaledZ===0)return this.overscaledZ>0;const i=this.canonical.z-t.canonical.z;return!(i<0)&&t.canonical.x===this.canonical.x>>i&&t.canonical.y===this.canonical.y>>i}children(t){if(this.overscaledZ>=t)return[new Er(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const i=this.canonical.z+1,o=2*this.canonical.x,l=2*this.canonical.y;return[new Er(i,this.wrap,i,o,l),new Er(i,this.wrap,i,o+1,l),new Er(i,this.wrap,i,o,l+1),new Er(i,this.wrap,i,o+1,l+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new Er(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new Er(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new zm(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(t){return this.canonical.getTilePoint(new md(t.x-this.wrap,t.y))}}function iu(a,t,i,o,l){(a*=2)<0&&(a=-1*a-1);const d=1<<i;return(d*d*a+d*l+o).toString(36)+i.toString(36)+t.toString(36)}function Pi(a,t){return t?a.properties[t]:a.id}function xp(a,t){const i={id:a.id};if(t.removeAllProperties&&(delete a.removeProperties,delete a.addOrUpdateProperties,delete t.removeProperties),t.removeProperties)for(const o of t.removeProperties){const l=a.addOrUpdateProperties.findIndex((d=>d.key===o));l>-1&&a.addOrUpdateProperties.splice(l,1)}return(a.removeAllProperties||t.removeAllProperties)&&(i.removeAllProperties=!0),(a.removeProperties||t.removeProperties)&&(i.removeProperties=[...a.removeProperties||[],...t.removeProperties||[]]),(a.addOrUpdateProperties||t.addOrUpdateProperties)&&(i.addOrUpdateProperties=[...a.addOrUpdateProperties||[],...t.addOrUpdateProperties||[]]),(a.newGeometry||t.newGeometry)&&(i.newGeometry=t.newGeometry||a.newGeometry),i}function Ma(a){var t,i;if(!a)return{};const o={};return o.removeAll=a.removeAll,o.remove=new Set(a.remove||[]),o.add=new Map((t=a.add)===null||t===void 0?void 0:t.map((l=>[l.id,l]))),o.update=new Map((i=a.update)===null||i===void 0?void 0:i.map((l=>[l.id,l]))),o}ge("CanonicalTileID",vp),ge("OverscaledTileID",Er,{omit:["terrainRttPosMatrix32f"]});class Pm{constructor(t){this._stringToNumber={},this._numberToString=[];for(let i=0;i<t.length;i++){const o=t[i];this._stringToNumber[o]=i,this._numberToString[i]=o}}encode(t){return this._stringToNumber[t]}decode(t){if(t>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${t} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[t]}}class bp{constructor(t,i,o,l,d){this.type="Feature",this._vectorTileFeature=t,t._z=i,t._x=o,t._y=l,this.properties=t.properties,this.id=d}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={geometry:this.geometry};for(const i in this)i!=="_geometry"&&i!=="_vectorTileFeature"&&(t[i]=this[i]);return t}}class ah{_name;dataBuffer;nullabilityBuffer;_size;constructor(t,i,o){this._name=t,this.dataBuffer=i,typeof o=="number"?this._size=o:(this.nullabilityBuffer=o,this._size=o.size())}getValue(t){return this.nullabilityBuffer&&!this.nullabilityBuffer.get(t)?null:this.getValueFromBuffer(t)}has(t){return this.nullabilityBuffer&&this.nullabilityBuffer.get(t)||!this.nullabilityBuffer}get name(){return this._name}get size(){return this._size}}class rh extends ah{}class gd extends rh{getValueFromBuffer(t){return this.dataBuffer[t]}}class sh extends rh{getValueFromBuffer(t){return this.dataBuffer[t]}}class wp extends ah{delta;constructor(t,i,o,l){super(t,i,l),this.delta=o}}class wf extends wp{constructor(t,i,o,l){super(t,Int32Array.of(i),o,l)}getValueFromBuffer(t){return this.dataBuffer[0]+t*this.delta}}class _d extends ah{constructor(t,i,o){super(t,Int32Array.of(i),o)}getValueFromBuffer(t){return this.dataBuffer[0]}}class Tp{_name;_geometryVector;_idVector;_propertyVectors;_extent;propertyVectorsMap;constructor(t,i,o,l,d=4096){this._name=t,this._geometryVector=i,this._idVector=o,this._propertyVectors=l,this._extent=d}get name(){return this._name}get idVector(){return this._idVector}get geometryVector(){return this._geometryVector}get propertyVectors(){return this._propertyVectors}getPropertyVector(t){return this.propertyVectorsMap||(this.propertyVectorsMap=new Map(this._propertyVectors.map((i=>[i.name,i])))),this.propertyVectorsMap.get(t)}*[Symbol.iterator](){const t=this.geometryVector[Symbol.iterator]();let i=0;for(;i<this.numFeatures;){let o;this.idVector&&(o=this.containsMaxSaveIntegerValues(this.idVector)?Number(this.idVector.getValue(i)):this.idVector.getValue(i));const l=t?.next().value,d={};for(const p of this.propertyVectors){if(!p)continue;const y=p.name,x=p.getValue(i);x!==null&&(d[y]=x)}i++,yield{id:o,geometry:l,properties:d}}}get numFeatures(){return this.geometryVector.numGeometries}get extent(){return this._extent}getFeatures(){const t=[],i=this.geometryVector.getGeometries();for(let o=0;o<this.numFeatures;o++){let l;this.idVector&&(l=this.containsMaxSaveIntegerValues(this.idVector)?Number(this.idVector.getValue(o)):this.idVector.getValue(o));const d={coordinates:i[o],type:this.geometryVector.geometryType(o)},p={};for(const y of this.propertyVectors){if(!y)continue;const x=y.name,T=y.getValue(o);T!==null&&(p[x]=T)}t.push({id:l,geometry:d,properties:p})}return t}containsMaxSaveIntegerValues(t){return t instanceof gd||t instanceof _d&&t instanceof wf||t instanceof sh}}class mg{value;constructor(t){this.value=t}get(){return this.value}set(t){this.value=t}increment(){return this.value++}add(t){this.value+=t}}var ya,ni,Co,Ys,nu,Jn,ta,ea,Tf,$r;(function(a){a.PRESENT="PRESENT",a.DATA="DATA",a.OFFSET="OFFSET",a.LENGTH="LENGTH"})(ya||(ya={}));class Sp{_dictionaryType;_offsetType;_lengthType;constructor(t,i,o){this._dictionaryType=t,this._offsetType=i,this._lengthType=o}get dictionaryType(){return this._dictionaryType}get offsetType(){return this._offsetType}get lengthType(){return this._lengthType}}function Vn(a,t,i){const o=new Int32Array(i);let l=0,d=t.get();for(let p=0;p<o.length;p++){let y=a[d++],x=127&y;y<128||(y=a[d++],x|=(127&y)<<7,y<128||(y=a[d++],x|=(127&y)<<14,y<128||(y=a[d++],x|=(127&y)<<21,y<128||(y=a[d++],x|=(15&y)<<28)))),o[l++]=x}return t.set(d),o}function oh(a,t,i){const o=new BigInt64Array(i);for(let l=0;l<o.length;l++)o[l]=Rm(a,t);return o}function Ep(a,t){let i,o;return o=a[t.get()],t.increment(),i=127&o,o<128?i:(o=a[t.get()],t.increment(),i|=(127&o)<<7,o<128?i:(o=a[t.get()],t.increment(),i|=(127&o)<<14,o<128?i:(o=a[t.get()],t.increment(),i|=(127&o)<<21,o<128?i:(o=a[t.get()],i|=(15&o)<<28,(function(l,d,p){let y,x;if(x=d[p.get()],p.increment(),y=(112&x)>>4,x<128||(x=d[p.get()],p.increment(),y|=(127&x)<<3,x<128)||(x=d[p.get()],p.increment(),y|=(127&x)<<10,x<128)||(x=d[p.get()],p.increment(),y|=(127&x)<<17,x<128)||(x=d[p.get()],p.increment(),y|=(127&x)<<24,x<128)||(x=d[p.get()],p.increment(),y|=(1&x)<<31,x<128))return 4294967296*y+(l>>>0);throw new Error("Expected varint not more than 10 bytes")})(i,a,t)))))}function Im(a,t,i,o){throw new Error("FastPFor is not implemented yet.")}function Ca(a){return a>>>1^-(1&a)}function rc(a){return a>>1n^-(1n&a)}function Rm(a,t){let i=0n,o=0,l=t.get();for(;l<a.length;){const d=a[l++];if(i|=BigInt(127&d)<<BigInt(o),!(128&d))break;if(o+=7,o>=64)throw new Error("Varint too long")}return t.set(l),i}function Mp(a,t,i){const o=new Int32Array(i);let l=0;for(let d=0;d<t;d++){const p=a[d];o.fill(a[d+t],l,l+p),l+=p}return o}function Cp(a,t,i){const o=new BigInt64Array(i);let l=0;for(let d=0;d<t;d++){const p=Number(a[d]);o.fill(a[d+t],l,l+p),l+=p}return o}function lh(a,t,i){const o=new Float64Array(i);let l=0;for(let d=0;d<t;d++){const p=a[d];o.fill(a[d+t],l,l+p),l+=p}return o}function Mr(a){const t=a.length/4*4;let i=1;if(t>=4)for(let o=a[0];i<t-4;i+=4)o=a[i]+=o,o=a[i+1]+=o,o=a[i+2]+=o,o=a[i+3]+=o;for(;i!=a.length;)a[i]+=a[i-1],++i}function Ap(a){a[0]=a[0]>>>1^-(1&a[0]),a[1]=a[1]>>>1^-(1&a[1]);const t=a.length/4*4;let i=2;if(t>=4)for(;i<t-4;i+=4){const o=a[i],l=a[i+1],d=a[i+2],p=a[i+3];a[i]=(o>>>1^-(1&o))+a[i-2],a[i+1]=(l>>>1^-(1&l))+a[i-1],a[i+2]=(d>>>1^-(1&d))+a[i],a[i+3]=(p>>>1^-(1&p))+a[i+1]}for(;i!=a.length;i+=2)a[i]=(a[i]>>>1^-(1&a[i]))+a[i-2],a[i+1]=(a[i+1]>>>1^-(1&a[i+1]))+a[i-1]}function Ws(a,t,i){return Math.min(i,Math.max(t,a))}(function(a){a.NONE="NONE",a.DELTA="DELTA",a.COMPONENTWISE_DELTA="COMPONENTWISE_DELTA",a.RLE="RLE",a.MORTON="MORTON",a.PDE="PDE"})(ni||(ni={})),(function(a){a.NONE="NONE",a.FAST_PFOR="FAST_PFOR",a.VARINT="VARINT",a.ALP="ALP"})(Co||(Co={})),(function(a){a.NONE="NONE",a.SINGLE="SINGLE",a.SHARED="SHARED",a.VERTEX="VERTEX",a.MORTON="MORTON",a.FSST="FSST"})(Ys||(Ys={})),(function(a){a.VERTEX="VERTEX",a.INDEX="INDEX",a.STRING="STRING",a.KEY="KEY"})(nu||(nu={})),(function(a){a.VAR_BINARY="VAR_BINARY",a.GEOMETRIES="GEOMETRIES",a.PARTS="PARTS",a.RINGS="RINGS",a.TRIANGLES="TRIANGLES",a.SYMBOL="SYMBOL",a.DICTIONARY="DICTIONARY"})(Jn||(Jn={}));class dr{_physicalStreamType;_logicalStreamType;_logicalLevelTechnique1;_logicalLevelTechnique2;_physicalLevelTechnique;_numValues;_byteLength;constructor(t,i,o,l,d,p,y){this._physicalStreamType=t,this._logicalStreamType=i,this._logicalLevelTechnique1=o,this._logicalLevelTechnique2=l,this._physicalLevelTechnique=d,this._numValues=p,this._byteLength=y}static decode(t,i){const o=t[i.get()],l=Object.values(ya)[o>>4];let d=null;switch(l){case ya.DATA:d=new Sp(Object.values(Ys)[15&o]);break;case ya.OFFSET:d=new Sp(null,Object.values(nu)[15&o]);break;case ya.LENGTH:d=new Sp(null,null,Object.values(Jn)[15&o])}i.increment();const p=t[i.get()],y=Object.values(ni)[p>>5],x=Object.values(ni)[p>>2&7],T=Object.values(Co)[3&p];i.increment();const M=Vn(t,i,2);return new dr(l,d,y,x,T,M[0],M[1])}get physicalStreamType(){return this._physicalStreamType}get logicalStreamType(){return this._logicalStreamType}get logicalLevelTechnique1(){return this._logicalLevelTechnique1}get logicalLevelTechnique2(){return this._logicalLevelTechnique2}get physicalLevelTechnique(){return this._physicalLevelTechnique}get numValues(){return this._numValues}get byteLength(){return this._byteLength}getDecompressedCount(){return this._numValues}}class Sf extends dr{num_bits;coordinate_shift;constructor(t,i,o,l,d,p,y,x,T){super(t,i,o,l,d,p,y),this.num_bits=x,this.coordinate_shift=T}static decode(t,i){const o=dr.decode(t,i),l=Vn(t,i,2);return new Sf(o.physicalStreamType,o.logicalStreamType,o.logicalLevelTechnique1,o.logicalLevelTechnique2,o.physicalLevelTechnique,o.numValues,o.byteLength,l[0],l[1])}static decodePartial(t,i,o){const l=Vn(i,o,2);return new Sf(t.physicalStreamType,t.logicalStreamType,t.logicalLevelTechnique1,t.logicalLevelTechnique2,t.physicalLevelTechnique,t.numValues,t.byteLength,l[0],l[1])}numBits(){return this.num_bits}coordinateShift(){return this.coordinate_shift}}class yd extends dr{_runs;_numRleValues;constructor(t,i,o,l,d,p,y,x,T){super(t,i,o,l,d,p,y),this._runs=x,this._numRleValues=T}static decode(t,i){const o=dr.decode(t,i),l=Vn(t,i,2);return new yd(o.physicalStreamType,o.logicalStreamType,o.logicalLevelTechnique1,o.logicalLevelTechnique2,o.physicalLevelTechnique,o.numValues,o.byteLength,l[0],l[1])}static decodePartial(t,i,o){const l=Vn(i,o,2);return new yd(t.physicalStreamType,t.logicalStreamType,t.logicalLevelTechnique1,t.logicalLevelTechnique2,t.physicalLevelTechnique,t.numValues,t.byteLength,l[0],l[1])}get runs(){return this._runs}get numRleValues(){return this._numRleValues}getDecompressedCount(){return this._numRleValues}}class Un{static decode(t,i){const o=dr.decode(t,i);return o.logicalLevelTechnique1===ni.MORTON?Sf.decodePartial(o,t,i):ni.RLE!==o.logicalLevelTechnique1&&ni.RLE!==o.logicalLevelTechnique2||Co.NONE===o.physicalLevelTechnique?o:yd.decodePartial(o,t,i)}}(function(a){a[a.FLAT=0]="FLAT",a[a.CONST=1]="CONST",a[a.SEQUENCE=2]="SEQUENCE",a[a.DICTIONARY=3]="DICTIONARY",a[a.FSST_DICTIONARY=4]="FSST_DICTIONARY"})(ta||(ta={}));class ws{values;_size;constructor(t,i){this.values=t,this._size=i}get(t){const i=Math.floor(t/8);return(this.values[i]>>t%8&1)==1}set(t,i){const o=Math.floor(t/8);this.values[o]=this.values[o]|(i?1:0)<<t%8}getInt(t){const i=Math.floor(t/8);return this.values[i]>>t%8&1}size(){return this._size}getBuffer(){return this.values}}class He{constructor(){}static decodeIntStream(t,i,o,l,d){const p=He.decodePhysicalLevelTechnique(t,i,o);return this.decodeIntBuffer(p,o,l,d)}static decodeLengthStreamToOffsetBuffer(t,i,o){const l=He.decodePhysicalLevelTechnique(t,i,o);return this.decodeLengthToOffsetBuffer(l,o)}static decodePhysicalLevelTechnique(t,i,o){const l=o.physicalLevelTechnique;if(l===Co.FAST_PFOR)return Im();if(l===Co.VARINT)return Vn(t,i,o.numValues);if(l===Co.NONE){const d=i.get();i.add(o.byteLength);const p=t.subarray(d,i.get());return new Int32Array(p)}throw new Error("Specified physicalLevelTechnique is not supported (yet).")}static decodeConstIntStream(t,i,o,l){const d=He.decodePhysicalLevelTechnique(t,i,o);if(d.length===1){const p=d[0];return l?Ca(p):p}return l?(function(p){return Ca(p[1])})(d):(function(p){return p[1]})(d)}static decodeSequenceIntStream(t,i,o){return(function(l){if(l.length==2){const d=Ca(l[1]);return[d,d]}return[Ca(l[2]),Ca(l[3])]})(He.decodePhysicalLevelTechnique(t,i,o))}static decodeSequenceLongStream(t,i,o){return(function(l){if(l.length==2){const d=rc(l[1]);return[d,d]}return[rc(l[2]),rc(l[3])]})(oh(t,i,o.numValues))}static decodeLongStream(t,i,o,l){const d=oh(t,i,o.numValues);return this.decodeLongBuffer(d,o,l)}static decodeLongFloat64Stream(t,i,o,l){const d=(function(p,y,x){const T=new Float64Array(y);for(let M=0;M<y;M++)T[M]=Ep(p,x);return T})(t,o.numValues,i);return this.decodeFloat64Buffer(d,o,l)}static decodeConstLongStream(t,i,o,l){const d=oh(t,i,o.numValues);if(d.length===1){const p=d[0];return l?rc(p):p}return l?(function(p){return rc(p[1])})(d):(function(p){return p[1]})(d)}static decodeIntBuffer(t,i,o,l){switch(i.logicalLevelTechnique1){case ni.DELTA:return i.logicalLevelTechnique2===ni.RLE?(function(d,p,y){const x=new Int32Array(y);let T=0,M=0;for(let A=0;A<p;A++){const z=d[A],I=Ca(d[A+p]);for(let R=0;R<z;R++)M+=I,x[T++]=M}return x})(t,i.runs,i.numRleValues):((function(d){d[0]=d[0]>>>1^-(1&d[0]);const p=d.length/4*4;let y=1;if(p>=4)for(;y<p-4;y+=4){const x=d[y],T=d[y+1],M=d[y+2],A=d[y+3];d[y]=(x>>>1^-(1&x))+d[y-1],d[y+1]=(T>>>1^-(1&T))+d[y],d[y+2]=(M>>>1^-(1&M))+d[y+1],d[y+3]=(A>>>1^-(1&A))+d[y+2]}for(;y!=d.length;++y)d[y]=(d[y]>>>1^-(1&d[y]))+d[y-1]})(t),t);case ni.RLE:return(function(d,p,y){return y?(function(x,T,M){const A=new Int32Array(M);let z=0;for(let I=0;I<T;I++){const R=x[I];let N=x[I+T];N=N>>>1^-(1&N),A.fill(N,z,z+R),z+=R}return A})(d,p.runs,p.numRleValues):Mp(d,p.runs,p.numRleValues)})(t,i,o);case ni.MORTON:return Mr(t),t;case ni.COMPONENTWISE_DELTA:return l?((function(d,p,y,x){let T=d[0]>>>1^-(1&d[0]),M=d[1]>>>1^-(1&d[1]);d[0]=Ws(Math.round(T*p),y,x),d[1]=Ws(Math.round(M*p),y,x);const A=d.length/16;let z=2;if(A>=4)for(;z<A-4;z+=4){const I=d[z],R=d[z+1],N=(I>>>1^-(1&I))+T,V=(R>>>1^-(1&R))+M;d[z]=Ws(Math.round(N*p),y,x),d[z+1]=Ws(Math.round(V*p),y,x);const $=d[z+2],rt=d[z+3];T=($>>>1^-(1&$))+N,M=(rt>>>1^-(1&rt))+V,d[z+2]=Ws(Math.round(T*p),y,x),d[z+3]=Ws(Math.round(M*p),y,x)}for(;z!=d.length;z+=2)T+=d[z]>>>1^-(1&d[z]),M+=d[z+1]>>>1^-(1&d[z+1]),d[z]=Ws(Math.round(T*p),y,x),d[z+1]=Ws(Math.round(M*p),y,x)})(t,l.scale,l.min,l.max),t):(Ap(t),t);case ni.NONE:return o&&(function(d){for(let p=0;p<d.length;p++){const y=d[p];d[p]=y>>>1^-(1&y)}})(t),t;default:throw new Error(`The specified Logical level technique is not supported: ${i.logicalLevelTechnique1}`)}}static decodeLongBuffer(t,i,o){switch(i.logicalLevelTechnique1){case ni.DELTA:return i.logicalLevelTechnique2===ni.RLE?(function(l,d,p){const y=new BigInt64Array(p);let x=0,T=0n;for(let M=0;M<d;M++){const A=Number(l[M]),z=rc(l[M+d]);for(let I=0;I<A;I++)T+=z,y[x++]=T}return y})(t,i.runs,i.numRleValues):((function(l){l[0]=l[0]>>1n^-(1n&l[0]);const d=l.length/4*4;let p=1;if(d>=4)for(;p<d-4;p+=4){const y=l[p],x=l[p+1],T=l[p+2],M=l[p+3];l[p]=(y>>1n^-(1n&y))+l[p-1],l[p+1]=(x>>1n^-(1n&x))+l[p],l[p+2]=(T>>1n^-(1n&T))+l[p+1],l[p+3]=(M>>1n^-(1n&M))+l[p+2]}for(;p!=l.length;++p)l[p]=(l[p]>>1n^-(1n&l[p]))+l[p-1]})(t),t);case ni.RLE:return(function(l,d,p){return p?(function(y,x,T){const M=new BigInt64Array(T);let A=0;for(let z=0;z<x;z++){const I=Number(y[z]);let R=y[z+x];R=R>>1n^-(1n&R),M.fill(R,A,A+I),A+=I}return M})(l,d.runs,d.numRleValues):Cp(l,d.runs,d.numRleValues)})(t,i,o);case ni.NONE:return o&&(function(l){for(let d=0;d<l.length;d++){const p=l[d];l[d]=p>>1n^-(1n&p)}})(t),t;default:throw new Error(`The specified Logical level technique is not supported: ${i.logicalLevelTechnique1}`)}}static decodeFloat64Buffer(t,i,o){switch(i.logicalLevelTechnique1){case ni.DELTA:return i.logicalLevelTechnique2===ni.RLE&&(t=lh(t,i.runs,i.numRleValues)),(function(l){l[0]=l[0]%2==1?(l[0]+1)/-2:l[0]/2;const d=l.length/4*4;let p=1;if(d>=4)for(;p<d-4;p+=4){const y=l[p],x=l[p+1],T=l[p+2],M=l[p+3];l[p]=(y%2==1?(y+1)/-2:y/2)+l[p-1],l[p+1]=(x%2==1?(x+1)/-2:x/2)+l[p],l[p+2]=(T%2==1?(T+1)/-2:T/2)+l[p+1],l[p+3]=(M%2==1?(M+1)/-2:M/2)+l[p+2]}for(;p!=l.length;++p)l[p]=(l[p]%2==1?(l[p]+1)/-2:l[p]/2)+l[p-1]})(t),t;case ni.RLE:return(function(l,d,p){return p?(function(y,x,T){const M=new Float64Array(T);let A=0;for(let z=0;z<x;z++){const I=y[z];let R=y[z+x];R=R%2==1?(R+1)/-2:R/2,M.fill(R,A,A+I),A+=I}return M})(l,d.runs,d.numRleValues):lh(l,d.runs,d.numRleValues)})(t,i,o);case ni.NONE:return o&&(function(l){for(let d=0;d<l.length;d++){const p=l[d];l[d]=p%2==1?(p+1)/-2:p/2}})(t),t;default:throw new Error(`The specified Logical level technique is not supported: ${i.logicalLevelTechnique1}`)}}static decodeLengthToOffsetBuffer(t,i){if(i.logicalLevelTechnique1===ni.DELTA&&i.logicalLevelTechnique2===ni.NONE)return(function(o){const l=new Int32Array(o.length+1);l[0]=0,l[1]=Ca(o[0]);let d=l[1],p=2;for(;p!=l.length;++p){const y=o[p-1];d+=y>>>1^-(1&y),l[p]=l[p-1]+d}return l})(t);if(i.logicalLevelTechnique1===ni.RLE&&i.logicalLevelTechnique2===ni.NONE)return(function(o,l,d){const p=new Int32Array(d+1);p[0]=0;let y=1,x=p[0];for(let T=0;T<l;T++){const M=o[T],A=o[T+l];for(let z=y;z<y+M;z++)p[z]=A+x,x=p[z];y+=M}return p})(t,i.runs,i.numRleValues);if(i.logicalLevelTechnique1===ni.NONE&&i.logicalLevelTechnique2===ni.NONE){(function(l){let d=0;for(let p=0;p<l.length;p++)l[p]+=d,d=l[p]})(t);const o=new Int32Array(i.numValues+1);return o[0]=0,o.set(t,1),o}if(i.logicalLevelTechnique1===ni.DELTA&&i.logicalLevelTechnique2===ni.RLE){const o=(function(l,d,p){const y=new Int32Array(p+1);y[0]=0;let x=1,T=y[0];for(let M=0;M<d;M++){const A=l[M];let z=l[M+d];z=z>>>1^-(1&z);for(let I=x;I<x+A;I++)y[I]=z+T,T=y[I];x+=A}return y})(t,i.runs,i.numRleValues);return Mr(o),o}throw new Error("Only delta encoding is supported for transforming length to offset streams yet.")}static decodeNullableIntStream(t,i,o,l,d){const p=o.physicalLevelTechnique===Co.FAST_PFOR?Im():Vn(t,i,o.numValues);return this.decodeNullableIntBuffer(p,o,l,d)}static decodeNullableLongStream(t,i,o,l,d){const p=oh(t,i,o.numValues);return this.decodeNullableLongBuffer(p,o,l,d)}static decodeNullableIntBuffer(t,i,o,l){switch(i.logicalLevelTechnique1){case ni.DELTA:return i.logicalLevelTechnique2===ni.RLE&&(t=Mp(t,i.runs,i.numRleValues)),(function(d,p){const y=new Int32Array(d.size());let x=0;d.get(0)?(y[0]=d.get(0)?p[0]>>>1^-(1&p[0]):0,x=1):y[0]=0;let T=1;for(;T!=y.length;++T)y[T]=d.get(T)?y[T-1]+(p[x]>>>1^-(1&p[x++])):y[T-1];return y})(l,t);case ni.RLE:return(function(d,p,y,x){const T=p;return y?(function(M,A,z){const I=new Int32Array(M.size());let R=0;for(let N=0;N<z;N++){const V=A[N];let $=A[N+z];$=$>>>1^-(1&$);for(let rt=R;rt<R+V;rt++)M.get(rt)?I[rt]=$:(I[rt]=0,R++);R+=V}return I})(x,d,T.runs):(function(M,A,z){const I=new Int32Array(M.size());let R=0;for(let N=0;N<z;N++){const V=A[N],$=A[N+z];for(let rt=R;rt<R+V;rt++)M.get(rt)?I[rt]=$:(I[rt]=0,R++);R+=V}return I})(x,d,T.runs)})(t,i,o,l);case ni.MORTON:return Mr(t),t;case ni.COMPONENTWISE_DELTA:return Ap(t),t;case ni.NONE:return t=o?(function(d,p){const y=new Int32Array(d.size());let x=0,T=0;for(;T!=y.length;++T)if(d.get(T)){const M=p[x++];y[T]=M>>>1^-(1&M)}else y[T]=0;return y})(l,t):(function(d,p){const y=new Int32Array(d.size());let x=0,T=0;for(;T!=y.length;++T)y[T]=d.get(T)?p[x++]:0;return y})(l,t),t;default:throw new Error("The specified Logical level technique is not supported")}}static decodeNullableLongBuffer(t,i,o,l){switch(i.logicalLevelTechnique1){case ni.DELTA:return i.logicalLevelTechnique2===ni.RLE&&(t=Cp(t,i.runs,i.numRleValues)),(function(d,p){const y=new BigInt64Array(d.size());let x=0;d.get(0)?(y[0]=d.get(0)?p[0]>>1n^-(1n&p[0]):0n,x=1):y[0]=0n;let T=1;for(;T!=y.length;++T)y[T]=d.get(T)?y[T-1]+(p[x]>>1n^-(1n&p[x++])):y[T-1];return y})(l,t);case ni.RLE:return(function(d,p,y,x){const T=p;return y?(function(M,A,z){const I=new BigInt64Array(M.size());let R=0;for(let N=0;N<z;N++){const V=Number(A[N]);let $=A[N+z];$=$>>1n^-(1n&$);for(let rt=R;rt<R+V;rt++)M.get(rt)?I[rt]=$:(I[rt]=0n,R++);R+=V}return I})(x,d,T.runs):(function(M,A,z){const I=new BigInt64Array(M.size());let R=0;for(let N=0;N<z;N++){const V=Number(A[N]),$=A[N+z];for(let rt=R;rt<R+V;rt++)M.get(rt)?I[rt]=$:(I[rt]=0n,R++);R+=V}return I})(x,d,T.runs)})(t,i,o,l);case ni.NONE:return t=o?(function(d,p){const y=new BigInt64Array(d.size());let x=0,T=0;for(;T!=y.length;++T)if(d.get(T)){const M=p[x++];y[T]=M>>1n^-(1n&M)}else y[T]=0n;return y})(l,t):(function(d,p){const y=new BigInt64Array(d.size());let x=0,T=0;for(;T!=y.length;++T)y[T]=d.get(T)?p[x++]:0n;return y})(l,t),t;default:throw new Error("The specified Logical level technique is not supported")}}static getVectorType(t,i,o,l){const d=t.logicalLevelTechnique1;if(d===ni.RLE)return t.runs===1?ta.CONST:ta.FLAT;const p=i instanceof ws?i.size():i;if(d===ni.DELTA&&t.logicalLevelTechnique2===ni.RLE){const y=t.runs,x=2;if(t.numRleValues!==p)return ta.FLAT;if(y===1)return ta.SEQUENCE;if(y===2){const T=l.get();let M;if(t.physicalLevelTechnique===Co.VARINT)M=Vn(o,l,4);else{const A=l.get();M=new Int32Array(o.buffer,o.byteOffset+A,4)}if(l.set(T),M[2]===x&&M[3]===x)return ta.SEQUENCE}}return t.numValues===1?ta.CONST:ta.FLAT}}class Lm extends rh{getValueFromBuffer(t){return this.dataBuffer[t]}}class km extends wp{constructor(t,i,o,l){super(t,BigInt64Array.of(i),o,l)}getValueFromBuffer(t){return this.dataBuffer[0]+BigInt(t)*this.delta}}class ch{_geometryOffsets;_partOffsets;_ringOffsets;constructor(t,i,o){this._geometryOffsets=t,this._partOffsets=i,this._ringOffsets=o}get geometryOffsets(){return this._geometryOffsets}get partOffsets(){return this._partOffsets}get ringOffsets(){return this._ringOffsets}}class gg{tileExtent;_numBits;_coordinateShift;minBound;maxBound;constructor(t,i){this._coordinateShift=t<0?Math.abs(t):0,this.tileExtent=i+this._coordinateShift,this._numBits=Math.ceil(Math.log2(this.tileExtent)),this.minBound=t,this.maxBound=i}validateCoordinates(t){if(t.x<this.minBound||t.y<this.minBound||t.x>this.maxBound||t.y>this.maxBound)throw new Error("The specified tile buffer size is currently not supported.")}numBits(){return this._numBits}coordinateShift(){return this._coordinateShift}}class uh extends gg{encode(t){this.validateCoordinates(t);const i=t.x+this._coordinateShift,o=t.y+this._coordinateShift;let l=0;for(let d=0;d<this._numBits;d++)l|=(i&1<<d)<<d|(o&1<<d)<<d+1;return l}decode(t){return{x:this.decodeMorton(t)-this._coordinateShift,y:this.decodeMorton(t>>1)-this._coordinateShift}}decodeMorton(t){let i=0;for(let o=0;o<this._numBits;o++)i|=(t&1<<2*o)>>o;return i}static decode(t,i,o){return{x:uh.decodeMorton(t,i)-o,y:uh.decodeMorton(t>>1,i)-o}}static decodeMorton(t,i){let o=0;for(let l=0;l<i;l++)o|=(t&1<<2*l)>>l;return o}}(function(a){a[a.POINT=0]="POINT",a[a.LINESTRING=1]="LINESTRING",a[a.POLYGON=2]="POLYGON",a[a.MULTIPOINT=3]="MULTIPOINT",a[a.MULTILINESTRING=4]="MULTILINESTRING",a[a.MULTIPOLYGON=5]="MULTIPOLYGON"})(ea||(ea={})),(function(a){a[a.POINT=0]="POINT",a[a.LINESTRING=1]="LINESTRING",a[a.POLYGON=2]="POLYGON"})(Tf||(Tf={})),(function(a){a[a.MORTON=0]="MORTON",a[a.VEC_2=1]="VEC_2",a[a.VEC_3=2]="VEC_3"})($r||($r={}));class _g{createPoint(t){return[[t]]}createMultiPoint(t){return t.map((i=>[i]))}createLineString(t){return[t]}createMultiLineString(t){return t}createPolygon(t,i){return[t,...i]}createMultiPolygon(t){return t.flat()}}function Dp(a){const t=new Array(a.numGeometries);let i=1,o=1,l=1,d=0;const p=new _g;let y=0,x=0;const T=a.mortonSettings,M=a.topologyVector,A=M.geometryOffsets,z=M.partOffsets,I=M.ringOffsets,R=a.vertexOffsets,N=a.containsPolygonGeometry(),V=a.vertexBuffer;for(let $=0;$<a.numGeometries;$++){const rt=a.geometryType($);if(rt===ea.POINT){if(R&&R.length!==0)if(a.vertexBufferType===$r.VEC_2){const K=2*R[x++],tt=new et(V[K],V[K+1]);t[d++]=p.createPoint(tt)}else{const K=R[x++],tt=uh.decode(V[K],T.numBits,T.coordinateShift),vt=new et(tt.x,tt.y);t[d++]=p.createPoint(vt)}else{const K=new et(V[y++],V[y++]);t[d++]=p.createPoint(K)}A&&l++,z&&i++,I&&o++}else if(rt===ea.MULTIPOINT){const K=A[l]-A[l-1];l++;const tt=new Array(K);if(R&&R.length!==0){for(let vt=0;vt<K;vt++){const xt=2*R[x++];tt[vt]=new et(V[xt],V[xt+1])}t[d++]=p.createMultiPoint(tt)}else{for(let vt=0;vt<K;vt++){const xt=V[y++],Lt=V[y++];tt[vt]=new et(xt,Lt)}t[d++]=p.createMultiPoint(tt)}}else if(rt===ea.LINESTRING){let K,tt=0;N?(tt=I[o]-I[o-1],o++):tt=z[i]-z[i-1],i++,R&&R.length!==0?(K=a.vertexBufferType===$r.VEC_2?oc(V,R,x,tt,!1):au(V,R,x,tt,!1,T),x+=tt):(K=zp(V,y,tt,!1),y+=2*tt),t[d++]=p.createLineString(K),A&&l++}else if(rt===ea.POLYGON){const K=z[i]-z[i-1];i++;const tt=new Array(K-1);let vt=I[o]-I[o-1];if(o++,R&&R.length!==0){const xt=a.vertexBufferType===$r.VEC_2?sc(V,R,x,vt):vd(V,R,x,vt,0,T);x+=vt;for(let Lt=0;Lt<tt.length;Lt++)vt=I[o]-I[o-1],o++,tt[Lt]=a.vertexBufferType===$r.VEC_2?sc(V,R,x,vt):vd(V,R,x,vt,0,T),x+=vt;t[d++]=p.createPolygon(xt,tt)}else{const xt=gl(V,y,vt);y+=2*vt;for(let Lt=0;Lt<tt.length;Lt++)vt=I[o]-I[o-1],o++,tt[Lt]=gl(V,y,vt),y+=2*vt;t[d++]=p.createPolygon(xt,tt)}A&&l++}else if(rt===ea.MULTILINESTRING){const K=A[l]-A[l-1];l++;const tt=new Array(K);if(R&&R.length!==0){for(let vt=0;vt<K;vt++){let xt=0;N?(xt=I[o]-I[o-1],o++):xt=z[i]-z[i-1],i++;const Lt=a.vertexBufferType===$r.VEC_2?oc(V,R,x,xt,!1):au(V,R,x,xt,!1,T);tt[vt]=Lt,x+=xt}t[d++]=p.createMultiLineString(tt)}else{for(let vt=0;vt<K;vt++){let xt=0;N?(xt=I[o]-I[o-1],o++):xt=z[i]-z[i-1],i++,tt[vt]=zp(V,y,xt,!1),y+=2*xt}t[d++]=p.createMultiLineString(tt)}}else{if(rt!==ea.MULTIPOLYGON)throw new Error("The specified geometry type is currently not supported.");{const K=A[l]-A[l-1];l++;const tt=new Array(K);let vt=0;if(R&&R.length!==0){for(let xt=0;xt<K;xt++){const Lt=z[i]-z[i-1];i++;const Jt=new Array(Lt-1);vt=I[o]-I[o-1],o++;const qt=a.vertexBufferType===$r.VEC_2?sc(V,R,x,vt):vd(V,R,x,vt,0,T);x+=vt;for(let ee=0;ee<Jt.length;ee++)vt=I[o]-I[o-1],o++,Jt[ee]=a.vertexBufferType===$r.VEC_2?sc(V,R,x,vt):vd(V,R,x,vt,0,T),x+=vt;tt[xt]=p.createPolygon(qt,Jt)}t[d++]=p.createMultiPolygon(tt)}else{for(let xt=0;xt<K;xt++){const Lt=z[i]-z[i-1];i++;const Jt=new Array(Lt-1);vt=I[o]-I[o-1],o++;const qt=gl(V,y,vt);y+=2*vt;for(let ee=0;ee<Jt.length;ee++){const fe=I[o]-I[o-1];o++,Jt[ee]=gl(V,y,fe),y+=2*fe}tt[xt]=p.createPolygon(qt,Jt)}t[d++]=p.createMultiPolygon(tt)}}}}return t}function gl(a,t,i){return zp(a,t,i,!0)}function sc(a,t,i,o){return oc(a,t,i,o,!0)}function vd(a,t,i,o,l,d){return au(a,t,i,o,!0,d)}function zp(a,t,i,o){const l=new Array(o?i+1:i);for(let d=0;d<2*i;d+=2)l[d/2]=new et(a[t+d],a[t+d+1]);return o&&(l[l.length-1]=l[0]),l}function oc(a,t,i,o,l){const d=new Array(l?o+1:o);for(let p=0;p<2*o;p+=2){const y=2*t[i+p/2];d[p/2]=new et(a[y],a[y+1])}return l&&(d[d.length-1]=d[0]),d}function au(a,t,i,o,l,d){const p=new Array(l?o+1:o);for(let y=0;y<o;y++){const x=uh.decode(a[t[i+y]],d.numBits,d.coordinateShift);p[y]=new et(x.x,x.y)}return l&&(p[p.length-1]=p[0]),p}class Pp{_vertexBufferType;_topologyVector;_vertexOffsets;_vertexBuffer;_mortonSettings;constructor(t,i,o,l,d){this._vertexBufferType=t,this._topologyVector=i,this._vertexOffsets=o,this._vertexBuffer=l,this._mortonSettings=d}get vertexBufferType(){return this._vertexBufferType}get topologyVector(){return this._topologyVector}get vertexOffsets(){return this._vertexOffsets}get vertexBuffer(){return this._vertexBuffer}*[Symbol.iterator](){const t=Dp(this);let i=0;for(;i<this.numGeometries;)yield{coordinates:t[i],type:this.geometryType(i)},i++}getSimpleEncodedVertex(t){const i=this.vertexOffsets?2*this.vertexOffsets[t]:2*t;return[this.vertexBuffer[i],this.vertexBuffer[i+1]]}getVertex(t){if(this.vertexOffsets&&this.mortonSettings){const o=uh.decode(this.vertexBuffer[this.vertexOffsets[t]],this.mortonSettings.numBits,this.mortonSettings.coordinateShift);return[o.x,o.y]}const i=this.vertexOffsets?2*this.vertexOffsets[t]:2*t;return[this.vertexBuffer[i],this.vertexBuffer[i+1]]}getGeometries(){return Dp(this)}get mortonSettings(){return this._mortonSettings}}class lc extends Pp{_numGeometries;_geometryType;constructor(t,i,o,l,d,p,y){super(o,l,d,p,y),this._numGeometries=t,this._geometryType=i}static createMortonEncoded(t,i,o,l,d,p){return new lc(t,i,$r.MORTON,o,l,d,p)}static create(t,i,o,l,d){return new lc(t,i,$r.VEC_2,o,l,d)}geometryType(t){return this._geometryType}get numGeometries(){return this._numGeometries}containsPolygonGeometry(){return this._geometryType===ea.POLYGON||this._geometryType===ea.MULTIPOLYGON}containsSingleGeometryType(){return!0}}class ru extends Pp{_geometryTypes;constructor(t,i,o,l,d,p){super(t,o,l,d,p),this._geometryTypes=i}static createMortonEncoded(t,i,o,l,d){return new ru($r.MORTON,t,i,o,l,d)}static create(t,i,o,l){return new ru($r.VEC_2,t,i,o,l)}geometryType(t){return this._geometryTypes[t]}get numGeometries(){return this._geometryTypes.length}containsPolygonGeometry(){for(let t=0;t<this.numGeometries;t++)if(this.geometryType(t)===ea.POLYGON||this.geometryType(t)===ea.MULTIPOLYGON)return!0;return!1}containsSingleGeometryType(){return!1}}class Ef{_triangleOffsets;_indexBuffer;_vertexBuffer;_topologyVector;constructor(t,i,o,l){this._triangleOffsets=t,this._indexBuffer=i,this._vertexBuffer=o,this._topologyVector=l}get triangleOffsets(){return this._triangleOffsets}get indexBuffer(){return this._indexBuffer}get vertexBuffer(){return this._vertexBuffer}get topologyVector(){return this._topologyVector}getGeometries(){if(!this._topologyVector)throw new Error("Cannot convert GpuVector to coordinates without topology information");const t=new Array(this.numGeometries),i=this._topologyVector,o=i.partOffsets,l=i.ringOffsets,d=i.geometryOffsets;let p=0,y=1,x=1,T=1;for(let M=0;M<this.numGeometries;M++)switch(this.geometryType(M)){case ea.POLYGON:{const A=o[y]-o[y-1];y++;const z=[];for(let I=0;I<A;I++){const R=l[x]-l[x-1];x++;const N=[];for(let V=0;V<R;V++){const $=this._vertexBuffer[p++],rt=this._vertexBuffer[p++];N.push(new et($,rt))}N.length>0&&N.push(N[0]),z.push(N)}t[M]=z,d&&T++}break;case ea.MULTIPOLYGON:{const A=d[T]-d[T-1];T++;const z=[];for(let I=0;I<A;I++){const R=o[y]-o[y-1];y++;for(let N=0;N<R;N++){const V=l[x]-l[x-1];x++;const $=[];for(let rt=0;rt<V;rt++){const K=this._vertexBuffer[p++],tt=this._vertexBuffer[p++];$.push(new et(K,tt))}$.length>0&&$.push($[0]),z.push($)}}t[M]=z}}return t}[Symbol.iterator](){return null}}class su extends Ef{_numGeometries;_geometryType;constructor(t,i,o,l,d,p){super(o,l,d,p),this._numGeometries=t,this._geometryType=i}static create(t,i,o,l,d,p){return new su(t,i,o,l,d,p)}geometryType(t){return this._geometryType}get numGeometries(){return this._numGeometries}containsSingleGeometryType(){return!0}}class xd extends Ef{_geometryTypes;constructor(t,i,o,l,d){super(i,o,l,d),this._geometryTypes=t}static create(t,i,o,l,d){return new xd(t,i,o,l,d)}geometryType(t){return this._geometryTypes[t]}get numGeometries(){return this._geometryTypes.length}containsSingleGeometryType(){return!1}}function Om(a,t,i,o,l){const d=Un.decode(a,i);let p=null,y=null,x=null,T=null,M=null,A=null,z=null,I=null;if(He.getVectorType(d,o,a,i)===ta.CONST){const N=He.decodeConstIntStream(a,i,d,!1);for(let V=0;V<t-1;V++){const $=Un.decode(a,i);switch($.physicalStreamType){case ya.LENGTH:switch($.logicalStreamType.lengthType){case Jn.GEOMETRIES:p=He.decodeLengthStreamToOffsetBuffer(a,i,$);break;case Jn.PARTS:y=He.decodeLengthStreamToOffsetBuffer(a,i,$);break;case Jn.RINGS:x=He.decodeLengthStreamToOffsetBuffer(a,i,$);break;case Jn.TRIANGLES:z=He.decodeLengthStreamToOffsetBuffer(a,i,$)}break;case ya.OFFSET:switch($.logicalStreamType.offsetType){case nu.VERTEX:T=He.decodeIntStream(a,i,$,!1);break;case nu.INDEX:I=He.decodeIntStream(a,i,$,!1)}break;case ya.DATA:if(Ys.VERTEX===$.logicalStreamType.dictionaryType)M=He.decodeIntStream(a,i,$,!0,l);else{const rt=$;A={numBits:rt.numBits(),coordinateShift:rt.coordinateShift()},M=He.decodeIntStream(a,i,$,!1,l)}}}if(I!==null){if(p!=null||y!=null){const V=new ch(p,y,x);return su.create(o,N,z,I,M,V)}return su.create(o,N,z,I,M)}return A===null?lc.create(o,N,new ch(p,y,x),T,M):lc.createMortonEncoded(o,N,new ch(p,y,x),T,M,A)}const R=He.decodeIntStream(a,i,d,!1);for(let N=0;N<t-1;N++){const V=Un.decode(a,i);switch(V.physicalStreamType){case ya.LENGTH:switch(V.logicalStreamType.lengthType){case Jn.GEOMETRIES:p=He.decodeIntStream(a,i,V,!1);break;case Jn.PARTS:y=He.decodeIntStream(a,i,V,!1);break;case Jn.RINGS:x=He.decodeIntStream(a,i,V,!1);break;case Jn.TRIANGLES:z=He.decodeLengthStreamToOffsetBuffer(a,i,V)}break;case ya.OFFSET:switch(V.logicalStreamType.offsetType){case nu.VERTEX:T=He.decodeIntStream(a,i,V,!1);break;case nu.INDEX:I=He.decodeIntStream(a,i,V,!1)}break;case ya.DATA:if(Ys.VERTEX===V.logicalStreamType.dictionaryType)M=He.decodeIntStream(a,i,V,!0,l);else{const $=V;A={numBits:$.numBits(),coordinateShift:$.coordinateShift()},M=He.decodeIntStream(a,i,V,!1,l)}}}return I!==null&&y===null?xd.create(R,z,I,M):(p!==null?(p=Ip(R,p,2),y!==null&&x!==null?(y=Rp(R,p,y,!1),x=(function(N,V,$,rt){const K=new Int32Array($[$.length-1]+1);let tt=0;K[0]=tt;let vt=1,xt=1,Lt=0;for(let Jt=0;Jt<N.length;Jt++){const qt=N[Jt],ee=V[Jt+1]-V[Jt];if(qt!==0&&qt!==3)for(let fe=0;fe<ee;fe++){const oe=$[vt]-$[vt-1];vt++;for(let le=0;le<oe;le++)tt=K[xt++]=tt+rt[Lt++]}else for(let fe=0;fe<ee;fe++)K[xt++]=++tt,vt++}return K})(R,p,y,x)):y!==null&&(y=(function(N,V,$){const rt=new Int32Array(V[V.length-1]+1);let K=0;rt[0]=K;let tt=1,vt=0;for(let xt=0;xt<N.length;xt++){const Lt=N[xt],Jt=V[xt+1]-V[xt];if(Lt===4||Lt===1)for(let qt=0;qt<Jt;qt++)K=rt[tt++]=K+$[vt++];else for(let qt=0;qt<Jt;qt++)rt[tt++]=++K}return rt})(R,p,y))):y!==null&&x!==null?(y=Ip(R,y,1),x=Rp(R,y,x,!0)):y!==null&&(y=Ip(R,y,0)),I!==null?xd.create(R,z,I,M,new ch(p,y,x)):A===null?ru.create(R,new ch(p,y,x),T,M):ru.createMortonEncoded(R,new ch(p,y,x),T,M,A))}function Ip(a,t,i){const o=new Int32Array(a.length+1);let l=0;o[0]=l;let d=0;for(let p=0;p<a.length;p++)l=o[p+1]=l+(a[p]>i?t[d++]:1);return o}function Rp(a,t,i,o){const l=new Int32Array(t[t.length-1]+1);let d=0;l[0]=d;let p=1,y=0;for(let x=0;x<a.length;x++){const T=a[x],M=t[x+1]-t[x];if(T===5||T===2||o&&(T===4||T===1))for(let A=0;A<M;A++)d=l[p++]=d+i[y++];else for(let A=0;A<M;A++)l[p++]=++d}return l}class yg extends ah{dataVector;constructor(t,i,o){super(t,i.getBuffer(),o),this.dataVector=i}getValueFromBuffer(t){return this.dataVector.get(t)}}class Lp extends rh{getValueFromBuffer(t){return this.dataBuffer[t]}}class Bm extends ah{constructor(t,i,o){super(t,BigInt64Array.of(i),o)}getValueFromBuffer(t){return this.dataBuffer[0]}}function Mf(a,t,i){for(let o=0;o<a;o++){const l=Un.decode(t,i);i.add(l.byteLength)}}function cc(a,t,i){return bd(a,Math.ceil(t/8),i)}function bd(a,t,i){const o=new Uint8Array(t);let l=0;for(;l<t;){const d=a[i.increment()];if(d<=127){const p=d+3,y=a[i.increment()],x=l+p;o.fill(y,l,x),l=x}else{const p=256-d;for(let y=0;y<p;y++)o[l++]=a[i.increment()]}}return o}const vg=new TextDecoder;function ou(a,t,i){return i-t>=12?vg.decode(a.subarray(t,i)):(function(o,l,d){let p="",y=l;for(;y<d;){const x=o[y];let T,M,A,z=null,I=x>239?4:x>223?3:x>191?2:1;if(y+I>d)break;I===1?x<128&&(z=x):I===2?(T=o[y+1],(192&T)==128&&(z=(31&x)<<6|63&T,z<=127&&(z=null))):I===3?(T=o[y+1],M=o[y+2],(192&T)==128&&(192&M)==128&&(z=(15&x)<<12|(63&T)<<6|63&M,(z<=2047||z>=55296&&z<=57343)&&(z=null))):I===4&&(T=o[y+1],M=o[y+2],A=o[y+3],(192&T)==128&&(192&M)==128&&(192&A)==128&&(z=(15&x)<<18|(63&T)<<12|(63&M)<<6|63&A,(z<=65535||z>=1114112)&&(z=null))),z===null?(z=65533,I=1):z>65535&&(z-=65536,p+=String.fromCharCode(z>>>10&1023|55296),z=56320|1023&z),p+=String.fromCharCode(z),y+=I}return p})(a,t,i)}class kp extends ah{offsetBuffer;constructor(t,i,o,l){super(t,o,l),this.offsetBuffer=i}}class Op extends kp{textEncoder;constructor(t,i,o,l){super(t,i,o,l??i.length-1),this.textEncoder=new TextEncoder}getValueFromBuffer(t){return ou(this.dataBuffer,this.offsetBuffer[t],this.offsetBuffer[t+1])}}class lu extends kp{indexBuffer;textEncoder;constructor(t,i,o,l,d){super(t,o,l,d??i.length),this.indexBuffer=i,this.indexBuffer=i,this.textEncoder=new TextEncoder}getValueFromBuffer(t){const i=this.indexBuffer[t];return ou(this.dataBuffer,this.offsetBuffer[i],this.offsetBuffer[i+1])}}class Bp extends kp{indexBuffer;symbolOffsetBuffer;symbolTableBuffer;textEncoder;symbolLengthBuffer;lengthBuffer;decodedDictionary;constructor(t,i,o,l,d,p,y){super(t,o,l,y),this.indexBuffer=i,this.symbolOffsetBuffer=d,this.symbolTableBuffer=p,this.textEncoder=new TextEncoder}getValueFromBuffer(t){this.decodedDictionary==null&&(this.symbolLengthBuffer==null&&(this.symbolLengthBuffer=this.offsetToLengthBuffer(this.symbolOffsetBuffer),this.lengthBuffer=this.offsetToLengthBuffer(this.offsetBuffer)),this.decodedDictionary=(function(o,l,d){const p=[],y=new Array(l.length).fill(0);for(let x=1;x<l.length;x++)y[x]=y[x-1]+l[x-1];for(let x=0;x<d.length;x++)if(d[x]===255)p.push(d[++x]);else{const T=l[d[x]],M=y[d[x]];for(let A=0;A<T;A++)p.push(o[M+A])}return new Uint8Array(p)})(this.symbolTableBuffer,this.symbolLengthBuffer,this.dataBuffer));const i=this.indexBuffer[t];return ou(this.decodedDictionary,this.offsetBuffer[i],this.offsetBuffer[i+1])}offsetToLengthBuffer(t){const i=new Uint32Array(t.length-1);let o=t[0];for(let l=1;l<t.length;l++){const d=t[l];i[l-1]=d-o,o=d}return i}}class hh{static ROOT_COLUMN_NAME="default";static NESTED_COLUMN_SEPARATOR=":";constructor(){}static decode(t,i,o,l,d){let p=null,y=null,x=null,T=null,M=null,A=null,z=null,I=null;for(let R=0;R<l;R++){const N=Un.decode(i,o);if(N.byteLength!==0)switch(N.physicalStreamType){case ya.PRESENT:{const V=cc(i,N.numValues,o);A=new ws(V,N.numValues);break}case ya.OFFSET:y=d!=null||A!=null?He.decodeNullableIntStream(i,o,N,!1,d??A):He.decodeIntStream(i,o,N,!1);break;case ya.LENGTH:{const V=He.decodeLengthStreamToOffsetBuffer(i,o,N);Jn.DICTIONARY===N.logicalStreamType.lengthType?p=V:Jn.SYMBOL===N.logicalStreamType.lengthType?T=V:z=V;break}case ya.DATA:{const V=i.subarray(o.get(),o.get()+N.byteLength);o.add(N.byteLength);const $=N.logicalStreamType.dictionaryType;Ys.FSST===$?M=V:Ys.SINGLE===$||Ys.SHARED===$?x=V:Ys.NONE===$&&(I=V);break}}}return this.decodeFsstDictionaryVector(t,M,y,p,x,T,d??A)??this.decodeDictionaryVector(t,x,y,p,d??A)??this.decodePlainStringVector(t,z,I,y,d??A)}static decodeFsstDictionaryVector(t,i,o,l,d,p,y){return i?new Bp(t,o,l,d,p,i,y):null}static decodeDictionaryVector(t,i,o,l,d){return i?d?new lu(t,o,l,i,d):new lu(t,o,l,i):null}static decodePlainStringVector(t,i,o,l,d){if(!i||!o)return null;if(l)return d?new lu(t,l,i,o,d):new lu(t,l,i,o);if(d&&d.size()!==i.length-1){const p=new Int32Array(d.size());let y=0;for(let x=0;x<d.size();x++)p[x]=d.get(x)?y++:0;return new lu(t,p,i,o,d)}return d?new Op(t,i,o,d):new Op(t,i,o)}static decodeSharedDictionary(t,i,o,l,d){let p=null,y=null,x=null,T=null,M=!1;for(;!M;){const R=Un.decode(t,i);switch(R.physicalStreamType){case ya.LENGTH:Jn.DICTIONARY===R.logicalStreamType.lengthType?p=He.decodeLengthStreamToOffsetBuffer(t,i,R):x=He.decodeLengthStreamToOffsetBuffer(t,i,R);break;case ya.DATA:Ys.SINGLE===R.logicalStreamType.dictionaryType||Ys.SHARED===R.logicalStreamType.dictionaryType?(y=t.subarray(i.get(),i.get()+R.byteLength),M=!0):T=t.subarray(i.get(),i.get()+R.byteLength),i.add(R.byteLength)}}const A=o.complexType.children,z=[];let I=0;for(const R of A){const N=Vn(t,i,1)[0];if(N==0)continue;const V=`${o.name}${R.name===hh.ROOT_COLUMN_NAME?"":hh.NESTED_COLUMN_SEPARATOR+R.name}`;if(d&&!d.has(V)){Mf(N,t,i);continue}if(N!==2||R.type!=="scalarField"||R.scalarField.physicalType!==9)throw new Error("Currently only optional string fields are implemented for a struct.");const $=Un.decode(t,i),rt=cc(t,$.numValues,i),K=Un.decode(t,i),tt=(K instanceof yd?K.numRleValues:K.numValues)!==l?He.decodeNullableIntStream(t,i,K,!1,new ws(rt,$.numValues)):He.decodeIntStream(t,i,K,!1);z[I++]=T?new Bp(V,tt,p,y,x,T,new ws(rt,$.numValues)):new lu(V,tt,p,y,new ws(rt,$.numValues))}return z}}function Np(a,t,i,o,l,d){return i.type==="scalarType"?(function(p,y,x,T,M,A){let z=null,I=0;if(p===0)return null;if(A.nullable){const N=Un.decode(y,x);I=N.numValues;const V=x.get(),$=cc(y,I,x);x.set(V+N.byteLength),z=new ws($,N.numValues)}const R=z??T;switch(M.physicalType){case 4:case 3:return(function(N,V,$,rt,K){const tt=Un.decode(N,V),vt=He.getVectorType(tt,K,N,V),xt=rt.physicalType===3;if(vt===ta.FLAT){const Lt=dh(K)?He.decodeNullableIntStream(N,V,tt,xt,K):He.decodeIntStream(N,V,tt,xt);return new gd($.name,Lt,K)}if(vt===ta.SEQUENCE){const Lt=He.decodeSequenceIntStream(N,V,tt);return new wf($.name,Lt[0],Lt[1],tt.numRleValues)}{const Lt=He.decodeConstIntStream(N,V,tt,xt);return new _d($.name,Lt,K)}})(y,x,A,M,R);case 9:return hh.decode(A.name,y,x,A.nullable?p-1:p,z);case 0:return(function(N,V,$,rt,K){const tt=Un.decode(N,V),vt=tt.numValues,xt=V.get(),Lt=dh(K)?(function(qt,ee,fe,oe){const le=bd(qt,Math.ceil(ee/8),fe),Zt=new ws(le,ee),ze=oe.size(),Pe=new ws(new Uint8Array(ze),ze);let ke=0;for(let Ee=0;Ee<oe.size();Ee++){const ai=!!oe.get(Ee)&&Zt.get(ke++);Pe.set(Ee,ai)}return Pe.getBuffer()})(N,vt,V,K):cc(N,vt,V);V.set(xt+tt.byteLength);const Jt=new ws(Lt,vt);return new yg($.name,Jt,K)})(y,x,A,0,R);case 6:case 5:return(function(N,V,$,rt,K){const tt=Un.decode(N,V),vt=He.getVectorType(tt,rt,N,V),xt=K.physicalType===5;if(vt===ta.FLAT){const Lt=dh(rt)?He.decodeNullableLongStream(N,V,tt,xt,rt):He.decodeLongStream(N,V,tt,xt);return new Lm($.name,Lt,rt)}if(vt===ta.SEQUENCE){const Lt=He.decodeSequenceLongStream(N,V,tt);return new km($.name,Lt[0],Lt[1],tt.numRleValues)}{const Lt=He.decodeConstLongStream(N,V,tt,xt);return new Bm($.name,Lt,rt)}})(y,x,A,R,M);case 7:return(function(N,V,$,rt){const K=Un.decode(N,V),tt=dh(rt)?(function(vt,xt,Lt,Jt){const qt=xt.get(),ee=qt+Jt*Float32Array.BYTES_PER_ELEMENT,fe=new Uint8Array(vt.subarray(qt,ee)).buffer,oe=new Float32Array(fe);xt.set(ee);const le=Lt.size(),Zt=new Float32Array(le);let ze=0;for(let Pe=0;Pe<le;Pe++)Zt[Pe]=Lt.get(Pe)?oe[ze++]:0;return Zt})(N,V,rt,K.numValues):(function(vt,xt,Lt){const Jt=xt.get(),qt=Jt+Lt*Float32Array.BYTES_PER_ELEMENT,ee=new Uint8Array(vt.subarray(Jt,qt)).buffer,fe=new Float32Array(ee);return xt.set(qt),fe})(N,V,K.numValues);return new Lp($.name,tt,rt)})(y,x,A,R);case 8:return(function(N,V,$,rt){const K=Un.decode(N,V),tt=dh(rt)?(function(vt,xt,Lt,Jt){const qt=xt.get(),ee=qt+Jt*Float64Array.BYTES_PER_ELEMENT,fe=new Uint8Array(vt.subarray(qt,ee)).buffer,oe=new Float64Array(fe);xt.set(ee);const le=Lt.size(),Zt=new Float64Array(le);let ze=0;for(let Pe=0;Pe<le;Pe++)Zt[Pe]=Lt.get(Pe)?oe[ze++]:0;return Zt})(N,V,rt,K.numValues):(function(vt,xt,Lt){const Jt=xt.get(),qt=Jt+Lt*Float64Array.BYTES_PER_ELEMENT,ee=new Uint8Array(vt.subarray(Jt,qt)).buffer,fe=new Float64Array(ee);return xt.set(qt),fe})(N,V,K.numValues);return new sh($.name,tt,rt)})(y,x,A,R);default:throw new Error(`The specified data type for the field is currently not supported: ${M}`)}})(o,a,t,l,i.scalarType,i):o!=1?null:hh.decodeSharedDictionary(a,t,i,l,d)}function dh(a){return a instanceof ws}class wd{static decodeColumnType(t){switch(t){case 0:case 1:case 2:case 3:{const i={};i.nullable=!!(1&t),i.columnScope=0;const o={};return o.physicalType=t>1?6:4,o.type="physicalType",i.scalarType=o,i.type="scalarType",i}case 4:{const i={nullable:!1,columnScope:0},o={type:"physicalType",physicalType:0};return i.type="complexType",i.complexType=o,i}case 30:{const i={nullable:!1,columnScope:0},o={type:"physicalType",physicalType:1};return i.type="complexType",i.complexType=o,i}default:return this.mapScalarType(t)}}static columnTypeHasName(t){return t>=10}static columnTypeHasChildren(t){return t===30}static hasStreamCount(t){if(t.name==="id")return!1;if(t.type==="scalarType"){const i=t.scalarType;if(i.type==="physicalType")switch(i.physicalType){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:default:return!1;case 9:return!0}else if(i.type==="logicalType")return!1}else if(t.type==="complexType"){const i=t.complexType;if(i.type==="physicalType")switch(i.physicalType){case 0:case 1:return!0;default:return!1}}return console.warn("Unexpected column type in hasStreamCount",t),!1}static mapScalarType(t){let i=null;switch(t){case 10:case 11:i=0;break;case 12:case 13:i=1;break;case 14:case 15:i=2;break;case 16:case 17:i=3;break;case 18:case 19:i=4;break;case 20:case 21:i=5;break;case 22:case 23:i=6;break;case 24:case 25:i=7;break;case 26:case 27:i=8;break;case 28:case 29:i=9;break;default:return null}const o={};o.nullable=!!(1&t),o.columnScope=0;const l={type:"physicalType"};return l.physicalType=i,o.type="scalarType",o.scalarType=l,o}}const Cf=new TextDecoder;function Nm(a,t){const i=Vn(a,t,1)[0];if(i===0)return"";const o=t.get(),l=a.subarray(o,o+i);return t.add(i),Cf.decode(l)}function Fm(a,t){const i=Vn(a,t,1)[0]>>>0,o=!!(4&i),l=!!(2&i),d=Vn(a,t,1)[0]>>>0,p={};if(1&i&&(p.nullable=!0),l){const y={};if(o?(y.type="logicalType",y.logicalType=d):(y.type="physicalType",y.physicalType=d),8&i){const x=Vn(a,t,1)[0]>>>0;y.children=new Array(x);for(let T=0;T<x;T++)y.children[T]=Fm(a,t)}p.type="complexField",p.complexField=y}else{const y={};o?(y.type="logicalType",y.logicalType=d):(y.type="physicalType",y.physicalType=d),p.type="scalarField",p.scalarField=y}return p}function Fp(a,t){const i=Vn(a,t,1)[0]>>>0,o=wd.decodeColumnType(i);if(!o)throw new Error(`Unsupported column type code: ${i}`);if(wd.columnTypeHasName(i)?o.name=Nm(a,t):i>=0&&i<=3?o.name="id":i===4&&(o.name="geometry"),wd.columnTypeHasChildren(i)){const l=Vn(a,t,1)[0]>>>0,d=o.complexType;d.children=new Array(l);for(let p=0;p<l;p++)d.children[p]=Fm(a,t)}return o}function jp(a,t){const i={featureTables:[]},o={};o.name=Nm(a,t);const l=Vn(a,t,1)[0]>>>0,d=Vn(a,t,1)[0]>>>0;o.columns=new Array(d);for(let p=0;p<d;p++)o.columns[p]=Fp(a,t);return i.featureTables.push(o),[i,l]}function Af(a,t,i,o,l,d,p=!1){const y=t.scalarType.physicalType,x=He.getVectorType(l,d,a,i);if(y===4)switch(x){case ta.FLAT:{const T=He.decodeIntStream(a,i,l,!1);return new gd(o,T,d)}case ta.SEQUENCE:{const T=He.decodeSequenceIntStream(a,i,l);return new wf(o,T[0],T[1],l.numRleValues)}case ta.CONST:{const T=He.decodeConstIntStream(a,i,l,!1);return new _d(o,T,d)}}else switch(x){case ta.FLAT:{if(p){const M=He.decodeLongFloat64Stream(a,i,l,!1);return new sh(o,M,d)}const T=He.decodeLongStream(a,i,l,!1);return new Lm(o,T,d)}case ta.SEQUENCE:{const T=He.decodeSequenceLongStream(a,i,l);return new km(o,T[0],T[1],l.numRleValues)}case ta.CONST:{const T=He.decodeConstLongStream(a,i,l,!1);return new Bm(o,T,d)}}throw new Error("Vector type not supported for id column.")}class Vp{constructor(t,i){var o;switch(this._featureData=t,this.properties=this._featureData.properties||{},(o=this._featureData.geometry)===null||o===void 0?void 0:o.type){case ea.POINT:case ea.MULTIPOINT:this.type=1;break;case ea.LINESTRING:case ea.MULTILINESTRING:this.type=2;break;case ea.POLYGON:case ea.MULTIPOLYGON:this.type=3;break;default:this.type=0}this.extent=i,this.id=Number(this._featureData.id)}projectPoint(t,i,o,l){return[360*(t.x+i)/l-180,360/Math.PI*Math.atan(Math.exp((1-2*(t.y+o)/l)*Math.PI))-90]}projectLine(t,i,o,l){return t.map((d=>this.projectPoint(d,i,o,l)))}toGeoJSON(t,i,o){const l=this.extent*Math.pow(2,o),d=this.extent*t,p=this.extent*i,y=this.loadGeometry();let x;switch(this.type){case 1:{const M=[];for(const z of y)M.push(z[0]);const A=this.projectLine(M,d,p,l);x=M.length===1?{type:"Point",coordinates:A[0]}:{type:"MultiPoint",coordinates:A};break}case 2:{const M=y.map((A=>this.projectLine(A,d,p,l)));x=M.length===1?{type:"LineString",coordinates:M[0]}:{type:"MultiLineString",coordinates:M};break}case 3:{const M=Il(y),A=[];for(const z of M)A.push(z.map((I=>this.projectLine(I,d,p,l))));x=A.length===1?{type:"Polygon",coordinates:A[0]}:{type:"MultiPolygon",coordinates:A};break}default:throw new Error(`unknown feature type: ${this.type}`)}const T={type:"Feature",geometry:x,properties:this.properties};return this.id!=null&&(T.id=this.id),T}loadGeometry(){const t=[];for(const i of this._featureData.geometry.coordinates){const o=[];for(const l of i)o.push(new et(l.x,l.y));t.push(o)}return t}bbox(){return[0,0,0,0]}}class jm{constructor(t){this.features=[],this.featureTable=t,this.name=t.name,this.extent=t.extent,this.version=2,this.features=t.getFeatures(),this.length=this.features.length}feature(t){return new Vp(this.features[t],this.extent)}}class Df{constructor(t){this.layers={};const i=(function(o,l,d=!0){const p=new mg(0),y=[];for(;p.get()<o.length;){const x=Vn(o,p,1)[0]>>>0,T=p.get()+x;if(T>o.length)throw new Error(`Block overruns tile: ${T} > ${o.length}`);if(Vn(o,p,1)[0]>>>0!=1){p.set(T);continue}const M=jp(o,p),A=M[1],z=M[0].featureTables[0];let I=null,R=null;const N=[];let V=0;for(const rt of z.columns){const K=rt.name;if(K==="id"){let tt=null;if(rt.nullable){const xt=Un.decode(o,p),Lt=p.get(),Jt=cc(o,xt.numValues,p);p.set(Lt+xt.byteLength),tt=new ws(Jt,xt.numValues)}const vt=Un.decode(o,p);V=vt.getDecompressedCount(),I=Af(o,rt,p,K,vt,tt??V,d)}else if(K==="geometry"){const tt=Vn(o,p,1)[0];if(V===0){const vt=p.get();V=Un.decode(o,p).getDecompressedCount(),p.set(vt)}R=Om(o,tt,p,V,l)}else{const tt=wd.hasStreamCount(rt)?Vn(o,p,1)[0]:1;if(tt===0&&rt.type==="scalarType")continue;const vt=Np(o,p,rt,tt,V,void 0);vt&&(Array.isArray(vt)?N.push(...vt):N.push(vt))}}const $=new Tp(z.name,R,I,N,A);y.push($),p.set(T)}return y})(new Uint8Array(t));this.layers=i.reduce(((o,l)=>Object.assign(Object.assign({},o),{[l.name]:new jm(l)})),{})}}class Cr{constructor(){this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0}extend(t){return this.minX=Math.min(this.minX,t.x),this.minY=Math.min(this.minY,t.y),this.maxX=Math.max(this.maxX,t.x),this.maxY=Math.max(this.maxY,t.y),this}expandBy(t){return this.minX-=t,this.minY-=t,this.maxX+=t,this.maxY+=t,(this.minX>this.maxX||this.minY>this.maxY)&&(this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0),this}shrinkBy(t){return this.expandBy(-t)}map(t){const i=new Cr;return i.extend(t(new et(this.minX,this.minY))),i.extend(t(new et(this.maxX,this.minY))),i.extend(t(new et(this.minX,this.maxY))),i.extend(t(new et(this.maxX,this.maxY))),i}static fromPoints(t){const i=new Cr;for(const o of t)i.extend(o);return i}contains(t){return t.x>=this.minX&&t.x<=this.maxX&&t.y>=this.minY&&t.y<=this.maxY}empty(){return this.minX>this.maxX}width(){return this.maxX-this.minX}height(){return this.maxY-this.minY}covers(t){return!this.empty()&&!t.empty()&&t.minX>=this.minX&&t.maxX<=this.maxX&&t.minY>=this.minY&&t.maxY<=this.maxY}intersects(t){return!this.empty()&&!t.empty()&&t.minX<=this.maxX&&t.maxX>=this.minX&&t.minY<=this.maxY&&t.maxY>=this.minY}}const Ao="_geojsonTileLayer";class _l{constructor(t,i){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new Jo(Re,16,0),this.grid3D=new Jo(Re,16,0),this.featureIndexArray=new Q,this.promoteId=i}insert(t,i,o,l,d,p){const y=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(o,l,d);const x=p?this.grid3D:this.grid;for(let T=0;T<i.length;T++){const M=i[T],A=[1/0,1/0,-1/0,-1/0];for(let z=0;z<M.length;z++){const I=M[z];A[0]=Math.min(A[0],I.x),A[1]=Math.min(A[1],I.y),A[2]=Math.max(A[2],I.x),A[3]=Math.max(A[3],I.y)}A[0]<Re&&A[1]<Re&&A[2]>=0&&A[3]>=0&&x.insert(y,A[0],A[1],A[2],A[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=this.encoding!=="mlt"?new Jf(new df(this.rawTileData)).layers:new Df(this.rawTileData).layers,this.sourceLayerCoder=new Pm(this.vtLayers?Object.keys(this.vtLayers).sort():[Ao])),this.vtLayers}query(t,i,o,l){this.loadVTLayers();const d=t.params,p=Re/t.tileSize/t.scale,y=Xa(d.filter,d.globalState),x=t.queryGeometry,T=t.queryPadding*p,M=Cr.fromPoints(x),A=this.grid.query(M.minX-T,M.minY-T,M.maxX+T,M.maxY+T),z=Cr.fromPoints(t.cameraQueryGeometry).expandBy(T),I=this.grid3D.query(z.minX,z.minY,z.maxX,z.maxY,((V,$,rt,K)=>(function(tt,vt,xt,Lt,Jt){for(const ee of tt)if(vt<=ee.x&&xt<=ee.y&&Lt>=ee.x&&Jt>=ee.y)return!0;const qt=[new et(vt,xt),new et(vt,Jt),new et(Lt,Jt),new et(Lt,xt)];if(tt.length>2){for(const ee of qt)if(Vc(tt,ee))return!0}for(let ee=0;ee<tt.length-1;ee++)if(im(tt[ee],tt[ee+1],qt))return!0;return!1})(t.cameraQueryGeometry,V-T,$-T,rt+T,K+T)));for(const V of I)A.push(V);A.sort(Td);const R={};let N;for(let V=0;V<A.length;V++){const $=A[V];if($===N)continue;N=$;const rt=this.featureIndexArray.get($);let K=null;this.loadMatchingFeature(R,rt.bucketIndex,rt.sourceLayerIndex,rt.featureIndex,y,d.layers,d.availableImages,i,o,l,((tt,vt,xt)=>(K||(K=$s(tt)),vt.queryIntersectsFeature({queryGeometry:x,feature:tt,featureState:xt,geometry:K,zoom:this.z,transform:t.transform,pixelsToTileUnits:p,pixelPosMatrix:t.pixelPosMatrix,unwrappedTileID:this.tileID.toUnwrapped(),getElevation:t.getElevation}))))}return R}loadMatchingFeature(t,i,o,l,d,p,y,x,T,M,A){const z=this.bucketLayerIDs[i];if(p&&!z.some((V=>p.has(V))))return;const I=this.sourceLayerCoder.decode(o),R=this.vtLayers[I].feature(l);if(d.needGeometry){const V=Na(R,!0);if(!d.filter(new Mi(this.tileID.overscaledZ),V,this.tileID.canonical))return}else if(!d.filter(new Mi(this.tileID.overscaledZ),R))return;const N=this.getId(R,I);for(let V=0;V<z.length;V++){const $=z[V];if(p&&!p.has($))continue;const rt=x[$];if(!rt)continue;let K={};N&&M&&(K=M.getState(rt.sourceLayer||Ao,N));const tt=Ke({},T[$]);tt.paint=fh(tt.paint,rt.paint,R,K,y),tt.layout=fh(tt.layout,rt.layout,R,K,y);const vt=!A||A(R,rt,K);if(!vt)continue;const xt=new bp(R,this.z,this.x,this.y,N);xt.layer=tt;let Lt=t[$];Lt===void 0&&(Lt=t[$]=[]),Lt.push({featureIndex:l,feature:xt,intersectionZ:vt})}}lookupSymbolFeatures(t,i,o,l,d,p,y,x){const T={};this.loadVTLayers();const M=Xa(d.filterSpec,d.globalState);for(const A of t)this.loadMatchingFeature(T,o,l,A,M,p,y,x,i);return T}hasLayer(t){for(const i of this.bucketLayerIDs)for(const o of i)if(t===o)return!0;return!1}getId(t,i){var o;let l=t.id;return this.promoteId&&(l=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[i]],typeof l=="boolean"&&(l=Number(l)),l===void 0&&(!((o=t.properties)===null||o===void 0)&&o.cluster)&&this.promoteId&&(l=Number(t.properties.cluster_id))),l}}function fh(a,t,i,o,l){return dn(a,((d,p)=>{const y=t instanceof wr?t.get(p):null;return y&&y.evaluate?y.evaluate(i,o,l):y}))}function Td(a,t){return t-a}function yl(a,t,i,o,l){const d=[];for(let p=0;p<a.length;p++){const y=a[p];let x;for(let T=0;T<y.length-1;T++){let M=y[T],A=y[T+1];M.x<t&&A.x<t||(M.x<t?M=new et(t,M.y+(t-M.x)/(A.x-M.x)*(A.y-M.y))._round():A.x<t&&(A=new et(t,M.y+(t-M.x)/(A.x-M.x)*(A.y-M.y))._round()),M.y<i&&A.y<i||(M.y<i?M=new et(M.x+(i-M.y)/(A.y-M.y)*(A.x-M.x),i)._round():A.y<i&&(A=new et(M.x+(i-M.y)/(A.y-M.y)*(A.x-M.x),i)._round()),M.x>=o&&A.x>=o||(M.x>=o?M=new et(o,M.y+(o-M.x)/(A.x-M.x)*(A.y-M.y))._round():A.x>=o&&(A=new et(o,M.y+(o-M.x)/(A.x-M.x)*(A.y-M.y))._round()),M.y>=l&&A.y>=l||(M.y>=l?M=new et(M.x+(l-M.y)/(A.y-M.y)*(A.x-M.x),l)._round():A.y>=l&&(A=new et(M.x+(l-M.y)/(A.y-M.y)*(A.x-M.x),l)._round()),x&&M.equals(x[x.length-1])||(x=[M],d.push(x)),x.push(A)))))}}return d}function Vm(a,t,i,o,l){switch(t){case 1:return(function(d,p,y,x){const T=[];for(const M of d)for(const A of M){const z=x===0?A.x:A.y;z>=p&&z<=y&&T.push([A])}return T})(a,i,o,l);case 2:return ph(a,i,o,l,!1);case 3:return ph(a,i,o,l,!0)}return[]}function Um(a,t,i,o,l){const d=o===0?xg:Gm;let p=[];const y=[];for(let M=0;M<a.length-1;M++){const A=a[M],z=a[M+1],I=o===0?A.x:A.y,R=o===0?z.x:z.y;let N=!1;I<t?R>t&&p.push(d(A,z,t)):I>i?R<i&&p.push(d(A,z,i)):p.push(A),R<t&&I>=t&&(p.push(d(A,z,t)),N=!0),R>i&&I<=i&&(p.push(d(A,z,i)),N=!0),!l&&N&&(y.push(p),p=[])}const x=a.length-1,T=o===0?a[x].x:a[x].y;return T>=t&&T<=i&&p.push(a[x]),l&&p.length>0&&!p[0].equals(p[p.length-1])&&p.push(new et(p[0].x,p[0].y)),p.length>0&&y.push(p),y}function ph(a,t,i,o,l){const d=[];for(const p of a){const y=Um(p,t,i,o,l);y.length>0&&d.push(...y)}return d}function xg(a,t,i){return new et(i,a.y+(i-a.x)/(t.x-a.x)*(t.y-a.y))}function Gm(a,t,i){return new et(a.x+(i-a.y)/(t.y-a.y)*(t.x-a.x),i)}ge("FeatureIndex",_l,{omit:["rawTileData","sourceLayerCoder"]});class Ks extends et{constructor(t,i,o,l){super(t,i),this.angle=o,l!==void 0&&(this.segment=l)}clone(){return new Ks(this.x,this.y,this.angle,this.segment)}}function Up(a,t,i,o,l){if(t.segment===void 0||i===0)return!0;let d=t,p=t.segment+1,y=0;for(;y>-i/2;){if(p--,p<0)return!1;y-=a[p].dist(d),d=a[p]}y+=a[p].dist(a[p+1]),p++;const x=[];let T=0;for(;y<i/2;){const M=a[p],A=a[p+1];if(!A)return!1;let z=a[p-1].angleTo(M)-M.angleTo(A);for(z=Math.abs((z+3*Math.PI)%(2*Math.PI)-Math.PI),x.push({distance:y,angleDelta:z}),T+=z;y-x[0].distance>o;)T-=x.shift().angleDelta;if(T>l)return!1;p++,y+=M.dist(A)}return!0}function qm(a){let t=0;for(let i=0;i<a.length-1;i++)t+=a[i].dist(a[i+1]);return t}function Sd(a,t,i){return a?.6*t*i:0}function Ed(a,t){return Math.max(a?a.right-a.left:0,t?t.right-t.left:0)}function Zm(a,t,i,o,l,d){const p=Sd(i,l,d),y=Ed(i,o)*d;let x=0;const T=qm(a)/2;for(let M=0;M<a.length-1;M++){const A=a[M],z=a[M+1],I=A.dist(z);if(x+I>T){const R=(T-x)/I,N=Rr.number(A.x,z.x,R),V=Rr.number(A.y,z.y,R),$=new Ks(N,V,z.angleTo(A),M);return $._round(),!p||Up(a,$,y,p,t)?$:void 0}x+=I}}function mh(a,t,i,o,l,d,p,y,x){const T=Sd(o,d,p),M=Ed(o,l),A=M*p,z=a[0].x===0||a[0].x===x||a[0].y===0||a[0].y===x;return t-A<t/4&&(t=A+t/4),Gp(a,z?t/2*y%t:(M/2+2*d)*p*y%t,t,T,i,A,z,!1,x)}function Gp(a,t,i,o,l,d,p,y,x){const T=d/2,M=qm(a);let A=0,z=t-i,I=[];for(let R=0;R<a.length-1;R++){const N=a[R],V=a[R+1],$=N.dist(V),rt=V.angleTo(N);for(;z+i<A+$;){z+=i;const K=(z-A)/$,tt=Rr.number(N.x,V.x,K),vt=Rr.number(N.y,V.y,K);if(tt>=0&&tt<x&&vt>=0&&vt<x&&z-T>=0&&z+T<=M){const xt=new Ks(tt,vt,rt,R);xt._round(),o&&!Up(a,xt,d,o,l)||I.push(xt)}}A+=$}return y||I.length||p||(I=Gp(a,A/2,i,o,l,d,p,!0,x)),I}function zf(a,t,i,o){const l=[],d=a.image,p=d.pixelRatio,y=d.paddedRect.w-2,x=d.paddedRect.h-2;let T={x1:a.left,y1:a.top,x2:a.right,y2:a.bottom};const M=d.stretchX||[[0,y]],A=d.stretchY||[[0,x]],z=(Zt,ze)=>Zt+ze[1]-ze[0],I=M.reduce(z,0),R=A.reduce(z,0),N=y-I,V=x-R;let $=0,rt=I,K=0,tt=R,vt=0,xt=N,Lt=0,Jt=V;if(d.content&&o){const Zt=d.content,ze=Zt[2]-Zt[0],Pe=Zt[3]-Zt[1];(d.textFitWidth||d.textFitHeight)&&(T=Cm(a)),$=cu(M,0,Zt[0]),K=cu(A,0,Zt[1]),rt=cu(M,Zt[0],Zt[2]),tt=cu(A,Zt[1],Zt[3]),vt=Zt[0]-$,Lt=Zt[1]-K,xt=ze-rt,Jt=Pe-tt}const qt=T.x1,ee=T.y1,fe=T.x2-qt,oe=T.y2-ee,le=(Zt,ze,Pe,ke)=>{const Ee=Pf(Zt.stretch-$,rt,fe,qt),ai=uu(Zt.fixed-vt,xt,Zt.stretch,I),vn=Pf(ze.stretch-K,tt,oe,ee),oa=uu(ze.fixed-Lt,Jt,ze.stretch,R),Qa=Pf(Pe.stretch-$,rt,fe,qt),Do=uu(Pe.fixed-vt,xt,Pe.stretch,I),Ar=Pf(ke.stretch-K,tt,oe,ee),ja=uu(ke.fixed-Lt,Jt,ke.stretch,R),Ja=new et(Ee,vn),Gn=new et(Qa,vn),Va=new et(Qa,Ar),fr=new et(Ee,Ar),pr=new et(ai/p,oa/p),Xr=new et(Do/p,ja/p),tr=t*Math.PI/180;if(tr){const Aa=Math.sin(tr),Mn=Math.cos(tr),la=[Mn,-Aa,Aa,Mn];Ja._matMult(la),Gn._matMult(la),fr._matMult(la),Va._matMult(la)}const Yr=Zt.stretch+Zt.fixed,zo=ze.stretch+ze.fixed;return{tl:Ja,tr:Gn,bl:fr,br:Va,tex:{x:d.paddedRect.x+1+Yr,y:d.paddedRect.y+1+zo,w:Pe.stretch+Pe.fixed-Yr,h:ke.stretch+ke.fixed-zo},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:pr,pixelOffsetBR:Xr,minFontScaleX:xt/p/fe,minFontScaleY:Jt/p/oe,isSDF:i}};if(o&&(d.stretchX||d.stretchY)){const Zt=qp(M,N,I),ze=qp(A,V,R);for(let Pe=0;Pe<Zt.length-1;Pe++){const ke=Zt[Pe],Ee=Zt[Pe+1];for(let ai=0;ai<ze.length-1;ai++)l.push(le(ke,ze[ai],Ee,ze[ai+1]))}}else l.push(le({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:y+1},{fixed:0,stretch:x+1}));return l}function cu(a,t,i){let o=0;for(const l of a)o+=Math.max(t,Math.min(i,l[1]))-Math.max(t,Math.min(i,l[0]));return o}function qp(a,t,i){const o=[{fixed:-1,stretch:0}];for(const[l,d]of a){const p=o[o.length-1];o.push({fixed:l-p.stretch,stretch:p.stretch}),o.push({fixed:l-p.stretch,stretch:p.stretch+(d-l)})}return o.push({fixed:t+1,stretch:i}),o}function Pf(a,t,i,o){return a/t*i+o}function uu(a,t,i,o){return a-t*i/o}ge("Anchor",Ks);class n{constructor(t,i,o,l,d,p,y,x,T,M){var A;if(this.boxStartIndex=t.length,T){let z=p.top,I=p.bottom;const R=p.collisionPadding;R&&(z-=R[1],I+=R[3]);let N=I-z;N>0&&(N=Math.max(10,N),this.circleDiameter=N)}else{const z=!((A=p.image)===null||A===void 0)&&A.content&&(p.image.textFitWidth||p.image.textFitHeight)?Cm(p):{x1:p.left,y1:p.top,x2:p.right,y2:p.bottom};z.y1=z.y1*y-x[0],z.y2=z.y2*y+x[2],z.x1=z.x1*y-x[3],z.x2=z.x2*y+x[1];const I=p.collisionPadding;if(I&&(z.x1-=I[0]*y,z.y1-=I[1]*y,z.x2+=I[2]*y,z.y2+=I[3]*y),M){const R=new et(z.x1,z.y1),N=new et(z.x2,z.y1),V=new et(z.x1,z.y2),$=new et(z.x2,z.y2),rt=M*Math.PI/180;R._rotate(rt),N._rotate(rt),V._rotate(rt),$._rotate(rt),z.x1=Math.min(R.x,N.x,V.x,$.x),z.x2=Math.max(R.x,N.x,V.x,$.x),z.y1=Math.min(R.y,N.y,V.y,$.y),z.y2=Math.max(R.y,N.y,V.y,$.y)}t.emplaceBack(i.x,i.y,z.x1,z.y1,z.x2,z.y2,o,l,d)}this.boxEndIndex=t.length}}class s{constructor(t=[],i=(o,l)=>o<l?-1:o>l?1:0){if(this.data=t,this.length=this.data.length,this.compare=i,this.length>0)for(let o=(this.length>>1)-1;o>=0;o--)this._down(o)}push(t){this.data.push(t),this._up(this.length++)}pop(){if(this.length===0)return;const t=this.data[0],i=this.data.pop();return--this.length>0&&(this.data[0]=i,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:i,compare:o}=this,l=i[t];for(;t>0;){const d=t-1>>1,p=i[d];if(o(l,p)>=0)break;i[t]=p,t=d}i[t]=l}_down(t){const{data:i,compare:o}=this,l=this.length>>1,d=i[t];for(;t<l;){let p=1+(t<<1);const y=p+1;if(y<this.length&&o(i[y],i[p])<0&&(p=y),o(i[p],d)>=0)break;i[t]=i[p],t=p}i[t]=d}}function u(a,t=1,i=!1){const o=Cr.fromPoints(a[0]),l=Math.min(o.width(),o.height());let d=l/2;const p=new s([],_),{minX:y,minY:x,maxX:T,maxY:M}=o;if(l===0)return new et(y,x);for(let I=y;I<T;I+=l)for(let R=x;R<M;R+=l)p.push(new b(I+d,R+d,d,a));let A=(function(I){let R=0,N=0,V=0;const $=I[0];for(let rt=0,K=$.length,tt=K-1;rt<K;tt=rt++){const vt=$[rt],xt=$[tt],Lt=vt.x*xt.y-xt.x*vt.y;N+=(vt.x+xt.x)*Lt,V+=(vt.y+xt.y)*Lt,R+=3*Lt}return new b(N/R,V/R,0,I)})(a),z=p.length;for(;p.length;){const I=p.pop();(I.d>A.d||!A.d)&&(A=I,i&&console.log("found best %d after %d probes",Math.round(1e4*I.d)/1e4,z)),I.max-A.d<=t||(d=I.h/2,p.push(new b(I.p.x-d,I.p.y-d,d,a)),p.push(new b(I.p.x+d,I.p.y-d,d,a)),p.push(new b(I.p.x-d,I.p.y+d,d,a)),p.push(new b(I.p.x+d,I.p.y+d,d,a)),z+=4)}return i&&(console.log(`num probes: ${z}`),console.log(`best distance: ${A.d}`)),A.p}function _(a,t){return t.max-a.max}function b(a,t,i,o){this.p=new et(a,t),this.h=i,this.d=(function(l,d){let p=!1,y=1/0;for(let x=0;x<d.length;x++){const T=d[x];for(let M=0,A=T.length,z=A-1;M<A;z=M++){const I=T[M],R=T[z];I.y>l.y!=R.y>l.y&&l.x<(R.x-I.x)*(l.y-I.y)/(R.y-I.y)+I.x&&(p=!p),y=Math.min(y,Wn(l,I,R))}}return(p?1:-1)*Math.sqrt(y)})(this.p,o),this.max=this.d+this.h*Math.SQRT2}var E;P.aO=void 0,(E=P.aO||(P.aO={}))[E.center=1]="center",E[E.left=2]="left",E[E.right=3]="right",E[E.top=4]="top",E[E.bottom=5]="bottom",E[E["top-left"]=6]="top-left",E[E["top-right"]=7]="top-right",E[E["bottom-left"]=8]="bottom-left",E[E["bottom-right"]=9]="bottom-right";const O=Number.POSITIVE_INFINITY;function X(a,t){return t[1]!==O?(function(i,o,l){let d=0,p=0;switch(o=Math.abs(o),l=Math.abs(l),i){case"top-right":case"top-left":case"top":p=l-7;break;case"bottom-right":case"bottom-left":case"bottom":p=7-l}switch(i){case"top-right":case"bottom-right":case"right":d=-o;break;case"top-left":case"bottom-left":case"left":d=o}return[d,p]})(a,t[0],t[1]):(function(i,o){let l=0,d=0;o<0&&(o=0);const p=o/Math.SQRT2;switch(i){case"top-right":case"top-left":d=p-7;break;case"bottom-right":case"bottom-left":d=7-p;break;case"bottom":d=7-o;break;case"top":d=o-7}switch(i){case"top-right":case"bottom-right":l=-p;break;case"top-left":case"bottom-left":l=p;break;case"left":l=o;break;case"right":l=-o}return[l,d]})(a,t[0])}function _t(a,t,i){var o;const l=a.layout,d=(o=l.get("text-variable-anchor-offset"))===null||o===void 0?void 0:o.evaluate(t,{},i);if(d){const y=d.values,x=[];for(let T=0;T<y.length;T+=2){const M=x[T]=y[T],A=y[T+1].map((z=>z*Qn));M.startsWith("top")?A[1]-=7:M.startsWith("bottom")&&(A[1]+=7),x[T+1]=A}return new Hn(x)}const p=l.get("text-variable-anchor");if(p){let y;y=a._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[l.get("text-radial-offset").evaluate(t,{},i)*Qn,O]:l.get("text-offset").evaluate(t,{},i).map((T=>T*Qn));const x=[];for(const T of p)x.push(T,X(T,y));return new Hn(x)}return null}function Ft(a){switch(a){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Wt(a,t,i,o,l,d,p,y,x,T,M,A){let z=d.textMaxSize.evaluate(t,{});z===void 0&&(z=p);const I=a.layers[0].layout,R=I.get("icon-offset").evaluate(t,{},M),N=Vt(i.horizontal),V=p/24,$=a.tilePixelRatio*V,rt=a.tilePixelRatio*z/24,K=a.tilePixelRatio*y,tt=a.tilePixelRatio*I.get("symbol-spacing"),vt=I.get("text-padding")*a.tilePixelRatio,xt=(function(Pe,ke,Ee,ai=1){const vn=Pe.get("icon-padding").evaluate(ke,{},Ee),oa=vn&&vn.values;return[oa[0]*ai,oa[1]*ai,oa[2]*ai,oa[3]*ai]})(I,t,M,a.tilePixelRatio),Lt=I.get("text-max-angle")/180*Math.PI,Jt=I.get("text-rotation-alignment")!=="viewport"&&I.get("symbol-placement")!=="point",qt=I.get("icon-rotation-alignment")==="map"&&I.get("symbol-placement")!=="point",ee=I.get("symbol-placement"),fe=tt/2,oe=I.get("icon-text-fit");let le;o&&oe!=="none"&&(a.allowVerticalPlacement&&i.vertical&&(le=od(o,i.vertical,oe,I.get("icon-text-fit-padding"),R,V)),N&&(o=od(o,N,oe,I.get("icon-text-fit-padding"),R,V)));const Zt=M?A.line.getGranularityForZoomLevel(M.z):1,ze=(Pe,ke)=>{ke.x<0||ke.x>=Re||ke.y<0||ke.y>=Re||(function(Ee,ai,vn,oa,Qa,Do,Ar,ja,Ja,Gn,Va,fr,pr,Xr,tr,Yr,zo,Aa,Mn,la,kn,Da,hu,vl,Zp){const gh=Ee.addToLineVertexArray(ai,vn);let Md,If,Rf,Lf,$g=0,Xg=0,Yg=0,Wg=0,bg=-1,wg=-1;const du={};let Kg=_s("");if(Ee.allowVerticalPlacement&&oa.vertical){const mr=ja.layout.get("text-rotate").evaluate(kn,{},vl)+90;Rf=new n(Ja,ai,Gn,Va,fr,oa.vertical,pr,Xr,tr,mr),Ar&&(Lf=new n(Ja,ai,Gn,Va,fr,Ar,zo,Aa,tr,mr))}if(Qa){const mr=ja.layout.get("icon-rotate").evaluate(kn,{}),Qs=ja.layout.get("icon-text-fit")!=="none",Cd=zf(Qa,mr,hu,Qs),bl=Ar?zf(Ar,mr,hu,Qs):void 0;If=new n(Ja,ai,Gn,Va,fr,Qa,zo,Aa,!1,mr),$g=4*Cd.length;const Ad=Ee.iconSizeData;let hc=null;Ad.kind==="source"?(hc=[Sr*ja.layout.get("icon-size").evaluate(kn,{})],hc[0]>Mo&&oi(`${Ee.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):Ad.kind==="composite"&&(hc=[Sr*Da.compositeIconSizes[0].evaluate(kn,{},vl),Sr*Da.compositeIconSizes[1].evaluate(kn,{},vl)],(hc[0]>Mo||hc[1]>Mo)&&oi(`${Ee.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),Ee.addSymbols(Ee.icon,Cd,hc,la,Mn,kn,P.ay.none,ai,gh.lineStartIndex,gh.lineLength,-1,vl),bg=Ee.icon.placedSymbolArray.length-1,bl&&(Xg=4*bl.length,Ee.addSymbols(Ee.icon,bl,hc,la,Mn,kn,P.ay.vertical,ai,gh.lineStartIndex,gh.lineLength,-1,vl),wg=Ee.icon.placedSymbolArray.length-1)}const Qg=Object.keys(oa.horizontal);for(const mr of Qg){const Qs=oa.horizontal[mr];if(!Md){Kg=_s(Qs.text);const bl=ja.layout.get("text-rotate").evaluate(kn,{},vl);Md=new n(Ja,ai,Gn,Va,fr,Qs,pr,Xr,tr,bl)}const Cd=Qs.positionedLines.length===1;if(Yg+=ie(Ee,ai,Qs,Do,ja,tr,kn,Yr,gh,oa.vertical?P.ay.horizontal:P.ay.horizontalOnly,Cd?Qg:[mr],du,bg,Da,vl),Cd)break}oa.vertical&&(Wg+=ie(Ee,ai,oa.vertical,Do,ja,tr,kn,Yr,gh,P.ay.vertical,["vertical"],du,wg,Da,vl));const B_=Md?Md.boxStartIndex:Ee.collisionBoxArray.length,N_=Md?Md.boxEndIndex:Ee.collisionBoxArray.length,F_=Rf?Rf.boxStartIndex:Ee.collisionBoxArray.length,j_=Rf?Rf.boxEndIndex:Ee.collisionBoxArray.length,V_=If?If.boxStartIndex:Ee.collisionBoxArray.length,U_=If?If.boxEndIndex:Ee.collisionBoxArray.length,G_=Lf?Lf.boxStartIndex:Ee.collisionBoxArray.length,q_=Lf?Lf.boxEndIndex:Ee.collisionBoxArray.length;let xl=-1;const Hm=(mr,Qs)=>mr&&mr.circleDiameter?Math.max(mr.circleDiameter,Qs):Qs;xl=Hm(Md,xl),xl=Hm(Rf,xl),xl=Hm(If,xl),xl=Hm(Lf,xl);const Jg=xl>-1?1:0;Jg&&(xl*=Zp/Qn),Ee.glyphOffsetArray.length>=eu.MAX_GLYPHS&&oi("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),kn.sortKey!==void 0&&Ee.addToSortKeyRanges(Ee.symbolInstances.length,kn.sortKey);const Z_=_t(ja,kn,vl),[H_,$_]=(function(mr,Qs){const Cd=mr.length,bl=Qs?.values;if(bl?.length>0)for(let Ad=0;Ad<bl.length;Ad+=2){const hc=bl[Ad+1];mr.emplaceBack(P.aO[bl[Ad]],hc[0],hc[1])}return[Cd,mr.length]})(Ee.textAnchorOffsets,Z_);Ee.symbolInstances.emplaceBack(ai.x,ai.y,du.right>=0?du.right:-1,du.center>=0?du.center:-1,du.left>=0?du.left:-1,du.vertical||-1,bg,wg,Kg,B_,N_,F_,j_,V_,U_,G_,q_,Gn,Yg,Wg,$g,Xg,Jg,0,pr,xl,H_,$_)})(a,ke,Pe,i,o,l,le,a.layers[0],a.collisionBoxArray,t.index,t.sourceLayerIndex,a.index,$,[vt,vt,vt,vt],Jt,x,K,xt,qt,R,t,d,T,M,p)};if(ee==="line")for(const Pe of yl(t.geometry,0,0,Re,Re)){const ke=Ql(Pe,Zt),Ee=mh(ke,tt,Lt,i.vertical||N,o,24,rt,a.overscaling,Re);for(const ai of Ee)N&&Gt(a,N.text,fe,ai)||ze(ke,ai)}else if(ee==="line-center"){for(const Pe of t.geometry)if(Pe.length>1){const ke=Ql(Pe,Zt),Ee=Zm(ke,Lt,i.vertical||N,o,24,rt);Ee&&ze(ke,Ee)}}else if(t.type==="Polygon")for(const Pe of Il(t.geometry,0)){const ke=u(Pe,16);ze(Ql(Pe[0],Zt,!0),new Ks(ke.x,ke.y,0))}else if(t.type==="LineString")for(const Pe of t.geometry){const ke=Ql(Pe,Zt);ze(ke,new Ks(ke[0].x,ke[0].y,0))}else if(t.type==="Point")for(const Pe of t.geometry)for(const ke of Pe)ze([ke],new Ks(ke.x,ke.y,0))}function ie(a,t,i,o,l,d,p,y,x,T,M,A,z,I,R){const N=(function(rt,K,tt,vt,xt,Lt,Jt,qt){const ee=vt.layout.get("text-rotate").evaluate(Lt,{})*Math.PI/180,fe=[];for(const oe of K.positionedLines)for(const le of oe.positionedGlyphs){if(!le.rect)continue;const Zt=le.rect||{};let ze=4,Pe=!0,ke=1,Ee=0;const ai=(xt||qt)&&le.vertical,vn=le.metrics.advance*le.scale/2;if(qt&&K.verticalizable&&(Ee=oe.lineOffset/2-(le.imageName?-(Qn-le.metrics.width*le.scale)/2:(le.scale-1)*Qn)),le.imageName){const Aa=Jt[le.imageName];Pe=Aa.sdf,ke=Aa.pixelRatio,ze=1/ke}const oa=xt?[le.x+vn,le.y]:[0,0];let Qa=xt?[0,0]:[le.x+vn+tt[0],le.y+tt[1]-Ee],Do=[0,0];ai&&(Do=Qa,Qa=[0,0]);const Ar=le.metrics.isDoubleResolution?2:1,ja=(le.metrics.left-ze)*le.scale-vn+Qa[0],Ja=(-le.metrics.top-ze)*le.scale+Qa[1],Gn=ja+Zt.w/Ar*le.scale/ke,Va=Ja+Zt.h/Ar*le.scale/ke,fr=new et(ja,Ja),pr=new et(Gn,Ja),Xr=new et(ja,Va),tr=new et(Gn,Va);if(ai){const Aa=new et(-vn,vn- -17),Mn=-Math.PI/2,la=12-vn,kn=new et(22-la,-(le.imageName?la:0)),Da=new et(...Do);fr._rotateAround(Mn,Aa)._add(kn)._add(Da),pr._rotateAround(Mn,Aa)._add(kn)._add(Da),Xr._rotateAround(Mn,Aa)._add(kn)._add(Da),tr._rotateAround(Mn,Aa)._add(kn)._add(Da)}if(ee){const Aa=Math.sin(ee),Mn=Math.cos(ee),la=[Mn,-Aa,Aa,Mn];fr._matMult(la),pr._matMult(la),Xr._matMult(la),tr._matMult(la)}const Yr=new et(0,0),zo=new et(0,0);fe.push({tl:fr,tr:pr,bl:Xr,br:tr,tex:Zt,writingMode:K.writingMode,glyphOffset:oa,sectionIndex:le.sectionIndex,isSDF:Pe,pixelOffsetTL:Yr,pixelOffsetBR:zo,minFontScaleX:0,minFontScaleY:0})}return fe})(0,i,y,l,d,p,o,a.allowVerticalPlacement),V=a.textSizeData;let $=null;V.kind==="source"?($=[Sr*l.layout.get("text-size").evaluate(p,{})],$[0]>Mo&&oi(`${a.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):V.kind==="composite"&&($=[Sr*I.compositeTextSizes[0].evaluate(p,{},R),Sr*I.compositeTextSizes[1].evaluate(p,{},R)],($[0]>Mo||$[1]>Mo)&&oi(`${a.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),a.addSymbols(a.text,N,$,y,d,p,T,t,x.lineStartIndex,x.lineLength,z,R);for(const rt of M)A[rt]=a.text.placedSymbolArray.length-1;return 4*N.length}function Vt(a){for(const t in a)return a[t];return null}function Gt(a,t,i,o){const l=a.compareText;if(t in l){const d=l[t];for(let p=d.length-1;p>=0;p--)if(o.dist(d[p])<i)return!0}else l[t]=[];return l[t].push(o),!1}const Me=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Ve{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[i,o]=new Uint8Array(t,0,2);if(i!==219)throw new Error("Data does not appear to be in a KDBush format.");const l=o>>4;if(l!==1)throw new Error(`Got v${l} data when expected v1.`);const d=Me[15&o];if(!d)throw new Error("Unrecognized array type.");const[p]=new Uint16Array(t,2,1),[y]=new Uint32Array(t,4,1);return new Ve(y,p,d,t)}constructor(t,i=64,o=Float64Array,l){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+i,2),65535),this.ArrayType=o,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const d=Me.indexOf(this.ArrayType),p=2*t*this.ArrayType.BYTES_PER_ELEMENT,y=t*this.IndexArrayType.BYTES_PER_ELEMENT,x=(8-y%8)%8;if(d<0)throw new Error(`Unexpected typed array class: ${o}.`);l&&l instanceof ArrayBuffer?(this.data=l,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+y+x,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+p+y+x),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+y+x,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+d]),new Uint16Array(this.data,2,1)[0]=i,new Uint32Array(this.data,4,1)[0]=t)}add(t,i){const o=this._pos>>1;return this.ids[o]=o,this.coords[this._pos++]=t,this.coords[this._pos++]=i,o}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return Gi(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,i,o,l){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:d,coords:p,nodeSize:y}=this,x=[0,d.length-1,0],T=[];for(;x.length;){const M=x.pop()||0,A=x.pop()||0,z=x.pop()||0;if(A-z<=y){for(let V=z;V<=A;V++){const $=p[2*V],rt=p[2*V+1];$>=t&&$<=o&&rt>=i&&rt<=l&&T.push(d[V])}continue}const I=z+A>>1,R=p[2*I],N=p[2*I+1];R>=t&&R<=o&&N>=i&&N<=l&&T.push(d[I]),(M===0?t<=R:i<=N)&&(x.push(z),x.push(I-1),x.push(1-M)),(M===0?o>=R:l>=N)&&(x.push(I+1),x.push(A),x.push(1-M))}return T}within(t,i,o){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:l,coords:d,nodeSize:p}=this,y=[0,l.length-1,0],x=[],T=o*o;for(;y.length;){const M=y.pop()||0,A=y.pop()||0,z=y.pop()||0;if(A-z<=p){for(let V=z;V<=A;V++)te(d[2*V],d[2*V+1],t,i)<=T&&x.push(l[V]);continue}const I=z+A>>1,R=d[2*I],N=d[2*I+1];te(R,N,t,i)<=T&&x.push(l[I]),(M===0?t-o<=R:i-o<=N)&&(y.push(z),y.push(I-1),y.push(1-M)),(M===0?t+o>=R:i+o>=N)&&(y.push(I+1),y.push(A),y.push(1-M))}return x}}function Gi(a,t,i,o,l,d){if(l-o<=i)return;const p=o+l>>1;Ct(a,t,p,o,l,d),Gi(a,t,i,o,p-1,1-d),Gi(a,t,i,p+1,l,1-d)}function Ct(a,t,i,o,l,d){for(;l>o;){if(l-o>600){const T=l-o+1,M=i-o+1,A=Math.log(T),z=.5*Math.exp(2*A/3),I=.5*Math.sqrt(A*z*(T-z)/T)*(M-T/2<0?-1:1);Ct(a,t,i,Math.max(o,Math.floor(i-M*z/T+I)),Math.min(l,Math.floor(i+(T-M)*z/T+I)),d)}const p=t[2*i+d];let y=o,x=l;for(St(a,t,o,i),t[2*l+d]>p&&St(a,t,o,l);y<x;){for(St(a,t,y,x),y++,x--;t[2*y+d]<p;)y++;for(;t[2*x+d]>p;)x--}t[2*o+d]===p?St(a,t,o,x):(x++,St(a,t,x,l)),x<=i&&(o=x+1),i<=x&&(l=x-1)}}function St(a,t,i,o){Ot(a,i,o),Ot(t,2*i,2*o),Ot(t,2*i+1,2*o+1)}function Ot(a,t,i){const o=a[t];a[t]=a[i],a[i]=o}function te(a,t,i,o){const l=a-i,d=t-o;return l*l+d*d}var Oe;P.cG=void 0,(Oe=P.cG||(P.cG={})).create="create",Oe.load="load",Oe.fullLoad="fullLoad";let wi=null,De=[];const ei=1e3/60,fi="loadTime",Ei="fullLoadTime",uc={mark(a){performance.mark(a)},frame(a){const t=a;wi!=null&&De.push(t-wi),wi=t},clearMetrics(){wi=null,De=[],performance.clearMeasures(fi),performance.clearMeasures(Ei);for(const a in P.cG)performance.clearMarks(P.cG[a])},getPerformanceMetrics(){performance.measure(fi,P.cG.create,P.cG.load),performance.measure(Ei,P.cG.create,P.cG.fullLoad);const a=performance.getEntriesByName(fi)[0].duration,t=performance.getEntriesByName(Ei)[0].duration,i=De.length,o=1/(De.reduce(((d,p)=>d+p),0)/i/1e3),l=De.filter((d=>d>ei)).reduce(((d,p)=>d+(p-ei)/ei),0);return{loadTime:a,fullLoadTime:t,fps:o,percentDroppedFrames:l/(i+l)*100,totalFrames:i}}};P.$=Yt,P.A=At,P.B=ps,P.C=yr,P.D=Se,P.E=Et,P.F=function([a,t,i]){return t+=90,t*=Math.PI/180,i*=Math.PI/180,{x:a*Math.cos(t)*Math.sin(i),y:a*Math.sin(t)*Math.sin(i),z:a*Math.cos(i)}},P.G=Rr,P.H=Mi,P.I=mf,P.J=Hd,P.K=function(a){if(Di==null){const t=a.navigator?a.navigator.userAgent:null;Di=!!a.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return Di},P.L=class{constructor(a,t){this.target=a,this.mapId=t,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new pg((()=>this.process())),this.subscription=xa(this.target,"message",(i=>this.receive(i)),!1),this.globalScope=xn(self)?a:window}registerMessageHandler(a,t){this.messageHandlers[a]=t}unregisterMessageHandler(a){delete this.messageHandlers[a]}sendAsync(a,t){return new Promise(((i,o)=>{const l=Math.round(1e18*Math.random()).toString(36).substring(0,10),d=t?xa(t.signal,"abort",(()=>{d?.unsubscribe(),delete this.resolveRejects[l];const x={id:l,type:"<cancel>",origin:location.origin,targetMapId:a.targetMapId,sourceMapId:this.mapId};this.target.postMessage(x)}),dd):null;this.resolveRejects[l]={resolve:x=>{d?.unsubscribe(),i(x)},reject:x=>{d?.unsubscribe(),o(x)}};const p=[],y=Object.assign(Object.assign({},a),{id:l,sourceMapId:this.mapId,origin:location.origin,data:po(a.data,p)});this.target.postMessage(y,{transfer:p})}))}receive(a){const t=a.data,i=t.id;if(!(t.origin!=="file://"&&location.origin!=="file://"&&t.origin!=="resource://android"&&location.origin!=="resource://android"&&t.origin!==location.origin||t.targetMapId&&this.mapId!==t.targetMapId)){if(t.type==="<cancel>"){delete this.tasks[i];const o=this.abortControllers[i];return delete this.abortControllers[i],void(o&&o.abort())}if(xn(self)||t.mustQueue)return this.tasks[i]=t,this.taskQueue.push(i),void this.invoker.trigger();this.processTask(i,t)}}process(){if(this.taskQueue.length===0)return;const a=this.taskQueue.shift(),t=this.tasks[a];delete this.tasks[a],this.taskQueue.length>0&&this.invoker.trigger(),t&&this.processTask(a,t)}processTask(a,t){return h(this,void 0,void 0,(function*(){if(t.type==="<response>"){const l=this.resolveRejects[a];return delete this.resolveRejects[a],l?void(t.error?l.reject(ms(t.error)):l.resolve(ms(t.data))):void 0}if(!this.messageHandlers[t.type])return void this.completeTask(a,new Error(`Could not find a registered handler for ${t.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const i=ms(t.data),o=new AbortController;this.abortControllers[a]=o;try{const l=yield this.messageHandlers[t.type](t.sourceMapId,i,o);this.completeTask(a,null,l)}catch(l){this.completeTask(a,l)}}))}completeTask(a,t,i){const o=[];delete this.abortControllers[a];const l={id:a,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:t?po(t):null,data:po(i,o)};this.target.postMessage(l,{transfer:o})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},P.M=Ro,P.N=function(){var a=new At(16);return At!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=0,a[12]=0,a[13]=0,a[14]=0),a[0]=1,a[5]=1,a[10]=1,a[15]=1,a},P.O=function(a,t,i){var o,l,d,p,y,x,T,M,A,z,I,R,N=i[0],V=i[1],$=i[2];return t===a?(a[12]=t[0]*N+t[4]*V+t[8]*$+t[12],a[13]=t[1]*N+t[5]*V+t[9]*$+t[13],a[14]=t[2]*N+t[6]*V+t[10]*$+t[14],a[15]=t[3]*N+t[7]*V+t[11]*$+t[15]):(l=t[1],d=t[2],p=t[3],y=t[4],x=t[5],T=t[6],M=t[7],A=t[8],z=t[9],I=t[10],R=t[11],a[0]=o=t[0],a[1]=l,a[2]=d,a[3]=p,a[4]=y,a[5]=x,a[6]=T,a[7]=M,a[8]=A,a[9]=z,a[10]=I,a[11]=R,a[12]=o*N+y*V+A*$+t[12],a[13]=l*N+x*V+z*$+t[13],a[14]=d*N+T*V+I*$+t[14],a[15]=p*N+M*V+R*$+t[15]),a},P.P=et,P.Q=function(a,t,i){var o=i[0],l=i[1],d=i[2];return a[0]=t[0]*o,a[1]=t[1]*o,a[2]=t[2]*o,a[3]=t[3]*o,a[4]=t[4]*l,a[5]=t[5]*l,a[6]=t[6]*l,a[7]=t[7]*l,a[8]=t[8]*d,a[9]=t[9]*d,a[10]=t[10]*d,a[11]=t[11]*d,a[12]=t[12],a[13]=t[13],a[14]=t[14],a[15]=t[15],a},P.R=Fa,P.S=function(a,t,i){var o=t[0],l=t[1],d=t[2],p=t[3],y=t[4],x=t[5],T=t[6],M=t[7],A=t[8],z=t[9],I=t[10],R=t[11],N=t[12],V=t[13],$=t[14],rt=t[15],K=i[0],tt=i[1],vt=i[2],xt=i[3];return a[0]=K*o+tt*y+vt*A+xt*N,a[1]=K*l+tt*x+vt*z+xt*V,a[2]=K*d+tt*T+vt*I+xt*$,a[3]=K*p+tt*M+vt*R+xt*rt,a[4]=(K=i[4])*o+(tt=i[5])*y+(vt=i[6])*A+(xt=i[7])*N,a[5]=K*l+tt*x+vt*z+xt*V,a[6]=K*d+tt*T+vt*I+xt*$,a[7]=K*p+tt*M+vt*R+xt*rt,a[8]=(K=i[8])*o+(tt=i[9])*y+(vt=i[10])*A+(xt=i[11])*N,a[9]=K*l+tt*x+vt*z+xt*V,a[10]=K*d+tt*T+vt*I+xt*$,a[11]=K*p+tt*M+vt*R+xt*rt,a[12]=(K=i[12])*o+(tt=i[13])*y+(vt=i[14])*A+(xt=i[15])*N,a[13]=K*l+tt*x+vt*z+xt*V,a[14]=K*d+tt*T+vt*I+xt*$,a[15]=K*p+tt*M+vt*R+xt*rt,a},P.T=$u,P.U=function(a,t){const i={};for(let o=0;o<t.length;o++){const l=t[o];l in a&&(i[l]=a[l])}return i},P.V=ml,P.W=Ue,P.X=xf,P.Y=fd,P.Z=gt,P._=h,P.a=Ts,P.a$=$e,P.a0=ca,P.a1=Er,P.a2=bf,P.a3=ac,P.a4=Re,P.a5=function(a,t,i){if(!a)return t||{};if(!t)return a||{};const o=Ma(a),l=Ma(t);(function(p,y){y.removeAll&&(p.add.clear(),p.update.clear(),p.remove.clear(),y.remove.clear());for(const x of y.remove)p.add.delete(x),p.update.delete(x);for(const[x,T]of y.update){const M=p.update.get(x);M&&(y.update.set(x,xp(M,T)),p.update.delete(x))}})(o,l);const d={};if((o.removeAll||l.removeAll)&&(d.removeAll=!0),d.remove=new Set([...o.remove,...l.remove]),d.add=new Map([...o.add,...l.add]),d.update=new Map([...o.update,...l.update]),d.remove.size&&d.add.size)for(const p of d.add.keys())d.remove.delete(p);return(function(p){const y={};return p.removeAll&&(y.removeAll=p.removeAll),p.remove&&(y.remove=Array.from(p.remove)),p.add&&(y.add=Array.from(p.add.values())),p.update&&(y.update=Array.from(p.update.values())),y})(d)},P.a6=function(a,t){if(a==null)return!0;if(a.type==="Feature")return Pi(a,t)!=null;if(a.type==="FeatureCollection"){const i=new Set;for(const o of a.features){const l=Pi(o,t);if(l==null||i.has(l))return!1;i.add(l)}return!0}return!1},P.a7=function(a,t){const i=new Map;if(a!=null)if(a.type==="Feature")i.set(Pi(a,t),a);else for(const o of a.features)i.set(Pi(o,t),o);return i},P.a8=function(a,t,i){var o,l;if(t.removeAll)a.clear();else if(t.remove)for(const d of t.remove)a.delete(d);if(t.add)for(const d of t.add){const p=Pi(d,i);p!=null&&a.set(p,d)}if(t.update)for(const d of t.update){let p=a.get(d.id);if(!p)continue;const y=!!d.newGeometry,x=d.removeAllProperties||((o=d.removeProperties)===null||o===void 0?void 0:o.length)>0||((l=d.addOrUpdateProperties)===null||l===void 0?void 0:l.length)>0;if((y||x)&&(p=Object.assign({},p),a.set(d.id,p),y&&(p.geometry=d.newGeometry),x)){if(p.properties=d.removeAllProperties?{}:Object.assign({},p.properties||{}),d.removeProperties)for(const T of d.removeProperties)delete p.properties[T];if(d.addOrUpdateProperties)for(const{key:T,value:M}of d.addOrUpdateProperties)p.properties[T]=M}}},P.a9=Ao,P.aA=function(a,t){var i=t[0],o=t[1],l=t[2],d=t[3],p=t[4],y=t[5],x=t[6],T=t[7],M=t[8],A=t[9],z=t[10],I=t[11],R=t[12],N=t[13],V=t[14],$=t[15],rt=i*y-o*p,K=i*x-l*p,tt=i*T-d*p,vt=o*x-l*y,xt=o*T-d*y,Lt=l*T-d*x,Jt=M*N-A*R,qt=M*V-z*R,ee=M*$-I*R,fe=A*V-z*N,oe=A*$-I*N,le=z*$-I*V,Zt=rt*le-K*oe+tt*fe+vt*ee-xt*qt+Lt*Jt;return Zt?(a[0]=(y*le-x*oe+T*fe)*(Zt=1/Zt),a[1]=(l*oe-o*le-d*fe)*Zt,a[2]=(N*Lt-V*xt+$*vt)*Zt,a[3]=(z*xt-A*Lt-I*vt)*Zt,a[4]=(x*ee-p*le-T*qt)*Zt,a[5]=(i*le-l*ee+d*qt)*Zt,a[6]=(V*tt-R*Lt-$*K)*Zt,a[7]=(M*Lt-z*tt+I*K)*Zt,a[8]=(p*oe-y*ee+T*Jt)*Zt,a[9]=(o*ee-i*oe-d*Jt)*Zt,a[10]=(R*xt-N*tt+$*rt)*Zt,a[11]=(A*tt-M*xt-I*rt)*Zt,a[12]=(y*qt-p*fe-x*Jt)*Zt,a[13]=(i*fe-o*qt+l*Jt)*Zt,a[14]=(N*K-R*vt-V*rt)*Zt,a[15]=(M*vt-A*K+z*rt)*Zt,a):null},P.aB=de,P.aC=function(a){var t=a[0],i=a[1];return Math.sqrt(t*t+i*i)},P.aD=function(a){return a[0]=0,a[1]=0,a},P.aE=function(a,t,i){return a[0]=t[0]*i,a[1]=t[1]*i,a},P.aF=tu,P.aG=On,P.aH=function(a,t,i,o){const l=t.y-a.y,d=t.x-a.x,p=o.y-i.y,y=o.x-i.x,x=p*d-y*l;if(x===0)return null;const T=(y*(a.y-i.y)-p*(a.x-i.x))/x;return new et(a.x+T*d,a.y+T*l)},P.aI=yl,P.aJ=Hh,P.aK=function(a){let t=1/0,i=1/0,o=-1/0,l=-1/0;for(const d of a)t=Math.min(t,d.x),i=Math.min(i,d.y),o=Math.max(o,d.x),l=Math.max(l,d.y);return[t,i,o,l]},P.aL=Qn,P.aM=si,P.aN=function(a,t,i,o,l=!1){if(!i[0]&&!i[1])return[0,0];const d=l?o==="map"?-a.bearingInRadians:0:o==="viewport"?a.bearingInRadians:0;if(d){const p=Math.sin(d),y=Math.cos(d);i=[i[0]*y-i[1]*p,i[0]*p+i[1]*y]}return[l?i[0]:si(t,i[0],a.zoom),l?i[1]:si(t,i[1],a.zoom)]},P.aP=cd,P.aQ=Ft,P.aR=gf,P.aS=Ve,P.aT=zi,P.aU=qc,P.aV=it,P.aW=Fe,P.aX=re,P.aY=bn,P.aZ=pd,P.a_=Ai,P.aa=md,P.ab=Cr,P.ac=25,P.ad=vp,P.ae=a=>{const t=window.document.createElement("video");return t.muted=!0,new Promise((i=>{t.onloadstart=()=>{i(t)};for(const o of a){const l=window.document.createElement("source");F(o)||(t.crossOrigin="Anonymous"),l.src=o,t.appendChild(l)}}))},P.af=ne,P.ag=function(){return mi++},P.ah=v,P.ai=eu,P.aj=Xa,P.ak=Na,P.al=bp,P.am=function(a){const t={};if(a.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((i,o,l,d)=>{const p=l||d;return t[o]=!p||p.toLowerCase(),""})),t["max-age"]){const i=parseInt(t["max-age"],10);isNaN(i)?delete t["max-age"]:t["max-age"]=i}return t},P.an=Ie,P.ao=85.051129,P.ap=qi,P.aq=function(a){return Math.pow(2,a)},P.ar=ue,P.as=_p,P.at=function(a){return Math.log(a)/Math.LN2},P.au=function(a){var t=a[0],i=a[1];return t*t+i*i},P.av=class{constructor(a,t){this.max=a,this.onRemove=t,this.reset()}reset(){for(const a in this.data)for(const t of this.data[a])t.timeout&&clearTimeout(t.timeout),this.onRemove(t.value);return this.data={},this.order=[],this}add(a,t,i){const o=a.wrapped().key;this.data[o]===void 0&&(this.data[o]=[]);const l={value:t,timeout:void 0};if(i!==void 0&&(l.timeout=setTimeout((()=>{this.remove(a,l)}),i)),this.data[o].push(l),this.order.push(o),this.order.length>this.max){const d=this._getAndRemoveByKey(this.order[0]);d&&this.onRemove(d)}return this}has(a){return a.wrapped().key in this.data}getAndRemove(a){return this.has(a)?this._getAndRemoveByKey(a.wrapped().key):null}_getAndRemoveByKey(a){const t=this.data[a].shift();return t.timeout&&clearTimeout(t.timeout),this.data[a].length===0&&delete this.data[a],this.order.splice(this.order.indexOf(a),1),t.value}getByKey(a){const t=this.data[a];return t?t[0].value:null}get(a){return this.has(a)?this.data[a.wrapped().key][0].value:null}remove(a,t){if(!this.has(a))return this;const i=a.wrapped().key,o=t===void 0?0:this.data[i].indexOf(t),l=this.data[i][o];return this.data[i].splice(o,1),l.timeout&&clearTimeout(l.timeout),this.data[i].length===0&&delete this.data[i],this.onRemove(l.value),this.order.splice(this.order.indexOf(i),1),this}setMaxSize(a){for(this.max=a;this.order.length>this.max;){const t=this._getAndRemoveByKey(this.order[0]);t&&this.onRemove(t)}return this}filter(a){const t=[];for(const i in this.data)for(const o of this.data[i])a(o.value)||t.push(o);for(const i of t)this.remove(i.value.tileID,i)}},P.aw=function(a){if(!a.length)return new Set;const t=Math.max(...a.map((x=>x.canonical.z)));let i=1/0,o=-1/0,l=1/0,d=-1/0;const p=[];for(const x of a){const{x:T,y:M,z:A}=x.canonical,z=Math.pow(2,t-A),I=T*z,R=M*z;p.push({id:x,x:I,y:R}),I<i&&(i=I),I>o&&(o=I),R<l&&(l=R),R>d&&(d=R)}const y=new Set;for(const x of p)x.x!==i&&x.x!==o&&x.y!==l&&x.y!==d||y.add(x.id);return y},P.ax=function(a,t){let i=0,o=0;if(a.kind==="constant")o=a.layoutSize;else if(a.kind!=="source"){const{interpolationType:l,minZoom:d,maxZoom:p}=a,y=l?Ie(ra.interpolationFactor(l,t,d,p),0,1):0;a.kind==="camera"?o=Rr.number(a.minSize,a.maxSize,y):i=y}return{uSizeT:i,uSize:o}},P.az=function(a,{uSize:t,uSizeT:i},{lowerSize:o,upperSize:l}){return a.kind==="source"?o/Sr:a.kind==="composite"?Rr.number(o/Sr,l/Sr,i):t},P.b=Cn,P.b$=class extends or{constructor(a,t){super(a,t),this.current=sl}set(a){if(a[12]!==this.current[12]||a[0]!==this.current[0])return this.current=a,void this.gl.uniformMatrix4fv(this.location,!1,a);for(let t=1;t<16;t++)if(a[t]!==this.current[t]){this.current=a,this.gl.uniformMatrix4fv(this.location,!1,a);break}}},P.b0=function(a){var t=new At(3);return t[0]=a[0],t[1]=a[1],t[2]=a[2],t},P.b1=function(a,t,i){return a[0]=t[0]-i[0],a[1]=t[1]-i[1],a[2]=t[2]-i[2],a},P.b2=function(a,t){var i=t[0],o=t[1],l=t[2],d=i*i+o*o+l*l;return d>0&&(d=1/Math.sqrt(d)),a[0]=t[0]*d,a[1]=t[1]*d,a[2]=t[2]*d,a},P.b3=sn,P.b4=function(a,t){return a[0]*t[0]+a[1]*t[1]+a[2]*t[2]},P.b5=function(a,t,i){return a[0]=t[0]*i[0],a[1]=t[1]*i[1],a[2]=t[2]*i[2],a[3]=t[3]*i[3],a},P.b6=pe,P.b7=function(a,t,i){const o=t[0]*i[0]+t[1]*i[1]+t[2]*i[2];return o===0?null:(-(a[0]*i[0]+a[1]*i[1]+a[2]*i[2])-i[3])/o},P.b8=va,P.b9=function(a,t,i){return a[0]=t[0]*i,a[1]=t[1]*i,a[2]=t[2]*i,a[3]=t[3]*i,a},P.bA=$t,P.bB=function(a,t,i){var o=i[0],l=i[1],d=i[2],p=i[3],y=t[0],x=t[1],T=t[2],M=l*T-d*x,A=d*y-o*T,z=o*x-l*y;return a[0]=y+p*(M+=M)+l*(z+=z)-d*(A+=A),a[1]=x+p*A+d*M-o*z,a[2]=T+p*z+o*A-l*M,a},P.bC=function(a,t,i){const o=(l=[a[0],a[1],a[2],t[0],t[1],t[2],i[0],i[1],i[2]])[0]*((M=l[8])*(p=l[4])-(y=l[5])*(T=l[7]))+l[1]*(-M*(d=l[3])+y*(x=l[6]))+l[2]*(T*d-p*x);var l,d,p,y,x,T,M;if(o===0)return null;const A=sn([],[t[0],t[1],t[2]],[i[0],i[1],i[2]]),z=sn([],[i[0],i[1],i[2]],[a[0],a[1],a[2]]),I=sn([],[a[0],a[1],a[2]],[t[0],t[1],t[2]]),R=Ai([],A,-a[3]);return $e(R,R,Ai([],z,-t[3])),$e(R,R,Ai([],I,-i[3])),Ai(R,R,1/o),R},P.bD=gp,P.bE=function(){return new Float64Array(4)},P.bF=function(a,t,i,o){var l=[],d=[];return l[0]=t[0]-i[0],l[1]=t[1]-i[1],l[2]=t[2]-i[2],d[0]=l[0]*Math.cos(o)-l[1]*Math.sin(o),d[1]=l[0]*Math.sin(o)+l[1]*Math.cos(o),d[2]=l[2],a[0]=d[0]+i[0],a[1]=d[1]+i[1],a[2]=d[2]+i[2],a},P.bG=function(a,t,i,o){var l=[],d=[];return l[0]=t[0]-i[0],l[1]=t[1]-i[1],l[2]=t[2]-i[2],d[0]=l[0],d[1]=l[1]*Math.cos(o)-l[2]*Math.sin(o),d[2]=l[1]*Math.sin(o)+l[2]*Math.cos(o),a[0]=d[0]+i[0],a[1]=d[1]+i[1],a[2]=d[2]+i[2],a},P.bH=function(a,t,i,o){var l=[],d=[];return l[0]=t[0]-i[0],l[1]=t[1]-i[1],l[2]=t[2]-i[2],d[0]=l[2]*Math.sin(o)+l[0]*Math.cos(o),d[1]=l[1],d[2]=l[2]*Math.cos(o)-l[0]*Math.sin(o),a[0]=d[0]+i[0],a[1]=d[1]+i[1],a[2]=d[2]+i[2],a},P.bI=function(a,t,i){var o=Math.sin(i),l=Math.cos(i),d=t[0],p=t[1],y=t[2],x=t[3],T=t[8],M=t[9],A=t[10],z=t[11];return t!==a&&(a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7],a[12]=t[12],a[13]=t[13],a[14]=t[14],a[15]=t[15]),a[0]=d*l-T*o,a[1]=p*l-M*o,a[2]=y*l-A*o,a[3]=x*l-z*o,a[8]=d*o+T*l,a[9]=p*o+M*l,a[10]=y*o+A*l,a[11]=x*o+z*l,a},P.bJ=function(a,t){const i=bt(a,360),o=bt(t,360),l=o-i,d=o>i?l-360:l+360;return Math.abs(l)<Math.abs(d)?l:d},P.bK=function(a){return a[0]=0,a[1]=0,a[2]=0,a},P.bL=function(a,t,i,o){const l=Math.sqrt(a*a+t*t),d=Math.sqrt(i*i+o*o);a/=l,t/=l,i/=d,o/=d;const p=Math.acos(a*i+t*o);return-t*i+a*o>0?p:-p},P.bM=function(a,t){const i=bt(a,2*Math.PI),o=bt(t,2*Math.PI);return Math.min(Math.abs(i-o),Math.abs(i-o+2*Math.PI),Math.abs(i-o-2*Math.PI))},P.bN=function(){const a={},t=J.$version;for(const i in J.$root){const o=J.$root[i];if(o.required){let l=null;l=i==="version"?t:o.type==="array"?[]:{},l!=null&&(a[i]=l)}}return a},P.bO=Ji,P.bP=Bu,P.bQ=function a(t,i){if(Array.isArray(t)){if(!Array.isArray(i)||t.length!==i.length)return!1;for(let o=0;o<t.length;o++)if(!a(t[o],i[o]))return!1;return!0}if(typeof t=="object"&&t!==null&&i!==null){if(typeof i!="object"||Object.keys(t).length!==Object.keys(i).length)return!1;for(const o in t)if(!a(t[o],i[o]))return!1;return!0}return t===i},P.bR=function(a){a=a.slice();const t=Object.create(null);for(let i=0;i<a.length;i++)t[a[i].id]=a[i];for(let i=0;i<a.length;i++)"ref"in a[i]&&(a[i]=Nt(a[i],t[a[i].ref]));return a},P.bS=function(a,t){if(a.type==="custom")return new fg(a,t);switch(a.type){case"background":return new mp(a,t);case"circle":return new Gf(a,t);case"color-relief":return new ng(a,t);case"fill":return new Qu(a,t);case"fill-extrusion":return new th(a,t);case"heatmap":return new Zf(a,t);case"hillshade":return new ll(a,t);case"line":return new uf(a,t);case"raster":return new go(a,t);case"symbol":return new hd(a,t)}},P.bT=a=>a.type==="raster",P.bU=qe,P.bV=function(a,t){if(!a)return[{command:"setStyle",args:[t]}];let i=[];try{if(!jt(a.version,t.version))return[{command:"setStyle",args:[t]}];jt(a.center,t.center)||i.push({command:"setCenter",args:[t.center]}),jt(a.state,t.state)||i.push({command:"setGlobalState",args:[t.state]}),jt(a.centerAltitude,t.centerAltitude)||i.push({command:"setCenterAltitude",args:[t.centerAltitude]}),jt(a.zoom,t.zoom)||i.push({command:"setZoom",args:[t.zoom]}),jt(a.bearing,t.bearing)||i.push({command:"setBearing",args:[t.bearing]}),jt(a.pitch,t.pitch)||i.push({command:"setPitch",args:[t.pitch]}),jt(a.roll,t.roll)||i.push({command:"setRoll",args:[t.roll]}),jt(a.sprite,t.sprite)||i.push({command:"setSprite",args:[t.sprite]}),jt(a.glyphs,t.glyphs)||i.push({command:"setGlyphs",args:[t.glyphs]}),jt(a.transition,t.transition)||i.push({command:"setTransition",args:[t.transition]}),jt(a.light,t.light)||i.push({command:"setLight",args:[t.light]}),jt(a.terrain,t.terrain)||i.push({command:"setTerrain",args:[t.terrain]}),jt(a.sky,t.sky)||i.push({command:"setSky",args:[t.sky]}),jt(a.projection,t.projection)||i.push({command:"setProjection",args:[t.projection]});const o={},l=[];(function(p,y,x,T){let M;for(M in y=y||{},p=p||{})Object.prototype.hasOwnProperty.call(p,M)&&(Object.prototype.hasOwnProperty.call(y,M)||Ce(M,x,T));for(M in y)Object.prototype.hasOwnProperty.call(y,M)&&(Object.prototype.hasOwnProperty.call(p,M)?jt(p[M],y[M])||(p[M].type==="geojson"&&y[M].type==="geojson"&&pn(p,y,M)?Ut(x,{command:"setGeoJSONSourceData",args:[M,y[M].data]}):je(M,y,x,T)):ye(M,y,x))})(a.sources,t.sources,l,o);const d=[];a.layers&&a.layers.forEach((p=>{"source"in p&&o[p.source]?i.push({command:"removeLayer",args:[p.id]}):d.push(p)})),i=i.concat(l),(function(p,y,x){y=y||[];const T=(p=p||[]).map(yi),M=y.map(yi),A=p.reduce(Li,{}),z=y.reduce(Li,{}),I=T.slice(),R=Object.create(null);let N,V,$,rt,K;for(let tt=0,vt=0;tt<T.length;tt++)N=T[tt],Object.prototype.hasOwnProperty.call(z,N)?vt++:(Ut(x,{command:"removeLayer",args:[N]}),I.splice(I.indexOf(N,vt),1));for(let tt=0,vt=0;tt<M.length;tt++)N=M[M.length-1-tt],I[I.length-1-tt]!==N&&(Object.prototype.hasOwnProperty.call(A,N)?(Ut(x,{command:"removeLayer",args:[N]}),I.splice(I.lastIndexOf(N,I.length-vt),1)):vt++,rt=I[I.length-tt],Ut(x,{command:"addLayer",args:[z[N],rt]}),I.splice(I.length-tt,0,N),R[N]=!0);for(let tt=0;tt<M.length;tt++)if(N=M[tt],V=A[N],$=z[N],!R[N]&&!jt(V,$))if(jt(V.source,$.source)&&jt(V["source-layer"],$["source-layer"])&&jt(V.type,$.type)){for(K in Je(V.layout,$.layout,x,N,null,"setLayoutProperty"),Je(V.paint,$.paint,x,N,null,"setPaintProperty"),jt(V.filter,$.filter)||Ut(x,{command:"setFilter",args:[N,$.filter]}),jt(V.minzoom,$.minzoom)&&jt(V.maxzoom,$.maxzoom)||Ut(x,{command:"setLayerZoomRange",args:[N,$.minzoom,$.maxzoom]}),V)Object.prototype.hasOwnProperty.call(V,K)&&K!=="layout"&&K!=="paint"&&K!=="filter"&&K!=="metadata"&&K!=="minzoom"&&K!=="maxzoom"&&(K.indexOf("paint.")===0?Je(V[K],$[K],x,N,K.slice(6),"setPaintProperty"):jt(V[K],$[K])||Ut(x,{command:"setLayerProperty",args:[N,K,$[K]]}));for(K in $)Object.prototype.hasOwnProperty.call($,K)&&!Object.prototype.hasOwnProperty.call(V,K)&&K!=="layout"&&K!=="paint"&&K!=="filter"&&K!=="metadata"&&K!=="minzoom"&&K!=="maxzoom"&&(K.indexOf("paint.")===0?Je(V[K],$[K],x,N,K.slice(6),"setPaintProperty"):jt(V[K],$[K])||Ut(x,{command:"setLayerProperty",args:[N,K,$[K]]}))}else Ut(x,{command:"removeLayer",args:[N]}),rt=I[I.lastIndexOf(N)+1],Ut(x,{command:"addLayer",args:[$,rt]})})(d,t.layers,i)}catch(o){console.warn("Unable to compute style diff:",o),i=[{command:"setStyle",args:[t]}]}return i},P.bW=function(a){const t=[],i=a.id;return i===void 0&&t.push({message:`layers.${i}: missing required property "id"`}),a.render===void 0&&t.push({message:`layers.${i}: missing required method "render"`}),a.renderingMode&&a.renderingMode!=="2d"&&a.renderingMode!=="3d"&&t.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),t},P.bX=dn,P.bY=Qe,P.bZ=class extends or{constructor(a,t){super(a,t),this.current=0}set(a){this.current!==a&&(this.current=a,this.gl.uniform1i(this.location,a))}},P.b_=vs,P.ba=function(a,t){return a[0]*t[0]+a[1]*t[1]+a[2]*t[2]+a[3]},P.bb=zm,P.bc=iu,P.bd=function(a,t,i,o,l){var d=1/Math.tan(t/2);if(a[0]=d/i,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=d,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=-1,a[12]=0,a[13]=0,a[15]=0,l!=null&&l!==1/0){var p=1/(o-l);a[10]=(l+o)*p,a[14]=2*l*o*p}else a[10]=-1,a[14]=-2*o;return a},P.be=function(a){var t=new At(16);return t[0]=a[0],t[1]=a[1],t[2]=a[2],t[3]=a[3],t[4]=a[4],t[5]=a[5],t[6]=a[6],t[7]=a[7],t[8]=a[8],t[9]=a[9],t[10]=a[10],t[11]=a[11],t[12]=a[12],t[13]=a[13],t[14]=a[14],t[15]=a[15],t},P.bf=function(a,t,i){var o=Math.sin(i),l=Math.cos(i),d=t[0],p=t[1],y=t[2],x=t[3],T=t[4],M=t[5],A=t[6],z=t[7];return t!==a&&(a[8]=t[8],a[9]=t[9],a[10]=t[10],a[11]=t[11],a[12]=t[12],a[13]=t[13],a[14]=t[14],a[15]=t[15]),a[0]=d*l+T*o,a[1]=p*l+M*o,a[2]=y*l+A*o,a[3]=x*l+z*o,a[4]=T*l-d*o,a[5]=M*l-p*o,a[6]=A*l-y*o,a[7]=z*l-x*o,a},P.bg=function(a,t,i){var o=Math.sin(i),l=Math.cos(i),d=t[4],p=t[5],y=t[6],x=t[7],T=t[8],M=t[9],A=t[10],z=t[11];return t!==a&&(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[12]=t[12],a[13]=t[13],a[14]=t[14],a[15]=t[15]),a[4]=d*l+T*o,a[5]=p*l+M*o,a[6]=y*l+A*o,a[7]=x*l+z*o,a[8]=T*l-d*o,a[9]=M*l-p*o,a[10]=A*l-y*o,a[11]=z*l-x*o,a},P.bh=function(){const a=new Float32Array(16);return ue(a),a},P.bi=function(){const a=new Float64Array(16);return ue(a),a},P.bj=function(){return new Float64Array(16)},P.bk=function(a,t,i){const o=new Float64Array(4);return $t(o,a,t-90,i),o},P.bl=function(a,t,i,o){var l,d,p,y,x,T=t[0],M=t[1],A=t[2],z=t[3],I=i[0],R=i[1],N=i[2],V=i[3];return(d=T*I+M*R+A*N+z*V)<0&&(d=-d,I=-I,R=-R,N=-N,V=-V),1-d>Pt?(l=Math.acos(d),p=Math.sin(l),y=Math.sin((1-o)*l)/p,x=Math.sin(o*l)/p):(y=1-o,x=o),a[0]=y*T+x*I,a[1]=y*M+x*R,a[2]=y*A+x*N,a[3]=y*z+x*V,a},P.bm=function(a){const t=new Float64Array(9);var i,o,l,d,p,y,x,T,M,A,z,I,R,N,V,$,rt,K;A=(l=(o=a)[0])*(x=l+l),z=(d=o[1])*x,R=(p=o[2])*x,N=p*(T=d+d),$=(y=o[3])*x,rt=y*T,K=y*(M=p+p),(i=t)[0]=1-(I=d*T)-(V=p*M),i[3]=z-K,i[6]=R+rt,i[1]=z+K,i[4]=1-A-V,i[7]=N-$,i[2]=R-rt,i[5]=N+$,i[8]=1-A-I;const tt=bn(-Math.asin(Ie(t[2],-1,1)));let vt,xt;return Math.hypot(t[5],t[8])<.001?(vt=0,xt=-bn(Math.atan2(t[3],t[4]))):(vt=bn(t[5]===0&&t[8]===0?0:Math.atan2(t[5],t[8])),xt=bn(t[1]===0&&t[0]===0?0:Math.atan2(t[1],t[0]))),{roll:vt,pitch:tt+90,bearing:xt}},P.bn=function(a,t){return a.roll==t.roll&&a.pitch==t.pitch&&a.bearing==t.bearing},P.bo=ii,P.bp=Vr,P.bq=ga,P.br=lr,P.bs=Ku,P.bt=Ht,P.bu=_e,P.bv=aa,P.bw=function(a,t,i,o,l){return Ht(o,l,Ie((a-t)/(i-t),0,1))},P.bx=bt,P.by=function(){return new Float64Array(3)},P.bz=function(a,t,i,o){return a[0]=t[0]+i[0]*o,a[1]=t[1]+i[1]*o,a[2]=t[2]+i[2]*o,a},P.c=El,P.c$=class{constructor(a){this._marks={start:[a.url,"start"].join("#"),end:[a.url,"end"].join("#"),measure:a.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let a=performance.getEntriesByName(this._marks.measure);return a.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),a=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),a}},P.c0=Ka,P.c1=class extends or{constructor(a,t){super(a,t),this.current=[0,0,0]}set(a){a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]||(this.current=a,this.gl.uniform3f(this.location,a[0],a[1],a[2]))}},P.c2=class extends or{constructor(a,t){super(a,t),this.current=[0,0]}set(a){a[0]===this.current[0]&&a[1]===this.current[1]||(this.current=a,this.gl.uniform2f(this.location,a[0],a[1]))}},P.c3=ce,P.c4=function(a,t){var i=Math.sin(t),o=Math.cos(t);return a[0]=o,a[1]=i,a[2]=0,a[3]=-i,a[4]=o,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},P.c5=function(a,t,i){var o=t[0],l=t[1],d=t[2];return a[0]=o*i[0]+l*i[3]+d*i[6],a[1]=o*i[1]+l*i[4]+d*i[7],a[2]=o*i[2]+l*i[5]+d*i[8],a},P.c6=function(a,t,i,o,l,d,p){var y=1/(t-i),x=1/(o-l),T=1/(d-p);return a[0]=-2*y,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*x,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2*T,a[11]=0,a[12]=(t+i)*y,a[13]=(l+o)*x,a[14]=(p+d)*T,a[15]=1,a},P.c7=class extends or{constructor(a,t){super(a,t),this.current=new Array}set(a){if(a!=this.current){this.current=a;const t=new Float32Array(4*a.length);for(let i=0;i<a.length;i++)t[4*i]=a[i].r,t[4*i+1]=a[i].g,t[4*i+2]=a[i].b,t[4*i+3]=a[i].a;this.gl.uniform4fv(this.location,t)}}},P.c8=class extends or{constructor(a,t){super(a,t),this.current=new Array}set(a){if(a!=this.current){this.current=a;const t=new Float32Array(a);this.gl.uniform1fv(this.location,t)}}},P.c9=class extends Fc{},P.cA=function(a){return Io[a]||Sl[a]},P.cB=function(a,t,i){var o=t[0],l=t[1];return a[0]=i[0]*o+i[4]*l+i[12],a[1]=i[1]*o+i[5]*l+i[13],a},P.cC=function(a,t){const{x:i,y:o}=md.fromLngLat(t);return!(a<0||a>25||o<0||o>=1||i<0||i>=1)},P.cD=function(a,t){return a[0]=t[0],a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=t[1],a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=t[2],a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},P.cE=class extends ln{},P.cF=uc,P.cH=function(a){return a.message===Wr},P.cI=za,P.cJ=function(a,t){Ts.REGISTERED_PROTOCOLS[a]=t},P.cK=function(a){delete Ts.REGISTERED_PROTOCOLS[a]},P.cL=function(a,t){const i={};for(let l=0;l<a.length;l++){const d=t&&t[a[l].id]||hi(a[l]);t&&(t[a[l].id]=d);let p=i[d];p||(p=i[d]=[]),p.push(a[l])}const o=[];for(const l in i)o.push(i[l]);return o},P.cM=ge,P.cN=Pm,P.cO=_l,P.cP=up,P.cQ=function(a){a.bucket.createArrays(),a.bucket.tilePixelRatio=Re/(512*a.bucket.overscaling),a.bucket.compareText={},a.bucket.iconsNeedLinear=!1;const t=a.bucket.layers[0],i=t.layout,o=t._unevaluatedLayout._values,l={layoutIconSize:o["icon-size"].possiblyEvaluate(new Mi(a.bucket.zoom+1),a.canonical),layoutTextSize:o["text-size"].possiblyEvaluate(new Mi(a.bucket.zoom+1),a.canonical),textMaxSize:o["text-size"].possiblyEvaluate(new Mi(18))};if(a.bucket.textSizeData.kind==="composite"){const{minZoom:T,maxZoom:M}=a.bucket.textSizeData;l.compositeTextSizes=[o["text-size"].possiblyEvaluate(new Mi(T),a.canonical),o["text-size"].possiblyEvaluate(new Mi(M),a.canonical)]}if(a.bucket.iconSizeData.kind==="composite"){const{minZoom:T,maxZoom:M}=a.bucket.iconSizeData;l.compositeIconSizes=[o["icon-size"].possiblyEvaluate(new Mi(T),a.canonical),o["icon-size"].possiblyEvaluate(new Mi(M),a.canonical)]}const d=i.get("text-line-height")*Qn,p=i.get("text-rotation-alignment")!=="viewport"&&i.get("symbol-placement")!=="point",y=i.get("text-keep-upright"),x=i.get("text-size");for(const T of a.bucket.features){const M=i.get("text-font").evaluate(T,{},a.canonical).join(","),A=x.evaluate(T,{},a.canonical),z=l.layoutTextSize.evaluate(T,{},a.canonical),I=l.layoutIconSize.evaluate(T,{},a.canonical),R={horizontal:{},vertical:void 0},N=T.text;let V,$=[0,0];if(N){const tt=N.toString(),vt=i.get("text-letter-spacing").evaluate(T,{},a.canonical)*Qn,xt=Bs(tt)?vt:0,Lt=i.get("text-anchor").evaluate(T,{},a.canonical),Jt=_t(t,T,a.canonical);if(!Jt){const oe=i.get("text-radial-offset").evaluate(T,{},a.canonical);$=oe?X(Lt,[oe*Qn,O]):i.get("text-offset").evaluate(T,{},a.canonical).map((le=>le*Qn))}let qt=p?"center":i.get("text-justify").evaluate(T,{},a.canonical);const ee=i.get("symbol-placement")==="point"?i.get("text-max-width").evaluate(T,{},a.canonical)*Qn:1/0,fe=()=>{a.bucket.allowVerticalPlacement&&Vl(tt)&&(R.vertical=Jc(N,a.glyphMap,a.glyphPositions,a.imagePositions,M,ee,d,Lt,"left",xt,$,P.ay.vertical,!0,z,A))};if(!p&&Jt){const oe=new Set;if(qt==="auto")for(let Zt=0;Zt<Jt.values.length;Zt+=2)oe.add(Ft(Jt.values[Zt]));else oe.add(qt);let le=!1;for(const Zt of oe)if(!R.horizontal[Zt])if(le)R.horizontal[Zt]=R.horizontal[0];else{const ze=Jc(N,a.glyphMap,a.glyphPositions,a.imagePositions,M,ee,d,"center",Zt,xt,$,P.ay.horizontal,!1,z,A);ze&&(R.horizontal[Zt]=ze,le=ze.positionedLines.length===1)}fe()}else{qt==="auto"&&(qt=Ft(Lt));const oe=Jc(N,a.glyphMap,a.glyphPositions,a.imagePositions,M,ee,d,Lt,qt,xt,$,P.ay.horizontal,!1,z,A);oe&&(R.horizontal[qt]=oe),fe(),Vl(tt)&&p&&y&&(R.vertical=Jc(N,a.glyphMap,a.glyphPositions,a.imagePositions,M,ee,d,Lt,qt,xt,$,P.ay.vertical,!1,z,A))}}let rt=!1;if(T.icon&&T.icon.name){const tt=a.imageMap[T.icon.name];tt&&(V=hg(a.imagePositions[T.icon.name],i.get("icon-offset").evaluate(T,{},a.canonical),i.get("icon-anchor").evaluate(T,{},a.canonical)),rt=!!tt.sdf,a.bucket.sdfIcons===void 0?a.bucket.sdfIcons=rt:a.bucket.sdfIcons!==rt&&oi("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(tt.pixelRatio!==a.bucket.pixelRatio||i.get("icon-rotate").constantOr(1)!==0)&&(a.bucket.iconsNeedLinear=!0))}const K=Vt(R.horizontal)||R.vertical;a.bucket.iconsInText=!!K&&K.iconsInText,(K||V)&&Wt(a.bucket,T,R,V,a.imageMap,l,z,I,$,rt,a.canonical,a.subdivisionGranularity)}a.showCollisionBoxes&&a.bucket.generateCollisionDebugBuffers()},P.cR=id,P.cS=Yi,P.cT=Yc,P.cU=Qf,P.cV=df,P.cW=Zc,P.cX=function(a,t,i,o,l,d){let p=Vm(a,t,i,l,0);return p=Vm(p,t,o,d,1),p},P.cY=class{constructor(a){this.maxEntries=a,this.map=new Map}get(a){const t=this.map.get(a);return t!==void 0&&(this.map.delete(a),this.map.set(a,t)),t}set(a,t){if(this.map.has(a))this.map.delete(a);else if(this.map.size>=this.maxEntries){const i=this.map.keys().next().value;this.map.delete(i)}this.map.set(a,t)}clear(){this.map.clear()}},P.cZ=Jf,P.c_=Df,P.ca=ip,P.cb=class extends Zl{},P.cc=Xs,P.cd=function(a){return a<=1?1:Math.pow(2,Math.ceil(Math.log(a)/Math.LN2))},P.ce=qf,P.cf=function(a,t,i){var o=t[0],l=t[1],d=t[2],p=i[3]*o+i[7]*l+i[11]*d+i[15];return a[0]=(i[0]*o+i[4]*l+i[8]*d+i[12])/(p=p||1),a[1]=(i[1]*o+i[5]*l+i[9]*d+i[13])/p,a[2]=(i[2]*o+i[6]*l+i[10]*d+i[14])/p,a},P.cg=class extends ql{},P.ch=class extends c{},P.ci=function(a,t){return a[0]===t[0]&&a[1]===t[1]&&a[2]===t[2]&&a[3]===t[3]&&a[4]===t[4]&&a[5]===t[5]&&a[6]===t[6]&&a[7]===t[7]&&a[8]===t[8]&&a[9]===t[9]&&a[10]===t[10]&&a[11]===t[11]&&a[12]===t[12]&&a[13]===t[13]&&a[14]===t[14]&&a[15]===t[15]},P.cj=function(a,t){var i=a[0],o=a[1],l=a[2],d=a[3],p=a[4],y=a[5],x=a[6],T=a[7],M=a[8],A=a[9],z=a[10],I=a[11],R=a[12],N=a[13],V=a[14],$=a[15],rt=t[0],K=t[1],tt=t[2],vt=t[3],xt=t[4],Lt=t[5],Jt=t[6],qt=t[7],ee=t[8],fe=t[9],oe=t[10],le=t[11],Zt=t[12],ze=t[13],Pe=t[14],ke=t[15];return Math.abs(i-rt)<=Pt*Math.max(1,Math.abs(i),Math.abs(rt))&&Math.abs(o-K)<=Pt*Math.max(1,Math.abs(o),Math.abs(K))&&Math.abs(l-tt)<=Pt*Math.max(1,Math.abs(l),Math.abs(tt))&&Math.abs(d-vt)<=Pt*Math.max(1,Math.abs(d),Math.abs(vt))&&Math.abs(p-xt)<=Pt*Math.max(1,Math.abs(p),Math.abs(xt))&&Math.abs(y-Lt)<=Pt*Math.max(1,Math.abs(y),Math.abs(Lt))&&Math.abs(x-Jt)<=Pt*Math.max(1,Math.abs(x),Math.abs(Jt))&&Math.abs(T-qt)<=Pt*Math.max(1,Math.abs(T),Math.abs(qt))&&Math.abs(M-ee)<=Pt*Math.max(1,Math.abs(M),Math.abs(ee))&&Math.abs(A-fe)<=Pt*Math.max(1,Math.abs(A),Math.abs(fe))&&Math.abs(z-oe)<=Pt*Math.max(1,Math.abs(z),Math.abs(oe))&&Math.abs(I-le)<=Pt*Math.max(1,Math.abs(I),Math.abs(le))&&Math.abs(R-Zt)<=Pt*Math.max(1,Math.abs(R),Math.abs(Zt))&&Math.abs(N-ze)<=Pt*Math.max(1,Math.abs(N),Math.abs(ze))&&Math.abs(V-Pe)<=Pt*Math.max(1,Math.abs(V),Math.abs(Pe))&&Math.abs($-ke)<=Pt*Math.max(1,Math.abs($),Math.abs(ke))},P.ck=function(a,t){return a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7],a[8]=t[8],a[9]=t[9],a[10]=t[10],a[11]=t[11],a[12]=t[12],a[13]=t[13],a[14]=t[14],a[15]=t[15],a},P.cl=a=>a.type==="symbol",P.cm=a=>a.type==="circle",P.cn=a=>a.type==="heatmap",P.co=a=>a.type==="line",P.cp=a=>a.type==="fill",P.cq=a=>a.type==="fill-extrusion",P.cr=a=>a.type==="hillshade",P.cs=a=>a.type==="color-relief",P.ct=a=>a.type==="background",P.cu=a=>a.type==="custom",P.cv=Te,P.cw=function(a,t,i){const o=Ne(t.x-i.x,t.y-i.y),l=Ne(a.x-i.x,a.y-i.y);var d,p;return bn(Math.atan2(o[0]*l[1]-o[1]*l[0],(d=o)[0]*(p=l)[0]+d[1]*p[1]))},P.cx=be,P.cy=function(a,t){return Sl[t]&&(a instanceof MouseEvent||a instanceof WheelEvent)},P.cz=function(a,t){return Io[t]&&"touches"in a},P.d=F,P.d0=function(a,t,i,o,l){return h(this,void 0,void 0,(function*(){if(Yt())try{return yield ca(a,t,i,o,l)}catch{}return(function(d,p,y,x,T){const M=d.width,A=d.height;Qi&&fn||(Qi=new OffscreenCanvas(M,A),fn=Qi.getContext("2d",{willReadFrequently:!0})),Qi.width=M,Qi.height=A,fn.drawImage(d,0,0,M,A);const z=fn.getImageData(p,y,x,T);return fn.clearRect(0,0,M,A),z.data})(a,t,i,o,l)}))},P.d1=Xu,P.d2=ft,P.d3=Bl,P.d4=gs,P.e=Ke,P.f=a=>h(void 0,void 0,void 0,(function*(){if(a.byteLength===0)return createImageBitmap(new ImageData(1,1));const t=new Blob([new Uint8Array(a)],{type:"image/png"});try{return createImageBitmap(t)}catch(i){throw new Error(`Could not load image because of ${i.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}})),P.g=Ml,P.h=a=>new Promise(((t,i)=>{const o=new Image;o.onload=()=>{t(o),URL.revokeObjectURL(o.src),o.onload=null,window.requestAnimationFrame((()=>{o.src=An}))},o.onerror=()=>i(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const l=new Blob([new Uint8Array(a)],{type:"image/png"});o.src=a.byteLength?URL.createObjectURL(l):An})),P.i=xn,P.j=(a,t)=>pt(Ke(a,{type:"json"}),t),P.k=ut,P.l=ot,P.m=pt,P.n=(a,t)=>pt(Ke(a,{type:"arrayBuffer"}),t),P.o=function(a){return new df(a).readFields(pf,[])},P.p=cp,P.q=function(a){return/[\u02EA\u02EB\u1100-\u11FF\u2E80-\u2FDF\u3000-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u4DBF\u4E00-\uA48C\uA490-\uA4C6\uA960-\uA97C\uAC00-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE4F\uFF00-\uFFEF]|\uD81B[\uDFE0-\uDFFF]|[\uD81C-\uD822\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFFF]|\uD82C[\uDC00-\uDEFB]|\uD83C[\uDE00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(a))},P.r=Hu,P.s=xa,P.t=$i,P.u=J,P.v=fs,P.w=oi,P.x=Fu,P.y=jf,P.z=xr})),lt("worker",["./shared"],(function(P){class h{constructor(F,G){this.keyCache={},F&&this.replace(F,G)}replace(F,G){this._layerConfigs={},this._layers={},this.update(F,[],G)}update(F,G,H){for(const ut of F){this._layerConfigs[ut.id]=ut;const Et=this._layers[ut.id]=P.bS(ut,H);Et._featureFilter=P.aj(Et.filter,H),this.keyCache[ut.id]&&delete this.keyCache[ut.id]}for(const ut of G)delete this.keyCache[ut],delete this._layerConfigs[ut],delete this._layers[ut];this.familiesBySource={};const ot=P.cL(Object.values(this._layerConfigs),this.keyCache);for(const ut of ot){const Et=ut.map((ye=>this._layers[ye.id])),J=Et[0];if(J.visibility==="none")continue;const wt=J.source||"";let Nt=this.familiesBySource[wt];Nt||(Nt=this.familiesBySource[wt]={});const jt=J.sourceLayer||P.a9;let Ut=Nt[jt];Ut||(Ut=Nt[jt]=[]),Ut.push(Et)}}}class et{constructor(F){const G={},H=[];for(const J in F){const wt=F[J],Nt=G[J]={};for(const jt in wt){const Ut=wt[+jt];if(!Ut||Ut.bitmap.width===0||Ut.bitmap.height===0)continue;const ye={x:0,y:0,w:Ut.bitmap.width+2,h:Ut.bitmap.height+2};H.push(ye),Nt[jt]={rect:ye,metrics:Ut.metrics}}}const{w:ot,h:ut}=P.p(H),Et=new P.r({width:ot||1,height:ut||1});for(const J in F){const wt=F[J];for(const Nt in wt){const jt=wt[+Nt];if(!jt||jt.bitmap.width===0||jt.bitmap.height===0)continue;const Ut=G[J][Nt].rect;P.r.copy(jt.bitmap,Et,{x:0,y:0},{x:Ut.x+1,y:Ut.y+1},jt.bitmap)}}this.image=Et,this.positions=G}}P.cM("GlyphAtlas",et);class ft{constructor(F){this.tileID=new P.a1(F.tileID.overscaledZ,F.tileID.wrap,F.tileID.canonical.z,F.tileID.canonical.x,F.tileID.canonical.y),this.uid=F.uid,this.zoom=F.zoom,this.pixelRatio=F.pixelRatio,this.tileSize=F.tileSize,this.source=F.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=F.showCollisionBoxes,this.collectResourceTiming=!!F.collectResourceTiming,this.returnDependencies=!!F.returnDependencies,this.promoteId=F.promoteId,this.inFlightDependencies=[]}parse(F,G,H,ot,ut){return P._(this,void 0,void 0,(function*(){this.status="parsing",this.data=F,this.collisionBoxArray=new P.ah;const Et=new P.cN(Object.keys(F.layers).sort()),J=new P.cO(this.tileID,this.promoteId);J.bucketLayerIDs=[];const wt={},Nt={featureIndex:J,iconDependencies:{},patternDependencies:{},glyphDependencies:{},dashDependencies:{},availableImages:H,subdivisionGranularity:ut},jt=G.familiesBySource[this.source];for(const me in jt){const Ae=F.layers[me];if(!Ae)continue;Ae.version===1&&P.w(`Vector tile source "${this.source}" layer "${me}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const ba=Et.encode(me),Lo=[];for(let na=0;na<Ae.length;na++){const Be=Ae.feature(na),ir=J.getId(Be,me);Lo.push({feature:Be,id:ir,index:na,sourceLayerIndex:ba})}for(const na of jt[me]){const Be=na[0];Be.source!==this.source&&P.w(`layer.source = ${Be.source} does not equal this.source = ${this.source}`),Be.isHidden(this.zoom,!0)||(Bt(na,this.zoom,H),(wt[Be.id]=Be.createBucket({index:J.bucketLayerIDs.length,layers:na,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:ba,sourceID:this.source})).populate(Lo,Nt,this.tileID.canonical),J.bucketLayerIDs.push(na.map((ir=>ir.id))))}}const Ut=P.bX(Nt.glyphDependencies,(me=>Object.keys(me).map(Number)));this.inFlightDependencies.forEach((me=>me?.abort())),this.inFlightDependencies=[];let ye=Promise.resolve({});if(Object.keys(Ut).length){const me=new AbortController;this.inFlightDependencies.push(me),ye=ot.sendAsync({type:"GG",data:{stacks:Ut,source:this.source,tileID:this.tileID,type:"glyphs"}},me)}const Ce=Object.keys(Nt.iconDependencies);let je=Promise.resolve({});if(Ce.length){const me=new AbortController;this.inFlightDependencies.push(me),je=ot.sendAsync({type:"GI",data:{icons:Ce,source:this.source,tileID:this.tileID,type:"icons"}},me)}const pn=Object.keys(Nt.patternDependencies);let Je=Promise.resolve({});if(pn.length){const me=new AbortController;this.inFlightDependencies.push(me),Je=ot.sendAsync({type:"GI",data:{icons:pn,source:this.source,tileID:this.tileID,type:"patterns"}},me)}const yi=Nt.dashDependencies;let Li=Promise.resolve({});if(Object.keys(yi).length){const me=new AbortController;this.inFlightDependencies.push(me),Li=ot.sendAsync({type:"GDA",data:{dashes:yi}},me)}const[ne,ki,Oi,Dn]=yield Promise.all([ye,je,Je,Li]),vi=new et(ne),Qt=new P.cP(ki,Oi);for(const me in wt){const Ae=wt[me];Ae instanceof P.ai?(Bt(Ae.layers,this.zoom,H),P.cQ({bucket:Ae,glyphMap:ne,glyphPositions:vi.positions,imageMap:ki,imagePositions:Qt.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:Nt.subdivisionGranularity})):Ae.hasDependencies&&(Ae instanceof P.cR||Ae instanceof P.cS||Ae instanceof P.cT)&&(Bt(Ae.layers,this.zoom,H),Ae.addFeatures(Nt,this.tileID.canonical,Qt.patternPositions,Dn))}return this.status="done",{buckets:Object.values(wt).filter((me=>!me.isEmpty())),featureIndex:J,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:vi.image,imageAtlas:Qt,dashPositions:Dn,glyphMap:this.returnDependencies?ne:null,iconMap:this.returnDependencies?ki:null,glyphPositions:this.returnDependencies?vi.positions:null}}))}}function Bt(pt,F,G){const H=new P.H(F);for(const ot of pt)ot.recalculate(H,G)}class Dt extends P.cW{constructor(F,G){super(new P.cV,0,G,[],[]),this.feature=F,this.type=F.type,this.properties=F.tags?F.tags:{},"id"in F&&(typeof F.id=="string"?this.id=parseInt(F.id,10):typeof F.id!="number"||isNaN(F.id)||(this.id=F.id))}loadGeometry(){const F=[],G=this.feature.type===1?[this.feature.geometry]:this.feature.geometry;for(const H of G){const ot=[];for(const ut of H)ot.push(new P.P(ut[0],ut[1]));F.push(ot)}return F}}class se extends P.cU{constructor(F,G){super(new P.cV),this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.version=G?G.version:1,this.extent=G?G.extent:4096,this.length=F.length,this.features=F}feature(F){return new Dt(this.features[F],this.extent)}}function he(pt,F){F.writeVarintField(15,pt.version||1),F.writeStringField(1,pt.name||""),F.writeVarintField(5,pt.extent||4096);const G={keys:[],values:[],keycache:{},valuecache:{}};for(let ut=0;ut<pt.length;ut++)G.feature=pt.feature(ut),F.writeMessage(2,xe,G);const H=G.keys;for(const ut of H)F.writeStringField(3,ut);const ot=G.values;for(const ut of ot)F.writeMessage(4,At,ut)}function xe(pt,F){if(!pt.feature)return;const G=pt.feature;G.id!==void 0&&F.writeVarintField(1,G.id),F.writeMessage(2,Kt,pt),F.writeVarintField(3,G.type),F.writeMessage(4,Pt,G)}function Kt(pt,F){for(const G in pt.feature?.properties){let H=pt.feature.properties[G],ot=pt.keycache[G];if(H===null)continue;ot===void 0&&(pt.keys.push(G),ot=pt.keys.length-1,pt.keycache[G]=ot),F.writeVarint(ot),typeof H!="string"&&typeof H!="boolean"&&typeof H!="number"&&(H=JSON.stringify(H));const ut=typeof H+":"+H;let Et=pt.valuecache[ut];Et===void 0&&(pt.values.push(H),Et=pt.values.length-1,pt.valuecache[ut]=Et),F.writeVarint(Et)}}function gt(pt,F){return(F<<3)+(7&pt)}function Yt(pt){return pt<<1^pt>>31}function Pt(pt,F){const G=pt.loadGeometry(),H=pt.type;let ot=0,ut=0;for(const Et of G){let J=1;H===1&&(J=Et.length),F.writeVarint(gt(1,J));const wt=H===3?Et.length-1:Et.length;for(let Nt=0;Nt<wt;Nt++){Nt===1&&H!==1&&F.writeVarint(gt(2,wt-1));const jt=Et[Nt].x-ot,Ut=Et[Nt].y-ut;F.writeVarint(Yt(jt)),F.writeVarint(Yt(Ut)),ot+=jt,ut+=Ut}pt.type===3&&F.writeVarint(gt(7,1))}}function At(pt,F){const G=typeof pt;G==="string"?F.writeStringField(1,pt):G==="boolean"?F.writeBooleanField(7,pt):G==="number"&&(pt%1!=0?F.writeDoubleField(3,pt):pt<0?F.writeSVarintField(6,pt):F.writeVarintField(5,pt))}class ce extends P.cW{constructor(F,G,H,ot,ut){super(new P.cV,0,ut,[],[]),this.type=F,this.properties=H||{},this.extent=ut,this.pointsArray=G,this.id=ot}loadGeometry(){return this.pointsArray.map((F=>F.map((G=>new P.P(G.x,G.y)))))}}class ue extends P.cU{constructor(F,G,H){super(new P.cV),this.version=2,this._myFeatures=F,this.name=G,this.length=F.length,this.extent=H}feature(F){return this._myFeatures[F]}}class we{constructor(){this.layers={}}addLayer(F){this.layers[F.name]=F}}function pe(pt){let F=(function(G){const H=new P.cV;return(function(ot,ut){for(const Et in ot.layers)ut.writeMessage(3,he,ot.layers[Et])})(G,H),H.finish()})(pt);return F.byteOffset===0&&F.byteLength===F.buffer.byteLength||(F=new Uint8Array(F)),{vectorTile:pt,rawData:F.buffer}}function pi(pt,F,G){const{extent:H}=pt,ot=Math.pow(2,G.z-F.z),ut=(G.x-F.x*ot)*H,Et=(G.y-F.y*ot)*H,J=[];for(let wt=0;wt<pt.length;wt++){const Nt=pt.feature(wt);let jt=Nt.loadGeometry();for(const ye of jt)for(const Ce of ye)Ce.x=Ce.x*ot-ut,Ce.y=Ce.y*ot-Et;const Ut=128;jt=P.cX(jt,Nt.type,-Ut,-Ut,H+Ut,H+Ut),jt.length!==0&&J.push(new ce(Nt.type,jt,Nt.properties,Nt.id,H))}return new ue(J,pt.name,H)}class $e{constructor(F,G,H){this.actor=F,this.layerIndex=G,this.availableImages=H,this.fetching={},this.loading={},this.loaded={},this.overzoomedTileResultCache=new P.cY(1e3)}loadVectorTile(F,G){return P._(this,void 0,void 0,(function*(){const H=yield P.n(F.request,G);try{return{vectorTile:F.encoding!=="mlt"?new P.cZ(new P.cV(H.data)):new P.c_(H.data),rawData:H.data,cacheControl:H.cacheControl,expires:H.expires}}catch(ot){const ut=new Uint8Array(H.data);let Et=`Unable to parse the tile at ${F.request.url}, `;throw Et+=ut[0]===31&&ut[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${ot.message}`,new Error(Et)}}))}loadTile(F){return P._(this,void 0,void 0,(function*(){const{uid:G,overzoomParameters:H}=F;H&&(F.request=H.overzoomRequest);const ot=!!(F&&F.request&&F.request.collectResourceTiming)&&new P.c$(F.request),ut=new ft(F);this.loading[G]=ut;const Et=new AbortController;ut.abort=Et;try{const J=yield this.loadVectorTile(F,Et);if(delete this.loading[G],!J)return null;if(H){const ye=this._getOverzoomTile(F,J.vectorTile);J.rawData=ye.rawData,J.vectorTile=ye.vectorTile}const wt=J.rawData,Nt={};J.expires&&(Nt.expires=J.expires),J.cacheControl&&(Nt.cacheControl=J.cacheControl);const jt={};if(ot){const ye=ot.finish();ye&&(jt.resourceTiming=JSON.parse(JSON.stringify(ye)))}ut.vectorTile=J.vectorTile;const Ut=ut.parse(J.vectorTile,this.layerIndex,this.availableImages,this.actor,F.subdivisionGranularity);this.loaded[G]=ut,this.fetching[G]={rawTileData:wt,cacheControl:Nt,resourceTiming:jt};try{const ye=yield Ut;return P.e({rawTileData:wt.slice(0),encoding:F.encoding},ye,Nt,jt)}finally{delete this.fetching[G]}}catch(J){throw delete this.loading[G],ut.status="done",this.loaded[G]=ut,J}}))}_getOverzoomTile(F,G){const{tileID:H,source:ot,overzoomParameters:ut}=F,{maxZoomTileID:Et}=ut,J=`${Et.key}_${H.key}`,wt=this.overzoomedTileResultCache.get(J);if(wt)return wt;const Nt=new we,jt=this.layerIndex.familiesBySource[ot];for(const ye in jt){const Ce=G.layers[ye];if(!Ce)continue;const je=pi(Ce,Et,H.canonical);je.length>0&&Nt.addLayer(je)}const Ut=pe(Nt);return this.overzoomedTileResultCache.set(J,Ut),Ut}reloadTile(F){return P._(this,void 0,void 0,(function*(){const G=F.uid;if(!this.loaded||!this.loaded[G])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const H=this.loaded[G];if(H.showCollisionBoxes=F.showCollisionBoxes,H.status==="parsing"){const ot=yield H.parse(H.vectorTile,this.layerIndex,this.availableImages,this.actor,F.subdivisionGranularity);let ut;if(this.fetching[G]){const{rawTileData:Et,cacheControl:J,resourceTiming:wt}=this.fetching[G];delete this.fetching[G],ut=P.e({rawTileData:Et.slice(0),encoding:F.encoding},ot,J,wt)}else ut=ot;return ut}if(H.status==="done"&&H.vectorTile)return H.parse(H.vectorTile,this.layerIndex,this.availableImages,this.actor,F.subdivisionGranularity)}))}abortTile(F){return P._(this,void 0,void 0,(function*(){const G=this.loading,H=F.uid;G&&G[H]&&G[H].abort&&(G[H].abort.abort(),delete G[H])}))}removeTile(F){return P._(this,void 0,void 0,(function*(){this.loaded&&this.loaded[F.uid]&&delete this.loaded[F.uid]}))}}class Ai{constructor(){this.loaded={}}loadTile(F){return P._(this,void 0,void 0,(function*(){const{uid:G,encoding:H,rawImageData:ot,redFactor:ut,greenFactor:Et,blueFactor:J,baseShift:wt}=F,Nt=ot.width+2,jt=ot.height+2,Ut=P.b(ot)?new P.R({width:Nt,height:jt},yield P.d0(ot,-1,-1,Nt,jt)):ot,ye=new P.d1(G,Ut,H,ut,Et,J,wt);return this.loaded=this.loaded||{},this.loaded[G]=ye,ye}))}removeTile(F){const G=this.loaded,H=F.uid;G&&G[H]&&delete G[H]}}var sn,on,va=(function(){if(on)return sn;function pt(G,H){if(G.length!==0){F(G[0],H);for(var ot=1;ot<G.length;ot++)F(G[ot],!H)}}function F(G,H){for(var ot=0,ut=0,Et=0,J=G.length,wt=J-1;Et<J;wt=Et++){var Nt=(G[Et][0]-G[wt][0])*(G[wt][1]+G[Et][1]),jt=ot+Nt;ut+=Math.abs(ot)>=Math.abs(Nt)?ot-jt+Nt:Nt-jt+ot,ot=jt}ot+ut>=0!=!!H&&G.reverse()}return on=1,sn=function G(H,ot){var ut,Et=H&&H.type;if(Et==="FeatureCollection")for(ut=0;ut<H.features.length;ut++)G(H.features[ut],ot);else if(Et==="GeometryCollection")for(ut=0;ut<H.geometries.length;ut++)G(H.geometries[ut],ot);else if(Et==="Feature")G(H.geometry,ot);else if(Et==="Polygon")pt(H.coordinates,ot);else if(Et==="MultiPolygon")for(ut=0;ut<H.coordinates.length;ut++)pt(H.coordinates[ut],ot);return H}})(),On=P.d2(va);const Zn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:pt=>pt},$t=Math.fround||(de=new Float32Array(1),pt=>(de[0]=+pt,de[0]));var de;class Ne{constructor(F){this.options=Object.assign(Object.create(Zn),F),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(F){const{log:G,minZoom:H,maxZoom:ot}=this.options;G&&console.time("total time");const ut=`prepare ${F.length} points`;G&&console.time(ut),this.points=F;const Et=[];for(let wt=0;wt<F.length;wt++){const Nt=F[wt];if(!Nt.geometry)continue;const[jt,Ut]=Nt.geometry.coordinates,ye=$t(bt(jt)),Ce=$t(Ht(Ut));Et.push(ye,Ce,1/0,wt,-1,1),this.options.reduce&&Et.push(0)}let J=this.trees[ot+1]=this._createTree(Et);G&&console.timeEnd(ut);for(let wt=ot;wt>=H;wt--){const Nt=+Date.now();J=this.trees[wt]=this._createTree(this._cluster(J,wt)),G&&console.log("z%d: %d clusters in %dms",wt,J.numItems,+Date.now()-Nt)}return G&&console.timeEnd("total time"),this}getClusters(F,G){let H=((F[0]+180)%360+360)%360-180;const ot=Math.max(-90,Math.min(90,F[1]));let ut=F[2]===180?180:((F[2]+180)%360+360)%360-180;const Et=Math.max(-90,Math.min(90,F[3]));if(F[2]-F[0]>=360)H=-180,ut=180;else if(H>ut){const Ut=this.getClusters([H,ot,180,Et],G),ye=this.getClusters([-180,ot,ut,Et],G);return Ut.concat(ye)}const J=this.trees[this._limitZoom(G)],wt=J.range(bt(H),Ht(Et),bt(ut),Ht(ot)),Nt=J.data,jt=[];for(const Ut of wt){const ye=this.stride*Ut;jt.push(Nt[ye+5]>1?Re(Nt,ye,this.clusterProps):this.points[Nt[ye+3]])}return jt}getChildren(F){const G=this._getOriginId(F),H=this._getOriginZoom(F),ot="No cluster with the specified id.",ut=this.trees[H];if(!ut)throw new Error(ot);const Et=ut.data;if(G*this.stride>=Et.length)throw new Error(ot);const J=this.options.radius/(this.options.extent*Math.pow(2,H-1)),wt=ut.within(Et[G*this.stride],Et[G*this.stride+1],J),Nt=[];for(const jt of wt){const Ut=jt*this.stride;Et[Ut+4]===F&&Nt.push(Et[Ut+5]>1?Re(Et,Ut,this.clusterProps):this.points[Et[Ut+3]])}if(Nt.length===0)throw new Error(ot);return Nt}getLeaves(F,G,H){const ot=[];return this._appendLeaves(ot,F,G=G||10,H=H||0,0),ot}getTile(F,G,H){const ot=this.trees[this._limitZoom(F)],ut=Math.pow(2,F),{extent:Et,radius:J}=this.options,wt=J/Et,Nt=(H-wt)/ut,jt=(H+1+wt)/ut,Ut={features:[]};return this._addTileFeatures(ot.range((G-wt)/ut,Nt,(G+1+wt)/ut,jt),ot.data,G,H,ut,Ut),G===0&&this._addTileFeatures(ot.range(1-wt/ut,Nt,1,jt),ot.data,ut,H,ut,Ut),G===ut-1&&this._addTileFeatures(ot.range(0,Nt,wt/ut,jt),ot.data,-1,H,ut,Ut),Ut.features.length?Ut:null}getClusterExpansionZoom(F){let G=this._getOriginZoom(F)-1;for(;G<=this.options.maxZoom;){const H=this.getChildren(F);if(G++,H.length!==1)break;F=H[0].properties.cluster_id}return G}_appendLeaves(F,G,H,ot,ut){const Et=this.getChildren(G);for(const J of Et){const wt=J.properties;if(wt&&wt.cluster?ut+wt.point_count<=ot?ut+=wt.point_count:ut=this._appendLeaves(F,wt.cluster_id,H,ot,ut):ut<ot?ut++:F.push(J),F.length===H)break}return ut}_createTree(F){const G=new P.aS(F.length/this.stride|0,this.options.nodeSize,Float32Array);for(let H=0;H<F.length;H+=this.stride)G.add(F[H],F[H+1]);return G.finish(),G.data=F,G}_addTileFeatures(F,G,H,ot,ut,Et){for(const J of F){const wt=J*this.stride,Nt=G[wt+5]>1;let jt,Ut,ye;if(Nt)jt=si(G,wt,this.clusterProps),Ut=G[wt],ye=G[wt+1];else{const pn=this.points[G[wt+3]];jt=pn.properties;const[Je,yi]=pn.geometry.coordinates;Ut=bt(Je),ye=Ht(yi)}const Ce={type:1,geometry:[[Math.round(this.options.extent*(Ut*ut-H)),Math.round(this.options.extent*(ye*ut-ot))]],tags:jt};let je;je=Nt||this.options.generateId?G[wt+3]:this.points[G[wt+3]].id,je!==void 0&&(Ce.id=je),Et.features.push(Ce)}}_limitZoom(F){return Math.max(this.options.minZoom,Math.min(Math.floor(+F),this.options.maxZoom+1))}_cluster(F,G){const{radius:H,extent:ot,reduce:ut,minPoints:Et}=this.options,J=H/(ot*Math.pow(2,G)),wt=F.data,Nt=[],jt=this.stride;for(let Ut=0;Ut<wt.length;Ut+=jt){if(wt[Ut+2]<=G)continue;wt[Ut+2]=G;const ye=wt[Ut],Ce=wt[Ut+1],je=F.within(wt[Ut],wt[Ut+1],J),pn=wt[Ut+5];let Je=pn;for(const yi of je){const Li=yi*jt;wt[Li+2]>G&&(Je+=wt[Li+5])}if(Je>pn&&Je>=Et){let yi,Li=ye*pn,ne=Ce*pn,ki=-1;const Oi=(Ut/jt<<5)+(G+1)+this.points.length;for(const Dn of je){const vi=Dn*jt;if(wt[vi+2]<=G)continue;wt[vi+2]=G;const Qt=wt[vi+5];Li+=wt[vi]*Qt,ne+=wt[vi+1]*Qt,wt[vi+4]=Oi,ut&&(yi||(yi=this._map(wt,Ut,!0),ki=this.clusterProps.length,this.clusterProps.push(yi)),ut(yi,this._map(wt,vi)))}wt[Ut+4]=Oi,Nt.push(Li/Je,ne/Je,1/0,Oi,-1,Je),ut&&Nt.push(ki)}else{for(let yi=0;yi<jt;yi++)Nt.push(wt[Ut+yi]);if(Je>1)for(const yi of je){const Li=yi*jt;if(!(wt[Li+2]<=G)){wt[Li+2]=G;for(let ne=0;ne<jt;ne++)Nt.push(wt[Li+ne])}}}}return Nt}_getOriginId(F){return F-this.points.length>>5}_getOriginZoom(F){return(F-this.points.length)%32}_map(F,G,H){if(F[G+5]>1){const Et=this.clusterProps[F[G+6]];return H?Object.assign({},Et):Et}const ot=this.points[F[G+3]].properties,ut=this.options.map(ot);return H&&ut===ot?Object.assign({},ut):ut}}function Re(pt,F,G){return{type:"Feature",id:pt[F+3],properties:si(pt,F,G),geometry:{type:"Point",coordinates:[(H=pt[F],360*(H-.5)),_e(pt[F+1])]}};var H}function si(pt,F,G){const H=pt[F+5],ot=H>=1e4?`${Math.round(H/1e3)}k`:H>=1e3?Math.round(H/100)/10+"k":H,ut=pt[F+6],Et=ut===-1?{}:Object.assign({},G[ut]);return Object.assign(Et,{cluster:!0,cluster_id:pt[F+3],point_count:H,point_count_abbreviated:ot})}function bt(pt){return pt/360+.5}function Ht(pt){const F=Math.sin(pt*Math.PI/180),G=.5-.25*Math.log((1+F)/(1-F))/Math.PI;return G<0?0:G>1?1:G}function _e(pt){const F=(180-360*pt)*Math.PI/180;return 360*Math.atan(Math.exp(F))/Math.PI-90}function Te(pt,F,G,H){let ot=H;const ut=F+(G-F>>1);let Et,J=G-F;const wt=pt[F],Nt=pt[F+1],jt=pt[G],Ut=pt[G+1];for(let ye=F+3;ye<G;ye+=3){const Ce=be(pt[ye],pt[ye+1],wt,Nt,jt,Ut);if(Ce>ot)Et=ye,ot=Ce;else if(Ce===ot){const je=Math.abs(ye-ut);je<J&&(Et=ye,J=je)}}ot>H&&(Et-F>3&&Te(pt,F,Et,H),pt[Et+2]=ot,G-Et>3&&Te(pt,Et,G,H))}function be(pt,F,G,H,ot,ut){let Et=ot-G,J=ut-H;if(Et!==0||J!==0){const wt=((pt-G)*Et+(F-H)*J)/(Et*Et+J*J);wt>1?(G=ot,H=ut):wt>0&&(G+=Et*wt,H+=J*wt)}return Et=pt-G,J=F-H,Et*Et+J*J}function Ie(pt,F,G,H){const ot={id:pt??null,type:F,geometry:G,tags:H,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(F==="Point"||F==="MultiPoint"||F==="LineString")Ue(ot,G);else if(F==="Polygon")Ue(ot,G[0]);else if(F==="MultiLineString")for(const ut of G)Ue(ot,ut);else if(F==="MultiPolygon")for(const ut of G)Ue(ot,ut[0]);return ot}function Ue(pt,F){for(let G=0;G<F.length;G+=3)pt.minX=Math.min(pt.minX,F[G]),pt.minY=Math.min(pt.minY,F[G+1]),pt.maxX=Math.max(pt.maxX,F[G]),pt.maxY=Math.max(pt.maxY,F[G+1])}function Ke(pt,F,G,H){if(!F.geometry)return;const ot=F.geometry.coordinates;if(ot&&ot.length===0)return;const ut=F.geometry.type,Et=Math.pow(G.tolerance/((1<<G.maxZoom)*G.extent),2);let J=[],wt=F.id;if(G.promoteId?wt=F.properties[G.promoteId]:G.generateId&&(wt=H||0),ut==="Point")mi(ot,J);else if(ut==="MultiPoint")for(const Nt of ot)mi(Nt,J);else if(ut==="LineString")dn(ot,J,Et,!1);else if(ut==="MultiLineString"){if(G.lineMetrics){for(const Nt of ot)J=[],dn(Nt,J,Et,!1),pt.push(Ie(wt,"LineString",J,F.properties));return}Qe(ot,J,Et,!1)}else if(ut==="Polygon")Qe(ot,J,Et,!0);else{if(ut!=="MultiPolygon"){if(ut==="GeometryCollection"){for(const Nt of F.geometry.geometries)Ke(pt,{id:wt,geometry:Nt,properties:F.properties},G,H);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Nt of ot){const jt=[];Qe(Nt,jt,Et,!0),J.push(jt)}}pt.push(Ie(wt,ut,J,F.properties))}function mi(pt,F){F.push(qe(pt[0]),Ki(pt[1]),0)}function dn(pt,F,G,H){let ot,ut,Et=0;for(let wt=0;wt<pt.length;wt++){const Nt=qe(pt[wt][0]),jt=Ki(pt[wt][1]);F.push(Nt,jt,0),wt>0&&(Et+=H?(ot*jt-Nt*ut)/2:Math.sqrt(Math.pow(Nt-ot,2)+Math.pow(jt-ut,2))),ot=Nt,ut=jt}const J=F.length-3;F[2]=1,Te(F,0,J,G),F[J+2]=1,F.size=Math.abs(Et),F.start=0,F.end=F.size}function Qe(pt,F,G,H){for(let ot=0;ot<pt.length;ot++){const ut=[];dn(pt[ot],ut,G,H),F.push(ut)}}function qe(pt){return pt/360+.5}function Ki(pt){const F=Math.sin(pt*Math.PI/180),G=.5-.25*Math.log((1+F)/(1-F))/Math.PI;return G<0?0:G>1?1:G}function oi(pt,F,G,H,ot,ut,Et,J){if(H/=F,ut>=(G/=F)&&Et<H)return pt;if(Et<G||ut>=H)return null;const wt=[];for(const Nt of pt){const jt=Nt.geometry;let Ut=Nt.type;const ye=ot===0?Nt.minX:Nt.minY,Ce=ot===0?Nt.maxX:Nt.maxY;if(ye>=G&&Ce<H){wt.push(Nt);continue}if(Ce<G||ye>=H)continue;let je=[];if(Ut==="Point"||Ut==="MultiPoint")ia(jt,je,G,H,ot);else if(Ut==="LineString")xn(jt,je,G,H,ot,!1,J.lineMetrics);else if(Ut==="MultiLineString")Cn(jt,je,G,H,ot,!1);else if(Ut==="Polygon")Cn(jt,je,G,H,ot,!0);else if(Ut==="MultiPolygon")for(const pn of jt){const Je=[];Cn(pn,Je,G,H,ot,!0),Je.length&&je.push(Je)}if(je.length){if(J.lineMetrics&&Ut==="LineString"){for(const pn of je)wt.push(Ie(Nt.id,Ut,pn,Nt.tags));continue}Ut!=="LineString"&&Ut!=="MultiLineString"||(je.length===1?(Ut="LineString",je=je[0]):Ut="MultiLineString"),Ut!=="Point"&&Ut!=="MultiPoint"||(Ut=je.length===3?"Point":"MultiPoint"),wt.push(Ie(Nt.id,Ut,je,Nt.tags))}}return wt.length?wt:null}function ia(pt,F,G,H,ot){for(let ut=0;ut<pt.length;ut+=3){const Et=pt[ut+ot];Et>=G&&Et<=H&&An(F,pt[ut],pt[ut+1],pt[ut+2])}}function xn(pt,F,G,H,ot,ut,Et){let J=Di(pt);const wt=ot===0?ca:Qi;let Nt,jt,Ut=pt.start;for(let Je=0;Je<pt.length-3;Je+=3){const yi=pt[Je],Li=pt[Je+1],ne=pt[Je+2],ki=pt[Je+3],Oi=pt[Je+4],Dn=ot===0?yi:Li,vi=ot===0?ki:Oi;let Qt=!1;Et&&(Nt=Math.sqrt(Math.pow(yi-ki,2)+Math.pow(Li-Oi,2))),Dn<G?vi>G&&(jt=wt(J,yi,Li,ki,Oi,G),Et&&(J.start=Ut+Nt*jt)):Dn>H?vi<H&&(jt=wt(J,yi,Li,ki,Oi,H),Et&&(J.start=Ut+Nt*jt)):An(J,yi,Li,ne),vi<G&&Dn>=G&&(jt=wt(J,yi,Li,ki,Oi,G),Qt=!0),vi>H&&Dn<=H&&(jt=wt(J,yi,Li,ki,Oi,H),Qt=!0),!ut&&Qt&&(Et&&(J.end=Ut+Nt*jt),F.push(J),J=Di(pt)),Et&&(Ut+=Nt)}let ye=pt.length-3;const Ce=pt[ye],je=pt[ye+1],pn=ot===0?Ce:je;pn>=G&&pn<=H&&An(J,Ce,je,pt[ye+2]),ye=J.length-3,ut&&ye>=3&&(J[ye]!==J[0]||J[ye+1]!==J[1])&&An(J,J[0],J[1],J[2]),J.length&&F.push(J)}function Di(pt){const F=[];return F.size=pt.size,F.start=pt.start,F.end=pt.end,F}function Cn(pt,F,G,H,ot,ut){for(const Et of pt)xn(Et,F,G,H,ot,ut,!1)}function An(pt,F,G,H){pt.push(F,G,H)}function ca(pt,F,G,H,ot,ut){const Et=(ut-F)/(H-F);return An(pt,ut,G+(ot-G)*Et,1),Et}function Qi(pt,F,G,H,ot,ut){const Et=(ut-G)/(ot-G);return An(pt,F+(H-F)*Et,ut,1),Et}function fn(pt,F){const G=[];for(let H=0;H<pt.length;H++){const ot=pt[H],ut=ot.type;let Et;if(ut==="Point"||ut==="MultiPoint"||ut==="LineString")Et=xa(ot.geometry,F);else if(ut==="MultiLineString"||ut==="Polygon"){Et=[];for(const J of ot.geometry)Et.push(xa(J,F))}else if(ut==="MultiPolygon"){Et=[];for(const J of ot.geometry){const wt=[];for(const Nt of J)wt.push(xa(Nt,F));Et.push(wt)}}G.push(Ie(ot.id,ut,Et,ot.tags))}return G}function xa(pt,F){const G=[];G.size=pt.size,pt.start!==void 0&&(G.start=pt.start,G.end=pt.end);for(let H=0;H<pt.length;H+=3)G.push(pt[H]+F,pt[H+1],pt[H+2]);return G}function qi(pt,F){if(pt.transformed)return pt;const G=1<<pt.z,H=pt.x,ot=pt.y;for(const ut of pt.features){const Et=ut.geometry,J=ut.type;if(ut.geometry=[],J===1)for(let wt=0;wt<Et.length;wt+=2)ut.geometry.push(bn(Et[wt],Et[wt+1],F,G,H,ot));else for(let wt=0;wt<Et.length;wt++){const Nt=[];for(let jt=0;jt<Et[wt].length;jt+=2)Nt.push(bn(Et[wt][jt],Et[wt][jt+1],F,G,H,ot));ut.geometry.push(Nt)}}return pt.transformed=!0,pt}function bn(pt,F,G,H,ot,ut){return[Math.round(G*(pt*H-ot)),Math.round(G*(F*H-ut))]}function Io(pt,F,G,H,ot){const ut=F===ot.maxZoom?0:ot.tolerance/((1<<F)*ot.extent),Et={features:[],numPoints:0,numSimplified:0,numFeatures:pt.length,source:null,x:G,y:H,z:F,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const J of pt)Sl(Et,J,ut,ot);return Et}function Sl(pt,F,G,H){const ot=F.geometry,ut=F.type,Et=[];if(pt.minX=Math.min(pt.minX,F.minX),pt.minY=Math.min(pt.minY,F.minY),pt.maxX=Math.max(pt.maxX,F.maxX),pt.maxY=Math.max(pt.maxY,F.maxY),ut==="Point"||ut==="MultiPoint")for(let J=0;J<ot.length;J+=3)Et.push(ot[J],ot[J+1]),pt.numPoints++,pt.numSimplified++;else if(ut==="LineString")Wr(Et,ot,pt,G,!1,!1);else if(ut==="MultiLineString"||ut==="Polygon")for(let J=0;J<ot.length;J++)Wr(Et,ot[J],pt,G,ut==="Polygon",J===0);else if(ut==="MultiPolygon")for(let J=0;J<ot.length;J++){const wt=ot[J];for(let Nt=0;Nt<wt.length;Nt++)Wr(Et,wt[Nt],pt,G,!0,Nt===0)}if(Et.length){let J=F.tags||null;if(ut==="LineString"&&H.lineMetrics){J={};for(const Nt in F.tags)J[Nt]=F.tags[Nt];J.mapbox_clip_start=ot.start/ot.size,J.mapbox_clip_end=ot.end/ot.size}const wt={geometry:Et,type:ut==="Polygon"||ut==="MultiPolygon"?3:ut==="LineString"||ut==="MultiLineString"?2:1,tags:J};F.id!==null&&(wt.id=F.id),pt.features.push(wt)}}function Wr(pt,F,G,H,ot,ut){const Et=H*H;if(H>0&&F.size<(ot?Et:H))return void(G.numPoints+=F.length/3);const J=[];for(let wt=0;wt<F.length;wt+=3)(H===0||F[wt+2]>Et)&&(G.numSimplified++,J.push(F[wt],F[wt+1])),G.numPoints++;ot&&(function(wt,Nt){let jt=0;for(let Ut=0,ye=wt.length,Ce=ye-2;Ut<ye;Ce=Ut,Ut+=2)jt+=(wt[Ut]-wt[Ce])*(wt[Ut+1]+wt[Ce+1]);if(jt>0===Nt)for(let Ut=0,ye=wt.length;Ut<ye/2;Ut+=2){const Ce=wt[Ut],je=wt[Ut+1];wt[Ut]=wt[ye-2-Ut],wt[Ut+1]=wt[ye-1-Ut],wt[ye-2-Ut]=Ce,wt[ye-1-Ut]=je}})(J,ut),pt.push(J)}const El={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Ts{constructor(F,G){const H=(G=this.options=(function(ut,Et){for(const J in Et)ut[J]=Et[J];return ut})(Object.create(El),G)).debug;if(H&&console.time("preprocess data"),G.maxZoom<0||G.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(G.promoteId&&G.generateId)throw new Error("promoteId and generateId cannot be used together.");let ot=(function(ut,Et){const J=[];if(ut.type==="FeatureCollection")for(let wt=0;wt<ut.features.length;wt++)Ke(J,ut.features[wt],Et,wt);else Ke(J,ut.type==="Feature"?ut:{geometry:ut},Et);return J})(F,G);this.tiles={},this.tileCoords=[],H&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",G.indexMaxZoom,G.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ot=(function(ut,Et){const J=Et.buffer/Et.extent;let wt=ut;const Nt=oi(ut,1,-1-J,J,0,-1,2,Et),jt=oi(ut,1,1-J,2+J,0,-1,2,Et);return(Nt||jt)&&(wt=oi(ut,1,-J,1+J,0,-1,2,Et)||[],Nt&&(wt=fn(Nt,1).concat(wt)),jt&&(wt=wt.concat(fn(jt,-1)))),wt})(ot,G),ot.length&&this.splitTile(ot,0,0,0),H&&(ot.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(F,G,H,ot,ut,Et,J){const wt=[F,G,H,ot],Nt=this.options,jt=Nt.debug;for(;wt.length;){ot=wt.pop(),H=wt.pop(),G=wt.pop(),F=wt.pop();const Ut=1<<G,ye=Ml(G,H,ot);let Ce=this.tiles[ye];if(!Ce&&(jt>1&&console.time("creation"),Ce=this.tiles[ye]=Io(F,G,H,ot,Nt),this.tileCoords.push({z:G,x:H,y:ot}),jt)){jt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",G,H,ot,Ce.numFeatures,Ce.numPoints,Ce.numSimplified),console.timeEnd("creation"));const Qt=`z${G}`;this.stats[Qt]=(this.stats[Qt]||0)+1,this.total++}if(Ce.source=F,ut==null){if(G===Nt.indexMaxZoom||Ce.numPoints<=Nt.indexMaxPoints)continue}else{if(G===Nt.maxZoom||G===ut)continue;if(ut!=null){const Qt=ut-G;if(H!==Et>>Qt||ot!==J>>Qt)continue}}if(Ce.source=null,F.length===0)continue;jt>1&&console.time("clipping");const je=.5*Nt.buffer/Nt.extent,pn=.5-je,Je=.5+je,yi=1+je;let Li=null,ne=null,ki=null,Oi=null,Dn=oi(F,Ut,H-je,H+Je,0,Ce.minX,Ce.maxX,Nt),vi=oi(F,Ut,H+pn,H+yi,0,Ce.minX,Ce.maxX,Nt);F=null,Dn&&(Li=oi(Dn,Ut,ot-je,ot+Je,1,Ce.minY,Ce.maxY,Nt),ne=oi(Dn,Ut,ot+pn,ot+yi,1,Ce.minY,Ce.maxY,Nt),Dn=null),vi&&(ki=oi(vi,Ut,ot-je,ot+Je,1,Ce.minY,Ce.maxY,Nt),Oi=oi(vi,Ut,ot+pn,ot+yi,1,Ce.minY,Ce.maxY,Nt),vi=null),jt>1&&console.timeEnd("clipping"),wt.push(Li||[],G+1,2*H,2*ot),wt.push(ne||[],G+1,2*H,2*ot+1),wt.push(ki||[],G+1,2*H+1,2*ot),wt.push(Oi||[],G+1,2*H+1,2*ot+1)}}getTile(F,G,H){F=+F,G=+G,H=+H;const ot=this.options,{extent:ut,debug:Et}=ot;if(F<0||F>24)return null;const J=1<<F,wt=Ml(F,G=G+J&J-1,H);if(this.tiles[wt])return qi(this.tiles[wt],ut);Et>1&&console.log("drilling down to z%d-%d-%d",F,G,H);let Nt,jt=F,Ut=G,ye=H;for(;!Nt&&jt>0;)jt--,Ut>>=1,ye>>=1,Nt=this.tiles[Ml(jt,Ut,ye)];return Nt&&Nt.source?(Et>1&&(console.log("found parent tile z%d-%d-%d",jt,Ut,ye),console.time("drilling down")),this.splitTile(Nt.source,jt,Ut,ye,F,G,H),Et>1&&console.timeEnd("drilling down"),this.tiles[wt]?qi(this.tiles[wt],ut):null):null}}function Ml(pt,F,G){return 32*((1<<pt)*G+F)+pt}class Ro extends $e{constructor(F,G,H,ot=za){super(F,G,H),this._dataUpdateable=new Map,this._createGeoJSONIndex=ot}loadVectorTile(F,G){return P._(this,void 0,void 0,(function*(){const H=F.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const ot=this._geoJSONIndex.getTile(H.z,H.x,H.y);return ot?pe(new se(ot.features,{version:2,extent:P.a4})):null}))}loadData(F){return P._(this,void 0,void 0,(function*(){var G;(G=this._pendingRequest)===null||G===void 0||G.abort();const H=this._startPerformance(F);this._pendingRequest=new AbortController;try{(!this._pendingData||F.request||F.data||F.dataDiff)&&(this._pendingData=this.loadAndProcessGeoJSON(F,this._pendingRequest));const ot=yield this._pendingData;this._geoJSONIndex=this._createGeoJSONIndex(ot,F),this.loaded={};const ut=F.dataDiff&&P.a6(ot)?{applyDiff:!0}:{data:ot};return this._finishPerformance(H,F,ut),ut}catch(ot){if(delete this._pendingRequest,P.cH(ot))return{abandoned:!0};throw ot}}))}_startPerformance(F){var G;if(!((G=F?.request)===null||G===void 0)&&G.collectResourceTiming)return new P.c$(F.request)}_finishPerformance(F,G,H){if(!F)return;const ot=F.finish();ot&&(H.resourceTiming={},H.resourceTiming[G.source]=JSON.parse(JSON.stringify(ot)))}getData(){return P._(this,void 0,void 0,(function*(){return this._pendingData}))}reloadTile(F){const G=this.loaded;return G&&G[F.uid]?super.reloadTile(F):this.loadTile(F)}loadAndProcessGeoJSON(F,G){return P._(this,void 0,void 0,(function*(){let H;if(F.request?H=yield this.loadGeoJSONFromUrl(F.request,F.promoteId,G):F.data?H=this._loadGeoJSONFromObject(F.data,F.promoteId):F.dataDiff&&(H=this._loadGeoJSONFromDiff(F.dataDiff,F.promoteId,F.source)),delete this._pendingRequest,typeof H!="object")throw new Error(`Input data given to '${F.source}' is not a valid GeoJSON object.`);return On(H,!0),F.filter&&(H=this._filterGeoJSON(H,F.filter)),H}))}loadGeoJSONFromUrl(F,G,H){return P._(this,void 0,void 0,(function*(){const ot=yield P.j(F,H);return this._dataUpdateable=P.a6(ot.data,G)?P.a7(ot.data,G):void 0,ot.data}))}_loadGeoJSONFromObject(F,G){return this._dataUpdateable=P.a6(F,G)?P.a7(F,G):void 0,F}_loadGeoJSONFromDiff(F,G,H){if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${H}`);P.a8(this._dataUpdateable,F,G);const ot=Array.from(this._dataUpdateable.values());return this._toFeatureCollection(ot)}_filterGeoJSON(F,G){const H=P.d3(G,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(H.result==="error")throw new Error(H.value.map((ut=>`${ut.key}: ${ut.message}`)).join(", "));const ot=F.features.filter((ut=>H.value.evaluate({zoom:0},ut)));return this._toFeatureCollection(ot)}_toFeatureCollection(F){return{type:"FeatureCollection",features:F}}removeSource(F){return P._(this,void 0,void 0,(function*(){this._pendingRequest&&this._pendingRequest.abort()}))}getClusterExpansionZoom(F){return this._geoJSONIndex.getClusterExpansionZoom(F.clusterId)}getClusterChildren(F){return this._geoJSONIndex.getChildren(F.clusterId)}getClusterLeaves(F){return this._geoJSONIndex.getLeaves(F.clusterId,F.limit,F.offset)}}function za(pt,F){return F.cluster?new Ne((function({superclusterOptions:G,clusterProperties:H}){if(!H||!G)return G;const ot={},ut={},Et={accumulated:null,zoom:0},J={properties:null},wt=Object.keys(H);for(const Nt of wt){const[jt,Ut]=H[Nt],ye=P.d3(Ut),Ce=P.d3(typeof jt=="string"?[jt,["accumulated"],["get",Nt]]:jt);ot[Nt]=ye.value,ut[Nt]=Ce.value}return G.map=Nt=>{J.properties=Nt;const jt={};for(const Ut of wt)jt[Ut]=ot[Ut].evaluate(Et,J);return jt},G.reduce=(Nt,jt)=>{J.properties=jt;for(const Ut of wt)Et.accumulated=Nt[Ut],Nt[Ut]=ut[Ut].evaluate(Et,J)},G})(F)).load(pt.features):(function(G,H){return new Ts(G,H)})(pt,F.geojsonVtOptions)}class Ji{constructor(F){this.self=F,this.actor=new P.L(F),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.globalStates=new Map,this.self.registerWorkerSource=(G,H)=>{if(this.externalWorkerSourceTypes[G])throw new Error(`Worker source with name "${G}" already registered.`);this.externalWorkerSourceTypes[G]=H},this.self.addProtocol=P.cJ,this.self.removeProtocol=P.cK,this.self.registerRTLTextPlugin=G=>{P.d4.setMethods(G)},this.actor.registerMessageHandler("LDT",((G,H)=>this._getDEMWorkerSource(G,H.source).loadTile(H))),this.actor.registerMessageHandler("RDT",((G,H)=>P._(this,void 0,void 0,(function*(){this._getDEMWorkerSource(G,H.source).removeTile(H)})))),this.actor.registerMessageHandler("GCEZ",((G,H)=>P._(this,void 0,void 0,(function*(){return this._getWorkerSource(G,H.type,H.source).getClusterExpansionZoom(H)})))),this.actor.registerMessageHandler("GCC",((G,H)=>P._(this,void 0,void 0,(function*(){return this._getWorkerSource(G,H.type,H.source).getClusterChildren(H)})))),this.actor.registerMessageHandler("GCL",((G,H)=>P._(this,void 0,void 0,(function*(){return this._getWorkerSource(G,H.type,H.source).getClusterLeaves(H)})))),this.actor.registerMessageHandler("LD",((G,H)=>this._getWorkerSource(G,H.type,H.source).loadData(H))),this.actor.registerMessageHandler("GD",((G,H)=>this._getWorkerSource(G,H.type,H.source).getData())),this.actor.registerMessageHandler("LT",((G,H)=>this._getWorkerSource(G,H.type,H.source).loadTile(H))),this.actor.registerMessageHandler("RT",((G,H)=>this._getWorkerSource(G,H.type,H.source).reloadTile(H))),this.actor.registerMessageHandler("AT",((G,H)=>this._getWorkerSource(G,H.type,H.source).abortTile(H))),this.actor.registerMessageHandler("RMT",((G,H)=>this._getWorkerSource(G,H.type,H.source).removeTile(H))),this.actor.registerMessageHandler("RS",((G,H)=>P._(this,void 0,void 0,(function*(){if(!this.workerSources[G]||!this.workerSources[G][H.type]||!this.workerSources[G][H.type][H.source])return;const ot=this.workerSources[G][H.type][H.source];delete this.workerSources[G][H.type][H.source],ot.removeSource!==void 0&&ot.removeSource(H)})))),this.actor.registerMessageHandler("RM",(G=>P._(this,void 0,void 0,(function*(){delete this.layerIndexes[G],delete this.availableImages[G],delete this.workerSources[G],delete this.demWorkerSources[G],this.globalStates.delete(G)})))),this.actor.registerMessageHandler("SR",((G,H)=>P._(this,void 0,void 0,(function*(){this.referrer=H})))),this.actor.registerMessageHandler("SRPS",((G,H)=>this._syncRTLPluginState(G,H))),this.actor.registerMessageHandler("IS",((G,H)=>P._(this,void 0,void 0,(function*(){this.self.importScripts(H)})))),this.actor.registerMessageHandler("SI",((G,H)=>this._setImages(G,H))),this.actor.registerMessageHandler("UL",((G,H)=>P._(this,void 0,void 0,(function*(){this._getLayerIndex(G).update(H.layers,H.removedIds,this._getGlobalState(G))})))),this.actor.registerMessageHandler("UGS",((G,H)=>P._(this,void 0,void 0,(function*(){const ot=this._getGlobalState(G);for(const ut in H)ot[ut]=H[ut]})))),this.actor.registerMessageHandler("SL",((G,H)=>P._(this,void 0,void 0,(function*(){this._getLayerIndex(G).replace(H,this._getGlobalState(G))}))))}_getGlobalState(F){let G=this.globalStates.get(F);return G||(G={},this.globalStates.set(F,G)),G}_setImages(F,G){return P._(this,void 0,void 0,(function*(){this.availableImages[F]=G;for(const H in this.workerSources[F]){const ot=this.workerSources[F][H];for(const ut in ot)ot[ut].availableImages=G}}))}_syncRTLPluginState(F,G){return P._(this,void 0,void 0,(function*(){return yield P.d4.syncState(G,this.self.importScripts)}))}_getAvailableImages(F){let G=this.availableImages[F];return G||(G=[]),G}_getLayerIndex(F){let G=this.layerIndexes[F];return G||(G=this.layerIndexes[F]=new h),G}_getWorkerSource(F,G,H){if(this.workerSources[F]||(this.workerSources[F]={}),this.workerSources[F][G]||(this.workerSources[F][G]={}),!this.workerSources[F][G][H]){const ot={sendAsync:(ut,Et)=>(ut.targetMapId=F,this.actor.sendAsync(ut,Et))};switch(G){case"vector":this.workerSources[F][G][H]=new $e(ot,this._getLayerIndex(F),this._getAvailableImages(F));break;case"geojson":this.workerSources[F][G][H]=new Ro(ot,this._getLayerIndex(F),this._getAvailableImages(F));break;default:this.workerSources[F][G][H]=new this.externalWorkerSourceTypes[G](ot,this._getLayerIndex(F),this._getAvailableImages(F))}}return this.workerSources[F][G][H]}_getDEMWorkerSource(F,G){return this.demWorkerSources[F]||(this.demWorkerSources[F]={}),this.demWorkerSources[F][G]||(this.demWorkerSources[F][G]=new Ai),this.demWorkerSources[F][G]}}return P.i(self)&&(self.worker=new Ji(self)),Ji})),lt("index",["exports","./shared"],(function(P,h){var et="5.13.0";function ft(){var m=new h.A(4);return h.A!=Float32Array&&(m[1]=0,m[2]=0),m[0]=1,m[3]=1,m}let Bt,Dt,se;const he={frame(m,e,r){const c=requestAnimationFrame((g=>{f(),e(g)})),{unsubscribe:f}=h.s(m.signal,"abort",(()=>{f(),cancelAnimationFrame(c),r(h.c())}),!1)},frameAsync(m){return new Promise(((e,r)=>{this.frame(m,e,r)}))},getImageData(m,e=0){return this.getImageCanvasContext(m).getImageData(-e,-e,m.width+2*e,m.height+2*e)},getImageCanvasContext(m){const e=window.document.createElement("canvas"),r=e.getContext("2d",{willReadFrequently:!0});if(!r)throw new Error("failed to create canvas 2d context");return e.width=m.width,e.height=m.height,r.drawImage(m,0,0,m.width,m.height),r},resolveURL:m=>(Bt||(Bt=document.createElement("a")),Bt.href=m,Bt.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return se!==void 0?se:!!matchMedia&&(Dt==null&&(Dt=matchMedia("(prefers-reduced-motion: reduce)")),Dt.matches)},set prefersReducedMotion(m){se=m}},xe=new class{constructor(){this._realTime=typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),this._frozenAt=null}getCurrentTime(){return this._frozenAt!==null?this._frozenAt:this._realTime()}setNow(m){this._frozenAt=m}restoreNow(){this._frozenAt=null}isFrozen(){return this._frozenAt!==null}};function Kt(){return xe.getCurrentTime()}class gt{static testProp(e){if(!gt.docStyle)return e[0];for(let r=0;r<e.length;r++)if(e[r]in gt.docStyle)return e[r];return e[0]}static create(e,r,c){const f=window.document.createElement(e);return r!==void 0&&(f.className=r),c&&c.appendChild(f),f}static createNS(e,r){return window.document.createElementNS(e,r)}static disableDrag(){gt.docStyle&&gt.selectProp&&(gt.userSelect=gt.docStyle[gt.selectProp],gt.docStyle[gt.selectProp]="none")}static enableDrag(){gt.docStyle&&gt.selectProp&&(gt.docStyle[gt.selectProp]=gt.userSelect)}static setTransform(e,r){e.style[gt.transformProp]=r}static addEventListener(e,r,c,f={}){e.addEventListener(r,c,"passive"in f?f:f.capture)}static removeEventListener(e,r,c,f={}){e.removeEventListener(r,c,"passive"in f?f:f.capture)}static suppressClickInternal(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",gt.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",gt.suppressClickInternal,!0),window.setTimeout((()=>{window.removeEventListener("click",gt.suppressClickInternal,!0)}),0)}static getScale(e){const r=e.getBoundingClientRect();return{x:r.width/e.offsetWidth||1,y:r.height/e.offsetHeight||1,boundingClientRect:r}}static getPoint(e,r,c){const f=r.boundingClientRect;return new h.P((c.clientX-f.left)/r.x-e.clientLeft,(c.clientY-f.top)/r.y-e.clientTop)}static mousePos(e,r){const c=gt.getScale(e);return gt.getPoint(e,c,r)}static touchPos(e,r){const c=[],f=gt.getScale(e);for(let g=0;g<r.length;g++)c.push(gt.getPoint(e,f,r[g]));return c}static mouseButton(e){return e.button}static remove(e){e.parentNode&&e.parentNode.removeChild(e)}static sanitize(e){const r=new DOMParser().parseFromString(e,"text/html").body||document.createElement("body"),c=r.querySelectorAll("script");for(const f of c)f.remove();return gt.clean(r),r.innerHTML}static isPossiblyDangerous(e,r){const c=r.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(e)||!c.includes("javascript:")&&!c.includes("data:"))||!!e.startsWith("on")||void 0}static clean(e){const r=e.children;for(const c of r)gt.removeAttributes(c),gt.clean(c)}static removeAttributes(e){for(const{name:r,value:c}of e.attributes)gt.isPossiblyDangerous(r,c)&&e.removeAttribute(r)}}gt.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,gt.selectProp=gt.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),gt.transformProp=gt.testProp(["transform","WebkitTransform"]);const Yt={supported:!1,testSupport:function(m){!ce&&At&&(ue?we(m):Pt=m)}};let Pt,At,ce=!1,ue=!1;function we(m){const e=m.createTexture();m.bindTexture(m.TEXTURE_2D,e);try{if(m.texImage2D(m.TEXTURE_2D,0,m.RGBA,m.RGBA,m.UNSIGNED_BYTE,At),m.isContextLost())return;Yt.supported=!0}catch{}m.deleteTexture(e),ce=!0}var pe;typeof document<"u"&&(At=document.createElement("img"),At.onload=()=>{Pt&&we(Pt),Pt=null,ue=!0},At.onerror=()=>{ce=!0,Pt=null},At.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),(function(m){let e,r,c,f;m.resetRequestQueue=()=>{e=[],r=0,c=0,f={}},m.addThrottleControl=S=>{const C=c++;return f[C]=S,C},m.removeThrottleControl=S=>{delete f[S],v()},m.getImage=(S,C,D=!0)=>new Promise(((k,L)=>{Yt.supported&&(S.headers||(S.headers={}),S.headers.accept="image/webp,*/*"),h.e(S,{type:"image"}),e.push({abortController:C,requestParameters:S,supportImageRefresh:D,state:"queued",onError:j=>{L(j)},onSuccess:j=>{k(j)}}),v()}));const g=S=>h._(this,void 0,void 0,(function*(){S.state="running";const{requestParameters:C,supportImageRefresh:D,onError:k,onSuccess:L,abortController:j}=S,Z=D===!1&&!h.i(self)&&!h.g(C.url)&&(!C.headers||Object.keys(C.headers).reduce(((it,st)=>it&&st==="accept"),!0));r++;const W=Z?w(C,j):h.m(C,j);try{const it=yield W;delete S.abortController,S.state="completed",it.data instanceof HTMLImageElement||h.b(it.data)?L(it):it.data&&L({data:yield(Q=it.data,typeof createImageBitmap=="function"?h.f(Q):h.h(Q)),cacheControl:it.cacheControl,expires:it.expires})}catch(it){delete S.abortController,k(it)}finally{r--,v()}var Q})),v=()=>{const S=(()=>{for(const C of Object.keys(f))if(f[C]())return!0;return!1})()?h.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:h.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let C=r;C<S&&e.length>0;C++){const D=e.shift();D.abortController.signal.aborted?C--:g(D)}},w=(S,C)=>new Promise(((D,k)=>{const L=new Image,j=S.url,Z=S.credentials;Z&&Z==="include"?L.crossOrigin="use-credentials":(Z&&Z==="same-origin"||!h.d(j))&&(L.crossOrigin="anonymous"),C.signal.addEventListener("abort",(()=>{L.src="",k(h.c())})),L.fetchPriority="high",L.onload=()=>{L.onerror=L.onload=null,D({data:L})},L.onerror=()=>{L.onerror=L.onload=null,C.signal.aborted||k(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},L.src=j}))})(pe||(pe={})),pe.resetRequestQueue();class pi{constructor(e){this._transformRequestFn=e??null}transformRequest(e,r){return this._transformRequestFn&&this._transformRequestFn(e,r)||{url:e}}setTransformRequest(e){this._transformRequestFn=e}}function $e(m){const e=[];if(typeof m=="string")e.push({id:"default",url:m});else if(m&&m.length>0){const r=[];for(const{id:c,url:f}of m){const g=`${c}${f}`;r.indexOf(g)===-1&&(r.push(g),e.push({id:c,url:f}))}}return e}function Ai(m,e,r){try{const c=new URL(m);return c.pathname+=`${e}${r}`,c.toString()}catch{throw new Error(`Invalid sprite URL "${m}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}function sn(m){const{userImage:e}=m;return!!(e&&e.render&&e.render())&&(m.data.replace(new Uint8Array(e.data.buffer)),!0)}class on extends h.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new h.R({width:1,height:1}),this.dirty=!0}destroy(){this.atlasTexture&&(this.atlasTexture.destroy(),this.atlasTexture=null);for(const e of Object.keys(this.images))this.removeImage(e);this.patterns={},this.atlasImage=new h.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(e){if(this.loaded!==e&&(this.loaded=e,e)){for(const{ids:r,promiseResolve:c}of this.requestors)c(this._getImagesForIds(r));this.requestors=[]}}getImage(e){const r=this.images[e];if(r&&!r.data&&r.spriteData){const c=r.spriteData;r.data=new h.R({width:c.width,height:c.height},c.context.getImageData(c.x,c.y,c.width,c.height).data),r.spriteData=null}return r}addImage(e,r){if(this.images[e])throw new Error(`Image id ${e} already exist, use updateImage instead`);this._validate(e,r)&&(this.images[e]=r)}_validate(e,r){let c=!0;const f=r.data||r.spriteData;return this._validateStretch(r.stretchX,f&&f.width)||(this.fire(new h.k(new Error(`Image "${e}" has invalid "stretchX" value`))),c=!1),this._validateStretch(r.stretchY,f&&f.height)||(this.fire(new h.k(new Error(`Image "${e}" has invalid "stretchY" value`))),c=!1),this._validateContent(r.content,r)||(this.fire(new h.k(new Error(`Image "${e}" has invalid "content" value`))),c=!1),c}_validateStretch(e,r){if(!e)return!0;let c=0;for(const f of e){if(f[0]<c||f[1]<f[0]||r<f[1])return!1;c=f[1]}return!0}_validateContent(e,r){if(!e)return!0;if(e.length!==4)return!1;const c=r.spriteData,f=c&&c.width||r.data.width,g=c&&c.height||r.data.height;return!(e[0]<0||f<e[0]||e[1]<0||g<e[1]||e[2]<0||f<e[2]||e[3]<0||g<e[3]||e[2]<e[0]||e[3]<e[1])}updateImage(e,r,c=!0){const f=this.getImage(e);if(c&&(f.data.width!==r.data.width||f.data.height!==r.data.height))throw new Error(`size mismatch between old image (${f.data.width}x${f.data.height}) and new image (${r.data.width}x${r.data.height}).`);r.version=f.version+1,this.images[e]=r,this.updatedImages[e]=!0}removeImage(e){const r=this.images[e];delete this.images[e],delete this.patterns[e],r.userImage&&r.userImage.onRemove&&r.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(e){return new Promise(((r,c)=>{let f=!0;if(!this.isLoaded())for(const g of e)this.images[g]||(f=!1);this.isLoaded()||f?r(this._getImagesForIds(e)):this.requestors.push({ids:e,promiseResolve:r})}))}_getImagesForIds(e){const r={};for(const c of e){let f=this.getImage(c);f||(this.fire(new h.l("styleimagemissing",{id:c})),f=this.getImage(c)),f?r[c]={data:f.data.clone(),pixelRatio:f.pixelRatio,sdf:f.sdf,version:f.version,stretchX:f.stretchX,stretchY:f.stretchY,content:f.content,textFitWidth:f.textFitWidth,textFitHeight:f.textFitHeight,hasRenderCallback:!!(f.userImage&&f.userImage.render)}:h.w(`Image "${c}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return r}getPixelSize(){const{width:e,height:r}=this.atlasImage;return{width:e,height:r}}getPattern(e){const r=this.patterns[e],c=this.getImage(e);if(!c)return null;if(r&&r.position.version===c.version)return r.position;if(r)r.position.version=c.version;else{const f={w:c.data.width+2,h:c.data.height+2,x:0,y:0},g=new h.I(f,c);this.patterns[e]={bin:f,position:g}}return this._updatePatternAtlas(),this.patterns[e].position}bind(e){const r=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new h.T(e,this.atlasImage,r.RGBA),this.atlasTexture.bind(r.LINEAR,r.CLAMP_TO_EDGE)}_updatePatternAtlas(){const e=[];for(const g in this.patterns)e.push(this.patterns[g].bin);const{w:r,h:c}=h.p(e),f=this.atlasImage;f.resize({width:r||1,height:c||1});for(const g in this.patterns){const{bin:v}=this.patterns[g],w=v.x+1,S=v.y+1,C=this.getImage(g).data,D=C.width,k=C.height;h.R.copy(C,f,{x:0,y:0},{x:w,y:S},{width:D,height:k}),h.R.copy(C,f,{x:0,y:k-1},{x:w,y:S-1},{width:D,height:1}),h.R.copy(C,f,{x:0,y:0},{x:w,y:S+k},{width:D,height:1}),h.R.copy(C,f,{x:D-1,y:0},{x:w-1,y:S},{width:1,height:k}),h.R.copy(C,f,{x:0,y:0},{x:w+D,y:S},{width:1,height:k})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(e){for(const r of e){if(this.callbackDispatchedThisFrame[r])continue;this.callbackDispatchedThisFrame[r]=!0;const c=this.getImage(r);c||h.w(`Image with ID: "${r}" was not found`),sn(c)&&this.updateImage(r,c)}}cloneImages(){const e={};for(const r in this.images){const c=this.images[r];e[r]=Object.assign(Object.assign({},c),{data:c.data?c.data.clone():null})}return e}}const va=1e20;function On(m,e,r,c,f,g,v,w,S){for(let C=e;C<e+c;C++)Zn(m,r*g+C,g,f,v,w,S);for(let C=r;C<r+f;C++)Zn(m,C*g+e,1,c,v,w,S)}function Zn(m,e,r,c,f,g,v){g[0]=0,v[0]=-va,v[1]=va,f[0]=m[e];for(let w=1,S=0,C=0;w<c;w++){f[w]=m[e+w*r];const D=w*w;do{const k=g[S];C=(f[w]-f[k]+D-k*k)/(w-k)/2}while(C<=v[S]&&--S>-1);S++,g[S]=w,v[S]=C,v[S+1]=va}for(let w=0,S=0;w<c;w++){for(;v[S+1]<w;)S++;const C=g[S],D=w-C;m[e+w*r]=f[C]+D*D}}const $t=h.v.layout_symbol["text-font"].default.join(",");class de{constructor(e,r,c){this.requestManager=e,this.localIdeographFontFamily=r,this.entries={},this.lang=c}setURL(e){this.url=e}getGlyphs(e){return h._(this,void 0,void 0,(function*(){const r=[];for(const g in e)for(const v of e[g])r.push(this._getAndCacheGlyphsPromise(g,v));const c=yield Promise.all(r),f={};for(const{stack:g,id:v,glyph:w}of c)f[g]||(f[g]={}),f[g][v]=w&&{id:w.id,bitmap:w.bitmap.clone(),metrics:w.metrics};return f}))}_getAndCacheGlyphsPromise(e,r){return h._(this,void 0,void 0,(function*(){let c=this.entries[e];c||(c=this.entries[e]={glyphs:{},requests:{},ranges:{}});let f=c.glyphs[r];return f!==void 0?{stack:e,id:r,glyph:f}:!this.url||this._charUsesLocalIdeographFontFamily(r)?(f=c.glyphs[r]=this._drawGlyph(c,e,r),{stack:e,id:r,glyph:f}):yield this._downloadAndCacheRangePromise(e,r)}))}_downloadAndCacheRangePromise(e,r){return h._(this,void 0,void 0,(function*(){const c=this.entries[e],f=Math.floor(r/256);if(c.ranges[f])return{stack:e,id:r,glyph:null};if(!c.requests[f]){const g=de.loadGlyphRange(e,f,this.url,this.requestManager);c.requests[f]=g}try{const g=yield c.requests[f];for(const v in g)c.glyphs[+v]=g[+v];return c.ranges[f]=!0,{stack:e,id:r,glyph:g[r]||null}}catch(g){const v=c.glyphs[r]=this._drawGlyph(c,e,r);return this._warnOnMissingGlyphRange(v,f,r,g),{stack:e,id:r,glyph:v}}}))}_warnOnMissingGlyphRange(e,r,c,f){const g=256*r,v=g+255,w=c.toString(16).padStart(4,"0").toUpperCase();h.w(`Unable to load glyph range ${r}, ${g}-${v}. Rendering codepoint U+${w} locally instead. ${f}`)}_charUsesLocalIdeographFontFamily(e){return!!this.localIdeographFontFamily&&h.q(e)}_drawGlyph(e,r,c){const f=r===$t&&this.localIdeographFontFamily!==""&&this._charUsesLocalIdeographFontFamily(c),g=f?"ideographTinySDF":"tinySDF";e[g]||(e[g]=this._createTinySDF(f?this.localIdeographFontFamily:r));const v=e[g].draw(String.fromCodePoint(c));return{id:c,bitmap:new h.r({width:v.width||60,height:v.height||60},v.data),metrics:{width:v.glyphWidth/2||24,height:v.glyphHeight/2||24,left:v.glyphLeft/2+.5||0,top:v.glyphTop/2-27.5||-8,advance:v.glyphAdvance/2||24,isDoubleResolution:!0}}}_createTinySDF(e){const r=e?e.split(","):[];r.push("sans-serif");const c=r.map((f=>/[-\w]+/.test(f)?f:`'${CSS.escape(f)}'`)).join(",");return new de.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:c,fontWeight:this._fontWeight(r[0]),fontStyle:this._fontStyle(r[0]),lang:this.lang})}_fontStyle(e){return/italic/i.test(e)?"italic":/oblique/i.test(e)?"oblique":"normal"}_fontWeight(e){const r={thin:100,hairline:100,"extra light":200,"ultra light":200,light:300,normal:400,regular:400,medium:500,semibold:600,demibold:600,bold:700,"extra bold":800,"ultra bold":800,black:900,heavy:900,"extra black":950,"ultra black":950};let c;for(const[f,g]of Object.entries(r))new RegExp(`\\b${f}\\b`,"i").test(e)&&(c=`${g}`);return c}destroy(){for(const e in this.entries){const r=this.entries[e];r.tinySDF&&(r.tinySDF=null),r.ideographTinySDF&&(r.ideographTinySDF=null),r.glyphs={},r.requests={},r.ranges={}}this.entries={}}}de.loadGlyphRange=function(m,e,r,c){return h._(this,void 0,void 0,(function*(){const f=256*e,g=f+255,v=c.transformRequest(r.replace("{fontstack}",m).replace("{range}",`${f}-${g}`),"Glyphs"),w=yield h.n(v,new AbortController);if(!w||!w.data)throw new Error(`Could not load glyph range. range: ${e}, ${f}-${g}`);const S={};for(const C of h.o(w.data))S[C.id]=C;return S}))},de.TinySDF=class{constructor({fontSize:m=24,buffer:e=3,radius:r=8,cutoff:c=.25,fontFamily:f="sans-serif",fontWeight:g="normal",fontStyle:v="normal",lang:w=null}={}){this.buffer=e,this.cutoff=c,this.radius=r,this.lang=w;const S=this.size=m+4*e,C=this._createCanvas(S),D=this.ctx=C.getContext("2d",{willReadFrequently:!0});D.font=`${v} ${g} ${m}px ${f}`,D.textBaseline="alphabetic",D.textAlign="left",D.fillStyle="black",this.gridOuter=new Float64Array(S*S),this.gridInner=new Float64Array(S*S),this.f=new Float64Array(S),this.z=new Float64Array(S+1),this.v=new Uint16Array(S)}_createCanvas(m){const e=document.createElement("canvas");return e.width=e.height=m,e}draw(m){const{width:e,actualBoundingBoxAscent:r,actualBoundingBoxDescent:c,actualBoundingBoxLeft:f,actualBoundingBoxRight:g}=this.ctx.measureText(m),v=Math.ceil(r),w=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(g-f))),S=Math.min(this.size-this.buffer,v+Math.ceil(c)),C=w+2*this.buffer,D=S+2*this.buffer,k=Math.max(C*D,0),L=new Uint8ClampedArray(k),j={data:L,width:C,height:D,glyphWidth:w,glyphHeight:S,glyphTop:v,glyphLeft:0,glyphAdvance:e};if(w===0||S===0)return j;const{ctx:Z,buffer:W,gridInner:Q,gridOuter:it}=this;this.lang&&(Z.lang=this.lang),Z.clearRect(W,W,w,S),Z.fillText(m,W,W+v);const st=Z.getImageData(W,W,w,S);it.fill(va,0,k),Q.fill(0,0,k);for(let ht=0;ht<S;ht++)for(let at=0;at<w;at++){const dt=st.data[4*(ht*w+at)+3]/255;if(dt===0)continue;const mt=(ht+W)*C+at+W;if(dt===1)it[mt]=0,Q[mt]=va;else{const ct=.5-dt;it[mt]=ct>0?ct*ct:0,Q[mt]=ct<0?ct*ct:0}}On(it,0,0,C,D,C,this.f,this.v,this.z),On(Q,W,W,w,S,C,this.f,this.v,this.z);for(let ht=0;ht<k;ht++){const at=Math.sqrt(it[ht])-Math.sqrt(Q[ht]);L[ht]=Math.round(255-255*(at/this.radius+this.cutoff))}return j}};class Ne{constructor(){this.specification=h.u.light.position}possiblyEvaluate(e,r){return h.F(e.expression.evaluate(r))}interpolate(e,r,c){return{x:h.G.number(e.x,r.x,c),y:h.G.number(e.y,r.y,c),z:h.G.number(e.z,r.z,c)}}}let Re;class si extends h.E{constructor(e){super(),Re=Re||new h.t({anchor:new h.D(h.u.light.anchor),position:new Ne,color:new h.D(h.u.light.color),intensity:new h.D(h.u.light.intensity)}),this._transitionable=new h.x(Re,void 0),this.setLight(e),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,r={}){if(!this._validate(h.y,e,r))for(const c in e){const f=e[c];c.endsWith(h.z)?this._transitionable.setTransition(c.slice(0,-h.z.length),f):this._transitionable.setValue(c,f)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,r,c){return(!c||c.validate!==!1)&&h.B(this,e.call(h.C,{value:r,style:{glyphs:!0,sprite:!0},styleSpec:h.u}))}}const bt=new h.t({"sky-color":new h.D(h.u.sky["sky-color"]),"horizon-color":new h.D(h.u.sky["horizon-color"]),"fog-color":new h.D(h.u.sky["fog-color"]),"fog-ground-blend":new h.D(h.u.sky["fog-ground-blend"]),"horizon-fog-blend":new h.D(h.u.sky["horizon-fog-blend"]),"sky-horizon-blend":new h.D(h.u.sky["sky-horizon-blend"]),"atmosphere-blend":new h.D(h.u.sky["atmosphere-blend"])});class Ht extends h.E{constructor(e){super(),this._transitionable=new h.x(bt,void 0),this.setSky(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new h.H(0))}setSky(e,r={}){if(!this._validate(h.J,e,r)){e||(e={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const c in e){const f=e[c];c.endsWith(h.z)?this._transitionable.setTransition(c.slice(0,-h.z.length),f):this._transitionable.setValue(c,f)}}}getSky(){return this._transitionable.serialize()}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,r,c={}){return c?.validate!==!1&&h.B(this,e.call(h.C,h.e({value:r,style:{glyphs:!0,sprite:!0},styleSpec:h.u})))}calculateFogBlendOpacity(e){return e<60?0:e<70?(e-60)/10:1}}class _e{constructor(e,r){this.width=e,this.height=r,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(e,r){const c=e.join(",")+String(r);return this.dashEntry[c]||(this.dashEntry[c]=this.addDash(e,r)),this.dashEntry[c]}getDashRanges(e,r,c){const f=[];let g=e.length%2==1?-e[e.length-1]*c:0,v=e[0]*c,w=!0;f.push({left:g,right:v,isDash:w,zeroLength:e[0]===0});let S=e[0];for(let C=1;C<e.length;C++){w=!w;const D=e[C];g=S*c,S+=D,v=S*c,f.push({left:g,right:v,isDash:w,zeroLength:D===0})}return f}addRoundDash(e,r,c){const f=r/2;for(let g=-c;g<=c;g++){const v=this.width*(this.nextRow+c+g);let w=0,S=e[w];for(let C=0;C<this.width;C++){C/S.right>1&&(S=e[++w]);const D=Math.abs(C-S.left),k=Math.abs(C-S.right),L=Math.min(D,k);let j;const Z=g/c*(f+1);if(S.isDash){const W=f-Math.abs(Z);j=Math.sqrt(L*L+W*W)}else j=f-Math.sqrt(L*L+Z*Z);this.data[v+C]=Math.max(0,Math.min(255,j+128))}}}addRegularDash(e){for(let w=e.length-1;w>=0;--w){const S=e[w],C=e[w+1];S.zeroLength?e.splice(w,1):C&&C.isDash===S.isDash&&(C.left=S.left,e.splice(w,1))}const r=e[0],c=e[e.length-1];r.isDash===c.isDash&&(r.left=c.left-this.width,c.right=r.right+this.width);const f=this.width*this.nextRow;let g=0,v=e[g];for(let w=0;w<this.width;w++){w/v.right>1&&(v=e[++g]);const S=Math.abs(w-v.left),C=Math.abs(w-v.right),D=Math.min(S,C);this.data[f+w]=Math.max(0,Math.min(255,(v.isDash?D:-D)+128))}}addDash(e,r){const c=r?7:0,f=2*c+1;if(this.nextRow+f>this.height)return h.w("LineAtlas out of space"),null;let g=0;for(let w=0;w<e.length;w++)g+=e[w];if(g!==0){const w=this.width/g,S=this.getDashRanges(e,this.width,w);r?this.addRoundDash(S,w,c):this.addRegularDash(S)}const v={y:this.nextRow+c,height:2*c,width:g};return this.nextRow+=f,this.dirty=!0,v}bind(e){const r=e.gl;this.texture?(r.bindTexture(r.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,r.texSubImage2D(r.TEXTURE_2D,0,0,0,this.width,this.height,r.ALPHA,r.UNSIGNED_BYTE,this.data))):(this.texture=r.createTexture(),r.bindTexture(r.TEXTURE_2D,this.texture),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.REPEAT),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.REPEAT),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),r.texImage2D(r.TEXTURE_2D,0,r.ALPHA,this.width,this.height,0,r.ALPHA,r.UNSIGNED_BYTE,this.data))}}const Te="maplibre_preloaded_worker_pool";class be{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<be.workerCount;)this.workers.push(new Worker(h.a.WORKER_URL));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.numActive()===0&&(this.workers.forEach((r=>{r.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[Te]}numActive(){return Object.keys(this.active).length}}const Ie=Math.floor(he.hardwareConcurrency/2);let Ue,Ke;function mi(){return Ue||(Ue=new be),Ue}be.workerCount=h.K(globalThis)?Math.max(Math.min(Ie,3),1):1;class dn{constructor(e,r){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=r;const c=this.workerPool.acquire(r);for(let f=0;f<c.length;f++){const g=new h.L(c[f],r);g.name=`Worker ${f}`,this.actors.push(g)}if(!this.actors.length)throw new Error("No actors found")}broadcast(e,r){const c=[];for(const f of this.actors)c.push(f.sendAsync({type:e,data:r}));return Promise.all(c)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(e=!0){this.actors.forEach((r=>{r.remove()})),this.actors=[],e&&this.workerPool.release(this.id)}registerMessageHandler(e,r){for(const c of this.actors)c.registerMessageHandler(e,r)}unregisterMessageHandler(e){for(const r of this.actors)r.unregisterMessageHandler(e)}}function Qe(){return Ke||(Ke=new dn(mi(),h.M),Ke.registerMessageHandler("GR",((m,e,r)=>h.m(e,r)))),Ke}function qe(m,e){const r=h.N();return h.O(r,r,[1,1,0]),h.Q(r,r,[.5*m.width,.5*m.height,1]),m.calculatePosMatrix?h.S(r,r,m.calculatePosMatrix(e.toUnwrapped())):r}function Ki(m,e,r,c,f,g,v){var w;const S=(function(L,j,Z){if(L)for(const W of L){const Q=j[W];if(Q&&Q.source===Z&&Q.type==="fill-extrusion")return!0}else for(const W in j){const Q=j[W];if(Q.source===Z&&Q.type==="fill-extrusion")return!0}return!1})((w=f?.layers)!==null&&w!==void 0?w:null,e,m.id),C=g.maxPitchScaleFactor(),D=m.tilesIn(c,C,S);D.sort(oi);const k=[];for(const L of D)k.push({wrappedTileID:L.tileID.wrapped().key,queryResults:L.tile.queryRenderedFeatures(e,r,m.getState(),L.queryGeometry,L.cameraQueryGeometry,L.scale,f,g,C,qe(g,L.tileID),v?(j,Z)=>v(L.tileID,j,Z):void 0)});return(function(L,j){for(const Z in L)for(const W of L[Z])ia(W,j);return L})((function(L){const j={},Z={};for(const W of L){const Q=W.queryResults,it=W.wrappedTileID,st=Z[it]=Z[it]||{};for(const ht in Q){const at=Q[ht],dt=st[ht]=st[ht]||{},mt=j[ht]=j[ht]||[];for(const ct of at)dt[ct.featureIndex]||(dt[ct.featureIndex]=!0,mt.push(ct))}}return j})(k),m)}function oi(m,e){const r=m.tileID,c=e.tileID;return r.overscaledZ-c.overscaledZ||r.canonical.y-c.canonical.y||r.wrap-c.wrap||r.canonical.x-c.canonical.x}function ia(m,e){const r=m.feature,c=e.getFeatureState(r.layer["source-layer"],r.id);r.source=r.layer.source,r.layer["source-layer"]&&(r.sourceLayer=r.layer["source-layer"]),r.state=c}function xn(m,e,r){return h._(this,void 0,void 0,(function*(){let c=m;if(m.url?c=(yield h.j(e.transformRequest(m.url,"Source"),r)).data:yield he.frameAsync(r),!c)return null;const f=h.U(h.e(c,m),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in c&&c.vector_layers&&(f.vectorLayerIds=c.vector_layers.map((g=>g.id))),f}))}class Di{constructor(e,r){e&&(r?this.setSouthWest(e).setNorthEast(r):Array.isArray(e)&&(e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1])))}setNorthEast(e){return this._ne=e instanceof h.V?new h.V(e.lng,e.lat):h.V.convert(e),this}setSouthWest(e){return this._sw=e instanceof h.V?new h.V(e.lng,e.lat):h.V.convert(e),this}extend(e){const r=this._sw,c=this._ne;let f,g;if(e instanceof h.V)f=e,g=e;else{if(!(e instanceof Di))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(Di.convert(e)):this.extend(h.V.convert(e)):e&&("lng"in e||"lon"in e)&&"lat"in e?this.extend(h.V.convert(e)):this;if(f=e._sw,g=e._ne,!f||!g)return this}return r||c?(r.lng=Math.min(f.lng,r.lng),r.lat=Math.min(f.lat,r.lat),c.lng=Math.max(g.lng,c.lng),c.lat=Math.max(g.lat,c.lat)):(this._sw=new h.V(f.lng,f.lat),this._ne=new h.V(g.lng,g.lat)),this}getCenter(){return new h.V((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new h.V(this.getWest(),this.getNorth())}getSouthEast(){return new h.V(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:r,lat:c}=h.V.convert(e);let f=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(f=this._sw.lng>=r&&r>=this._ne.lng),this._sw.lat<=c&&c<=this._ne.lat&&f}intersects(e){if((e=Di.convert(e)).getNorth()<this.getSouth()||e.getSouth()>this.getNorth())return!1;const r=h.W(this.getWest(),-180,180),c=h.W(this.getEast(),-180,180),f=h.W(e.getWest(),-180,180),g=h.W(e.getEast(),-180,180),v=r>c,w=f>g;return!(!v||!w)||(v?g>=r||f<=c:w?c>=f||r<=g:!(f>c||g<r))}static convert(e){return e instanceof Di?e:e&&new Di(e)}static fromLngLat(e,r=0){const c=360*r/40075017,f=c/Math.cos(Math.PI/180*e.lat);return new Di(new h.V(e.lng-f,e.lat-c),new h.V(e.lng+f,e.lat+c))}adjustAntiMeridian(){const e=new h.V(this._sw.lng,this._sw.lat),r=new h.V(this._ne.lng,this._ne.lat);return new Di(e,e.lng>r.lng?new h.V(r.lng+360,r.lat):r)}}class Cn{constructor(e,r,c){this.bounds=Di.convert(this.validateBounds(e)),this.minzoom=r||0,this.maxzoom=c||24}validateBounds(e){return Array.isArray(e)&&e.length===4?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(e){const r=Math.pow(2,e.z),c=Math.floor(h.Y(this.bounds.getWest())*r),f=Math.floor(h.X(this.bounds.getNorth())*r),g=Math.ceil(h.Y(this.bounds.getEast())*r),v=Math.ceil(h.X(this.bounds.getSouth())*r);return e.x>=c&&e.x<g&&e.y>=f&&e.y<v}}class An extends h.E{constructor(e,r,c,f){if(super(),this.id=e,this.dispatcher=c,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,h.e(this,h.U(r,["url","scheme","tileSize","promoteId","encoding"])),this._options=h.e({type:"vector"},r),this._collectResourceTiming=r.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(f)}load(){return h._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new h.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const e=yield xn(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.tileManagers[this.id].clearTiles(),e&&(h.e(this,e),e.bounds&&(this.tileBounds=new Cn(e.bounds,this.minzoom,this.maxzoom)),this.fire(new h.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new h.l("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this._loaded=!0,this.fire(new h.k(e))}}))}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}setSourceProperty(e){this._tileJSONRequest&&this._tileJSONRequest.abort(),e(),this.load()}setTiles(e){return this.setSourceProperty((()=>{this._options.tiles=e})),this}setUrl(e){return this.setSourceProperty((()=>{this.url=e,this._options.url=e})),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return h.e({},this._options)}loadTile(e){return h._(this,void 0,void 0,(function*(){const r=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),c={request:this.map._requestManager.transformRequest(r,"Tile"),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,encoding:this.encoding,overzoomParameters:this._getOverzoomParameters(e)};c.request.collectResourceTiming=this._collectResourceTiming;let f="RT";if(e.actor&&e.state!=="expired"){if(e.state==="loading")return new Promise(((g,v)=>{e.reloadPromise={resolve:g,reject:v}}))}else e.actor=this.dispatcher.getActor(),f="LT";e.abortController=new AbortController;try{const g=yield e.actor.sendAsync({type:f,data:c},e.abortController);if(delete e.abortController,e.aborted)return;this._afterTileLoadWorkerResponse(e,g)}catch(g){if(delete e.abortController,e.aborted)return;if(g&&g.status!==404)throw g;this._afterTileLoadWorkerResponse(e,null)}}))}_getOverzoomParameters(e){if(e.tileID.canonical.z<=this.maxzoom||this.map._zoomLevelsToOverscale===void 0)return;const r=e.tileID.scaledTo(this.maxzoom).canonical,c=r.url(this.tiles,this.map.getPixelRatio(),this.scheme);return{maxZoomTileID:r,overzoomRequest:this.map._requestManager.transformRequest(c,"Tile")}}_afterTileLoadWorkerResponse(e,r){if(r&&r.resourceTiming&&(e.resourceTiming=r.resourceTiming),r&&this.map._refreshExpiredTiles&&e.setExpiryData(r),e.loadVectorData(r,this.map.painter),e.reloadPromise){const c=e.reloadPromise;e.reloadPromise=null,this.loadTile(e).then(c.resolve).catch(c.reject)}}abortTile(e){return h._(this,void 0,void 0,(function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.actor&&(yield e.actor.sendAsync({type:"AT",data:{uid:e.uid,type:this.type,source:this.id}}))}))}unloadTile(e){return h._(this,void 0,void 0,(function*(){e.unloadVectorData(),e.actor&&(yield e.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}}))}))}hasTransition(){return!1}}class ca extends h.E{constructor(e,r,c,f){super(),this.id=e,this.dispatcher=c,this.setEventedParent(f),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=h.e({type:"raster"},r),h.e(this,h.U(r,["url","scheme","tileSize"]))}load(){return h._(this,arguments,void 0,(function*(e=!1){this._loaded=!1,this.fire(new h.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const r=yield xn(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,r&&(h.e(this,r),r.bounds&&(this.tileBounds=new Cn(r.bounds,this.minzoom,this.maxzoom)),this.fire(new h.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new h.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:e})))}catch(r){this._tileJSONRequest=null,this._loaded=!0,this.fire(new h.k(r))}}))}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(e){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),e(),this.load(!0)}setTiles(e){return this.setSourceProperty((()=>{this._options.tiles=e})),this}setUrl(e){return this.setSourceProperty((()=>{this.url=e,this._options.url=e})),this}serialize(){return h.e({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e){return h._(this,void 0,void 0,(function*(){const r=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);e.abortController=new AbortController;try{const c=yield pe.getImage(this.map._requestManager.transformRequest(r,"Tile"),e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(c&&c.data){this.map._refreshExpiredTiles&&(c.cacheControl||c.expires)&&e.setExpiryData({cacheControl:c.cacheControl,expires:c.expires});const f=this.map.painter.context,g=f.gl,v=c.data;e.texture=this.map.painter.getTileTexture(v.width),e.texture?e.texture.update(v,{useMipmap:!0}):(e.texture=new h.T(f,v,g.RGBA,{useMipmap:!0}),e.texture.bind(g.LINEAR,g.CLAMP_TO_EDGE,g.LINEAR_MIPMAP_NEAREST)),e.state="loaded"}}catch(c){if(delete e.abortController,e.aborted)e.state="unloaded";else if(c)throw e.state="errored",c}}))}abortTile(e){return h._(this,void 0,void 0,(function*(){e.abortController&&(e.abortController.abort(),delete e.abortController)}))}unloadTile(e){return h._(this,void 0,void 0,(function*(){e.texture&&this.map.painter.saveTileTexture(e.texture)}))}hasTransition(){return!1}}class Qi extends ca{constructor(e,r,c,f){super(e,r,c,f),this.type="raster-dem",this.maxzoom=22,this._options=h.e({type:"raster-dem"},r),this.encoding=r.encoding||"mapbox",this.redFactor=r.redFactor,this.greenFactor=r.greenFactor,this.blueFactor=r.blueFactor,this.baseShift=r.baseShift}loadTile(e){return h._(this,void 0,void 0,(function*(){const r=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),c=this.map._requestManager.transformRequest(r,"Tile");e.neighboringTiles=this._getNeighboringTiles(e.tileID),e.abortController=new AbortController;try{const f=yield pe.getImage(c,e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(f&&f.data){const g=f.data;this.map._refreshExpiredTiles&&(f.cacheControl||f.expires)&&e.setExpiryData({cacheControl:f.cacheControl,expires:f.expires});const v=h.b(g)&&h.Z()?g:yield this.readImageNow(g),w={type:this.type,uid:e.uid,source:this.id,rawImageData:v,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!e.actor||e.state==="expired"){e.actor=this.dispatcher.getActor();const S=yield e.actor.sendAsync({type:"LDT",data:w});e.dem=S,e.needsHillshadePrepare=!0,e.needsTerrainPrepare=!0,e.state="loaded"}}}catch(f){if(delete e.abortController,e.aborted)e.state="unloaded";else if(f)throw e.state="errored",f}}))}readImageNow(e){return h._(this,void 0,void 0,(function*(){if(typeof VideoFrame<"u"&&h.$()){const r=e.width+2,c=e.height+2;try{return new h.R({width:r,height:c},yield h.a0(e,-1,-1,r,c))}catch{}}return he.getImageData(e,1)}))}_getNeighboringTiles(e){const r=e.canonical,c=Math.pow(2,r.z),f=(r.x-1+c)%c,g=r.x===0?e.wrap-1:e.wrap,v=(r.x+1+c)%c,w=r.x+1===c?e.wrap+1:e.wrap,S={};return S[new h.a1(e.overscaledZ,g,r.z,f,r.y).key]={backfilled:!1},S[new h.a1(e.overscaledZ,w,r.z,v,r.y).key]={backfilled:!1},r.y>0&&(S[new h.a1(e.overscaledZ,g,r.z,f,r.y-1).key]={backfilled:!1},S[new h.a1(e.overscaledZ,e.wrap,r.z,r.x,r.y-1).key]={backfilled:!1},S[new h.a1(e.overscaledZ,w,r.z,v,r.y-1).key]={backfilled:!1}),r.y+1<c&&(S[new h.a1(e.overscaledZ,g,r.z,f,r.y+1).key]={backfilled:!1},S[new h.a1(e.overscaledZ,e.wrap,r.z,r.x,r.y+1).key]={backfilled:!1},S[new h.a1(e.overscaledZ,w,r.z,v,r.y+1).key]={backfilled:!1}),S}unloadTile(e){return h._(this,void 0,void 0,(function*(){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.fbo&&(e.fbo.destroy(),delete e.fbo),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded",e.actor&&(yield e.actor.sendAsync({type:"RDT",data:{type:this.type,uid:e.uid,source:this.id}}))}))}}function fn(m){return m.type==="GeometryCollection"?m.geometries.map((e=>e.coordinates)).flat(1/0):m.coordinates.flat(1/0)}function xa(m){const e=new Di;let r;switch(m.type){case"FeatureCollection":r=m.features.map((c=>fn(c.geometry))).flat(1/0);break;case"Feature":r=fn(m.geometry);break;default:r=fn(m)}if(r.length==0)return e;for(let c=0;c<r.length-1;c+=2)e.extend([r[c],r[c+1]]);return e}class qi extends h.E{constructor(e,r,c,f){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._isUpdatingWorker=!1,this._pendingWorkerUpdate={data:r.data},this.actor=c.getActor(),this.setEventedParent(f),this._data=typeof r.data=="string"?{url:r.data}:{geojson:r.data},this._options=h.e({},r),this._collectResourceTiming=r.collectResourceTiming,r.maxzoom!==void 0&&(this.maxzoom=r.maxzoom),r.type&&(this.type=r.type),r.attribution&&(this.attribution=r.attribution),this.promoteId=r.promoteId,r.clusterMaxZoom!==void 0&&this.maxzoom<=r.clusterMaxZoom&&h.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${r.clusterMaxZoom}".`),this.workerOptions=h.e({source:this.id,cluster:r.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(r.buffer!==void 0?r.buffer:128),tolerance:this._pixelsToTileUnits(r.tolerance!==void 0?r.tolerance:.375),extent:h.a4,maxZoom:this.maxzoom,lineMetrics:r.lineMetrics||!1,generateId:r.generateId||!1},superclusterOptions:{maxZoom:this._getClusterMaxZoom(r.clusterMaxZoom),minPoints:Math.max(2,r.clusterMinPoints||2),extent:h.a4,radius:this._pixelsToTileUnits(r.clusterRadius||50),log:!1,generateId:r.generateId||!1},clusterProperties:r.clusterProperties,filter:r.filter},r.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_hasPendingWorkerUpdate(){return this._pendingWorkerUpdate.data!==void 0||this._pendingWorkerUpdate.diff!==void 0||this._pendingWorkerUpdate.optionsChanged}_pixelsToTileUnits(e){return e*(h.a4/this.tileSize)}_getClusterMaxZoom(e){const r=e?Math.round(e):this.maxzoom-1;return Number.isInteger(e)||e===void 0||h.w(`Integer expected for option 'clusterMaxZoom': provided value "${e}" rounded to "${r}"`),r}load(){return h._(this,void 0,void 0,(function*(){yield this._updateWorkerData()}))}onAdd(e){this.map=e,this.load()}setData(e,r){this._data=typeof e=="string"?{url:e}:{geojson:e},this._pendingWorkerUpdate={data:e};const c=this._updateWorkerData();return r?c:this}updateData(e,r){this._pendingWorkerUpdate.diff=h.a5(this._pendingWorkerUpdate.diff,e);const c=this._updateWorkerData();return r?c:this}getData(){return h._(this,void 0,void 0,(function*(){const e=h.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:e})}))}getBounds(){return h._(this,void 0,void 0,(function*(){return xa(yield this.getData())}))}setClusterOptions(e){return this.workerOptions.cluster=e.cluster,e.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(e.clusterRadius)),e.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=this._getClusterMaxZoom(e.clusterMaxZoom)),this._pendingWorkerUpdate.optionsChanged=!0,this._updateWorkerData(),this}getClusterExpansionZoom(e){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:e,source:this.id}})}getClusterChildren(e){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:e,source:this.id}})}getClusterLeaves(e,r,c){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:e,limit:r,offset:c}})}_updateWorkerData(){return h._(this,void 0,void 0,(function*(){if(this._isUpdatingWorker)return;if(!this._hasPendingWorkerUpdate())return void h.w(`No pending worker updates for GeoJSONSource ${this.id}.`);const{data:e,diff:r}=this._pendingWorkerUpdate,c=h.e({type:this.type},this.workerOptions);e?(typeof e=="string"?(c.request=this.map._requestManager.transformRequest(he.resolveURL(e),"Source"),c.request.collectResourceTiming=this._collectResourceTiming):c.data=e,this._pendingWorkerUpdate.data=void 0):r&&(c.dataDiff=r,this._pendingWorkerUpdate.diff=void 0),this._pendingWorkerUpdate.optionsChanged=void 0,this._isUpdatingWorker=!0,this.fire(new h.l("dataloading",{dataType:"source"}));try{const f=yield this.actor.sendAsync({type:"LD",data:c});if(this._isUpdatingWorker=!1,this._removed||f.abandoned)return void this.fire(new h.l("dataabort",{dataType:"source"}));f.applyDiff?this._applyDiff(r):this._data={geojson:f.data};let g=null;f.resourceTiming&&f.resourceTiming[this.id]&&(g=f.resourceTiming[this.id].slice(0));const v={dataType:"source"};this._collectResourceTiming&&g&&g.length>0&&h.e(v,{resourceTiming:g}),this.fire(new h.l("data",Object.assign(Object.assign({},v),{sourceDataType:"metadata"}))),this.fire(new h.l("data",Object.assign(Object.assign({},v),{sourceDataType:"content",shouldReloadTileOptions:this._getShouldReloadTileOptions(r)})))}catch(f){if(this._isUpdatingWorker=!1,this._removed)return void this.fire(new h.l("dataabort",{dataType:"source"}));this.fire(new h.k(f))}finally{this._hasPendingWorkerUpdate()&&this._updateWorkerData()}}))}_applyDiff(e){const r=typeof this.promoteId=="string"?this.promoteId:void 0;this._data.url||this._data.updateable||!h.a6(this._data.geojson,r)||(this._data={updateable:h.a7(this._data.geojson,r)}),e&&this._data.updateable?h.a8(this._data.updateable,e,r):h.w("Cannot apply GeoJSONSource#updateData due to internal error")}_getShouldReloadTileOptions(e){if(this._options.cluster||!e||e.removeAll)return;const{add:r=[],update:c=[],remove:f=[]}=e||{},g=new Set([...c.map((v=>v.id)),...f]);for(const v of g.values())if(typeof v!="number"&&this.promoteId==null)return void h.w(`GeoJSONSource "${this.id}": updateData is slower when using string GeoJSON feature IDs (e.g. "${v}"). Consider using promoteId or numeric IDs for better performance.`);return{nextBounds:[...c.map((v=>v.newGeometry)),...r.map((v=>v.geometry))].filter(Boolean).map((v=>xa(v))),prevIds:g}}shouldReloadTile(e,{nextBounds:r,prevIds:c}){if(!e.latestFeatureIndex)return e.state!=="unloaded";const f=e.latestFeatureIndex.loadVTLayers();for(let S=0;S<e.latestFeatureIndex.featureIndexArray.length;S++){const C=e.latestFeatureIndex.featureIndexArray.get(S),D=f[h.a9].feature(C.featureIndex),k=e.latestFeatureIndex.getId(D,h.a9);if(c.has(k))return!0}const{buffer:g,extent:v}=this.workerOptions.geojsonVtOptions,w=(function({x:S,y:C,z:D},k=0){const L=h.a2((S-k)/Math.pow(2,D)),j=h.a3((C+1+k)/Math.pow(2,D)),Z=h.a2((S+1+k)/Math.pow(2,D)),W=h.a3((C-k)/Math.pow(2,D));return new Di([L,j],[Z,W])})(e.tileID.canonical,g/v);for(const S of r)if(w.intersects(S))return!0;return!1}loaded(){return!this._isUpdatingWorker&&!this._hasPendingWorkerUpdate()}loadTile(e){return h._(this,void 0,void 0,(function*(){const r=e.actor?"RT":"LT";e.actor=this.actor;const c={type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};e.abortController=new AbortController;const f=yield this.actor.sendAsync({type:r,data:c},e.abortController);delete e.abortController,e.unloadVectorData(),e.aborted||e.loadVectorData(f,this.map.painter,r==="RT")}))}abortTile(e){return h._(this,void 0,void 0,(function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.aborted=!0}))}unloadTile(e){return h._(this,void 0,void 0,(function*(){e.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}})}))}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return h.e({},this._options,{type:this.type,data:this._data.updateable?{type:"FeatureCollection",features:Array.from(this._data.updateable.values())}:this._data.url||this._data.geojson})}hasTransition(){return!1}}class bn extends h.E{constructor(e,r,c,f){super(),this.flippedWindingOrder=!1,this.id=e,this.dispatcher=c,this.coordinates=r.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(f),this.options=r}load(e){return h._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new h.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const r=yield pe.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,r&&r.data&&(this.image=r.data,e&&(this.coordinates=e),this._finishLoading())}catch(r){this._request=null,this._loaded=!0,this.fire(new h.k(r))}}))}loaded(){return this._loaded}updateImage(e){return e.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=e.url,this.load(e.coordinates).finally((()=>{this.texture=null})),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new h.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(e){this.coordinates=e;const r=e.map(h.aa.fromLngLat);var c;return this.tileID=(function(f){const g=h.ab.fromPoints(f),v=g.width(),w=g.height(),S=Math.max(v,w),C=Math.max(0,Math.floor(-Math.log(S)/Math.LN2)),D=Math.pow(2,C);return new h.ad(C,Math.floor((g.minX+g.maxX)/2*D),Math.floor((g.minY+g.maxY)/2*D))})(r),this.terrainTileRanges=this._getOverlappingTileRanges(r),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=r.map((f=>this.tileID.getTilePoint(f)._round())),this.flippedWindingOrder=((c=this.tileCoords)[1].x-c[0].x)*(c[2].y-c[0].y)-(c[1].y-c[0].y)*(c[2].x-c[0].x)<0,this.fire(new h.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const e=this.map.painter.context,r=e.gl;this.texture||(this.texture=new h.T(e,this.image,r.RGBA),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE));let c=!1;for(const f in this.tiles){const g=this.tiles[f];g.state!=="loaded"&&(g.state="loaded",g.texture=this.texture,c=!0)}c&&this.fire(new h.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(e){return h._(this,void 0,void 0,(function*(){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={}):e.state="errored"}))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}_getOverlappingTileRanges(e){const{minX:r,minY:c,maxX:f,maxY:g}=h.ab.fromPoints(e),v={};for(let w=0;w<=h.ac;w++){const S=Math.pow(2,w),C=Math.floor(r*S),D=Math.floor(c*S),k=Math.floor(f*S),L=Math.floor(g*S);v[w]={minTileX:C,minTileY:D,maxTileX:k,maxTileY:L}}return v}}class Io extends bn{constructor(e,r,c,f){super(e,r,c,f),this.roundZoom=!0,this.type="video",this.options=r}load(){return h._(this,void 0,void 0,(function*(){this._loaded=!1;const e=this.options;this.urls=[];for(const r of e.urls)this.urls.push(this.map._requestManager.transformRequest(r,"Source").url);try{const r=yield h.ae(this.urls);if(this._loaded=!0,!r)return;this.video=r,this.video.loop=!0,this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading()}catch(r){this.fire(new h.k(r))}}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){const r=this.video.seekable;e<r.start(0)||e>r.end(0)?this.fire(new h.k(new h.af(`sources.${this.id}`,null,`Playback for this video can be set only between the ${r.start(0)} and ${r.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const e=this.map.painter.context,r=e.gl;this.texture?this.video.paused||(this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),r.texSubImage2D(r.TEXTURE_2D,0,0,0,r.RGBA,r.UNSIGNED_BYTE,this.video)):(this.texture=new h.T(e,this.video,r.RGBA),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE));let c=!1;for(const f in this.tiles){const g=this.tiles[f];g.state!=="loaded"&&(g.state="loaded",g.texture=this.texture,c=!0)}c&&this.fire(new h.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Sl extends bn{constructor(e,r,c,f){super(e,r,c,f),r.coordinates?Array.isArray(r.coordinates)&&r.coordinates.length===4&&!r.coordinates.some((g=>!Array.isArray(g)||g.length!==2||g.some((v=>typeof v!="number"))))||this.fire(new h.k(new h.af(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new h.k(new h.af(`sources.${e}`,null,'missing required property "coordinates"'))),r.animate&&typeof r.animate!="boolean"&&this.fire(new h.k(new h.af(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),r.canvas?typeof r.canvas=="string"||r.canvas instanceof HTMLCanvasElement||this.fire(new h.k(new h.af(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new h.k(new h.af(`sources.${e}`,null,'missing required property "canvas"'))),this.options=r,this.animate=r.animate===void 0||r.animate}load(){return h._(this,void 0,void 0,(function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new h.k(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}))}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const r=this.map.painter.context,c=r.gl;this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new h.T(r,this.canvas,c.RGBA,{premultiply:!0});let f=!1;for(const g in this.tiles){const v=this.tiles[g];v.state!=="loaded"&&(v.state="loaded",v.texture=this.texture,f=!0)}f&&this.fire(new h.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",animate:this.animate,canvas:this.options.canvas,coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}}const Wr={},El=m=>{switch(m){case"geojson":return qi;case"image":return bn;case"raster":return ca;case"raster-dem":return Qi;case"vector":return An;case"video":return Io;case"canvas":return Sl}return Wr[m]},Ts="RTLPluginLoaded";class Ml extends h.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=Qe()}_syncState(e){return this.status=e,this.dispatcher.broadcast("SRPS",{pluginStatus:e,pluginURL:this.url}).catch((r=>{throw this.status="error",r}))}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(e){return h._(this,arguments,void 0,(function*(r,c=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=he.resolveURL(r),!this.url)throw new Error(`requested url ${r} is invalid`);if(this.status==="unavailable"){if(!c)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()}))}_requestImport(){return h._(this,void 0,void 0,(function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new h.l(Ts))}))}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Ro=null;function za(){return Ro||(Ro=new Ml),Ro}var Ji,pt;(function(m){m[m.Base=0]="Base",m[m.Parent=1]="Parent"})(Ji||(Ji={})),(function(m){m[m.Departing=0]="Departing",m[m.Incoming=1]="Incoming"})(pt||(pt={}));class F{constructor(e,r){this.timeAdded=0,this.fadeEndTime=0,this.fadeOpacity=1,this.tileID=e,this.uid=h.ag(),this.uses=0,this.tileSize=r,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}isRenderable(e){return this.hasData()&&(!this.fadeEndTime||this.fadeOpacity>0)&&(e||!this.holdingForSymbolFade())}setCrossFadeLogic({fadingRole:e,fadingDirection:r,fadingParentID:c,fadeEndTime:f}){this.resetFadeLogic(),this.fadingRole=e,this.fadingDirection=r,this.fadingParentID=c,this.fadeEndTime=f}setSelfFadeLogic(e){this.resetFadeLogic(),this.selfFading=!0,this.fadeEndTime=e}resetFadeLogic(){this.fadingRole=null,this.fadingDirection=null,this.fadingParentID=null,this.selfFading=!1,this.timeAdded=Kt(),this.fadeEndTime=0,this.fadeOpacity=1}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(e){this.demTexture&&e.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(e,r,c){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData,this.latestFeatureIndex.encoding=e.encoding):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData,this.latestFeatureIndex.encoding=this.latestEncoding)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=(function(f,g){const v={};if(!g)return v;for(const w of f){const S=w.layerIds.map((C=>g.getLayer(C))).filter(Boolean);if(S.length!==0){w.layers=S,w.stateDependentLayerIds&&(w.stateDependentLayers=w.stateDependentLayerIds.map((C=>S.filter((D=>D.id===C))[0])));for(const C of S)v[C.id]=w}}return v})(e.buckets,r?.style),this.hasSymbolBuckets=!1;for(const f in this.buckets){const g=this.buckets[f];if(g instanceof h.ai){if(this.hasSymbolBuckets=!0,!c)break;g.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const f in this.buckets){const g=this.buckets[f];if(g instanceof h.ai&&g.hasRTLText){this.hasRTLText=!0,za().lazyLoad();break}}this.queryPadding=0;for(const f in this.buckets){const g=this.buckets[f];this.queryPadding=Math.max(this.queryPadding,r.style.getLayer(f).queryRadius(g))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),this.dashPositions=e.dashPositions}else this.collisionBoxArray=new h.ah}unloadVectorData(){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.dashPositions&&(this.dashPositions=null),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(e){return this.buckets[e.id]}upload(e){for(const c in this.buckets){const f=this.buckets[c];f.uploadPending()&&f.upload(e)}const r=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new h.T(e,this.imageAtlas.image,r.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new h.T(e,this.glyphAtlasImage,r.ALPHA),this.glyphAtlasImage=null)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,r,c,f,g,v,w,S,C,D,k){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:f,cameraQueryGeometry:g,scale:v,tileSize:this.tileSize,pixelPosMatrix:D,transform:S,params:w,queryPadding:this.queryPadding*C,getElevation:k},e,r,c):{}}querySourceFeatures(e,r){const c=this.latestFeatureIndex;if(!c||!c.rawTileData)return;const f=c.loadVTLayers(),g=r&&r.sourceLayer?r.sourceLayer:"",v=f[h.a9]||f[g];if(!v)return;const w=h.aj(r?.filter,r?.globalState),{z:S,x:C,y:D}=this.tileID.canonical,k={z:S,x:C,y:D};for(let L=0;L<v.length;L++){const j=v.feature(L);if(w.needGeometry){const Q=h.ak(j,!0);if(!w.filter(new h.H(this.tileID.overscaledZ),Q,this.tileID.canonical))continue}else if(!w.filter(new h.H(this.tileID.overscaledZ),j))continue;const Z=c.getId(j,g),W=new h.al(j,S,C,D,Z);W.tile=k,e.push(W)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const r=this.expirationTime;if(e.cacheControl){const c=h.am(e.cacheControl);c["max-age"]&&(this.expirationTime=Date.now()+1e3*c["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const c=Date.now();let f=!1;if(this.expirationTime>c)f=!1;else if(r)if(this.expirationTime<r)f=!0;else{const g=this.expirationTime-r;g?this.expirationTime=c+Math.max(g,3e4):f=!0}else f=!0;f?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,r){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0)return;const c=this.latestFeatureIndex.loadVTLayers();for(const f in this.buckets){if(!r.style.hasLayer(f))continue;const g=this.buckets[f],v=g.layers[0].sourceLayer||h.a9,w=c[v],S=e[v];if(!w||!S||Object.keys(S).length===0)continue;g.update(S,w,this.imageAtlas&&this.imageAtlas.patternPositions||{},this.dashPositions||{});const C=r&&r.style&&r.style.getLayer(f);C&&(this.queryPadding=Math.max(this.queryPadding,C.queryRadius(g)))}}holdingForSymbolFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Kt()}clearSymbolFadeHold(){this.symbolFadeHoldUntil=void 0}setSymbolHoldDuration(e){this.symbolFadeHoldUntil=Kt()+e}setDependencies(e,r){const c={};for(const f of r)c[f]=!0;this.dependencies[e]=c}hasDependency(e,r){for(const c of e){const f=this.dependencies[c];if(f){for(const g of r)if(f[g])return!0}}return!1}}class G{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,r,c){const f=String(r);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][f]=this.stateChanges[e][f]||{},h.e(this.stateChanges[e][f],c),this.deletedStates[e]===null){this.deletedStates[e]={};for(const g in this.state[e])g!==f&&(this.deletedStates[e][g]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][f]===null){this.deletedStates[e][f]={};for(const g in this.state[e][f])c[g]||(this.deletedStates[e][f][g]=null)}else for(const g in c)this.deletedStates[e]&&this.deletedStates[e][f]&&this.deletedStates[e][f][g]===null&&delete this.deletedStates[e][f][g]}removeFeatureState(e,r,c){if(this.deletedStates[e]===null)return;const f=String(r);if(this.deletedStates[e]=this.deletedStates[e]||{},c&&r!==void 0)this.deletedStates[e][f]!==null&&(this.deletedStates[e][f]=this.deletedStates[e][f]||{},this.deletedStates[e][f][c]=null);else if(r!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][f])for(c in this.deletedStates[e][f]={},this.stateChanges[e][f])this.deletedStates[e][f][c]=null;else this.deletedStates[e][f]=null;else this.deletedStates[e]=null}getState(e,r){const c=String(r),f=h.e({},(this.state[e]||{})[c],(this.stateChanges[e]||{})[c]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const g=this.deletedStates[e][r];if(g===null)return{};for(const v in g)delete f[v]}return f}initializeTileState(e,r){e.setFeatureState(this.state,r)}coalesceChanges(e,r){const c={};for(const f in this.stateChanges){this.state[f]=this.state[f]||{};const g={};for(const v in this.stateChanges[f])this.state[f][v]||(this.state[f][v]={}),h.e(this.state[f][v],this.stateChanges[f][v]),g[v]=this.state[f][v];c[f]=g}for(const f in this.deletedStates){this.state[f]=this.state[f]||{};const g={};if(this.deletedStates[f]===null)for(const v in this.state[f])g[v]={},this.state[f][v]={};else for(const v in this.deletedStates[f]){if(this.deletedStates[f][v]===null)this.state[f][v]={};else for(const w of Object.keys(this.deletedStates[f][v]))delete this.state[f][v][w];g[v]=this.state[f][v]}c[f]=c[f]||{},h.e(c[f],g)}if(this.stateChanges={},this.deletedStates={},Object.keys(c).length!==0)for(const f in e)e[f].setFeatureState(c,r)}}const H=89.25;function ot(m,e){const r=h.an(e.lat,-h.ao,h.ao);return new h.P(h.Y(e.lng)*m,h.X(r)*m)}function ut(m,e){return new h.aa(e.x/m,e.y/m).toLngLat()}function Et(m){return m.cameraToCenterDistance*Math.min(.85*Math.tan(h.ap(90-m.pitch)),Math.tan(h.ap(H-m.pitch)))}function J(m,e){const r=m.canonical,c=e/h.aq(r.z),f=r.x+Math.pow(2,r.z)*m.wrap,g=h.ar(new Float64Array(16));return h.O(g,g,[f*c,r.y*c,0]),h.Q(g,g,[c/h.a4,c/h.a4,1]),g}function wt(m,e,r,c,f){const g=h.aa.fromLngLat(m,e),v=f*h.as(1,m.lat),w=v*Math.cos(h.ap(r)),S=Math.sqrt(v*v-w*w),C=S*Math.sin(h.ap(-c)),D=S*Math.cos(h.ap(-c));return new h.aa(g.x+C,g.y+D,g.z+w)}function Nt(m,e,r){const c=e.intersectsFrustum(m);if(!r||c===0)return c;const f=e.intersectsPlane(r);return f===0?0:c===2&&f===2?2:1}function jt(m,e,r){let c=0;const f=(r-e)/10;for(let g=0;g<10;g++)c+=f*Math.pow(Math.cos(e+(g+.5)/10*(r-e)),m);return c}function Ut(m,e){return function(r,c,f,g,v){const w=2*((m-1)/h.at(Math.cos(h.ap(H-v))/Math.cos(h.ap(H)))-1),S=Math.acos(f/g),C=2*jt(w-1,0,h.ap(v/2)),D=Math.min(h.ap(H),S+h.ap(v/2)),k=jt(w-1,Math.min(D,S-h.ap(v/2)),D),L=Math.atan(c/f),j=Math.hypot(c,f);let Z=r;return Z+=h.at(g/j/Math.max(.5,Math.cos(h.ap(v/2)))),Z+=w*h.at(Math.cos(L))/2,Z-=h.at(Math.max(1,k/C/e))/2,Z}}const ye=Ut(9.314,3);function Ce(m,e){const r=(e.roundZoom?Math.round:Math.floor)(m.zoom+h.at(m.tileSize/e.tileSize));return Math.max(0,r)}function je(m,e){const r=m.getCameraFrustum(),c=m.getClippingPlane(),f=m.screenPointToMercatorCoordinate(m.getCameraPoint()),g=h.aa.fromLngLat(m.center,m.elevation);f.z=g.z+Math.cos(m.pitchInRadians)*m.cameraToCenterDistance/m.worldSize;const v=m.getCoveringTilesDetailsProvider(),w=v.allowVariableZoom(m,e),S=Ce(m,e),C=e.minzoom||0,D=e.maxzoom!==void 0?e.maxzoom:m.maxZoom,k=Math.min(Math.max(0,S),D),L=Math.pow(2,k),j=[L*f.x,L*f.y,0],Z=[L*g.x,L*g.y,0],W=Math.hypot(g.x-f.x,g.y-f.y),Q=Math.abs(g.z-f.z),it=Math.hypot(W,Q),st=dt=>({zoom:0,x:0,y:0,wrap:dt,fullyVisible:!1}),ht=[],at=[];if(m.renderWorldCopies&&v.allowWorldCopies())for(let dt=1;dt<=3;dt++)ht.push(st(-dt)),ht.push(st(dt));for(ht.push(st(0));ht.length>0;){const dt=ht.pop(),mt=dt.x,ct=dt.y;let Tt=dt.fullyVisible;const kt={x:mt,y:ct,z:dt.zoom},zt=v.getTileBoundingVolume(kt,dt.wrap,m.elevation,e);if(!Tt){const re=Nt(r,zt,c);if(re===0)continue;Tt=re===2}const It=v.distanceToTile2d(f.x,f.y,kt,zt);let Rt=S;w&&(Rt=(e.calculateTileZoom||ye)(m.zoom+h.at(m.tileSize/e.tileSize),It,Q,it,m.fov)),Rt=(e.roundZoom?Math.round:Math.floor)(Rt),Rt=Math.max(0,Rt);const ae=Math.min(Rt,D);if(dt.wrap=v.getWrap(g,kt,dt.wrap),dt.zoom>=ae){if(dt.zoom<C)continue;const re=k-dt.zoom,Xt=j[0]-.5-(mt<<re),ve=j[1]-.5-(ct<<re),Ge=e.reparseOverscaled?Math.max(dt.zoom,Rt):dt.zoom;at.push({tileID:new h.a1(dt.zoom===D?Ge:dt.zoom,dt.wrap,dt.zoom,mt,ct),distanceSq:h.au([Z[0]-.5-mt,Z[1]-.5-ct]),tileDistanceToCamera:Math.sqrt(Xt*Xt+ve*ve)})}else for(let re=0;re<4;re++)ht.push({zoom:dt.zoom+1,x:(mt<<1)+re%2,y:(ct<<1)+(re>>1),wrap:dt.wrap,fullyVisible:Tt})}return at.sort(((dt,mt)=>dt.distanceSq-mt.distanceSq)).map((dt=>dt.tileID))}const pn=h.ab.fromPoints([new h.P(0,0),new h.P(h.a4,h.a4)]);class Je extends h.E{constructor(e,r,c){super(),this.id=e,this.dispatcher=c,this.on("data",(f=>this._dataHandler(f))),this.on("dataloading",(()=>{this._sourceErrored=!1})),this.on("error",(()=>{this._sourceErrored=this._source.loaded()})),this._source=((f,g,v,w)=>{const S=new(El(g.type))(f,g,v,w);if(S.id!==f)throw new Error(`Expected Source id to be ${f} instead of ${S.id}`);return S})(e,r,c,this),this._tiles={},this._cache=new h.av(0,(f=>this._unloadTile(f))),this._timers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._rasterFadeDuration=0,this._maxFadingAncestorLevels=5,this._state=new G,this._didEmitContent=!1,this._updated=!1}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null,this._maxTileCacheZoomLevels=e?e._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(e)}onRemove(e){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(e)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const e in this._tiles){const r=this._tiles[e];if(r.state!=="loaded"&&r.state!=="errored")return!1}return!0}getSource(){return this._source}getState(){return this._state}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(e,r,c){return h._(this,void 0,void 0,(function*(){try{yield this._source.loadTile(e),this._tileLoaded(e,r,c)}catch(f){e.state="errored",f.status!==404?this._source.fire(new h.k(f,{tile:e})):this.update(this.transform,this.terrain)}}))}_unloadTile(e){this._source.unloadTile&&this._source.unloadTile(e)}_abortTile(e){this._source.abortTile&&this._source.abortTile(e),this._source.fire(new h.l("dataabort",{tile:e,coord:e.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const r in this._tiles){const c=this._tiles[r];c.upload(e),c.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map((e=>e.tileID)).sort(yi).map((e=>e.key))}getRenderableIds(e){const r=[];for(const c in this._tiles)this._isIdRenderable(c,e)&&r.push(this._tiles[c]);return e?r.sort(((c,f)=>{const g=c.tileID,v=f.tileID,w=new h.P(g.canonical.x,g.canonical.y)._rotate(-this.transform.bearingInRadians),S=new h.P(v.canonical.x,v.canonical.y)._rotate(-this.transform.bearingInRadians);return g.overscaledZ-v.overscaledZ||S.y-w.y||S.x-w.x})).map((c=>c.tileID.key)):r.map((c=>c.tileID)).sort(yi).map((c=>c.key))}hasRenderableParent(e){const r=e.overscaledZ-1;if(r>=this._source.minzoom){const c=this.getLoadedTile(e.scaledTo(r));if(c)return this._isIdRenderable(c.tileID.key)}return!1}_isIdRenderable(e,r=!1){var c;return(c=this._tiles[e])===null||c===void 0?void 0:c.isRenderable(r)}reload(e,r=void 0){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const c in this._tiles)r&&this._source.shouldReloadTile&&!this._source.shouldReloadTile(this._tiles[c],r)||(e?this._reloadTile(c,"expired"):this._tiles[c].state!=="errored"&&this._reloadTile(c,"reloading"))}}_reloadTile(e,r){return h._(this,void 0,void 0,(function*(){const c=this._tiles[e];c&&(c.state!=="loading"&&(c.state=r),yield this._loadTile(c,e,r))}))}_tileLoaded(e,r,c){e.timeAdded=Kt(),e.selfFading&&(e.fadeEndTime=e.timeAdded+this._rasterFadeDuration),c==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(r,e),this.getSource().type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),e.aborted||this._source.fire(new h.l("data",{dataType:"source",tile:e,coord:e.tileID}))}_backfillDEM(e){const r=this.getRenderableIds();for(let f=0;f<r.length;f++){const g=r[f];if(e.neighboringTiles&&e.neighboringTiles[g]){const v=this.getTileByID(g);c(e,v),c(v,e)}}function c(f,g){f.needsHillshadePrepare=!0,f.needsTerrainPrepare=!0;let v=g.tileID.canonical.x-f.tileID.canonical.x;const w=g.tileID.canonical.y-f.tileID.canonical.y,S=Math.pow(2,f.tileID.canonical.z),C=g.tileID.key;v===0&&w===0||Math.abs(w)>1||(Math.abs(v)>1&&(Math.abs(v+S)===1?v+=S:Math.abs(v-S)===1&&(v-=S)),g.dem&&f.dem&&(f.dem.backfillBorder(g.dem,v,w),f.neighboringTiles&&f.neighboringTiles[C]&&(f.neighboringTiles[C].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,r){const c=this._getLoadedDescendents(r),f=new Set;for(const g of r){const v=c[g.key];if(!v?.length){f.add(g);continue}const w=g.overscaledZ+Je.maxOverzooming,S=v.filter((k=>k.tileID.overscaledZ<=w));if(!S.length){f.add(g);continue}const C=Math.min(...S.map((k=>k.tileID.overscaledZ))),D=S.filter((k=>k.tileID.overscaledZ===C)).map((k=>k.tileID));for(const k of D)e[k.key]=k;this._areDescendentsComplete(D,C,g.overscaledZ)||f.add(g)}return f}_getLoadedDescendents(e){var r;const c={};for(const f in this._tiles){const g=this._tiles[f];if(g.hasData())for(const v of e)g.tileID.isChildOf(v)&&(c[r=v.key]||(c[r]=[])).push(g)}return c}_areDescendentsComplete(e,r,c){return e.length===1&&e[0].isOverscaled()?e[0].overscaledZ===r:Math.pow(4,r-c)===e.length}getLoadedTile(e){const r=this._tiles[e.key];return r?.hasData()?r:null}updateCacheSize(e){const r=Math.ceil(e.width/this._source.tileSize)+1,c=Math.ceil(e.height/this._source.tileSize)+1,f=Math.floor(r*c*(this._maxTileCacheZoomLevels===null?h.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),g=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,f):f;this._cache.setMaxSize(g)}handleWrapJump(e){const r=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,r){const c={};for(const f in this._tiles){const g=this._tiles[f];g.tileID=g.tileID.unwrapTo(g.tileID.wrap+r),c[g.tileID.key]=g}this._tiles=c,this._resetTileReloadTimers()}}update(e,r){if(!this._sourceLoaded||this._paused)return;let c;this.transform=e,this.terrain=r,this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this.used||this.usedForTerrain?this._source.tileID?c=e.getVisibleUnwrappedCoordinates(this._source.tileID).map((S=>new h.a1(S.canonical.z,S.wrap,S.canonical.z,S.canonical.x,S.canonical.y))):(c=je(e,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.type==="vector"&&this.map._zoomLevelsToOverscale!==void 0?e.maxZoom-this.map._zoomLevelsToOverscale:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:r,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(c=c.filter((S=>this._source.hasTile(S))))):c=[],this.usedForTerrain&&(c=this._addTerrainIdealTiles(c));const f=c.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,f&&this.fire(new h.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const g=Ce(e,this._source),v=this._updateRetainedTiles(c,g),w=Li(this._source.type);w&&this._rasterFadeDuration>0&&!r&&this._updateFadingTiles(c,v),w?this._cleanUpRasterTiles(v):this._cleanUpVectorTiles(v)}_cleanUpRasterTiles(e){for(const r in this._tiles)e[r]||this._removeTile(r)}_cleanUpVectorTiles(e){for(const r in this._tiles){const c=this._tiles[r];e[r]?c.clearSymbolFadeHold():c.hasSymbolBuckets?c.holdingForSymbolFade()?c.symbolFadeFinished()&&this._removeTile(r):c.setSymbolHoldDuration(this.map._fadeDuration):this._removeTile(r)}}_addTerrainIdealTiles(e){const r=[];for(const c of e)if(c.canonical.z>this._source.minzoom){const f=c.scaledTo(c.canonical.z-1);r.push(f);const g=c.scaledTo(Math.max(this._source.minzoom,Math.min(c.canonical.z,5)));r.push(g)}return e.concat(r)}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForSymbolFade()&&this._removeTile(e)}_updateRetainedTiles(e,r){var c;const f=new Set;for(const C of e)this._addTile(C).hasData()||f.add(C);const g=e.reduce(((C,D)=>(C[D.key]=D,C)),{}),v=this._retainLoadedChildren(g,f),w={},S=Math.max(r-Je.maxUnderzooming,this._source.minzoom);for(const C of v){let D=this._tiles[C.key],k=D?.wasRequested();for(let L=C.overscaledZ-1;L>=S;--L){const j=C.scaledTo(L);if(w[j.key])break;if(w[j.key]=!0,D=this.getTile(j),!D&&k&&(D=this._addTile(j)),D){const Z=D.hasData();if((Z||!(!((c=this.map)===null||c===void 0)&&c.cancelPendingTileRequestsWhileZooming)||k)&&(g[j.key]=j),k=D.wasRequested(),Z)break}}}return g}_updateFadingTiles(e,r){const c=Kt(),f=h.aw(e);for(const g of e){const v=this._tiles[g.key];v.fadingDirection!==pt.Departing&&v.fadeOpacity!==0||v.resetFadeLogic(),this._updateFadingAncestor(v,r,c)||this._updateFadingDescendents(v,r,c)||this._updateFadingEdge(v,f,c)||v.resetFadeLogic()}}_updateFadingAncestor(e,r,c){if(!e.hasData())return!1;const{tileID:f,fadingRole:g,fadingDirection:v,fadingParentID:w}=e;if(g===Ji.Base&&v===pt.Incoming&&w)return r[w.key]=w,!0;const S=Math.max(f.overscaledZ-this._maxFadingAncestorLevels,this._source.minzoom);for(let C=f.overscaledZ-1;C>=S;C--){const D=f.scaledTo(C),k=this.getLoadedTile(D);if(k)return e.setCrossFadeLogic({fadingRole:Ji.Base,fadingDirection:pt.Incoming,fadingParentID:k.tileID,fadeEndTime:c+this._rasterFadeDuration}),k.setCrossFadeLogic({fadingRole:Ji.Parent,fadingDirection:pt.Departing,fadeEndTime:c+this._rasterFadeDuration}),r[D.key]=D,!0}return!1}_updateFadingDescendents(e,r,c){if(!e.hasData())return!1;const f=e.tileID.children(this._source.maxzoom);let g=this._updateFadingChildren(e,f,r,c);if(g)return!0;for(const v of f){const w=v.children(this._source.maxzoom);this._updateFadingChildren(e,w,r,c)&&(g=!0)}return g}_updateFadingChildren(e,r,c,f){if(r[0].overscaledZ>=this._source.maxzoom)return!1;let g=!1;for(const v of r){const w=this.getLoadedTile(v);if(!w)continue;const{fadingRole:S,fadingDirection:C,fadingParentID:D}=w;S===Ji.Base&&C===pt.Departing&&D||(w.setCrossFadeLogic({fadingRole:Ji.Base,fadingDirection:pt.Departing,fadingParentID:e.tileID,fadeEndTime:f+this._rasterFadeDuration}),e.setCrossFadeLogic({fadingRole:Ji.Parent,fadingDirection:pt.Incoming,fadeEndTime:f+this._rasterFadeDuration})),c[v.key]=v,g=!0}return g}_updateFadingEdge(e,r,c){const f=e.tileID;return!!e.selfFading||!e.hasData()&&!!r.has(f)&&(e.setSelfFadeLogic(c+this._rasterFadeDuration),!0)}_addTile(e){let r=this._tiles[e.key];if(r)return r;r=this._cache.getAndRemove(e),r&&(r.resetFadeLogic(),this._setTileReloadTimer(e.key,r),r.tileID=e,this._state.initializeTileState(r,this.map?this.map.painter:null));const c=r;return r||(r=new F(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(r,e.key,r.state)),r.uses++,this._tiles[e.key]=r,c||this._source.fire(new h.l("dataloading",{tile:r,coord:r.tileID,dataType:"source"})),r}_setTileReloadTimer(e,r){this._clearTileReloadTimer(e);const c=r.getExpiryTimeout();c&&(this._timers[e]=setTimeout((()=>{this._reloadTile(e,"expired"),delete this._timers[e]}),c))}_clearTileReloadTimer(e){const r=this._timers[e];r&&(clearTimeout(r),delete this._timers[e])}_resetTileReloadTimers(){for(const e in this._timers)clearTimeout(this._timers[e]),delete this._timers[e];for(const e in this._tiles)this._setTileReloadTimer(e,this._tiles[e])}refreshTiles(e){for(const r in this._tiles)(this._isIdRenderable(r)||this._tiles[r].state=="errored")&&e.some((c=>c.equals(this._tiles[r].tileID.canonical)))&&this._reloadTile(r,"expired")}_removeTile(e){const r=this._tiles[e];r&&(r.uses--,delete this._tiles[e],this._clearTileReloadTimer(e),r.uses>0||(r.hasData()&&r.state!=="reloading"?this._cache.add(r.tileID,r,r.getExpiryTimeout()):(r.aborted=!0,this._abortTile(r),this._unloadTile(r))))}_dataHandler(e){e.dataType==="source"&&(e.sourceDataType!=="metadata"?e.sourceDataType==="content"&&this._sourceLoaded&&!this._paused&&(this.reload(e.sourceDataChanged,e.shouldReloadTileOptions),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0):this._sourceLoaded=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(e);this._cache.reset()}tilesIn(e,r,c){const f=[],g=this.transform;if(!g)return f;const v=g.getCoveringTilesDetailsProvider().allowWorldCopies(),w=c?g.getCameraQueryGeometry(e):e,S=j=>g.screenPointToMercatorCoordinate(j,this.terrain),C=this.transformBbox(e,S,!v),D=this.transformBbox(w,S,!v),k=this.getIds(),L=h.ab.fromPoints(D);for(let j=0;j<k.length;j++){const Z=this._tiles[k[j]];if(Z.holdingForSymbolFade())continue;const W=v?[Z.tileID]:[Z.tileID.unwrapTo(-1),Z.tileID.unwrapTo(0)],Q=Math.pow(2,g.zoom-Z.tileID.overscaledZ),it=r*Z.queryPadding*h.a4/Z.tileSize/Q;for(const st of W){const ht=L.map((at=>st.getTilePoint(new h.aa(at.x,at.y))));if(ht.expandBy(it),ht.intersects(pn)){const at=C.map((mt=>st.getTilePoint(mt))),dt=D.map((mt=>st.getTilePoint(mt)));f.push({tile:Z,tileID:v?st:st.unwrapTo(0),queryGeometry:at,cameraQueryGeometry:dt,scale:Q})}}}return f}transformBbox(e,r,c){let f=e.map(r);if(c){const g=h.ab.fromPoints(e);g.shrinkBy(.001*Math.min(g.width(),g.height()));const v=g.map(r);h.ab.fromPoints(f).covers(v)||(f=f.map((w=>w.x>.5?new h.aa(w.x-1,w.y,w.z):w)))}return f}getVisibleCoordinates(e){const r=this.getRenderableIds(e).map((c=>this._tiles[c].tileID));return this.transform&&this.transform.populateCache(r),r}hasTransition(){if(this._source.hasTransition())return!0;if(Li(this._source.type)&&this._rasterFadeDuration>0){const e=Kt();for(const r in this._tiles)if(this._tiles[r].fadeEndTime>=e)return!0}return!1}setRasterFadeDuration(e){this._rasterFadeDuration=e}setFeatureState(e,r,c){this._state.updateState(e=e||h.a9,r,c)}removeFeatureState(e,r,c){this._state.removeFeatureState(e=e||h.a9,r,c)}getFeatureState(e,r){return this._state.getState(e=e||h.a9,r)}setDependencies(e,r,c){const f=this._tiles[e];f&&f.setDependencies(r,c)}reloadTilesForDependencies(e,r){for(const c in this._tiles)this._tiles[c].hasDependency(e,r)&&this._reloadTile(c,"reloading");this._cache.filter((c=>!c.hasDependency(e,r)))}}function yi(m,e){const r=Math.abs(2*m.wrap)-+(m.wrap<0),c=Math.abs(2*e.wrap)-+(e.wrap<0);return m.overscaledZ-e.overscaledZ||c-r||e.canonical.y-m.canonical.y||e.canonical.x-m.canonical.x}function Li(m){return m==="raster"||m==="image"||m==="video"}Je.maxUnderzooming=10,Je.maxOverzooming=3;class ne{constructor(e,r){this.reset(e,r)}reset(e,r){this.points=e||[],this._distances=[0];for(let c=1;c<this.points.length;c++)this._distances[c]=this._distances[c-1]+this.points[c].dist(this.points[c-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(r||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(this.points.length===1)return this.points[0];e=h.an(e,0,1);let r=1,c=this._distances[r];const f=e*this.paddedLength+this.padding;for(;c<f&&r<this._distances.length;)c=this._distances[++r];const g=r-1,v=this._distances[g],w=c-v,S=w>0?(f-v)/w:0;return this.points[g].mult(1-S).add(this.points[r].mult(S))}}function ki(m,e){let r=!0;return m==="always"||m!=="never"&&e!=="never"||(r=!1),r}class Oi{constructor(e,r,c){const f=this.boxCells=[],g=this.circleCells=[];this.xCellCount=Math.ceil(e/c),this.yCellCount=Math.ceil(r/c);for(let v=0;v<this.xCellCount*this.yCellCount;v++)f.push([]),g.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=r,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/r,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,r,c,f,g){this._forEachCell(r,c,f,g,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(r),this.bboxes.push(c),this.bboxes.push(f),this.bboxes.push(g)}insertCircle(e,r,c,f){this._forEachCell(r-f,c-f,r+f,c+f,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(r),this.circles.push(c),this.circles.push(f)}_insertBoxCell(e,r,c,f,g,v){this.boxCells[g].push(v)}_insertCircleCell(e,r,c,f,g,v){this.circleCells[g].push(v)}_query(e,r,c,f,g,v,w){if(c<0||e>this.width||f<0||r>this.height)return[];const S=[];if(e<=0&&r<=0&&this.width<=c&&this.height<=f){if(g)return[{key:null,x1:e,y1:r,x2:c,y2:f}];for(let C=0;C<this.boxKeys.length;C++)S.push({key:this.boxKeys[C],x1:this.bboxes[4*C],y1:this.bboxes[4*C+1],x2:this.bboxes[4*C+2],y2:this.bboxes[4*C+3]});for(let C=0;C<this.circleKeys.length;C++){const D=this.circles[3*C],k=this.circles[3*C+1],L=this.circles[3*C+2];S.push({key:this.circleKeys[C],x1:D-L,y1:k-L,x2:D+L,y2:k+L})}}else this._forEachCell(e,r,c,f,this._queryCell,S,{hitTest:g,overlapMode:v,seenUids:{box:{},circle:{}}},w);return S}query(e,r,c,f){return this._query(e,r,c,f,!1,null)}hitTest(e,r,c,f,g,v){return this._query(e,r,c,f,!0,g,v).length>0}hitTestCircle(e,r,c,f,g){const v=e-c,w=e+c,S=r-c,C=r+c;if(w<0||v>this.width||C<0||S>this.height)return!1;const D=[];return this._forEachCell(v,S,w,C,this._queryCellCircle,D,{hitTest:!0,overlapMode:f,circle:{x:e,y:r,radius:c},seenUids:{box:{},circle:{}}},g),D.length>0}_queryCell(e,r,c,f,g,v,w,S){const{seenUids:C,hitTest:D,overlapMode:k}=w,L=this.boxCells[g];if(L!==null){const Z=this.bboxes;for(const W of L)if(!C.box[W]){C.box[W]=!0;const Q=4*W,it=this.boxKeys[W];if(e<=Z[Q+2]&&r<=Z[Q+3]&&c>=Z[Q+0]&&f>=Z[Q+1]&&(!S||S(it))&&(!D||!ki(k,it.overlapMode))&&(v.push({key:it,x1:Z[Q],y1:Z[Q+1],x2:Z[Q+2],y2:Z[Q+3]}),D))return!0}}const j=this.circleCells[g];if(j!==null){const Z=this.circles;for(const W of j)if(!C.circle[W]){C.circle[W]=!0;const Q=3*W,it=this.circleKeys[W];if(this._circleAndRectCollide(Z[Q],Z[Q+1],Z[Q+2],e,r,c,f)&&(!S||S(it))&&(!D||!ki(k,it.overlapMode))){const st=Z[Q],ht=Z[Q+1],at=Z[Q+2];if(v.push({key:it,x1:st-at,y1:ht-at,x2:st+at,y2:ht+at}),D)return!0}}}return!1}_queryCellCircle(e,r,c,f,g,v,w,S){const{circle:C,seenUids:D,overlapMode:k}=w,L=this.boxCells[g];if(L!==null){const Z=this.bboxes;for(const W of L)if(!D.box[W]){D.box[W]=!0;const Q=4*W,it=this.boxKeys[W];if(this._circleAndRectCollide(C.x,C.y,C.radius,Z[Q+0],Z[Q+1],Z[Q+2],Z[Q+3])&&(!S||S(it))&&!ki(k,it.overlapMode))return v.push(!0),!0}}const j=this.circleCells[g];if(j!==null){const Z=this.circles;for(const W of j)if(!D.circle[W]){D.circle[W]=!0;const Q=3*W,it=this.circleKeys[W];if(this._circlesCollide(Z[Q],Z[Q+1],Z[Q+2],C.x,C.y,C.radius)&&(!S||S(it))&&!ki(k,it.overlapMode))return v.push(!0),!0}}}_forEachCell(e,r,c,f,g,v,w,S){const C=this._convertToXCellCoord(e),D=this._convertToYCellCoord(r),k=this._convertToXCellCoord(c),L=this._convertToYCellCoord(f);for(let j=C;j<=k;j++)for(let Z=D;Z<=L;Z++)if(g.call(this,e,r,c,f,this.xCellCount*Z+j,v,w,S))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,r,c,f,g,v){const w=f-e,S=g-r,C=c+v;return C*C>w*w+S*S}_circleAndRectCollide(e,r,c,f,g,v,w){const S=(v-f)/2,C=Math.abs(e-(f+S));if(C>S+c)return!1;const D=(w-g)/2,k=Math.abs(r-(g+D));if(k>D+c)return!1;if(C<=S||k<=D)return!0;const L=C-S,j=k-D;return L*L+j*j<=c*c}}function Dn(m,e,r){const c=h.N();if(!m){const{vecSouth:k,vecEast:L}=Qt(e),j=ft();j[0]=L[0],j[1]=L[1],j[2]=k[0],j[3]=k[1],f=j,(D=(v=(g=j)[0])*(C=g[3])-(S=g[2])*(w=g[1]))&&(f[0]=C*(D=1/D),f[1]=-w*D,f[2]=-S*D,f[3]=v*D),c[0]=j[0],c[1]=j[1],c[4]=j[2],c[5]=j[3]}var f,g,v,w,S,C,D;return h.Q(c,c,[1/r,1/r,1]),c}function vi(m,e,r,c){if(m){const f=h.N();if(!e){const{vecSouth:g,vecEast:v}=Qt(r);f[0]=v[0],f[1]=v[1],f[4]=g[0],f[5]=g[1]}return h.Q(f,f,[c,c,1]),f}return r.pixelsToClipSpaceMatrix}function Qt(m){const e=Math.cos(m.rollInRadians),r=Math.sin(m.rollInRadians),c=Math.cos(m.pitchInRadians),f=Math.cos(m.bearingInRadians),g=Math.sin(m.bearingInRadians),v=h.aB();v[0]=-f*c*r-g*e,v[1]=-g*c*r+f*e;const w=h.aC(v);w<1e-9?h.aD(v):h.aE(v,v,1/w);const S=h.aB();S[0]=f*c*e-g*r,S[1]=g*c*e+f*r;const C=h.aC(S);return C<1e-9?h.aD(S):h.aE(S,S,1/C),{vecEast:S,vecSouth:v}}function me(m,e,r,c){let f;c?(f=[m,e,c(m,e),1],h.aG(f,f,r)):(f=[m,e,0,1],dc(f,f,r));const g=f[3];return{point:new h.P(f[0]/g,f[1]/g),signedDistanceFromCamera:g,isOccluded:!1}}function Ae(m,e){return .5+m/e*.5}function ba(m,e){return m.x>=-e[0]&&m.x<=e[0]&&m.y>=-e[1]&&m.y<=e[1]}function Lo(m,e,r,c,f,g,v,w,S,C,D,k,L){const j=r?m.textSizeData:m.iconSizeData,Z=h.ax(j,e.transform.zoom),W=[256/e.width*2+1,256/e.height*2+1],Q=r?m.text.dynamicLayoutVertexArray:m.icon.dynamicLayoutVertexArray;Q.clear();const it=m.lineVertexArray,st=r?m.text.placedSymbolArray:m.icon.placedSymbolArray,ht=e.transform.width/e.transform.height;let at=!1;for(let dt=0;dt<st.length;dt++){const mt=st.get(dt);if(mt.hidden||mt.writingMode===h.ay.vertical&&!at){Pa(mt.numGlyphs,Q);continue}at=!1;const ct=new h.P(mt.anchorX,mt.anchorY),Tt={getElevation:L,pitchedLabelPlaneMatrix:c,lineVertexArray:it,pitchWithMap:g,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:e.transform,tileAnchorPoint:ct,unwrappedTileID:S,width:C,height:D,translation:k},kt=Ir(mt.anchorX,mt.anchorY,Tt);if(!ba(kt.point,W)){Pa(mt.numGlyphs,Q);continue}const zt=Ae(e.transform.cameraToCenterDistance,kt.signedDistanceFromCamera),It=h.az(j,Z,mt),Rt=g?It*e.transform.getPitchedTextCorrection(mt.anchorX,mt.anchorY,S)/zt:It*zt,ae=ir({projectionContext:Tt,pitchedLabelPlaneMatrixInverse:f,symbol:mt,fontSize:Rt,flip:!1,keepUpright:v,glyphOffsetArray:m.glyphOffsetArray,dynamicLayoutVertexArray:Q,aspectRatio:ht,rotateToLine:w});at=ae.useVertical,(ae.notEnoughRoom||at||ae.needsFlipping&&ir({projectionContext:Tt,pitchedLabelPlaneMatrixInverse:f,symbol:mt,fontSize:Rt,flip:!0,keepUpright:v,glyphOffsetArray:m.glyphOffsetArray,dynamicLayoutVertexArray:Q,aspectRatio:ht,rotateToLine:w}).notEnoughRoom)&&Pa(mt.numGlyphs,Q)}r?m.text.dynamicLayoutVertexBuffer.updateData(Q):m.icon.dynamicLayoutVertexBuffer.updateData(Q)}function na(m,e,r,c,f,g,v,w){const S=g.glyphStartIndex+g.numGlyphs,C=g.lineStartIndex,D=g.lineStartIndex+g.lineLength,k=e.getoffsetX(g.glyphStartIndex),L=e.getoffsetX(S-1),j=Bi(m*k,r,c,f,g.segment,C,D,w,v);if(!j)return null;const Z=Bi(m*L,r,c,f,g.segment,C,D,w,v);return Z?w.projectionCache.anyProjectionOccluded?null:{first:j,last:Z}:null}function Be(m,e,r,c){return m===h.ay.horizontal&&Math.abs(r.y-e.y)>Math.abs(r.x-e.x)*c?{useVertical:!0}:(m===h.ay.vertical?e.y<r.y:e.x>r.x)?{needsFlipping:!0}:null}function ir(m){const{projectionContext:e,pitchedLabelPlaneMatrixInverse:r,symbol:c,fontSize:f,flip:g,keepUpright:v,glyphOffsetArray:w,dynamicLayoutVertexArray:S,aspectRatio:C,rotateToLine:D}=m,k=f/24,L=c.lineOffsetX*k,j=c.lineOffsetY*k;let Z;if(c.numGlyphs>1){const W=c.glyphStartIndex+c.numGlyphs,Q=c.lineStartIndex,it=c.lineStartIndex+c.lineLength,st=na(k,w,L,j,g,c,D,e);if(!st)return{notEnoughRoom:!0};const ht=Pr(st.first.point.x,st.first.point.y,e,r),at=Pr(st.last.point.x,st.last.point.y,e,r);if(v&&!g){const dt=Be(c.writingMode,ht,at,C);if(dt)return dt}Z=[st.first];for(let dt=c.glyphStartIndex+1;dt<W-1;dt++){const mt=Bi(k*w.getoffsetX(dt),L,j,g,c.segment,Q,it,e,D);if(!mt)return{notEnoughRoom:!0};Z.push(mt)}Z.push(st.last)}else{if(v&&!g){const Q=wa(e.tileAnchorPoint.x,e.tileAnchorPoint.y,e).point,it=c.lineStartIndex+c.segment+1,st=new h.P(e.lineVertexArray.getx(it),e.lineVertexArray.gety(it)),ht=wa(st.x,st.y,e),at=ht.signedDistanceFromCamera>0?ht.point:Js(e.tileAnchorPoint,st,Q,1,e),dt=Pr(Q.x,Q.y,e,r),mt=Pr(at.x,at.y,e,r),ct=Be(c.writingMode,dt,mt,C);if(ct)return ct}const W=Bi(k*w.getoffsetX(c.glyphStartIndex),L,j,g,c.segment,c.lineStartIndex,c.lineStartIndex+c.lineLength,e,D);if(!W||e.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};Z=[W]}for(const W of Z)h.aF(S,W.point,W.angle);return{}}function Js(m,e,r,c,f){const g=m.add(m.sub(e)._unit()),v=wa(g.x,g.y,f).point,w=r.sub(v);return r.add(w._mult(c/w.mag()))}function zr(m,e,r){const c=e.projectionCache;if(c.projections[m])return c.projections[m];const f=new h.P(e.lineVertexArray.getx(m),e.lineVertexArray.gety(m)),g=wa(f.x,f.y,e);if(g.signedDistanceFromCamera>0)return c.projections[m]=g.point,c.anyProjectionOccluded=c.anyProjectionOccluded||g.isOccluded,g.point;const v=m-r.direction;return Js(r.distanceFromAnchor===0?e.tileAnchorPoint:new h.P(e.lineVertexArray.getx(v),e.lineVertexArray.gety(v)),f,r.previousVertex,r.absOffsetX-r.distanceFromAnchor+1,e)}function wa(m,e,r){const c=m+r.translation[0],f=e+r.translation[1];let g;return r.pitchWithMap?(g=me(c,f,r.pitchedLabelPlaneMatrix,r.getElevation),g.isOccluded=!1):(g=r.transform.projectTileCoordinates(c,f,r.unwrappedTileID,r.getElevation),g.point.x=(.5*g.point.x+.5)*r.width,g.point.y=(.5*-g.point.y+.5)*r.height),g}function Pr(m,e,r,c){if(r.pitchWithMap){const f=[m,e,0,1];return h.aG(f,f,c),r.transform.projectTileCoordinates(f[0]/f[3],f[1]/f[3],r.unwrappedTileID,r.getElevation).point}return{x:m/r.width*2-1,y:1-e/r.height*2}}function Ir(m,e,r){return r.transform.projectTileCoordinates(m,e,r.unwrappedTileID,r.getElevation)}function mn(m,e,r){return m._unit()._perp()._mult(e*r)}function Ua(m,e,r,c,f,g,v,w,S){if(w.projectionCache.offsets[m])return w.projectionCache.offsets[m];const C=r.add(e);if(m+S.direction<c||m+S.direction>=f)return w.projectionCache.offsets[m]=C,C;const D=zr(m+S.direction,w,S),k=mn(D.sub(r),v,S.direction),L=r.add(k),j=D.add(k);return w.projectionCache.offsets[m]=h.aH(g,C,L,j)||C,w.projectionCache.offsets[m]}function Bi(m,e,r,c,f,g,v,w,S){const C=c?m-e:m+e;let D=C>0?1:-1,k=0;c&&(D*=-1,k=Math.PI),D<0&&(k+=Math.PI);let L,j=D>0?g+f:g+f+1;w.projectionCache.cachedAnchorPoint?L=w.projectionCache.cachedAnchorPoint:(L=wa(w.tileAnchorPoint.x,w.tileAnchorPoint.y,w).point,w.projectionCache.cachedAnchorPoint=L);let Z,W,Q=L,it=L,st=0,ht=0;const at=Math.abs(C),dt=[];let mt;for(;st+ht<=at;){if(j+=D,j<g||j>=v)return null;st+=ht,it=Q,W=Z;const kt={absOffsetX:at,direction:D,distanceFromAnchor:st,previousVertex:it};if(Q=zr(j,w,kt),r===0)dt.push(it),mt=Q.sub(it);else{let zt;const It=Q.sub(it);zt=It.mag()===0?mn(zr(j+D,w,kt).sub(Q),r,D):mn(It,r,D),W||(W=it.add(zt)),Z=Ua(j,zt,Q,g,v,W,r,w,kt),dt.push(W),mt=Z.sub(W)}ht=mt.mag()}const ct=mt._mult((at-st)/ht)._add(W||it),Tt=k+Math.atan2(Q.y-it.y,Q.x-it.x);return dt.push(ct),{point:ct,angle:S?Tt:0,path:dt}}const ko=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Pa(m,e){for(let r=0;r<m;r++){const c=e.length;e.resize(c+4),e.float32.set(ko,3*c)}}function dc(m,e,r){const c=e[0],f=e[1];return m[0]=r[0]*c+r[4]*f+r[12],m[1]=r[1]*c+r[5]*f+r[13],m[3]=r[3]*c+r[7]*f+r[15],m}const tn=100;class Ss{constructor(e,r=new Oi(e.width+200,e.height+200,25),c=new Oi(e.width+200,e.height+200,25)){this.transform=e,this.grid=r,this.ignoredGrid=c,this.pitchFactor=Math.cos(e.pitch*Math.PI/180)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+tn,this.screenBottomBoundary=e.height+tn,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(e,r,c,f,g,v,w,S,C,D,k,L){const j=this.projectAndGetPerspectiveRatio(e.anchorPointX+S[0],e.anchorPointY+S[1],g,D,L),Z=c*j.perspectiveRatio;let W;if(v||w)W=this._projectCollisionBox(e,Z,f,g,v,w,S,j,D,k,L);else{const mt=j.x+(k?k.x*Z:0),ct=j.y+(k?k.y*Z:0);W={allPointsOccluded:!1,box:[mt+e.x1*Z,ct+e.y1*Z,mt+e.x2*Z,ct+e.y2*Z]}}const[Q,it,st,ht]=W.box,at=v?W.allPointsOccluded:j.isOccluded;let dt=at;return dt||(dt=j.perspectiveRatio<this.perspectiveRatioCutoff),dt||(dt=!this.isInsideGrid(Q,it,st,ht)),dt||r!=="always"&&this.grid.hitTest(Q,it,st,ht,r,C)?{box:[Q,it,st,ht],placeable:!1,offscreen:!1,occluded:at}:{box:[Q,it,st,ht],placeable:!0,offscreen:this.isOffscreen(Q,it,st,ht),occluded:at}}placeCollisionCircles(e,r,c,f,g,v,w,S,C,D,k,L,j,Z){const W=[],Q=new h.P(r.anchorX,r.anchorY),it=this.getPerspectiveRatio(Q.x,Q.y,v,Z),st=(C?g*this.transform.getPitchedTextCorrection(r.anchorX,r.anchorY,v)/it:g*it)/h.aL,ht={getElevation:Z,pitchedLabelPlaneMatrix:w,lineVertexArray:c,pitchWithMap:C,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:Q,unwrappedTileID:v,width:this.transform.width,height:this.transform.height,translation:j},at=na(st,f,r.lineOffsetX*st,r.lineOffsetY*st,!1,r,!1,ht);let dt=!1,mt=!1,ct=!0;if(at){const Tt=.5*k*it+L,kt=new h.P(-100,-100),zt=new h.P(this.screenRightBoundary,this.screenBottomBoundary),It=new ne,Rt=at.first,ae=at.last;let re=[];for(let Ge=Rt.path.length-1;Ge>=1;Ge--)re.push(Rt.path[Ge]);for(let Ge=1;Ge<ae.path.length;Ge++)re.push(ae.path[Ge]);const Xt=2.5*Tt;if(C){const Ge=this.projectPathToScreenSpace(re,ht);re=Ge.some((Fe=>Fe.signedDistanceFromCamera<=0))?[]:Ge.map((Fe=>Fe.point))}let ve=[];if(re.length>0){const Ge=re[0].clone(),Fe=re[0].clone();for(let Xi=1;Xi<re.length;Xi++)Ge.x=Math.min(Ge.x,re[Xi].x),Ge.y=Math.min(Ge.y,re[Xi].y),Fe.x=Math.max(Fe.x,re[Xi].x),Fe.y=Math.max(Fe.y,re[Xi].y);ve=Ge.x>=kt.x&&Fe.x<=zt.x&&Ge.y>=kt.y&&Fe.y<=zt.y?[re]:Fe.x<kt.x||Ge.x>zt.x||Fe.y<kt.y||Ge.y>zt.y?[]:h.aI([re],kt.x,kt.y,zt.x,zt.y)}for(const Ge of ve){It.reset(Ge,.25*Tt);let Fe=0;Fe=It.length<=.5*Tt?1:Math.ceil(It.paddedLength/Xt)+1;for(let Xi=0;Xi<Fe;Xi++){const Fi=Xi/Math.max(Fe-1,1),an=It.lerp(Fi),Ri=an.x+tn,Ln=an.y+tn;W.push(Ri,Ln,Tt,0);const Wi=Ri-Tt,_n=Ln-Tt,yn=Ri+Tt,Sn=Ln+Tt;if(ct=ct&&this.isOffscreen(Wi,_n,yn,Sn),mt=mt||this.isInsideGrid(Wi,_n,yn,Sn),e!=="always"&&this.grid.hitTestCircle(Ri,Ln,Tt,e,D)&&(dt=!0,!S))return{circles:[],offscreen:!1,collisionDetected:dt}}}}return{circles:!S&&dt||!mt||it<this.perspectiveRatioCutoff?[]:W,offscreen:ct,collisionDetected:dt}}projectPathToScreenSpace(e,r){const c=(function(f,g){const v=h.N();return h.aA(v,g.pitchedLabelPlaneMatrix),f.map((w=>{const S=me(w.x,w.y,v,g.getElevation),C=g.transform.projectTileCoordinates(S.point.x,S.point.y,g.unwrappedTileID,g.getElevation);return C.point.x=(.5*C.point.x+.5)*g.width,C.point.y=(.5*-C.point.y+.5)*g.height,C}))})(e,r);return(function(f){let g=0,v=0,w=0,S=0;for(let C=0;C<f.length;C++)f[C].isOccluded?(w=C+1,S=0):(S++,S>v&&(v=S,g=w));return f.slice(g,g+v)})(c)}queryRenderedSymbols(e){if(e.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const r=[],c=new h.ab;for(const k of e){const L=new h.P(k.x+tn,k.y+tn);c.extend(L),r.push(L)}const{minX:f,minY:g,maxX:v,maxY:w}=c,S=this.grid.query(f,g,v,w).concat(this.ignoredGrid.query(f,g,v,w)),C={},D={};for(const k of S){const L=k.key;if(C[L.bucketInstanceId]===void 0&&(C[L.bucketInstanceId]={}),C[L.bucketInstanceId][L.featureIndex])continue;const j=[new h.P(k.x1,k.y1),new h.P(k.x2,k.y1),new h.P(k.x2,k.y2),new h.P(k.x1,k.y2)];h.aJ(r,j)&&(C[L.bucketInstanceId][L.featureIndex]=!0,D[L.bucketInstanceId]===void 0&&(D[L.bucketInstanceId]=[]),D[L.bucketInstanceId].push(L.featureIndex))}return D}insertCollisionBox(e,r,c,f,g,v){(c?this.ignoredGrid:this.grid).insert({bucketInstanceId:f,featureIndex:g,collisionGroupID:v,overlapMode:r},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,r,c,f,g,v){const w=c?this.ignoredGrid:this.grid,S={bucketInstanceId:f,featureIndex:g,collisionGroupID:v,overlapMode:r};for(let C=0;C<e.length;C+=4)w.insertCircle(S,e[C],e[C+1],e[C+2])}projectAndGetPerspectiveRatio(e,r,c,f,g){if(g){let v;f?(v=[e,r,f(e,r),1],h.aG(v,v,g)):(v=[e,r,0,1],dc(v,v,g));const w=v[3];return{x:(v[0]/w+1)/2*this.transform.width+tn,y:(-v[1]/w+1)/2*this.transform.height+tn,perspectiveRatio:.5+this.transform.cameraToCenterDistance/w*.5,isOccluded:!1,signedDistanceFromCamera:w}}{const v=this.transform.projectTileCoordinates(e,r,c,f);return{x:(v.point.x+1)/2*this.transform.width+tn,y:(1-v.point.y)/2*this.transform.height+tn,perspectiveRatio:.5+this.transform.cameraToCenterDistance/v.signedDistanceFromCamera*.5,isOccluded:v.isOccluded,signedDistanceFromCamera:v.signedDistanceFromCamera}}}getPerspectiveRatio(e,r,c,f){const g=this.transform.projectTileCoordinates(e,r,c,f);return .5+this.transform.cameraToCenterDistance/g.signedDistanceFromCamera*.5}isOffscreen(e,r,c,f){return c<tn||e>=this.screenRightBoundary||f<tn||r>this.screenBottomBoundary}isInsideGrid(e,r,c,f){return c>=0&&e<this.gridRightBoundary&&f>=0&&r<this.gridBottomBoundary}getViewportMatrix(){const e=h.ar([]);return h.O(e,e,[-100,-100,0]),e}_projectCollisionBox(e,r,c,f,g,v,w,S,C,D,k){let L=1,j=0,Z=0,W=1;const Q=e.anchorPointX+w[0],it=e.anchorPointY+w[1];if(v&&!g){const re=this.projectAndGetPerspectiveRatio(Q+1,it,f,C,k),Xt=re.x-S.x,ve=Math.atan((re.y-S.y)/Xt)+(Xt<0?Math.PI:0),Ge=Math.sin(ve),Fe=Math.cos(ve);L=Fe,j=Ge,Z=-Ge,W=Fe}else if(!v&&g){const re=Qt(this.transform);L=re.vecEast[0],j=re.vecEast[1],Z=re.vecSouth[0],W=re.vecSouth[1]}let st=S.x,ht=S.y,at=r;g&&(st=Q,ht=it,at=Math.pow(2,-(this.transform.zoom-c.overscaledZ)),at*=this.transform.getPitchedTextCorrection(Q,it,f),D||(at*=h.an(.5+S.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),D&&(st+=L*D.x*at+Z*D.y*at,ht+=j*D.x*at+W*D.y*at);const dt=e.x1*at,mt=e.x2*at,ct=(dt+mt)/2,Tt=e.y1*at,kt=e.y2*at,zt=(Tt+kt)/2,It=[{offsetX:dt,offsetY:Tt},{offsetX:ct,offsetY:Tt},{offsetX:mt,offsetY:Tt},{offsetX:mt,offsetY:zt},{offsetX:mt,offsetY:kt},{offsetX:ct,offsetY:kt},{offsetX:dt,offsetY:kt},{offsetX:dt,offsetY:zt}];let Rt=[];for(const{offsetX:re,offsetY:Xt}of It)Rt.push(new h.P(st+L*re+Z*Xt,ht+j*re+W*Xt));let ae=!1;if(g){const re=Rt.map((Xt=>this.projectAndGetPerspectiveRatio(Xt.x,Xt.y,f,C,k)));ae=re.some((Xt=>!Xt.isOccluded)),Rt=re.map((Xt=>new h.P(Xt.x,Xt.y)))}else ae=!0;return{box:h.aK(Rt),allPointsOccluded:!ae}}}class vh{constructor(e,r,c,f){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?r:-r))):f&&c?1:0,this.placed=c}isHidden(){return this.opacity===0&&!this.placed}}class Es{constructor(e,r,c,f,g){this.text=new vh(e?e.text:null,r,c,g),this.icon=new vh(e?e.icon:null,r,f,g)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Cl{constructor(e,r,c){this.text=e,this.icon=r,this.skipFade=c}}class Ga{constructor(e,r,c,f,g){this.bucketInstanceId=e,this.featureIndex=r,this.sourceLayerIndex=c,this.bucketIndex=f,this.tileID=g}}class nr{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){const r=++this.maxGroupID;this.collisionGroups[e]={ID:r,predicate:c=>c.collisionGroupID===r}}return this.collisionGroups[e]}}function xh(m,e,r,c,f){const{horizontalAlign:g,verticalAlign:v}=h.aR(m);return new h.P(-(g-.5)*e+c[0]*f,-(v-.5)*r+c[1]*f)}class Bf{constructor(e,r,c,f,g){this.transform=e.clone(),this.terrain=r,this.collisionIndex=new Ss(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=c,this.retainedQueryData={},this.collisionGroups=new nr(f),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=g,g&&(g.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(e){const r=this.terrain;return r?(c,f)=>r.getElevation(e,c,f):null}getBucketParts(e,r,c,f){const g=c.getBucket(r),v=c.latestFeatureIndex;if(!g||!v||r.id!==g.layerIds[0])return;const w=c.collisionBoxArray,S=g.layers[0].layout,C=g.layers[0].paint,D=Math.pow(2,this.transform.zoom-c.tileID.overscaledZ),k=c.tileSize/h.a4,L=c.tileID.toUnwrapped(),j=S.get("text-rotation-alignment")==="map",Z=h.aM(c,1,this.transform.zoom),W=h.aN(this.collisionIndex.transform,c,C.get("text-translate"),C.get("text-translate-anchor")),Q=h.aN(this.collisionIndex.transform,c,C.get("icon-translate"),C.get("icon-translate-anchor")),it=Dn(j,this.transform,Z);this.retainedQueryData[g.bucketInstanceId]=new Ga(g.bucketInstanceId,v,g.sourceLayerIndex,g.index,c.tileID);const st={bucket:g,layout:S,translationText:W,translationIcon:Q,unwrappedTileID:L,pitchedLabelPlaneMatrix:it,scale:D,textPixelRatio:k,holdingForFade:c.holdingForSymbolFade(),collisionBoxArray:w,partiallyEvaluatedTextSize:h.ax(g.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(g.sourceID)};if(f)for(const ht of g.sortKeyRanges){const{sortKey:at,symbolInstanceStart:dt,symbolInstanceEnd:mt}=ht;e.push({sortKey:at,symbolInstanceStart:dt,symbolInstanceEnd:mt,parameters:st})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:g.symbolInstances.length,parameters:st})}attemptAnchorPlacement(e,r,c,f,g,v,w,S,C,D,k,L,j,Z,W,Q,it,st,ht,at){const dt=h.aO[e.textAnchor],mt=[e.textOffset0,e.textOffset1],ct=xh(dt,c,f,mt,g),Tt=this.collisionIndex.placeCollisionBox(r,L,S,C,D,w,v,Q,k.predicate,ht,ct,at);if((!st||this.collisionIndex.placeCollisionBox(st,L,S,C,D,w,v,it,k.predicate,ht,ct,at).placeable)&&Tt.placeable){let kt;if(this.prevPlacement&&this.prevPlacement.variableOffsets[j.crossTileID]&&this.prevPlacement.placements[j.crossTileID]&&this.prevPlacement.placements[j.crossTileID].text&&(kt=this.prevPlacement.variableOffsets[j.crossTileID].anchor),j.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[j.crossTileID]={textOffset:mt,width:c,height:f,anchor:dt,textBoxScale:g,prevAnchor:kt},this.markUsedJustification(Z,dt,j,W),Z.allowVerticalPlacement&&(this.markUsedOrientation(Z,W,j),this.placedOrientations[j.crossTileID]=W),{shift:ct,placedGlyphBoxes:Tt}}}placeLayerBucketPart(e,r,c){const{bucket:f,layout:g,translationText:v,translationIcon:w,unwrappedTileID:S,pitchedLabelPlaneMatrix:C,textPixelRatio:D,holdingForFade:k,collisionBoxArray:L,partiallyEvaluatedTextSize:j,collisionGroup:Z}=e.parameters,W=g.get("text-optional"),Q=g.get("icon-optional"),it=h.aP(g,"text-overlap","text-allow-overlap"),st=it==="always",ht=h.aP(g,"icon-overlap","icon-allow-overlap"),at=ht==="always",dt=g.get("text-rotation-alignment")==="map",mt=g.get("text-pitch-alignment")==="map",ct=g.get("icon-text-fit")!=="none",Tt=g.get("symbol-z-order")==="viewport-y",kt=st&&(at||!f.hasIconData()||Q),zt=at&&(st||!f.hasTextData()||W);!f.collisionArrays&&L&&f.deserializeCollisionBoxes(L);const It=this.retainedQueryData[f.bucketInstanceId].tileID,Rt=this._getTerrainElevationFunc(It),ae=this.transform.getFastPathSimpleProjectionMatrix(It),re=(Xt,ve,Ge)=>{var Fe,Xi;if(r[Xt.crossTileID])return;if(k)return void(this.placements[Xt.crossTileID]=new Cl(!1,!1,!1));let Fi=!1,an=!1,Ri=!0,Ln=null,Wi={box:null,placeable:!1,offscreen:null,occluded:!1},_n={placeable:!1},yn=null,Sn=null,Ta=null,_s=0,jr=0,vo=0;ve.textFeatureIndex?_s=ve.textFeatureIndex:Xt.useRuntimeCollisionCircles&&(_s=Xt.featureIndex),ve.verticalTextFeatureIndex&&(jr=ve.verticalTextFeatureIndex);const ys=ve.textBox;if(ys){const Ka=un=>{let ji=h.ay.horizontal;if(f.allowVerticalPlacement&&!un&&this.prevPlacement){const En=this.prevPlacement.placedOrientations[Xt.crossTileID];En&&(this.placedOrientations[Xt.crossTileID]=En,ji=En,this.markUsedOrientation(f,ji,Xt))}return ji},vs=(un,ji)=>{if(f.allowVerticalPlacement&&Xt.numVerticalGlyphVertices>0&&ve.verticalTextBox){for(const En of f.writingModes)if(En===h.ay.vertical?(Wi=ji(),_n=Wi):Wi=un(),Wi&&Wi.placeable)break}else Wi=un()},sl=Xt.textAnchorOffsetStartIndex,ol=Xt.textAnchorOffsetEndIndex;if(ol===sl){const un=(ji,En)=>{const Ci=this.collisionIndex.placeCollisionBox(ji,it,D,It,S,mt,dt,v,Z.predicate,Rt,void 0,ae);return Ci&&Ci.placeable&&(this.markUsedOrientation(f,En,Xt),this.placedOrientations[Xt.crossTileID]=En),Ci};vs((()=>un(ys,h.ay.horizontal)),(()=>{const ji=ve.verticalTextBox;return f.allowVerticalPlacement&&Xt.numVerticalGlyphVertices>0&&ji?un(ji,h.ay.vertical):{box:null,offscreen:null}})),Ka(Wi&&Wi.placeable)}else{let un=h.aO[(Xi=(Fe=this.prevPlacement)===null||Fe===void 0?void 0:Fe.variableOffsets[Xt.crossTileID])===null||Xi===void 0?void 0:Xi.anchor];const ji=(Ci,Zs,qh)=>{const $l=Ci.x2-Ci.x1,Zh=Ci.y2-Ci.y1,Hs=Xt.textBoxScale,Yd=ct&&ht==="never"?Zs:null;let xs=null,Xl=it==="never"?1:2,Gu="never";un&&Xl++;for(let $s=0;$s<Xl;$s++){for(let Na=sl;Na<ol;Na++){const qu=f.textAnchorOffsets.get(Na);if(un&&qu.textAnchor!==un)continue;const Zu=this.attemptAnchorPlacement(qu,Ci,$l,Zh,Hs,dt,mt,D,It,S,Z,Gu,Xt,f,qh,v,w,Yd,Rt);if(Zu&&(xs=Zu.placedGlyphBoxes,xs&&xs.placeable))return Fi=!0,Ln=Zu.shift,xs}un?un=null:Gu=it}return c&&!xs&&(xs={box:this.collisionIndex.placeCollisionBox(ys,"always",D,It,S,mt,dt,v,Z.predicate,Rt,void 0,ae).box,offscreen:!1,placeable:!1,occluded:!1}),xs};vs((()=>ji(ys,ve.iconBox,h.ay.horizontal)),(()=>{const Ci=ve.verticalTextBox;return f.allowVerticalPlacement&&(!Wi||!Wi.placeable)&&Xt.numVerticalGlyphVertices>0&&Ci?ji(Ci,ve.verticalIconBox,h.ay.vertical):{box:null,occluded:!0,offscreen:null}})),Wi&&(Fi=Wi.placeable,Ri=Wi.offscreen);const En=Ka(Wi&&Wi.placeable);if(!Fi&&this.prevPlacement){const Ci=this.prevPlacement.variableOffsets[Xt.crossTileID];Ci&&(this.variableOffsets[Xt.crossTileID]=Ci,this.markUsedJustification(f,Ci.anchor,Xt,En))}}}if(yn=Wi,Fi=yn&&yn.placeable,Ri=yn&&yn.offscreen,Xt.useRuntimeCollisionCircles&&Xt.centerJustifiedTextSymbolIndex>=0){const Ka=f.text.placedSymbolArray.get(Xt.centerJustifiedTextSymbolIndex),vs=h.az(f.textSizeData,j,Ka),sl=g.get("text-padding");Sn=this.collisionIndex.placeCollisionCircles(it,Ka,f.lineVertexArray,f.glyphOffsetArray,vs,S,C,c,mt,Z.predicate,Xt.collisionCircleDiameter,sl,v,Rt),Sn.circles.length&&Sn.collisionDetected&&!c&&h.w("Collisions detected, but collision boxes are not shown"),Fi=st||Sn.circles.length>0&&!Sn.collisionDetected,Ri=Ri&&Sn.offscreen}if(ve.iconFeatureIndex&&(vo=ve.iconFeatureIndex),ve.iconBox){const Ka=vs=>this.collisionIndex.placeCollisionBox(vs,ht,D,It,S,mt,dt,w,Z.predicate,Rt,ct&&Ln?Ln:void 0,ae);_n&&_n.placeable&&ve.verticalIconBox?(Ta=Ka(ve.verticalIconBox),an=Ta.placeable):(Ta=Ka(ve.iconBox),an=Ta.placeable),Ri=Ri&&Ta.offscreen}const xo=W||Xt.numHorizontalGlyphVertices===0&&Xt.numVerticalGlyphVertices===0,or=Q||Xt.numIconVertices===0;xo||or?or?xo||(an=an&&Fi):Fi=an&&Fi:an=Fi=an&&Fi;const Vr=an&&Ta.placeable;if(Fi&&yn.placeable&&this.collisionIndex.insertCollisionBox(yn.box,it,g.get("text-ignore-placement"),f.bucketInstanceId,_n&&_n.placeable&&jr?jr:_s,Z.ID),Vr&&this.collisionIndex.insertCollisionBox(Ta.box,ht,g.get("icon-ignore-placement"),f.bucketInstanceId,vo,Z.ID),Sn&&Fi&&this.collisionIndex.insertCollisionCircles(Sn.circles,it,g.get("text-ignore-placement"),f.bucketInstanceId,_s,Z.ID),c&&this.storeCollisionData(f.bucketInstanceId,Ge,ve,yn,Ta,Sn),Xt.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(f.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Xt.crossTileID]=new Cl((Fi||kt)&&!yn?.occluded,(an||zt)&&!Ta?.occluded,Ri||f.justReloaded),r[Xt.crossTileID]=!0};if(Tt){if(e.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Xt=f.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let ve=Xt.length-1;ve>=0;--ve){const Ge=Xt[ve];re(f.symbolInstances.get(Ge),f.collisionArrays[Ge],Ge)}}else for(let Xt=e.symbolInstanceStart;Xt<e.symbolInstanceEnd;Xt++)re(f.symbolInstances.get(Xt),f.collisionArrays[Xt],Xt);f.justReloaded=!1}storeCollisionData(e,r,c,f,g,v){if(c.textBox||c.iconBox){let w,S;this.collisionBoxArrays.has(e)?w=this.collisionBoxArrays.get(e):(w=new Map,this.collisionBoxArrays.set(e,w)),w.has(r)?S=w.get(r):(S={text:null,icon:null},w.set(r,S)),c.textBox&&(S.text=f.box),c.iconBox&&(S.icon=g.box)}if(v){let w=this.collisionCircleArrays[e];w===void 0&&(w=this.collisionCircleArrays[e]=[]);for(let S=0;S<v.circles.length;S+=4)w.push(v.circles[S+0]-tn),w.push(v.circles[S+1]-tn),w.push(v.circles[S+2]),w.push(v.collisionDetected?1:0)}}markUsedJustification(e,r,c,f){let g;g=f===h.ay.vertical?c.verticalPlacedTextSymbolIndex:{left:c.leftJustifiedTextSymbolIndex,center:c.centerJustifiedTextSymbolIndex,right:c.rightJustifiedTextSymbolIndex}[h.aQ(r)];const v=[c.leftJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.rightJustifiedTextSymbolIndex,c.verticalPlacedTextSymbolIndex];for(const w of v)w>=0&&(e.text.placedSymbolArray.get(w).crossTileID=g>=0&&w!==g?0:c.crossTileID)}markUsedOrientation(e,r,c){const f=r===h.ay.horizontal||r===h.ay.horizontalOnly?r:0,g=r===h.ay.vertical?r:0,v=[c.leftJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.rightJustifiedTextSymbolIndex];for(const w of v)e.text.placedSymbolArray.get(w).placedOrientation=f;c.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(c.verticalPlacedTextSymbolIndex).placedOrientation=g)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;const r=this.prevPlacement;let c=!1;this.prevZoomAdjustment=r?r.zoomAdjustment(this.transform.zoom):0;const f=r?r.symbolFadeChange(e):1,g=r?r.opacities:{},v=r?r.variableOffsets:{},w=r?r.placedOrientations:{};for(const S in this.placements){const C=this.placements[S],D=g[S];D?(this.opacities[S]=new Es(D,f,C.text,C.icon),c=c||C.text!==D.text.placed||C.icon!==D.icon.placed):(this.opacities[S]=new Es(null,f,C.text,C.icon,C.skipFade),c=c||C.text||C.icon)}for(const S in g){const C=g[S];if(!this.opacities[S]){const D=new Es(C,f,!1,!1);D.isHidden()||(this.opacities[S]=D,c=c||C.text.placed||C.icon.placed)}}for(const S in v)this.variableOffsets[S]||!this.opacities[S]||this.opacities[S].isHidden()||(this.variableOffsets[S]=v[S]);for(const S in w)this.placedOrientations[S]||!this.opacities[S]||this.opacities[S].isHidden()||(this.placedOrientations[S]=w[S]);if(r&&r.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");c?this.lastPlacementChangeTime=e:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=r?r.lastPlacementChangeTime:e)}updateLayerOpacities(e,r){const c={};for(const f of r){const g=f.getBucket(e);g&&f.latestFeatureIndex&&e.id===g.layerIds[0]&&this.updateBucketOpacities(g,f.tileID,c,f.collisionBoxArray)}}updateBucketOpacities(e,r,c,f){e.hasTextData()&&(e.text.opacityVertexArray.clear(),e.text.hasVisibleVertices=!1),e.hasIconData()&&(e.icon.opacityVertexArray.clear(),e.icon.hasVisibleVertices=!1),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();const g=e.layers[0],v=g.layout,w=new Es(null,0,!1,!1,!0),S=v.get("text-allow-overlap"),C=v.get("icon-allow-overlap"),D=g._unevaluatedLayout.hasValue("text-variable-anchor")||g._unevaluatedLayout.hasValue("text-variable-anchor-offset"),k=v.get("text-rotation-alignment")==="map",L=v.get("text-pitch-alignment")==="map",j=v.get("icon-text-fit")!=="none",Z=new Es(null,0,S&&(C||!e.hasIconData()||v.get("icon-optional")),C&&(S||!e.hasTextData()||v.get("text-optional")),!0);!e.collisionArrays&&f&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(f);const W=(it,st,ht)=>{for(let at=0;at<st/4;at++)it.opacityVertexArray.emplaceBack(ht);it.hasVisibleVertices=it.hasVisibleVertices||ht!==Kr},Q=this.collisionBoxArrays.get(e.bucketInstanceId);for(let it=0;it<e.symbolInstances.length;it++){const st=e.symbolInstances.get(it),{numHorizontalGlyphVertices:ht,numVerticalGlyphVertices:at,crossTileID:dt}=st;let mt=this.opacities[dt];c[dt]?mt=w:mt||(mt=Z,this.opacities[dt]=mt),c[dt]=!0;const ct=st.numIconVertices>0,Tt=this.placedOrientations[st.crossTileID],kt=Tt===h.ay.vertical,zt=Tt===h.ay.horizontal||Tt===h.ay.horizontalOnly;if(ht>0||at>0){const Rt=Oo(mt.text);W(e.text,ht,kt?Kr:Rt),W(e.text,at,zt?Kr:Rt);const ae=mt.text.isHidden();[st.rightJustifiedTextSymbolIndex,st.centerJustifiedTextSymbolIndex,st.leftJustifiedTextSymbolIndex].forEach((ve=>{ve>=0&&(e.text.placedSymbolArray.get(ve).hidden=ae||kt?1:0)})),st.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(st.verticalPlacedTextSymbolIndex).hidden=ae||zt?1:0);const re=this.variableOffsets[st.crossTileID];re&&this.markUsedJustification(e,re.anchor,st,Tt);const Xt=this.placedOrientations[st.crossTileID];Xt&&(this.markUsedJustification(e,"left",st,Xt),this.markUsedOrientation(e,Xt,st))}if(ct){const Rt=Oo(mt.icon),ae=!(j&&st.verticalPlacedIconSymbolIndex&&kt);st.placedIconSymbolIndex>=0&&(W(e.icon,st.numIconVertices,ae?Rt:Kr),e.icon.placedSymbolArray.get(st.placedIconSymbolIndex).hidden=mt.icon.isHidden()),st.verticalPlacedIconSymbolIndex>=0&&(W(e.icon,st.numVerticalIconVertices,ae?Kr:Rt),e.icon.placedSymbolArray.get(st.verticalPlacedIconSymbolIndex).hidden=mt.icon.isHidden())}const It=Q&&Q.has(it)?Q.get(it):{text:null,icon:null};if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){const Rt=e.collisionArrays[it];if(Rt){let ae=new h.P(0,0);if(Rt.textBox||Rt.verticalTextBox){let re=!0;if(D){const Xt=this.variableOffsets[dt];Xt?(ae=xh(Xt.anchor,Xt.width,Xt.height,Xt.textOffset,Xt.textBoxScale),k&&ae._rotate(L?-this.transform.bearingInRadians:this.transform.bearingInRadians)):re=!1}if(Rt.textBox||Rt.verticalTextBox){let Xt;Rt.textBox&&(Xt=kt),Rt.verticalTextBox&&(Xt=zt),mu(e.textCollisionBox.collisionVertexArray,mt.text.placed,!re||Xt,It.text,ae.x,ae.y)}}if(Rt.iconBox||Rt.verticalIconBox){const re=!!(!zt&&Rt.verticalIconBox);let Xt;Rt.iconBox&&(Xt=re),Rt.verticalIconBox&&(Xt=!re),mu(e.iconCollisionBox.collisionVertexArray,mt.icon.placed,Xt,It.icon,j?ae.x:0,j?ae.y:0)}}}}if(e.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.text.opacityVertexArray.length!==e.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${e.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${e.text.layoutVertexArray.length}) / 4`);if(e.icon.opacityVertexArray.length!==e.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${e.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${e.icon.layoutVertexArray.length}) / 4`);e.bucketInstanceId in this.collisionCircleArrays&&(e.collisionCircleArray=this.collisionCircleArrays[e.bucketInstanceId],delete this.collisionCircleArrays[e.bucketInstanceId])}symbolFadeChange(e){return this.fadeDuration===0?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,r){const c=this.zoomAtLastRecencyCheck===r?1-this.zoomAdjustment(r):1;return this.zoomAtLastRecencyCheck=r,this.commitTime+this.fadeDuration*c>e}setStale(){this.stale=!0}}function mu(m,e,r,c,f,g){c&&c.length!==0||(c=[0,0,0,0]);const v=c[0]-tn,w=c[1]-tn,S=c[2]-tn,C=c[3]-tn;m.emplaceBack(e?1:0,r?1:0,f||0,g||0,v,w),m.emplaceBack(e?1:0,r?1:0,f||0,g||0,S,w),m.emplaceBack(e?1:0,r?1:0,f||0,g||0,S,C),m.emplaceBack(e?1:0,r?1:0,f||0,g||0,v,C)}const bh=Math.pow(2,25),fc=Math.pow(2,24),wh=Math.pow(2,17),qa=Math.pow(2,16),gu=Math.pow(2,9),_u=Math.pow(2,8),pc=Math.pow(2,1);function Oo(m){if(m.opacity===0&&!m.placed)return 0;if(m.opacity===1&&m.placed)return 4294967295;const e=m.placed?1:0,r=Math.floor(127*m.opacity);return r*bh+e*fc+r*wh+e*qa+r*gu+e*_u+r*pc+e}const Kr=0;class mc{constructor(e){this._sortAcrossTiles=e.layout.get("symbol-z-order")!=="viewport-y"&&!e.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(e,r,c,f,g){const v=this._bucketParts;for(;this._currentTileIndex<e.length;)if(r.getBucketParts(v,f,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,g())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,v.sort(((w,S)=>w.sortKey-S.sortKey)));this._currentPartIndex<v.length;)if(r.placeLayerBucketPart(v[this._currentPartIndex],this._seenCrossTileIDs,c),this._currentPartIndex++,g())return!0;return!1}}class Bo{constructor(e,r,c,f,g,v,w,S){this.placement=new Bf(e,r,v,w,S),this._currentPlacementIndex=c.length-1,this._forceFullPlacement=f,this._showCollisionBoxes=g,this._done=!1}isDone(){return this._done}continuePlacement(e,r,c){const f=Kt(),g=()=>!this._forceFullPlacement&&Kt()-f>2;for(;this._currentPlacementIndex>=0;){const v=r[e[this._currentPlacementIndex]],w=this.placement.collisionIndex.transform.zoom;if(v.type==="symbol"&&(!v.minzoom||v.minzoom<=w)&&(!v.maxzoom||v.maxzoom>w)){if(this._inProgressLayer||(this._inProgressLayer=new mc(v)),this._inProgressLayer.continuePlacement(c[v.source],this.placement,this._showCollisionBoxes,v,g))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}const Qr=512/h.a4/2;class Th{constructor(e,r,c){this.tileID=e,this.bucketInstanceId=c,this._symbolsByKey={};const f=new Map;for(let g=0;g<r.length;g++){const v=r.get(g),w=v.key,S=f.get(w);S?S.push(v):f.set(w,[v])}for(const[g,v]of f){const w={positions:v.map((S=>({x:Math.floor(S.anchorX*Qr),y:Math.floor(S.anchorY*Qr)}))),crossTileIDs:v.map((S=>S.crossTileID))};if(w.positions.length>128){const S=new h.aS(w.positions.length,16,Uint16Array);for(const{x:C,y:D}of w.positions)S.add(C,D);S.finish(),delete w.positions,w.index=S}this._symbolsByKey[g]=w}}getScaledCoordinates(e,r){const{x:c,y:f,z:g}=this.tileID.canonical,{x:v,y:w,z:S}=r.canonical,C=Qr/Math.pow(2,S-g),D=(w*h.a4+e.anchorY)*C,k=f*h.a4*Qr;return{x:Math.floor((v*h.a4+e.anchorX)*C-c*h.a4*Qr),y:Math.floor(D-k)}}findMatches(e,r,c){const f=this.tileID.canonical.z<r.canonical.z?1:Math.pow(2,this.tileID.canonical.z-r.canonical.z);for(let g=0;g<e.length;g++){const v=e.get(g);if(v.crossTileID)continue;const w=this._symbolsByKey[v.key];if(!w)continue;const S=this.getScaledCoordinates(v,r);if(w.index){const C=w.index.range(S.x-f,S.y-f,S.x+f,S.y+f).sort();for(const D of C){const k=w.crossTileIDs[D];if(!c[k]){c[k]=!0,v.crossTileID=k;break}}}else if(w.positions)for(let C=0;C<w.positions.length;C++){const D=w.positions[C],k=w.crossTileIDs[C];if(Math.abs(D.x-S.x)<=f&&Math.abs(D.y-S.y)<=f&&!c[k]){c[k]=!0,v.crossTileID=k;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map((({crossTileIDs:e})=>e))}}class zd{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Jr{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){const r=Math.round((e-this.lng)/360);if(r!==0)for(const c in this.indexes){const f=this.indexes[c],g={};for(const v in f){const w=f[v];w.tileID=w.tileID.unwrapTo(w.tileID.wrap+r),g[w.tileID.key]=w}this.indexes[c]=g}this.lng=e}addBucket(e,r,c){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===r.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let g=0;g<r.symbolInstances.length;g++)r.symbolInstances.get(g).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});const f=this.usedCrossTileIDs[e.overscaledZ];for(const g in this.indexes){const v=this.indexes[g];if(Number(g)>e.overscaledZ)for(const w in v){const S=v[w];S.tileID.isChildOf(e)&&S.findMatches(r.symbolInstances,e,f)}else{const w=v[e.scaledTo(Number(g)).key];w&&w.findMatches(r.symbolInstances,e,f)}}for(let g=0;g<r.symbolInstances.length;g++){const v=r.symbolInstances.get(g);v.crossTileID||(v.crossTileID=c.generate(),f[v.crossTileID]=!0)}return this.indexes[e.overscaledZ]===void 0&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new Th(e,r.symbolInstances,r.bucketInstanceId),!0}removeBucketCrossTileIDs(e,r){for(const c of r.getCrossTileIDsLists())for(const f of c)delete this.usedCrossTileIDs[e][f]}removeStaleBuckets(e){let r=!1;for(const c in this.indexes){const f=this.indexes[c];for(const g in f)e[f[g].bucketInstanceId]||(this.removeBucketCrossTileIDs(c,f[g]),delete f[g],r=!0)}return r}}class No{constructor(){this.layerIndexes={},this.crossTileIDs=new zd,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,r,c){let f=this.layerIndexes[e.id];f===void 0&&(f=this.layerIndexes[e.id]=new Jr);let g=!1;const v={};f.handleWrapJump(c);for(const w of r){const S=w.getBucket(e);S&&e.id===S.layerIds[0]&&(S.bucketInstanceId||(S.bucketInstanceId=++this.maxBucketInstanceId),f.addBucket(w.tileID,S,this.crossTileIDs)&&(g=!0),v[S.bucketInstanceId]=!0)}return f.removeStaleBuckets(v)&&(g=!0),g}pruneUnusedLayers(e){const r={};e.forEach((c=>{r[c]=!0}));for(const c in this.layerIndexes)r[c]||delete this.layerIndexes[c]}}var ii="void main() {fragColor=vec4(1.0);}";const Ia={prelude:Xe(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:Xe("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:Xe("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:Xe(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:Xe(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Xe(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Xe(ii,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:Xe(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:Xe(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Xe("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Xe("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),colorRelief:Xe(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;uniform vec4 u_unpack;uniform sampler2D u_elevation_stops;uniform sampler2D u_color_stops;uniform int u_color_ramp_size;uniform float u_opacity;in vec2 v_pos;float getElevation(vec2 coord) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}float getElevationStop(int stop) {float x=(float(stop)+0.5)/float(u_color_ramp_size);vec4 data=texture(u_elevation_stops,vec2(x,0))*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {float el=getElevation(v_pos);int r=(u_color_ramp_size-1);int l=0;float el_l=getElevationStop(l);float el_r=getElevationStop(r);while(r-l > 1){int m=(r+l)/2;float el_m=getElevationStop(m);if(el < el_m){r=m;el_r=el_m;}else
{l=m;el_l=el_m;}}float x=(float(l)+(el-el_l)/(el_r-el_l)+0.5)/float(u_color_ramp_size);fragColor=u_opacity*texture(u_color_stops,vec2(x,0));
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_dimension;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_pos/8192.0)*scale+epsilon;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),debug:Xe("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:Xe(ii,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:Xe(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:Xe(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:Xe(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:Xe(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Xe(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Xe(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Xe(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {vec2 epsilon=1.0/u_dimension;float tileSize=u_dimension.x-2.0;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))*tileSize/pow(2.0,exaggeration+(28.2562-u_zoom));fragColor=clamp(vec4(deriv.x/8.0+0.5,deriv.y/8.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Xe(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform float u_exaggeration;uniform vec4 u_accent;uniform int u_method;uniform float u_altitudes[NUM_ILLUMINATION_SOURCES];uniform float u_azimuths[NUM_ILLUMINATION_SOURCES];uniform vec4 u_shadows[NUM_ILLUMINATION_SOURCES];uniform vec4 u_highlights[NUM_ILLUMINATION_SOURCES];
#define PI 3.141592653589793
#define STANDARD 0
#define COMBINED 1
#define IGOR 2
#define MULTIDIRECTIONAL 3
#define BASIC 4
float get_aspect(vec2 deriv){return deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);}void igor_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float aspect=get_aspect(deriv);float azimuth=u_azimuths[0]+PI;float slope_stength=atan(length(deriv))*2.0/PI;float aspect_strength=1.0-abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);float shadow_strength=slope_stength*aspect_strength;float highlight_strength=slope_stength*(1.0-aspect_strength);fragColor=u_shadows[0]*shadow_strength+u_highlights[0]*highlight_strength;}void standard_hillshade(vec2 deriv){float azimuth=u_azimuths[0]+PI;float slope=atan(0.625*length(deriv));float aspect=get_aspect(deriv);float intensity=u_exaggeration;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadows[0],u_highlights[0],shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;}void basic_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor=u_highlights[0]*(2.0*shade-1.0);}else
{fragColor=u_shadows[0]*(1.0-2.0*shade);}}void multidirectional_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;fragColor=vec4(0,0,0,0);for(int i=0; i < NUM_ILLUMINATION_SOURCES; i++){float cos_alt=cos(u_altitudes[i]);float sin_alt=sin(u_altitudes[i]);float cos_az=-cos(u_azimuths[i]);float sin_az=-sin(u_azimuths[i]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor+=u_highlights[i]*(2.0*shade-1.0)/float(NUM_ILLUMINATION_SOURCES);}else
{fragColor+=u_shadows[i]*(1.0-2.0*shade)/float(NUM_ILLUMINATION_SOURCES);}}}void combined_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=acos((sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv)));cang=clamp(cang,0.0,PI/2.0);float shade=cang*atan(length(deriv))*4.0/PI/PI;float highlight=(PI/2.0-cang)*atan(length(deriv))*4.0/PI/PI;fragColor=u_shadows[0]*shade+u_highlights[0]*highlight;}void main() {vec4 pixel=texture(u_image,v_pos);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));vec2 deriv=((pixel.rg*8.0)-4.0)/scaleFactor;if (u_method==BASIC) {basic_hillshade(deriv);} else if (u_method==COMBINED) {combined_hillshade(deriv);} else if (u_method==IGOR) {igor_hillshade(deriv);} else if (u_method==MULTIDIRECTIONAL) {multidirectional_hillshade(deriv);} else if (u_method==STANDARD) {standard_hillshade(deriv);} else {standard_hillshade(deriv);}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:Xe(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Xe(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Xe(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Xe(`uniform lowp float u_device_pixel_ratio;uniform lowp float u_lineatlas_width;uniform sampler2D u_image;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0/u_device_pixel_ratio)/min(dasharray_from.w,dasharray_to.w);alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
float u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}`),lineGradientSDF:Xe(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform sampler2D u_image_dash;uniform float u_mix;uniform lowp float u_lineatlas_width;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);float sdfdist_a=texture(u_image_dash,v_tex_a).a;float sdfdist_b=texture(u_image_dash,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0)/min(dasharray_from.w,dasharray_to.w);float dash_alpha=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*dash_alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;out vec2 v_tex_a;out vec2 v_tex_b;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;float texel_height=1.0/u_image_height;float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
float u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}`),raster:Xe(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:Xe(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Xe(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Xe(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Xe("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:Xe("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:Xe("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:Xe("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:Xe(`in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:Xe("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function Xe(m,e){const r=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,c=e.match(/in ([\w]+) ([\w]+)/g),f=m.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),g=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),v=g?g.concat(f):f,w={};return{fragmentSource:m=m.replace(r,((S,C,D,k,L)=>(w[L]=!0,C==="define"?`
#ifndef HAS_UNIFORM_u_${L}
in ${D} ${k} ${L};
#else
uniform ${D} ${k} u_${L};
#endif
`:`
#ifdef HAS_UNIFORM_u_${L}
    ${D} ${k} ${L} = u_${L};
#endif
`))),vertexSource:e=e.replace(r,((S,C,D,k,L)=>{const j=k==="float"?"vec2":"vec4",Z=L.match(/color/)?"color":j;return w[L]?C==="define"?`
#ifndef HAS_UNIFORM_u_${L}
uniform lowp float u_${L}_t;
in ${D} ${j} a_${L};
out ${D} ${k} ${L};
#else
uniform ${D} ${k} u_${L};
#endif
`:Z==="vec4"?`
#ifndef HAS_UNIFORM_u_${L}
    ${L} = a_${L};
#else
    ${D} ${k} ${L} = u_${L};
#endif
`:`
#ifndef HAS_UNIFORM_u_${L}
    ${L} = unpack_mix_${Z}(a_${L}, u_${L}_t);
#else
    ${D} ${k} ${L} = u_${L};
#endif
`:C==="define"?`
#ifndef HAS_UNIFORM_u_${L}
uniform lowp float u_${L}_t;
in ${D} ${j} a_${L};
#else
uniform ${D} ${k} u_${L};
#endif
`:Z==="vec4"?`
#ifndef HAS_UNIFORM_u_${L}
    ${D} ${k} ${L} = a_${L};
#else
    ${D} ${k} ${L} = u_${L};
#endif
`:`
#ifndef HAS_UNIFORM_u_${L}
    ${D} ${k} ${L} = unpack_mix_${Z}(a_${L}, u_${L}_t);
#else
    ${D} ${k} ${L} = u_${L};
#endif
`})),staticAttributes:c,staticUniforms:v}}class ts{constructor(e,r,c){this.vertexBuffer=e,this.indexBuffer=r,this.segments=c}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var wn=h.aT([{name:"a_pos",type:"Int16",components:2}]);const zn="#define PROJECTION_MERCATOR",Pn="mercator";class Bn{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return Pn}get shaderDefine(){return zn}get shaderPreludeCode(){return Ia.projectionMercator}get vertexShaderPreludeCode(){return Ia.projectionMercator.vertexSource}get subdivisionGranularity(){return h.aU.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(e){}getMeshFromTileID(e,r,c,f,g){if(this._cachedMesh)return this._cachedMesh;const v=new h.aV;v.emplaceBack(0,0),v.emplaceBack(h.a4,0),v.emplaceBack(0,h.a4),v.emplaceBack(h.a4,h.a4);const w=e.createVertexBuffer(v,wn.members),S=h.aW.simpleSegment(0,0,4,2),C=new h.aX;C.emplaceBack(1,0,2),C.emplaceBack(1,2,3);const D=e.createIndexBuffer(C);return this._cachedMesh=new ts(w,D,S),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(e){}}class Ii{constructor(e=0,r=0,c=0,f=0){if(isNaN(e)||e<0||isNaN(r)||r<0||isNaN(c)||c<0||isNaN(f)||f<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=r,this.left=c,this.right=f}interpolate(e,r,c){return r.top!=null&&e.top!=null&&(this.top=h.G.number(e.top,r.top,c)),r.bottom!=null&&e.bottom!=null&&(this.bottom=h.G.number(e.bottom,r.bottom,c)),r.left!=null&&e.left!=null&&(this.left=h.G.number(e.left,r.left,c)),r.right!=null&&e.right!=null&&(this.right=h.G.number(e.right,r.right,c)),this}getCenter(e,r){const c=h.an((this.left+e-this.right)/2,0,e),f=h.an((this.top+r-this.bottom)/2,0,r);return new h.P(c,f)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new Ii(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function gc(m,e){if(!m.renderWorldCopies||m.lngRange)return;const r=e.lng-m.center.lng;e.lng+=r>180?-360:r<-180?360:0}function Hn(m){return Math.max(0,Math.floor(m))}class Tn{constructor(e,r){var c;this.applyConstrain=(f,g)=>this._constrainOverride!==null?this._constrainOverride(f,g):this._callbacks.defaultConstrain(f,g),this._callbacks=e,this._tileSize=512,this._renderWorldCopies=r?.renderWorldCopies===void 0||!!r?.renderWorldCopies,this._minZoom=r?.minZoom||0,this._maxZoom=r?.maxZoom||22,this._minPitch=r?.minPitch==null?0:r?.minPitch,this._maxPitch=r?.maxPitch==null?60:r?.maxPitch,this._constrainOverride=(c=r?.constrainOverride)!==null&&c!==void 0?c:null,this.setMaxBounds(),this._width=0,this._height=0,this._center=new h.V(0,0),this._elevation=0,this._zoom=0,this._tileZoom=Hn(this._zoom),this._scale=h.aq(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new Ii,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(e,r,c){this._constrainOverride=e.constrainOverride,this._latRange=e.latRange,this._lngRange=e.lngRange,this._width=e.width,this._height=e.height,this._center=e.center,this._elevation=e.elevation,this._minElevationForCurrentTile=e.minElevationForCurrentTile,this._zoom=e.zoom,this._tileZoom=Hn(this._zoom),this._scale=h.aq(this._zoom),this._bearingInRadians=e.bearingInRadians,this._fovInRadians=e.fovInRadians,this._pitchInRadians=e.pitchInRadians,this._rollInRadians=e.rollInRadians,this._unmodified=e.unmodified,this._edgeInsets=new Ii(e.padding.top,e.padding.bottom,e.padding.left,e.padding.right),this._minZoom=e.minZoom,this._maxZoom=e.maxZoom,this._minPitch=e.minPitch,this._maxPitch=e.maxPitch,this._renderWorldCopies=e.renderWorldCopies,this._cameraToCenterDistance=e.cameraToCenterDistance,this._nearZ=e.nearZ,this._farZ=e.farZ,this._autoCalculateNearFarZ=!c&&e.autoCalculateNearFarZ,r&&this.constrainInternal(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(e){this._minElevationForCurrentTile=e}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(e){this._minZoom!==e&&(this._minZoom=e,this.setZoom(this.applyConstrain(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.setZoom(this.applyConstrain(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(e){this._minPitch!==e&&(this._minPitch=e,this.setPitch(Math.max(this.pitch,e)))}get maxPitch(){return this._maxPitch}setMaxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.setPitch(Math.min(this.pitch,e)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(e){e===void 0?e=!0:e===null&&(e=!1),this._renderWorldCopies=e}get constrainOverride(){return this._constrainOverride}setConstrainOverride(e){e===void 0&&(e=null),this._constrainOverride!==e&&(this._constrainOverride=e,this.constrainInternal(),this._calcMatrices())}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new h.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(e){const r=h.W(e,-180,180)*Math.PI/180;var c,f,g,v,w,S,C,D,k;this._bearingInRadians!==r&&(this._unmodified=!1,this._bearingInRadians=r,this._calcMatrices(),this._rotationMatrix=ft(),c=this._rotationMatrix,g=-this._bearingInRadians,v=(f=this._rotationMatrix)[0],w=f[1],S=f[2],C=f[3],D=Math.sin(g),k=Math.cos(g),c[0]=v*k+S*D,c[1]=w*k+C*D,c[2]=v*-D+S*k,c[3]=w*-D+C*k)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(e){const r=h.an(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==r&&(this._unmodified=!1,this._pitchInRadians=r,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(e){const r=e/180*Math.PI;this._rollInRadians!==r&&(this._unmodified=!1,this._rollInRadians=r,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return h.aY(this._fovInRadians)}setFov(e){e=h.an(e,.1,150),this.fov!==e&&(this._unmodified=!1,this._fovInRadians=h.ap(e),this._calcMatrices())}get zoom(){return this._zoom}setZoom(e){const r=this.applyConstrain(this._center,e).zoom;this._zoom!==r&&(this._unmodified=!1,this._zoom=r,this._tileZoom=Math.max(0,Math.floor(r)),this._scale=h.aq(r),this.constrainInternal(),this._calcMatrices())}get center(){return this._center}setCenter(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this.constrainInternal(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(e){e!==this._elevation&&(this._elevation=e,this.constrainInternal(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(e,r){this._autoCalculateNearFarZ=!1,this._nearZ=e,this._farZ=r,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,r,c){this._unmodified=!1,this._edgeInsets.interpolate(e,r,c),this.constrainInternal(),this._calcMatrices()}resize(e,r,c=!0){this._width=e,this._height=r,c&&this.constrainInternal(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new Di([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(e){e?(this._lngRange=[e.getWest(),e.getEast()],this._latRange=[e.getSouth(),e.getNorth()],this.constrainInternal()):(this._lngRange=null,this._latRange=[-h.ao,h.ao])}getCameraQueryGeometry(e,r){if(r.length===1)return[r[0],e];{const{minX:c,minY:f,maxX:g,maxY:v}=h.ab.fromPoints(r).extend(e);return[new h.P(c,f),new h.P(g,f),new h.P(g,v),new h.P(c,v),new h.P(c,f)]}}constrainInternal(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;const e=this._unmodified,{center:r,zoom:c}=this.applyConstrain(this.center,this.zoom);this.setCenter(r),this.setZoom(c),this._unmodified=e,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let e=h.ar(new Float64Array(16));h.Q(e,e,[this._width/2,-this._height/2,1]),h.O(e,e,[1,-1,0]),this._clipSpaceToPixelsMatrix=e,e=h.ar(new Float64Array(16)),h.Q(e,e,[1,-1,1]),h.O(e,e,[-1,-1,0]),h.Q(e,e,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=e,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(e,r,c,f){const g=c!==void 0?c:this.bearing,v=f=f!==void 0?f:this.pitch,w=h.aa.fromLngLat(e,r),S=-Math.cos(h.ap(v)),C=Math.sin(h.ap(v)),D=C*Math.sin(h.ap(g)),k=-C*Math.cos(h.ap(g));let L=this.elevation;const j=r-L;let Z;S*j>=0||Math.abs(S)<.1?(Z=1e4,L=r+Z*S):Z=-j/S;let W,Q,it=h.aZ(1,w.y),st=0;do{if(st+=1,st>10)break;Q=Z/it,W=new h.aa(w.x+D*Q,w.y+k*Q),it=1/W.meterInMercatorCoordinateUnits()}while(Math.abs(Z-Q*it)>1e-12);return{center:W.toLngLat(),elevation:L,zoom:h.at(this.height/2/Math.tan(this.fovInRadians/2)/Q/this.tileSize)}}recalculateZoomAndCenter(e){if(this.elevation-e==0)return;const r=h.as(1,this.center.lat)*this.worldSize,c=this.cameraToCenterDistance/r,f=h.aa.fromLngLat(this.center,this.elevation),g=wt(this.center,this.elevation,this.pitch,this.bearing,c);this._elevation=e;const v=this.calculateCenterFromCameraLngLatAlt(g.toLngLat(),h.aZ(g.z,f.y),this.bearing,this.pitch);this._elevation=v.elevation,this._center=v.center,this.setZoom(v.zoom)}getCameraPoint(){const e=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new h.P(e*Math.sin(this.rollInRadians),e*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){const e=h.as(1,this.center.lat)*this.worldSize;return wt(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/e).toLngLat()}getMercatorTileCoordinates(e){if(!e)return[0,0,1,1];const r=e.canonical.z>=0?1<<e.canonical.z:Math.pow(2,e.canonical.z);return[e.canonical.x/r,e.canonical.y/r,1/r/h.a4,1/r/h.a4]}}class aa{constructor(e,r){this.min=e,this.max=r,this.center=h.a_([],h.a$([],this.min,this.max),.5)}quadrant(e){const r=[e%2==0,e<2],c=h.b0(this.min),f=h.b0(this.max);for(let g=0;g<r.length;g++)c[g]=r[g]?this.min[g]:this.center[g],f[g]=r[g]?this.center[g]:this.max[g];return f[2]=this.max[2],new aa(c,f)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}intersectsFrustum(e){let r=!0;for(let c=0;c<e.planes.length;c++){const f=this.intersectsPlane(e.planes[c]);if(f===0)return 0;f===1&&(r=!1)}return r?2:e.aabb.min[0]>this.max[0]||e.aabb.min[1]>this.max[1]||e.aabb.min[2]>this.max[2]||e.aabb.max[0]<this.min[0]||e.aabb.max[1]<this.min[1]||e.aabb.max[2]<this.min[2]?0:1}intersectsPlane(e){let r=e[3],c=e[3];for(let f=0;f<3;f++)e[f]>0?(r+=e[f]*this.min[f],c+=e[f]*this.max[f]):(c+=e[f]*this.min[f],r+=e[f]*this.max[f]);return r>=0?2:c<0?0:1}}class Al{distanceToTile2d(e,r,c,f){const g=f.distanceX([e,r]),v=f.distanceY([e,r]);return Math.hypot(g,v)}getWrap(e,r,c){return c}getTileBoundingVolume(e,r,c,f){var g,v;let w=0,S=0;if(f?.terrain){const D=new h.a1(e.z,r,e.z,e.x,e.y),k=f.terrain.getMinMaxElevation(D);w=(g=k.minElevation)!==null&&g!==void 0?g:Math.min(0,c),S=(v=k.maxElevation)!==null&&v!==void 0?v:Math.max(0,c)}const C=1<<e.z;return new aa([r+e.x/C,e.y/C,w],[r+(e.x+1)/C,(e.y+1)/C,S])}allowVariableZoom(e,r){const c=e.fov*(Math.abs(Math.cos(e.rollInRadians))*e.height+Math.abs(Math.sin(e.rollInRadians))*e.width)/e.height,f=h.an(78.5-c/2,0,60);return!!r.terrain||e.pitch>f}allowWorldCopies(){return!0}prepareNextFrame(){}}class Ra{constructor(e,r,c){this.points=e,this.planes=r,this.aabb=c}static fromInvProjectionMatrix(e,r=1,c=0,f,g){const v=g?[[6,5,4],[0,1,2],[0,3,7],[2,1,5],[3,2,6],[0,4,5]]:[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]],w=Math.pow(2,c),S=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((L=>(function(j,Z,W,Q){const it=h.aG([],j,Z),st=1/it[3]/W*Q;return h.b5(it,it,[st,st,1/it[3],st])})(L,e,r,w)));f&&(function(L,j,Z,W){const Q=W?4:0,it=W?0:4;let st=0;const ht=[],at=[];for(let ct=0;ct<4;ct++){const Tt=h.b1([],L[ct+it],L[ct+Q]),kt=h.b6(Tt);h.a_(Tt,Tt,1/kt),ht.push(kt),at.push(Tt)}for(let ct=0;ct<4;ct++){const Tt=h.b7(L[ct+Q],at[ct],Z);st=Tt!==null&&Tt>=0?Math.max(st,Tt):Math.max(st,ht[ct])}const dt=(function(ct,Tt){const kt=h.b1([],ct[Tt[0]],ct[Tt[1]]),zt=h.b1([],ct[Tt[2]],ct[Tt[1]]),It=[0,0,0,0];return h.b2(It,h.b3([],kt,zt)),It[3]=-h.b4(It,ct[Tt[0]]),It})(L,j),mt=(function(ct,Tt){const kt=h.b8(ct),zt=h.b9([],ct,1/kt),It=h.b1([],Tt,h.a_([],zt,h.b4(Tt,zt))),Rt=h.b8(It);if(Rt>0){const ae=Math.sqrt(1-zt[3]*zt[3]),re=h.a_([],zt,-zt[3]),Xt=h.a$([],re,h.a_([],It,ae/Rt));return h.ba(Tt,Xt)}return null})(Z,dt);if(mt!==null){const ct=mt/h.b4(at[0],dt);st=Math.min(st,ct)}for(let ct=0;ct<4;ct++){const Tt=Math.min(st,ht[ct]);L[ct+it]=[L[ct+Q][0]+at[ct][0]*Tt,L[ct+Q][1]+at[ct][1]*Tt,L[ct+Q][2]+at[ct][2]*Tt,1]}})(S,v[0],f,g);const C=v.map((L=>{const j=h.b1([],S[L[0]],S[L[1]]),Z=h.b1([],S[L[2]],S[L[1]]),W=h.b2([],h.b3([],j,Z)),Q=-h.b4(W,S[L[1]]);return W.concat(Q)})),D=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],k=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(const L of S)for(let j=0;j<3;j++)D[j]=Math.min(D[j],L[j]),k[j]=Math.max(k[j],L[j]);return new Ra(S,C,new aa(D,k))}}class Ni{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,r,c){return this._helper.interpolatePadding(e,r,c)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,r,c=!0){this._helper.resize(e,r,c)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}setConstrainOverride(e){this._helper.setConstrainOverride(e)}overrideNearFarZ(e,r){this._helper.overrideNearFarZ(e,r)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(e,r){}constructor(e){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this.defaultConstrain=(r,c)=>{c=h.an(+c,this.minZoom,this.maxZoom);const f={center:new h.V(r.lng,r.lat),zoom:c};let g=this._helper._lngRange;if(!this._helper._renderWorldCopies&&g===null){const at=179.9999999999;g=[-at,at]}const v=this.tileSize*h.aq(f.zoom);let w=0,S=v,C=0,D=v,k=0,L=0;const{x:j,y:Z}=this.size;if(this._helper._latRange){const at=this._helper._latRange;w=h.X(at[1])*v,S=h.X(at[0])*v,S-w<Z&&(k=Z/(S-w))}g&&(C=h.W(h.Y(g[0])*v,0,v),D=h.W(h.Y(g[1])*v,0,v),D<C&&(D+=v),D-C<j&&(L=j/(D-C)));const{x:W,y:Q}=ot(v,r);let it,st;const ht=Math.max(L||0,k||0);if(ht){const at=new h.P(L?(D+C)/2:W,k?(S+w)/2:Q);return f.center=ut(v,at).wrap(),f.zoom+=h.at(ht),f}if(this._helper._latRange){const at=Z/2;Q-at<w&&(st=w+at),Q+at>S&&(st=S-at)}if(g){const at=(C+D)/2;let dt=W;this._helper._renderWorldCopies&&(dt=h.W(W,at-v/2,at+v/2));const mt=j/2;dt-mt<C&&(it=C+mt),dt+mt>D&&(it=D-mt)}if(it!==void 0||st!==void 0){const at=new h.P(it??W,st??Q);f.center=ut(v,at).wrap()}return f},this.applyConstrain=(r,c)=>this._helper.applyConstrain(r,c),this._helper=new Tn({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(r,c)=>this.defaultConstrain(r,c)},e),this._coveringTilesDetailsProvider=new Al}clone(){const e=new Ni;return e.apply(this),e}apply(e,r,c){this._helper.apply(e,r,c)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(e){const r=[new h.bb(0,e)];if(this._helper._renderWorldCopies){const c=this.screenPointToMercatorCoordinate(new h.P(0,0)),f=this.screenPointToMercatorCoordinate(new h.P(this._helper._width,0)),g=this.screenPointToMercatorCoordinate(new h.P(this._helper._width,this._helper._height)),v=this.screenPointToMercatorCoordinate(new h.P(0,this._helper._height)),w=Math.floor(Math.min(c.x,f.x,g.x,v.x)),S=Math.floor(Math.max(c.x,f.x,g.x,v.x)),C=1;for(let D=w-C;D<=S+C;D++)D!==0&&r.push(new h.bb(D,e))}return r}getCameraFrustum(){return Ra.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(e){const r=this.screenPointToLocation(this.centerPoint,e),c=e?e.getElevationForLngLatZoom(r,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(c)}setLocationAtPoint(e,r){const c=h.as(this.elevation,this.center.lat),f=this.screenPointToMercatorCoordinateAtZ(r,c),g=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,c),v=h.aa.fromLngLat(e),w=new h.aa(v.x-(f.x-g.x),v.y-(f.y-g.y));this.setCenter(w?.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(e,r){return r?this.coordinatePoint(h.aa.fromLngLat(e),r.getElevationForLngLatZoom(e,this._helper._tileZoom),this._pixelMatrix3D):this.coordinatePoint(h.aa.fromLngLat(e))}screenPointToLocation(e,r){var c;return(c=this.screenPointToMercatorCoordinate(e,r))===null||c===void 0?void 0:c.toLngLat()}screenPointToMercatorCoordinate(e,r){if(r){const c=r.pointCoordinate(e);if(c!=null)return c}return this.screenPointToMercatorCoordinateAtZ(e)}screenPointToMercatorCoordinateAtZ(e,r){const c=r||0,f=[e.x,e.y,0,1],g=[e.x,e.y,1,1];h.aG(f,f,this._pixelMatrixInverse),h.aG(g,g,this._pixelMatrixInverse);const v=f[3],w=g[3],S=f[1]/v,C=g[1]/w,D=f[2]/v,k=g[2]/w,L=D===k?0:(c-D)/(k-D);return new h.aa(h.G.number(f[0]/v,g[0]/w,L)/this.worldSize,h.G.number(S,C,L)/this.worldSize,c)}coordinatePoint(e,r=0,c=this._pixelMatrix){const f=[e.x*this.worldSize,e.y*this.worldSize,r,1];return h.aG(f,f,c),new h.P(f[0]/f[3],f[1]/f[3])}getBounds(){const e=Math.max(0,this._helper._height/2-Et(this));return new Di().extend(this.screenPointToLocation(new h.P(0,e))).extend(this.screenPointToLocation(new h.P(this._helper._width,e))).extend(this.screenPointToLocation(new h.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new h.P(0,this._helper._height)))}isPointOnMapSurface(e,r){return r?r.pointCoordinate(e)!=null:e.y>this.height/2-Et(this)}calculatePosMatrix(e,r=!1,c){var f;const g=(f=e.key)!==null&&f!==void 0?f:h.bc(e.wrap,e.canonical.z,e.canonical.z,e.canonical.x,e.canonical.y),v=r?this._alignedPosMatrixCache:this._posMatrixCache;if(v.has(g)){const C=v.get(g);return c?C.f32:C.f64}const w=J(e,this.worldSize);h.S(w,r?this._alignedProjMatrix:this._viewProjMatrix,w);const S={f64:w,f32:new Float32Array(w)};return v.set(g,S),c?S.f32:S.f64}calculateFogMatrix(e){const r=e.key,c=this._fogMatrixCacheF32;if(c.has(r))return c.get(r);const f=J(e,this.worldSize);return h.S(f,this._fogMatrix,f),c.set(r,new Float32Array(f)),c.get(r)}calculateCenterFromCameraLngLatAlt(e,r,c,f){return this._helper.calculateCenterFromCameraLngLatAlt(e,r,c,f)}_calculateNearFarZIfNeeded(e,r,c){if(!this._helper.autoCalculateNearFarZ)return;const f=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),g=e-f*this._helper._pixelPerMeter/Math.cos(r),v=f<0?g:e,w=Math.PI/2+this.pitchInRadians,S=h.ap(this.fov)*(Math.abs(Math.cos(h.ap(this.roll)))*this.height+Math.abs(Math.sin(h.ap(this.roll)))*this.width)/this.height*(.5+c.y/this.height),C=Math.sin(S)*v/Math.sin(h.an(Math.PI-w-S,.01,Math.PI-.01)),D=Et(this),k=Math.atan(D/this._helper.cameraToCenterDistance),L=h.ap(.75),j=k>L?2*k*(.5+c.y/(2*D)):L,Z=Math.sin(j)*v/Math.sin(h.an(Math.PI-w-j,.01,Math.PI-.01)),W=Math.min(C,Z);this._helper._farZ=1.01*(Math.cos(Math.PI/2-r)*W+v),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;const e=this.centerOffset,r=ot(this.worldSize,this.center),c=r.x,f=r.y;this._helper._pixelPerMeter=h.as(1,this.center.lat)*this.worldSize;const g=h.ap(Math.min(this.pitch,H)),v=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(g));let w;this._calculateNearFarZIfNeeded(v,g,e),w=new Float64Array(16),h.bd(w,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),h.aA(this._invProjMatrix,w),w[8]=2*-e.x/this._helper._width,w[9]=2*e.y/this._helper._height,this._projectionMatrix=h.be(w),h.Q(w,w,[1,-1,1]),h.O(w,w,[0,0,-this._helper.cameraToCenterDistance]),h.bf(w,w,-this.rollInRadians),h.bg(w,w,this.pitchInRadians),h.bf(w,w,-this.bearingInRadians),h.O(w,w,[-c,-f,0]),this._mercatorMatrix=h.Q([],w,[this.worldSize,this.worldSize,this.worldSize]),h.Q(w,w,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=h.S(new Float64Array(16),this.clipSpaceToPixelsMatrix,w),h.O(w,w,[0,0,-this.elevation]),this._viewProjMatrix=w,this._invViewProjMatrix=h.aA([],w);const S=[0,0,-1,1];h.aG(S,S,this._invViewProjMatrix),this._cameraPosition=[S[0]/S[3],S[1]/S[3],S[2]/S[3]],this._fogMatrix=new Float64Array(16),h.bd(this._fogMatrix,this.fovInRadians,this.width/this.height,v,this._helper._farZ),this._fogMatrix[8]=2*-e.x/this.width,this._fogMatrix[9]=2*e.y/this.height,h.Q(this._fogMatrix,this._fogMatrix,[1,-1,1]),h.O(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),h.bf(this._fogMatrix,this._fogMatrix,-this.rollInRadians),h.bg(this._fogMatrix,this._fogMatrix,this.pitchInRadians),h.bf(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),h.O(this._fogMatrix,this._fogMatrix,[-c,-f,0]),h.Q(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),h.O(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=h.S(new Float64Array(16),this.clipSpaceToPixelsMatrix,w);const C=this._helper._width%2/2,D=this._helper._height%2/2,k=Math.cos(this.bearingInRadians),L=Math.sin(-this.bearingInRadians),j=c-Math.round(c)+k*C+L*D,Z=f-Math.round(f)+k*D+L*C,W=new Float64Array(w);if(h.O(W,W,[j>.5?j-1:j,Z>.5?Z-1:Z,0]),this._alignedProjMatrix=W,w=h.aA(new Float64Array(16),this._pixelMatrix),!w)throw new Error("failed to invert matrix");this._pixelMatrixInverse=w,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;const e=this.screenPointToMercatorCoordinate(new h.P(0,0)),r=[e.x*this.worldSize,e.y*this.worldSize,0,1];return h.aG(r,r,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){const e=h.as(1,this.center.lat)*this.worldSize;return wt(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/e).toLngLat()}lngLatToCameraDepth(e,r){const c=h.aa.fromLngLat(e),f=[c.x*this.worldSize,c.y*this.worldSize,r,1];return h.aG(f,f,this._viewProjMatrix),f[2]/f[3]}getProjectionData(e){const{overscaledTileID:r,aligned:c,applyTerrainMatrix:f}=e,g=this._helper.getMercatorTileCoordinates(r),v=r?this.calculatePosMatrix(r,c,!0):null;let w;return w=r&&r.terrainRttPosMatrix32f&&f?r.terrainRttPosMatrix32f:v||h.bh(),{mainMatrix:w,tileMercatorCoords:g,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:w}}isLocationOccluded(e){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(e,r,c){return 1}transformLightDirection(e){return h.b0(e)}getRayDirectionFromPixel(e){throw new Error("Not implemented.")}projectTileCoordinates(e,r,c,f){const g=this.calculatePosMatrix(c);let v;f?(v=[e,r,f(e,r),1],h.aG(v,v,g)):(v=[e,r,0,1],dc(v,v,g));const w=v[3];return{point:new h.P(v[0]/w,v[1]/w),signedDistanceFromCamera:w,isOccluded:!1}}populateCache(e){for(const r of e)this.calculatePosMatrix(r)}getMatrixForModel(e,r){const c=h.aa.fromLngLat(e,r),f=c.meterInMercatorCoordinateUnits(),g=h.bi();return h.O(g,g,[c.x,c.y,c.z]),h.bf(g,g,Math.PI),h.bg(g,g,Math.PI/2),h.Q(g,g,[-f,f,f]),g}getProjectionDataForCustomLayer(e=!0){const r=new h.a1(0,0,0,0,0),c=this.getProjectionData({overscaledTileID:r,applyGlobeMatrix:e}),f=J(r,this.worldSize);h.S(f,this._viewProjMatrix,f),c.tileMercatorCoords=[0,0,1,1];const g=[h.a4,h.a4,this.worldSize/this._helper.pixelsPerMeter],v=h.bj();return h.Q(v,f,g),c.fallbackMatrix=v,c.mainMatrix=v,c}getFastPathSimpleProjectionMatrix(e){return this.calculatePosMatrix(e)}}function Ms(){h.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function Cs(m){if(m.useSlerp)if(m.k<1){const e=h.bk(m.startEulerAngles.roll,m.startEulerAngles.pitch,m.startEulerAngles.bearing),r=h.bk(m.endEulerAngles.roll,m.endEulerAngles.pitch,m.endEulerAngles.bearing),c=new Float64Array(4);h.bl(c,e,r,m.k);const f=h.bm(c);m.tr.setRoll(f.roll),m.tr.setPitch(f.pitch),m.tr.setBearing(f.bearing)}else m.tr.setRoll(m.endEulerAngles.roll),m.tr.setPitch(m.endEulerAngles.pitch),m.tr.setBearing(m.endEulerAngles.bearing);else m.tr.setRoll(h.G.number(m.startEulerAngles.roll,m.endEulerAngles.roll,m.k)),m.tr.setPitch(h.G.number(m.startEulerAngles.pitch,m.endEulerAngles.pitch,m.k)),m.tr.setBearing(h.G.number(m.startEulerAngles.bearing,m.endEulerAngles.bearing,m.k))}function to(m,e,r,c,f){const g=f.padding,v=ot(f.worldSize,r.getNorthWest()),w=ot(f.worldSize,r.getNorthEast()),S=ot(f.worldSize,r.getSouthEast()),C=ot(f.worldSize,r.getSouthWest()),D=h.ap(-c),k=v.rotate(D),L=w.rotate(D),j=S.rotate(D),Z=C.rotate(D),W=new h.P(Math.max(k.x,L.x,Z.x,j.x),Math.max(k.y,L.y,Z.y,j.y)),Q=new h.P(Math.min(k.x,L.x,Z.x,j.x),Math.min(k.y,L.y,Z.y,j.y)),it=W.sub(Q),st=(f.width-(g.left+g.right+e.left+e.right))/it.x,ht=(f.height-(g.top+g.bottom+e.top+e.bottom))/it.y;if(ht<0||st<0)return void Ms();const at=Math.min(h.at(f.scale*Math.min(st,ht)),m.maxZoom),dt=h.P.convert(m.offset),mt=new h.P((e.left-e.right)/2,(e.top-e.bottom)/2).rotate(h.ap(c)),ct=dt.add(mt).mult(f.scale/h.aq(at));return{center:ut(f.worldSize,v.add(S).div(2).sub(ct)),zoom:at,bearing:c}}class ua{get useGlobeControls(){return!1}handlePanInertia(e,r){const c=e.mag(),f=Math.abs(Et(r));return{easingOffset:e.mult(Math.min(.75*f/c,1)),easingCenter:r.center}}handleMapControlsRollPitchBearingZoom(e,r){e.bearingDelta&&r.setBearing(r.bearing+e.bearingDelta),e.pitchDelta&&r.setPitch(r.pitch+e.pitchDelta),e.rollDelta&&r.setRoll(r.roll+e.rollDelta),e.zoomDelta&&r.setZoom(r.zoom+e.zoomDelta)}handleMapControlsPan(e,r,c){e.around.distSqr(r.centerPoint)<.01||r.setLocationAtPoint(c,e.around)}cameraForBoxAndBearing(e,r,c,f,g){return to(e,r,c,f,g)}handleJumpToCenterZoom(e,r){e.zoom!==(r.zoom!==void 0?+r.zoom:e.zoom)&&e.setZoom(+r.zoom),r.center!==void 0&&e.setCenter(h.V.convert(r.center))}handleEaseTo(e,r){const c=e.zoom,f=e.padding,g={roll:e.roll,pitch:e.pitch,bearing:e.bearing},v={roll:r.roll===void 0?e.roll:r.roll,pitch:r.pitch===void 0?e.pitch:r.pitch,bearing:r.bearing===void 0?e.bearing:r.bearing},w=r.zoom!==void 0,S=!e.isPaddingEqual(r.padding);let C=!1;const D=w?+r.zoom:e.zoom;let k=e.centerPoint.add(r.offsetAsPoint);const L=e.screenPointToLocation(k),{center:j,zoom:Z}=e.applyConstrain(h.V.convert(r.center||L),D??c);gc(e,j);const W=ot(e.worldSize,L),Q=ot(e.worldSize,j).sub(W),it=h.aq(Z-c);return C=Z!==c,{easeFunc:st=>{if(C&&e.setZoom(h.G.number(c,Z,st)),h.bn(g,v)||Cs({startEulerAngles:g,endEulerAngles:v,tr:e,k:st,useSlerp:g.roll!=v.roll}),S&&(e.interpolatePadding(f,r.padding,st),k=e.centerPoint.add(r.offsetAsPoint)),r.around)e.setLocationAtPoint(r.around,r.aroundPoint);else{const ht=h.aq(e.zoom-c),at=Z>c?Math.min(2,it):Math.max(.5,it),dt=Math.pow(at,1-st),mt=ut(e.worldSize,W.add(Q.mult(st*dt)).mult(ht));e.setLocationAtPoint(e.renderWorldCopies?mt.wrap():mt,k)}},isZooming:C,elevationCenter:j}}handleFlyTo(e,r){const c=r.zoom!==void 0,f=e.zoom,g=e.applyConstrain(h.V.convert(r.center||r.locationAtOffset),c?+r.zoom:f),v=g.center,w=g.zoom;gc(e,v);const S=ot(e.worldSize,r.locationAtOffset),C=ot(e.worldSize,v).sub(S),D=C.mag(),k=h.aq(w-f);let L;if(r.minZoom!==void 0){const j=Math.min(+r.minZoom,f,w),Z=e.applyConstrain(v,j).zoom;L=h.aq(Z-f)}return{easeFunc:(j,Z,W,Q)=>{e.setZoom(j===1?w:f+h.at(Z));const it=j===1?v:ut(e.worldSize,S.add(C.mult(W)).mult(Z));e.setLocationAtPoint(e.renderWorldCopies?it.wrap():it,Q)},scaleOfZoom:k,targetCenter:v,scaleOfMinZoom:L,pixelPathLength:D}}}class Zi{constructor(e,r,c){this.blendFunction=e,this.blendColor=r,this.mask=c}}Zi.Replace=[1,0],Zi.disabled=new Zi(Zi.Replace,h.bo.transparent,[!1,!1,!1,!1]),Zi.unblended=new Zi(Zi.Replace,h.bo.transparent,[!0,!0,!0,!0]),Zi.alphaBlended=new Zi([1,771],h.bo.transparent,[!0,!0,!0,!0]);const gn=2305;class ti{constructor(e,r,c){this.enable=e,this.mode=r,this.frontFace=c}}ti.disabled=new ti(!1,1029,gn),ti.backCCW=new ti(!0,1029,gn),ti.frontCCW=new ti(!0,1028,gn);class Ze{constructor(e,r,c){this.func=e,this.mask=r,this.range=c}}Ze.ReadOnly=!1,Ze.ReadWrite=!0,Ze.disabled=new Ze(519,Ze.ReadOnly,[0,1]);const es=7680;class ci{constructor(e,r,c,f,g,v){this.test=e,this.ref=r,this.mask=c,this.fail=f,this.depthFail=g,this.pass=v}}ci.disabled=new ci({func:519,mask:0},0,0,es,es,es);const eo=new WeakMap;function ar(m){var e;if(eo.has(m))return eo.get(m);{const r=(e=m.getParameter(m.VERSION))===null||e===void 0?void 0:e.startsWith("WebGL 2.0");return eo.set(m,r),r}}class As{get awaitingQuery(){return!!this._readbackQueue}constructor(e){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=e;const r=e.context,c=r.gl;this._texFormat=c.RGBA,this._texType=c.UNSIGNED_BYTE;const f=new h.aV;f.emplaceBack(-1,-1),f.emplaceBack(2,-1),f.emplaceBack(-1,2);const g=new h.aX;g.emplaceBack(0,1,2),this._fullscreenTriangle=new ts(r.createVertexBuffer(f,wn.members),r.createIndexBuffer(g),h.aW.simpleSegment(0,0,f.length,g.length)),this._resultBuffer=new Uint8Array(4),r.activeTexture.set(c.TEXTURE1);const v=c.createTexture();c.bindTexture(c.TEXTURE_2D,v),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.NEAREST),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.NEAREST),c.texImage2D(c.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=r.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(v),ar(c)&&(this._pbo=c.createBuffer(),c.bindBuffer(c.PIXEL_PACK_BUFFER,this._pbo),c.bufferData(c.PIXEL_PACK_BUFFER,4,c.STREAM_READ),c.bindBuffer(c.PIXEL_PACK_BUFFER,null))}destroy(){const e=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),e.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(e,r){const c=this._updateCount;return this._readbackQueue?c>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():c>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(e,r),this._updateCount++,this._measuredError}_bindFramebuffer(){const e=this._cachedRenderContext.context,r=e.gl;e.activeTexture.set(r.TEXTURE1),r.bindTexture(r.TEXTURE_2D,this._fbo.colorAttachment.get()),e.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(e,r){const c=this._cachedRenderContext.context,f=c.gl;if(this._bindFramebuffer(),c.viewport.set([0,0,this._texWidth,this._texHeight]),c.clear({color:h.bo.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(c,f.TRIANGLES,Ze.disabled,ci.disabled,Zi.unblended,ti.disabled,((g,v)=>({u_input:g,u_output_expected:v}))(e,r),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&ar(f)){f.bindBuffer(f.PIXEL_PACK_BUFFER,this._pbo),f.readBuffer(f.COLOR_ATTACHMENT0),f.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),f.bindBuffer(f.PIXEL_PACK_BUFFER,null);const g=f.fenceSync(f.SYNC_GPU_COMMANDS_COMPLETE,0);f.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:g}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){const e=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&ar(e)){const r=e.clientWaitSync(this._readbackQueue.sync,0,0);if(r===e.WAIT_FAILED)return h.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(r===e.TIMEOUT_EXPIRED)return;e.bindBuffer(e.PIXEL_PACK_BUFFER,this._pbo),e.getBufferSubData(e.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),e.bindBuffer(e.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),e.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=As._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(e){let r=0;return r+=e[0]/256,r+=e[1]/65536,r+=e[2]/16777216,e[3]<127&&(r=-r),r/128}}const is=h.a4/128;function _c(m,e){const r=m.granularity!==void 0?Math.max(m.granularity,1):1,c=r+(m.generateBorders?2:0),f=r+(m.extendToNorthPole||m.generateBorders?1:0)+(m.extendToSouthPole||m.generateBorders?1:0),g=c+1,v=f+1,w=m.generateBorders?-1:0,S=m.generateBorders||m.extendToNorthPole?-1:0,C=r+(m.generateBorders?1:0),D=r+(m.generateBorders||m.extendToSouthPole?1:0),k=g*v,L=c*f*6,j=g*v>65536;if(j&&e==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");const Z=j||e==="32bit",W=new Int16Array(2*k);let Q=0;for(let ht=S;ht<=D;ht++)for(let at=w;at<=C;at++){let dt=at/r*h.a4;at===-1&&(dt=-is),at===r+1&&(dt=h.a4+is);let mt=ht/r*h.a4;ht===-1&&(mt=m.extendToNorthPole?h.bq:-is),ht===r+1&&(mt=m.extendToSouthPole?h.br:h.a4+is),W[Q++]=dt,W[Q++]=mt}const it=Z?new Uint32Array(L):new Uint16Array(L);let st=0;for(let ht=0;ht<f;ht++)for(let at=0;at<c;at++){const dt=at+1+ht*g,mt=at+(ht+1)*g,ct=at+1+(ht+1)*g;it[st++]=at+ht*g,it[st++]=mt,it[st++]=dt,it[st++]=dt,it[st++]=mt,it[st++]=ct}return{vertices:W.buffer.slice(0),indices:it.buffer.slice(0),uses32bitIndices:Z}}const yc=new h.aU({fill:new h.bs(128,2),line:new h.bs(512,0),tile:new h.bs(128,32),stencil:new h.bs(128,1),circle:3});class vc{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return Ia.projectionGlobe}get vertexShaderPreludeCode(){return Ia.projectionMercator.vertexSource}get subdivisionGranularity(){return yc}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(e){this._errorMeasurement||(this._errorMeasurement=new As(e));const r=h.X(this._errorQueryLatitudeDegrees),c=2*Math.atan(Math.exp(Math.PI-r*Math.PI*2))-.5*Math.PI,f=this._errorMeasurement.updateErrorLoop(r,c),g=Kt();f!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=f,this._errorMeasurementLastChangeTime=g);const v=Math.min(Math.max((g-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=h.bt(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,h.bu(v))}_getMeshKey(e){return`${e.granularity.toString(36)}_${e.generateBorders?"b":""}${e.extendToNorthPole?"n":""}${e.extendToSouthPole?"s":""}`}getMeshFromTileID(e,r,c,f,g){const v=(g==="stencil"?yc.stencil:yc.tile).getGranularityForZoomLevel(r.z);return this._getMesh(e,{granularity:v,generateBorders:c,extendToNorthPole:r.y===0&&f,extendToSouthPole:r.y===(1<<r.z)-1&&f})}_getMesh(e,r){const c=this._getMeshKey(r);if(c in this._tileMeshCache)return this._tileMeshCache[c];const f=(function(g,v){const w=_c(v,"16bit"),S=h.aV.deserialize({arrayBuffer:w.vertices,length:w.vertices.byteLength/2/2}),C=h.aX.deserialize({arrayBuffer:w.indices,length:w.indices.byteLength/2/3});return new ts(g.createVertexBuffer(S,wn.members),g.createIndexBuffer(C),h.aW.simpleSegment(0,0,S.length,C.length))})(e,r);return this._tileMeshCache[c]=f,f}recalculate(e){}hasTransition(){const e=Kt();let r=!1;return r=r||(e-this._errorMeasurementLastChangeTime)/1e3<.7,r=r||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,r}setErrorQueryLatitudeDegrees(e){this._errorQueryLatitudeDegrees=e}}const yu=new h.t({type:new h.D(h.u.projection.type)});class io extends h.E{constructor(e){super(),this._transitionable=new h.x(yu,void 0),this.setProjection(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new h.H(0)),this._mercatorProjection=new Bn,this._verticalPerspectiveProjection=new vc}get transitionState(){const e=this.properties.get("type");if(typeof e=="string"&&e==="mercator")return 0;if(typeof e=="string"&&e==="vertical-perspective")return 1;if(e instanceof h.bv){if(e.from==="vertical-perspective"&&e.to==="mercator")return 1-e.transition;if(e.from==="mercator"&&e.to==="vertical-perspective")return e.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(e){this._mercatorProjection.updateGPUdependent(e),this._verticalPerspectiveProjection.updateGPUdependent(e)}getMeshFromTileID(e,r,c,f,g){return this.currentProjection.getMeshFromTileID(e,r,c,f,g)}setProjection(e){this._transitionable.setValue("type",e?.type||"mercator")}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}setErrorQueryLatitudeDegrees(e){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(e),this._mercatorProjection.setErrorQueryLatitudeDegrees(e)}}function Pd(m){const e=vu(m.worldSize,m.center.lat);return 2*Math.PI*e}function ns(m,e,r,c,f){const g=1/(1<<f),v=e/h.a4*g+c*g,w=h.bx((m/h.a4*g+r*g)*Math.PI*2+Math.PI,2*Math.PI),S=2*Math.atan(Math.exp(Math.PI-v*Math.PI*2))-.5*Math.PI,C=Math.cos(S),D=new Float64Array(3);return D[0]=Math.sin(w)*C,D[1]=Math.sin(S),D[2]=Math.cos(w)*C,D}function ha(m){return(function(e,r){const c=Math.cos(r),f=new Float64Array(3);return f[0]=Math.sin(e)*c,f[1]=Math.sin(r),f[2]=Math.cos(e)*c,f})(m.lng*Math.PI/180,m.lat*Math.PI/180)}function vu(m,e){return m/(2*Math.PI)/Math.cos(e*Math.PI/180)}function Id(m){const e=Math.asin(m[1])/Math.PI*180,r=Math.sqrt(m[0]*m[0]+m[2]*m[2]);if(r>1e-6){const c=m[0]/r,f=Math.acos(m[2]/r),g=(c>0?f:-f)/Math.PI*180;return new h.V(h.W(g,-180,180),e)}return new h.V(0,e)}function ra(m){return Math.cos(m*Math.PI/180)}function Nn(m,e){const r=ra(m),c=ra(e);return h.at(c/r)}function Rr(m,e){const r=m.rotate(e.bearingInRadians),c=e.zoom+Nn(e.center.lat,0),f=h.bt(1/ra(e.center.lat),1/ra(Math.min(Math.abs(e.center.lat),60)),h.bw(c,7,3,0,1)),g=360/Pd({worldSize:e.worldSize,center:{lat:e.center.lat}});return new h.V(e.center.lng-r.x*g*f,h.an(e.center.lat+r.y*g,-h.ao,h.ao))}function Dl(m){const e=.5*m,r=Math.sin(e),c=Math.cos(e);return Math.log(r+c)-Math.log(c-r)}function Sh(m,e,r,c){const f=m.lat+r*c;if(Math.abs(r)>1){const g=(Math.sign(m.lat+r)!==Math.sign(m.lat)?-Math.abs(m.lat):Math.abs(m.lat))*Math.PI/180,v=Math.abs(m.lat+r)*Math.PI/180,w=Dl(g+c*(v-g)),S=Dl(g),C=Dl(v);return new h.V(m.lng+e*((w-S)/(C-S)),f)}return new h.V(m.lng+e*c,f)}class xu{constructor(e){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._boundingVolumeFactory=e}swapBuffers(){if(!this._hadAnyChanges)return;const e=this._cachePrevious;this._cachePrevious=this._cache,this._cache=e,this._cache.clear(),this._hadAnyChanges=!1}getTileBoundingVolume(e,r,c,f){const g=`${e.z}_${e.x}_${e.y}_${f?.terrain?"t":""}`,v=this._cache.get(g);if(v)return v;const w=this._cachePrevious.get(g);if(w)return this._cache.set(g,w),w;const S=this._boundingVolumeFactory(e,r,c,f);return this._cache.set(g,S),this._hadAnyChanges=!0,S}}class Lr{constructor(e,r,c,f){this.min=c,this.max=f,this.points=e,this.planes=r}static fromAabb(e,r){const c=[];for(let f=0;f<8;f++)c.push([1&~f?e[0]:r[0],(f>>1&1)==1?r[1]:e[1],(f>>2&1)==1?r[2]:e[2]]);return new Lr(c,[[-1,0,0,r[0]],[1,0,0,-e[0]],[0,-1,0,r[1]],[0,1,0,-e[1]],[0,0,-1,r[2]],[0,0,1,-e[2]]],e,r)}static fromCenterSizeAngles(e,r,c){const f=h.bA([],c[0],c[1],c[2]),g=h.bB([],[r[0],0,0],f),v=h.bB([],[0,r[1],0],f),w=h.bB([],[0,0,r[2]],f),S=[...e],C=[...e];for(let k=0;k<8;k++)for(let L=0;L<3;L++){const j=e[L]+g[L]*(1&~k?-1:1)+v[L]*((k>>1&1)==1?1:-1)+w[L]*((k>>2&1)==1?1:-1);S[L]=Math.min(S[L],j),C[L]=Math.max(C[L],j)}const D=[];for(let k=0;k<8;k++){const L=[...e];h.a$(L,L,h.a_([],g,1&~k?-1:1)),h.a$(L,L,h.a_([],v,(k>>1&1)==1?1:-1)),h.a$(L,L,h.a_([],w,(k>>2&1)==1?1:-1)),D.push(L)}return new Lr(D,[[...g,-h.b4(g,D[0])],[...v,-h.b4(v,D[0])],[...w,-h.b4(w,D[0])],[-g[0],-g[1],-g[2],-h.b4(g,D[7])],[-v[0],-v[1],-v[2],-h.b4(v,D[7])],[-w[0],-w[1],-w[2],-h.b4(w,D[7])]],S,C)}intersectsFrustum(e){let r=!0;const c=this.points.length,f=this.planes.length,g=e.planes.length,v=e.points.length;for(let w=0;w<g;w++){const S=e.planes[w];let C=0;for(let D=0;D<c;D++){const k=this.points[D];S[0]*k[0]+S[1]*k[1]+S[2]*k[2]+S[3]>=0&&C++}if(C===0)return 0;C<c&&(r=!1)}if(r)return 2;for(let w=0;w<f;w++){const S=this.planes[w];let C=0;for(let D=0;D<v;D++){const k=e.points[D];S[0]*k[0]+S[1]*k[1]+S[2]*k[2]+S[3]>=0&&C++}if(C===0)return 0}return 1}intersectsPlane(e){const r=this.points.length;let c=0;for(let f=0;f<r;f++){const g=this.points[f];e[0]*g[0]+e[1]*g[1]+e[2]*g[2]+e[3]>=0&&c++}return c===r?2:c===0?0:1}}function bu(m,e,r){const c=m-e;return c<0?-c:Math.max(0,c-r)}function Eh(m,e,r,c,f){const g=m-r;let v;return v=g<0?Math.min(-g,1+g-f):g>1?Math.min(Math.max(g-f,0),1-g):0,Math.max(v,bu(e,c,f))}class Rd{constructor(){this._boundingVolumeCache=new xu(this._computeTileBoundingVolume)}prepareNextFrame(){this._boundingVolumeCache.swapBuffers()}distanceToTile2d(e,r,c,f){const g=1<<c.z,v=1/g,w=c.x/g,S=c.y/g;let C=2;return C=Math.min(C,Eh(e,r,w,S,v)),C=Math.min(C,Eh(e,r,w+.5,-S-v,v)),C=Math.min(C,Eh(e,r,w+.5,2-S-v,v)),C}getWrap(e,r,c){const f=1<<r.z,g=1/f,v=r.x/f,w=bu(e.x,v,g),S=bu(e.x,v-1,g),C=bu(e.x,v+1,g),D=Math.min(w,S,C);return D===C?1:D===S?-1:0}allowVariableZoom(e,r){return Ce(e,r)>4}allowWorldCopies(){return!1}getTileBoundingVolume(e,r,c,f){return this._boundingVolumeCache.getTileBoundingVolume(e,r,c,f)}_computeTileBoundingVolume(e,r,c,f){var g,v;let w=0,S=0;if(f?.terrain){const C=new h.a1(e.z,r,e.z,e.x,e.y),D=f.terrain.getMinMaxElevation(C);w=(g=D.minElevation)!==null&&g!==void 0?g:Math.min(0,c),S=(v=D.maxElevation)!==null&&v!==void 0?v:Math.max(0,c)}if(w/=h.bD,S/=h.bD,w+=1,S+=1,e.z<=0)return Lr.fromAabb([-S,-S,-S],[S,S,S]);if(e.z===1)return Lr.fromAabb([e.x===0?-S:0,e.y===0?0:-S,-S],[e.x===0?0:S,e.y===0?S:0,S]);{const C=[ns(0,0,e.x,e.y,e.z),ns(h.a4,0,e.x,e.y,e.z),ns(h.a4,h.a4,e.x,e.y,e.z),ns(0,h.a4,e.x,e.y,e.z)],D=[];for(const It of C)D.push(h.a_([],It,S));if(S!==w)for(const It of C)D.push(h.a_([],It,w));e.y===0&&D.push([0,1,0]),e.y===(1<<e.z)-1&&D.push([0,-1,0]);const k=[1,1,1],L=[-1,-1,-1];for(const It of D)for(let Rt=0;Rt<3;Rt++)k[Rt]=Math.min(k[Rt],It[Rt]),L[Rt]=Math.max(L[Rt],It[Rt]);const j=ns(h.a4/2,h.a4/2,e.x,e.y,e.z),Z=h.b3([],[0,1,0],j);h.b2(Z,Z);const W=h.b3([],j,Z);h.b2(W,W);const Q=h.b3([],C[2],C[1]);h.b2(Q,Q);const it=h.b3([],C[0],C[3]);h.b2(it,it),D.push(h.a_([],j,S)),e.y>=(1<<e.z)/2&&D.push(h.a_([],ns(h.a4/2,0,e.x,e.y,e.z),S)),e.y<(1<<e.z)/2&&D.push(h.a_([],ns(h.a4/2,h.a4,e.x,e.y,e.z),S));const st=Ld(j,D),ht=Ld(W,D),at=[-j[0],-j[1],-j[2],st.max],dt=[j[0],j[1],j[2],-st.min],mt=[-W[0],-W[1],-W[2],ht.max],ct=[W[0],W[1],W[2],-ht.min],Tt=[...Q,0],kt=[...it,0],zt=[];return e.y===0?zt.push(h.bC(kt,Tt,at),h.bC(kt,Tt,dt)):zt.push(h.bC(mt,Tt,at),h.bC(mt,Tt,dt),h.bC(mt,kt,at),h.bC(mt,kt,dt)),e.y===(1<<e.z)-1?zt.push(h.bC(kt,Tt,at),h.bC(kt,Tt,dt)):zt.push(h.bC(ct,Tt,at),h.bC(ct,Tt,dt),h.bC(ct,kt,at),h.bC(ct,kt,dt)),new Lr(zt,[at,dt,mt,ct,Tt,kt],k,L)}}}function Ld(m,e){let r=1/0,c=-1/0;for(const f of e){const g=h.b4(m,f);r=Math.min(r,g),c=Math.max(c,g)}return{min:r,max:c}}class wu{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,r,c){return this._helper.interpolatePadding(e,r,c)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,r){this._helper.resize(e,r)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}setConstrainOverride(e){this._helper.setConstrainOverride(e)}overrideNearFarZ(e,r){this._helper.overrideNearFarZ(e,r)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(e){}constructor(e){this._cachedClippingPlane=h.bE(),this._projectionMatrix=h.bi(),this._globeViewProjMatrix32f=h.bh(),this._globeViewProjMatrixNoCorrection=h.bi(),this._globeViewProjMatrixNoCorrectionInverted=h.bi(),this._globeProjMatrixInverted=h.bi(),this._cameraPosition=h.by(),this._globeLatitudeErrorCorrectionRadians=0,this.defaultConstrain=(r,c)=>{const f=h.an(r.lat,-h.ao,h.ao),g=h.an(+c,this.minZoom+Nn(0,f),this.maxZoom);return{center:new h.V(r.lng,f),zoom:g}},this.applyConstrain=(r,c)=>this._helper.applyConstrain(r,c),this._helper=new Tn({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(r,c)=>this.defaultConstrain(r,c)},e),this._coveringTilesDetailsProvider=new Rd}clone(){const e=new wu;return e.apply(this),e}apply(e,r){this._globeLatitudeErrorCorrectionRadians=r||0,this._helper.apply(e)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){const e=h.by();return e[0]=this._cameraPosition[0],e[1]=this._cameraPosition[1],e[2]=this._cameraPosition[2],e}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(e){const{overscaledTileID:r,applyGlobeMatrix:c}=e,f=this._helper.getMercatorTileCoordinates(r);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:f,clippingPlane:this._cachedClippingPlane,projectionTransition:c?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(e){const r=this.pitchInRadians,c=this.cameraToCenterDistance/e,f=Math.sin(r)*c,g=Math.cos(r)*c+1,v=1/Math.sqrt(f*f+g*g)*1;let w=-f,S=g;const C=Math.sqrt(w*w+S*S);w/=C,S/=C;const D=[0,w,S];h.bF(D,D,[0,0,0],-this.bearingInRadians),h.bG(D,D,[0,0,0],-1*this.center.lat*Math.PI/180),h.bH(D,D,[0,0,0],this.center.lng*Math.PI/180);const k=1/h.b6(D);return h.a_(D,D,k),[...D,-v*k]}isLocationOccluded(e){return!this.isSurfacePointVisible(ha(e))}transformLightDirection(e){const r=this._helper._center.lng*Math.PI/180,c=this._helper._center.lat*Math.PI/180,f=Math.cos(c),g=[Math.sin(r)*f,Math.sin(c),Math.cos(r)*f],v=[g[2],0,-g[0]],w=[0,0,0];h.b3(w,v,g),h.b2(v,v),h.b2(w,w);const S=[0,0,0];return h.b2(S,[v[0]*e[0]+w[0]*e[1]+g[0]*e[2],v[1]*e[0]+w[1]*e[1]+g[1]*e[2],v[2]*e[0]+w[2]*e[1]+g[2]*e[2]]),S}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(e,r,c){const f=(function(w,S,C){const D=1/(1<<C.z);return new h.aa(w/h.a4*D+C.x*D,S/h.a4*D+C.y*D)})(e,r,c.canonical),g=(v=f.y,[h.bx(f.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-v*Math.PI*2))-.5*Math.PI]);var v;return this.getCircleRadiusCorrection()/Math.cos(g[1])}projectTileCoordinates(e,r,c,f){const g=c.canonical,v=ns(e,r,g.x,g.y,g.z),w=1+(f?f(e,r):0)/h.bD,S=[v[0]*w,v[1]*w,v[2]*w,1];h.aG(S,S,this._globeViewProjMatrixNoCorrection);const C=this._cachedClippingPlane,D=C[0]*v[0]+C[1]*v[1]+C[2]*v[2]+C[3]<0;return{point:new h.P(S[0]/S[3],S[1]/S[3]),signedDistanceFromCamera:S[3],isOccluded:D}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;const e=vu(this.worldSize,this.center.lat),r=h.bj(),c=h.bj();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*e),h.bd(r,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);const f=this.centerOffset;r[8]=2*-f.x/this._helper._width,r[9]=2*f.y/this._helper._height,this._projectionMatrix=h.be(r),this._globeProjMatrixInverted=h.bj(),h.aA(this._globeProjMatrixInverted,r),h.O(r,r,[0,0,-this.cameraToCenterDistance]),h.bf(r,r,this.rollInRadians),h.bg(r,r,-this.pitchInRadians),h.bf(r,r,this.bearingInRadians),h.O(r,r,[0,0,-e]);const g=h.by();g[0]=e,g[1]=e,g[2]=e,h.bg(c,r,this.center.lat*Math.PI/180),h.bI(c,c,-this.center.lng*Math.PI/180),h.Q(c,c,g),this._globeViewProjMatrixNoCorrection=c,h.bg(r,r,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),h.bI(r,r,-this.center.lng*Math.PI/180),h.Q(r,r,g),this._globeViewProjMatrix32f=new Float32Array(r),this._globeViewProjMatrixNoCorrectionInverted=h.bj(),h.aA(this._globeViewProjMatrixNoCorrectionInverted,c);const v=h.by();this._cameraPosition=h.by(),this._cameraPosition[2]=this.cameraToCenterDistance/e,h.bF(this._cameraPosition,this._cameraPosition,v,-this.rollInRadians),h.bG(this._cameraPosition,this._cameraPosition,v,this.pitchInRadians),h.bF(this._cameraPosition,this._cameraPosition,v,-this.bearingInRadians),h.a$(this._cameraPosition,this._cameraPosition,[0,0,1]),h.bG(this._cameraPosition,this._cameraPosition,v,-this.center.lat*Math.PI/180),h.bH(this._cameraPosition,this._cameraPosition,v,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(e);const w=h.be(this._globeViewProjMatrixNoCorrectionInverted);h.Q(w,w,[1,1,-1]),this._cachedFrustum=Ra.fromInvProjectionMatrix(w,1,0,this._cachedClippingPlane,!0)}calculateFogMatrix(e){h.w("calculateFogMatrix is not supported on globe projection.");const r=h.bj();return h.ar(r),r}getVisibleUnwrappedCoordinates(e){return[new h.bb(0,e)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(e){e&&h.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(e,r){if(!this._globeViewProjMatrixNoCorrection)return 1;const c=ha(e);h.a_(c,c,1+r/h.bD);const f=h.bE();return h.aG(f,[c[0],c[1],c[2],1],this._globeViewProjMatrixNoCorrection),f[2]/f[3]}populateCache(e){}getBounds(){const e=.5*this.width,r=.5*this.height,c=[new h.P(0,0),new h.P(e,0),new h.P(this.width,0),new h.P(this.width,r),new h.P(this.width,this.height),new h.P(e,this.height),new h.P(0,this.height),new h.P(0,r)],f=[];for(const k of c)f.push(this.unprojectScreenPoint(k));let g=0,v=0,w=0,S=0;const C=this.center;for(const k of f){const L=h.bJ(C.lng,k.lng),j=h.bJ(C.lat,k.lat);L<v&&(v=L),L>g&&(g=L),j<S&&(S=j),j>w&&(w=j)}const D=[C.lng+v,C.lat+S,C.lng+g,C.lat+w];return this.isSurfacePointOnScreen([0,1,0])&&(D[3]=90,D[0]=-180,D[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(D[1]=-90,D[0]=-180,D[2]=180),new Di(D)}calculateCenterFromCameraLngLatAlt(e,r,c,f){return this._helper.calculateCenterFromCameraLngLatAlt(e,r,c,f)}setLocationAtPoint(e,r){const c=ha(this.unprojectScreenPoint(r)),f=ha(e),g=h.by();h.bK(g);const v=h.by();h.bH(v,c,g,-this.center.lng*Math.PI/180),h.bG(v,v,g,this.center.lat*Math.PI/180);const w=f[0]*f[0]+f[2]*f[2],S=v[0]*v[0];if(w<S)return;const C=Math.sqrt(w-S),D=-C,k=h.bL(f[0],f[2],v[0],C),L=h.bL(f[0],f[2],v[0],D),j=h.by();h.bH(j,f,g,-k);const Z=h.bL(j[1],j[2],v[1],v[2]),W=h.by();h.bH(W,f,g,-L);const Q=h.bL(W[1],W[2],v[1],v[2]),it=.5*Math.PI,st=Z>=-it&&Z<=it,ht=Q>=-it&&Q<=it;let at,dt;if(st&&ht){const kt=this.center.lng*Math.PI/180,zt=this.center.lat*Math.PI/180;h.bM(k,kt)+h.bM(Z,zt)<h.bM(L,kt)+h.bM(Q,zt)?(at=k,dt=Z):(at=L,dt=Q)}else if(st)at=k,dt=Z;else{if(!ht)return;at=L,dt=Q}const mt=at/Math.PI*180,ct=dt/Math.PI*180,Tt=this.center.lat;this.setCenter(new h.V(mt,h.an(ct,-90,90))),this.setZoom(this.zoom+Nn(Tt,this.center.lat))}locationToScreenPoint(e,r){const c=ha(e);if(r){const f=r.getElevationForLngLatZoom(e,this._helper._tileZoom);h.a_(c,c,1+f/h.bD)}return this._projectSurfacePointToScreen(c)}_projectSurfacePointToScreen(e){const r=h.bE();return h.aG(r,[...e,1],this._globeViewProjMatrixNoCorrection),r[0]/=r[3],r[1]/=r[3],new h.P((.5*r[0]+.5)*this.width,(.5*-r[1]+.5)*this.height)}screenPointToMercatorCoordinate(e,r){if(r){const c=r.pointCoordinate(e);if(c)return c}return h.aa.fromLngLat(this.unprojectScreenPoint(e))}screenPointToLocation(e,r){var c;return(c=this.screenPointToMercatorCoordinate(e,r))===null||c===void 0?void 0:c.toLngLat()}isPointOnMapSurface(e,r){const c=this._cameraPosition,f=this.getRayDirectionFromPixel(e);return!!this.rayPlanetIntersection(c,f)}getRayDirectionFromPixel(e){const r=h.bE();r[0]=e.x/this.width*2-1,r[1]=-1*(e.y/this.height*2-1),r[2]=1,r[3]=1,h.aG(r,r,this._globeViewProjMatrixNoCorrectionInverted),r[0]/=r[3],r[1]/=r[3],r[2]/=r[3];const c=h.by();c[0]=r[0]-this._cameraPosition[0],c[1]=r[1]-this._cameraPosition[1],c[2]=r[2]-this._cameraPosition[2];const f=h.by();return h.b2(f,c),f}isSurfacePointVisible(e){const r=this._cachedClippingPlane;return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]+r[3]>=0}isSurfacePointOnScreen(e){if(!this.isSurfacePointVisible(e))return!1;const r=h.bE();return h.aG(r,[...e,1],this._globeViewProjMatrixNoCorrection),r[0]/=r[3],r[1]/=r[3],r[2]/=r[3],r[0]>-1&&r[0]<1&&r[1]>-1&&r[1]<1&&r[2]>-1&&r[2]<1}rayPlanetIntersection(e,r){const c=h.b4(e,r),f=h.by(),g=h.by();h.a_(g,r,c),h.b1(f,e,g);const v=1-h.b4(f,f);if(v<0)return null;const w=h.b4(e,e)-1,S=-c+(c<0?1:-1)*Math.sqrt(v),C=w/S,D=S;return{tMin:Math.min(C,D),tMax:Math.max(C,D)}}unprojectScreenPoint(e){const r=this._cameraPosition,c=this.getRayDirectionFromPixel(e),f=this.rayPlanetIntersection(r,c);if(f){const D=h.by();h.a$(D,r,[c[0]*f.tMin,c[1]*f.tMin,c[2]*f.tMin]);const k=h.by();return h.b2(k,D),Id(k)}const g=this._cachedClippingPlane,v=g[0]*c[0]+g[1]*c[1]+g[2]*c[2],w=-h.ba(g,r)/v,S=h.by();if(w>0)h.a$(S,r,[c[0]*w,c[1]*w,c[2]*w]);else{const D=h.by();h.a$(D,r,[2*c[0],2*c[1],2*c[2]]);const k=h.ba(this._cachedClippingPlane,D);h.b1(S,D,[this._cachedClippingPlane[0]*k,this._cachedClippingPlane[1]*k,this._cachedClippingPlane[2]*k])}const C=(function(D){const k=h.by();return k[0]=D[0]*-D[3],k[1]=D[1]*-D[3],k[2]=D[2]*-D[3],{center:k,radius:Math.sqrt(1-D[3]*D[3])}})(g);return Id((function(D,k,L){const j=h.by();h.b1(j,L,D);const Z=h.by();return h.bz(Z,D,j,k/h.b8(j)),Z})(C.center,C.radius,S))}getMatrixForModel(e,r){const c=h.V.convert(e),f=1/h.bD,g=h.bi();return h.bI(g,g,c.lng/180*Math.PI),h.bg(g,g,-c.lat/180*Math.PI),h.O(g,g,[0,0,1+r/h.bD]),h.bg(g,g,.5*Math.PI),h.Q(g,g,[f,f,f]),g}getProjectionDataForCustomLayer(e=!0){const r=this.getProjectionData({overscaledTileID:new h.a1(0,0,0,0,0),applyGlobeMatrix:e});return r.tileMercatorCoords=[0,0,1,1],r}getFastPathSimpleProjectionMatrix(e){}}class Tu{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,r,c){return this._helper.interpolatePadding(e,r,c)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,r,c=!0){this._helper.resize(e,r,c)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}setConstrainOverride(e){this._helper.setConstrainOverride(e)}overrideNearFarZ(e,r){this._helper.overrideNearFarZ(e,r)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(e,r){this._globeness=e,this._globeLatitudeErrorCorrectionRadians=r,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().prepareNextFrame(),this._mercatorTransform.getCoveringTilesDetailsProvider().prepareNextFrame()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(e){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this.defaultConstrain=(r,c)=>this.currentTransform.defaultConstrain(r,c),this.applyConstrain=(r,c)=>this._helper.applyConstrain(r,c),this._helper=new Tn({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(r,c)=>this.defaultConstrain(r,c)},e),this._globeness=1,this._mercatorTransform=new Ni,this._verticalPerspectiveTransform=new wu}clone(){const e=new Tu;return e._globeness=this._globeness,e._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,e.apply(this),e}apply(e){this._helper.apply(e),this._mercatorTransform.apply(this),this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(e){const r=this._mercatorTransform.getProjectionData(e),c=this._verticalPerspectiveTransform.getProjectionData(e);return{mainMatrix:this.isGlobeRendering?c.mainMatrix:r.mainMatrix,clippingPlane:c.clippingPlane,tileMercatorCoords:c.tileMercatorCoords,projectionTransition:e.applyGlobeMatrix?this._globeness:0,fallbackMatrix:r.fallbackMatrix}}isLocationOccluded(e){return this.currentTransform.isLocationOccluded(e)}transformLightDirection(e){return this.currentTransform.transformLightDirection(e)}getPixelScale(){return h.bt(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return h.bt(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(e,r,c){const f=this._mercatorTransform.getPitchedTextCorrection(e,r,c),g=this._verticalPerspectiveTransform.getPitchedTextCorrection(e,r,c);return h.bt(f,g,this._globeness)}projectTileCoordinates(e,r,c,f){return this.currentTransform.projectTileCoordinates(e,r,c,f)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(e){return this.currentTransform.calculateFogMatrix(e)}getVisibleUnwrappedCoordinates(e){return this.currentTransform.getVisibleUnwrappedCoordinates(e)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(e){this._mercatorTransform.recalculateZoomAndCenter(e),this._verticalPerspectiveTransform.recalculateZoomAndCenter(e)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(e,r){return this.currentTransform.lngLatToCameraDepth(e,r)}populateCache(e){this._mercatorTransform.populateCache(e),this._verticalPerspectiveTransform.populateCache(e)}getBounds(){return this.currentTransform.getBounds()}calculateCenterFromCameraLngLatAlt(e,r,c,f){return this._helper.calculateCenterFromCameraLngLatAlt(e,r,c,f)}setLocationAtPoint(e,r){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(e,r),void this.apply(this._mercatorTransform);this._verticalPerspectiveTransform.setLocationAtPoint(e,r),this.apply(this._verticalPerspectiveTransform)}locationToScreenPoint(e,r){return this.currentTransform.locationToScreenPoint(e,r)}screenPointToMercatorCoordinate(e,r){return this.currentTransform.screenPointToMercatorCoordinate(e,r)}screenPointToLocation(e,r){return this.currentTransform.screenPointToLocation(e,r)}isPointOnMapSurface(e,r){return this.currentTransform.isPointOnMapSurface(e,r)}getRayDirectionFromPixel(e){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(e)}getMatrixForModel(e,r){return this.currentTransform.getMatrixForModel(e,r)}getProjectionDataForCustomLayer(e=!0){const r=this._mercatorTransform.getProjectionDataForCustomLayer(e);if(!this.isGlobeRendering)return r;const c=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(e);return c.fallbackMatrix=r.mainMatrix,c}getFastPathSimpleProjectionMatrix(e){return this.currentTransform.getFastPathSimpleProjectionMatrix(e)}}class Za{get useGlobeControls(){return!0}handlePanInertia(e,r){const c=Rr(e,r);return Math.abs(c.lng-r.center.lng)>180&&(c.lng=r.center.lng+179.5*Math.sign(c.lng-r.center.lng)),{easingCenter:c,easingOffset:new h.P(0,0)}}handleMapControlsRollPitchBearingZoom(e,r){const c=e.around,f=r.screenPointToLocation(c);e.bearingDelta&&r.setBearing(r.bearing+e.bearingDelta),e.pitchDelta&&r.setPitch(r.pitch+e.pitchDelta),e.rollDelta&&r.setRoll(r.roll+e.rollDelta);const g=r.zoom;e.zoomDelta&&r.setZoom(r.zoom+e.zoomDelta);const v=r.zoom-g;if(v===0)return;const w=h.bJ(r.center.lng,f.lng),S=w/(Math.abs(w/180)+1),C=h.bJ(r.center.lat,f.lat),D=r.getRayDirectionFromPixel(c),k=r.cameraPosition,L=-1*h.b4(k,D),j=h.by();h.a$(j,k,[D[0]*L,D[1]*L,D[2]*L]);const Z=h.b6(j)-1,W=Math.exp(.5*-Math.max(Z-.3,0)),Q=vu(r.worldSize,r.center.lat)/Math.min(r.width,r.height),it=h.bw(Q,.9,.5,1,.25),st=(1-h.aq(-v))*Math.min(W,it),ht=r.center.lat,at=r.zoom,dt=new h.V(r.center.lng+S*st,h.an(r.center.lat+C*st,-h.ao,h.ao));r.setLocationAtPoint(f,c);const mt=r.center,ct=h.bw(Math.abs(w),45,85,0,1),Tt=h.bw(Q,.75,.35,0,1),kt=Math.pow(Math.max(ct,Tt),.25),zt=h.bJ(mt.lng,dt.lng),It=h.bJ(mt.lat,dt.lat);r.setCenter(new h.V(mt.lng+zt*kt,mt.lat+It*kt).wrap()),r.setZoom(at+Nn(ht,r.center.lat))}handleMapControlsPan(e,r,c){if(!e.panDelta)return;const f=r.center.lat,g=r.zoom;r.setCenter(Rr(e.panDelta,r).wrap()),r.setZoom(g+Nn(f,r.center.lat))}cameraForBoxAndBearing(e,r,c,f,g){const v=to(e,r,c,f,g),w=r.left/g.width*2-1,S=(g.width-r.right)/g.width*2-1,C=r.top/g.height*-2+1,D=(g.height-r.bottom)/g.height*-2+1,k=h.bJ(c.getWest(),c.getEast())<0,L=k?c.getEast():c.getWest(),j=k?c.getWest():c.getEast(),Z=Math.max(c.getNorth(),c.getSouth()),W=Math.min(c.getNorth(),c.getSouth()),Q=L+.5*h.bJ(L,j),it=Z+.5*h.bJ(Z,W),st=g.clone();st.setCenter(v.center),st.setBearing(v.bearing),st.setPitch(0),st.setRoll(0),st.setZoom(v.zoom);const ht=st.modelViewProjectionMatrix,at=[ha(c.getNorthWest()),ha(c.getNorthEast()),ha(c.getSouthWest()),ha(c.getSouthEast()),ha(new h.V(j,it)),ha(new h.V(L,it)),ha(new h.V(Q,Z)),ha(new h.V(Q,W))],dt=ha(v.center);let mt=Number.POSITIVE_INFINITY;for(const ct of at)w<0&&(mt=Za.getLesserNonNegativeNonNull(mt,Za.solveVectorScale(ct,dt,ht,"x",w))),S>0&&(mt=Za.getLesserNonNegativeNonNull(mt,Za.solveVectorScale(ct,dt,ht,"x",S))),C>0&&(mt=Za.getLesserNonNegativeNonNull(mt,Za.solveVectorScale(ct,dt,ht,"y",C))),D<0&&(mt=Za.getLesserNonNegativeNonNull(mt,Za.solveVectorScale(ct,dt,ht,"y",D)));if(Number.isFinite(mt)&&mt!==0)return v.zoom=st.zoom+h.at(mt),v;Ms()}handleJumpToCenterZoom(e,r){const c=e.center.lat,f=e.applyConstrain(r.center?h.V.convert(r.center):e.center,e.zoom).center;e.setCenter(f.wrap());const g=r.zoom!==void 0?+r.zoom:e.zoom+Nn(c,f.lat);e.zoom!==g&&e.setZoom(g)}handleEaseTo(e,r){const c=e.zoom,f=e.center,g=e.padding,v={roll:e.roll,pitch:e.pitch,bearing:e.bearing},w={roll:r.roll===void 0?e.roll:r.roll,pitch:r.pitch===void 0?e.pitch:r.pitch,bearing:r.bearing===void 0?e.bearing:r.bearing},S=r.zoom!==void 0,C=!e.isPaddingEqual(r.padding);let D=!1;const k=r.center?h.V.convert(r.center):f,L=e.applyConstrain(k,c).center;gc(e,L);const j=e.clone();j.setCenter(L),j.setZoom(S?+r.zoom:c+Nn(f.lat,k.lat)),j.setBearing(r.bearing);const Z=new h.P(h.an(e.centerPoint.x+r.offsetAsPoint.x,0,e.width),h.an(e.centerPoint.y+r.offsetAsPoint.y,0,e.height));j.setLocationAtPoint(L,Z);const W=(r.offset&&r.offsetAsPoint.mag())>0?j.center:L,Q=S?+r.zoom:c+Nn(f.lat,W.lat),it=c+Nn(f.lat,0),st=Q+Nn(W.lat,0),ht=h.bJ(f.lng,W.lng),at=h.bJ(f.lat,W.lat),dt=h.aq(st-it);return D=Q!==c,{easeFunc:mt=>{if(h.bn(v,w)||Cs({startEulerAngles:v,endEulerAngles:w,tr:e,k:mt,useSlerp:v.roll!=w.roll}),C&&e.interpolatePadding(g,r.padding,mt),r.around)h.w("Easing around a point is not supported under globe projection."),e.setLocationAtPoint(r.around,r.aroundPoint);else{const ct=st>it?Math.min(2,dt):Math.max(.5,dt),Tt=Math.pow(ct,1-mt),kt=Sh(f,ht,at,mt*Tt);e.setCenter(kt.wrap())}if(D){const ct=h.G.number(it,st,mt)+Nn(0,e.center.lat);e.setZoom(ct)}},isZooming:D,elevationCenter:W}}handleFlyTo(e,r){const c=r.zoom!==void 0,f=e.center,g=e.zoom,v=e.padding,w=!e.isPaddingEqual(r.padding),S=e.applyConstrain(h.V.convert(r.center||r.locationAtOffset),g).center,C=c?+r.zoom:e.zoom+Nn(e.center.lat,S.lat),D=e.clone();D.setCenter(S),D.setZoom(C),D.setBearing(r.bearing);const k=new h.P(h.an(e.centerPoint.x+r.offsetAsPoint.x,0,e.width),h.an(e.centerPoint.y+r.offsetAsPoint.y,0,e.height));D.setLocationAtPoint(S,k);const L=D.center;gc(e,L);const j=(function(at,dt,mt){const ct=ha(dt),Tt=ha(mt),kt=h.b4(ct,Tt),zt=Math.acos(kt),It=Pd(at);return zt/(2*Math.PI)*It})(e,f,L),Z=g+Nn(f.lat,0),W=C+Nn(L.lat,0),Q=h.aq(W-Z);let it;if(typeof r.minZoom=="number"){const at=+r.minZoom+Nn(L.lat,0),dt=Math.min(at,Z,W)+Nn(0,L.lat),mt=e.applyConstrain(L,dt).zoom+Nn(L.lat,0);it=h.aq(mt-Z)}const st=h.bJ(f.lng,L.lng),ht=h.bJ(f.lat,L.lat);return{easeFunc:(at,dt,mt,ct)=>{const Tt=Sh(f,st,ht,mt);w&&e.interpolatePadding(v,r.padding,at);const kt=at===1?L:Tt;e.setCenter(kt.wrap());const zt=Z+h.at(dt);e.setZoom(at===1?C:zt+Nn(0,kt.lat))},scaleOfZoom:Q,targetCenter:L,scaleOfMinZoom:it,pixelPathLength:j}}static solveVectorScale(e,r,c,f,g){const v=f==="x"?[c[0],c[4],c[8],c[12]]:[c[1],c[5],c[9],c[13]],w=[c[3],c[7],c[11],c[15]],S=e[0]*v[0]+e[1]*v[1]+e[2]*v[2],C=e[0]*w[0]+e[1]*w[1]+e[2]*w[2],D=r[0]*v[0]+r[1]*v[1]+r[2]*v[2],k=r[0]*w[0]+r[1]*w[1]+r[2]*w[2];return D+g*C===S+g*k||w[3]*(S-D)+v[3]*(k-C)+S*k==D*C?null:(D+v[3]-g*k-g*w[3])/(D-S-g*k+g*C)}static getLesserNonNegativeNonNull(e,r){return r!==null&&r>=0&&r<e?r:e}}class Su{constructor(e){this._globe=e,this._mercatorCameraHelper=new ua,this._verticalPerspectiveCameraHelper=new Za}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(e,r){return this.currentHelper.handlePanInertia(e,r)}handleMapControlsRollPitchBearingZoom(e,r){return this.currentHelper.handleMapControlsRollPitchBearingZoom(e,r)}handleMapControlsPan(e,r,c){this.currentHelper.handleMapControlsPan(e,r,c)}cameraForBoxAndBearing(e,r,c,f,g){return this.currentHelper.cameraForBoxAndBearing(e,r,c,f,g)}handleJumpToCenterZoom(e,r){this.currentHelper.handleJumpToCenterZoom(e,r)}handleEaseTo(e,r){return this.currentHelper.handleEaseTo(e,r)}handleFlyTo(e,r){return this.currentHelper.handleFlyTo(e,r)}}const Fo=(m,e)=>h.B(m,e&&e.filter((r=>r.identifier!=="source.canvas"))),Mh=h.bN();class xc extends h.E{constructor(e,r={}){var c,f;super(),this._rtlPluginLoaded=()=>{for(const v in this.tileManagers){const w=this.tileManagers[v].getSource().type;w!=="vector"&&w!=="geojson"||this.tileManagers[v].reload()}},this.map=e,this.dispatcher=new dn(mi(),e._getMapId()),this.dispatcher.registerMessageHandler("GG",((v,w)=>this.getGlyphs(v,w))),this.dispatcher.registerMessageHandler("GI",((v,w)=>this.getImages(v,w))),this.dispatcher.registerMessageHandler("GDA",((v,w)=>this.getDashes(v,w))),this.imageManager=new on,this.imageManager.setEventedParent(this);const g=((c=e._container)===null||c===void 0?void 0:c.lang)||typeof document<"u"&&((f=document.documentElement)===null||f===void 0?void 0:f.lang)||void 0;this.glyphManager=new de(e._requestManager,r.localIdeographFontFamily,g),this.lineAtlas=new _e(256,512),this.crossTileSymbolIndex=new No,this._setInitialValues(),this._resetUpdates(),this.dispatcher.broadcast("SR",h.bO()),za().on(Ts,this._rtlPluginLoaded),this.on("data",(v=>{if(v.dataType!=="source"||v.sourceDataType!=="metadata")return;const w=this.tileManagers[v.sourceId];if(!w)return;const S=w.getSource();if(S&&S.vectorLayerIds)for(const C in this._layers){const D=this._layers[C];D.source===S.id&&this._validateLayer(D)}}))}_setInitialValues(){var e;this._spritesImagesIds={},this._layers={},this._order=[],this.tileManagers={},this.zoomHistory=new h.bP,this._availableImages=[],this._globalState={},this._serializedLayers={},this.stylesheet=null,this.light=null,this.sky=null,this.projection&&(this.projection.destroy(),delete this.projection),this._loaded=!1,this._changed=!1,this._updatedLayers={},this._updatedSources={},this._changedImages={},this._glyphsDidChange=!1,this._updatedPaintProps={},this._layerOrderChanged=!1,this.crossTileSymbolIndex=new(((e=this.crossTileSymbolIndex)===null||e===void 0?void 0:e.constructor)||Object),this.pauseablePlacement=void 0,this.placement=void 0,this.z=0}setGlobalStateProperty(e,r){var c,f,g;this._checkLoaded();const v=r===null?(g=(f=(c=this.stylesheet.state)===null||c===void 0?void 0:c[e])===null||f===void 0?void 0:f.default)!==null&&g!==void 0?g:null:r;if(h.bQ(v,this._globalState[e]))return this;this._globalState[e]=v,this._applyGlobalStateChanges([e])}getGlobalState(){return this._globalState}setGlobalState(e){this._checkLoaded();const r=[];for(const c in e)!h.bQ(this._globalState[c],e[c].default)&&(r.push(c),this._globalState[c]=e[c].default);this._applyGlobalStateChanges(r)}_applyGlobalStateChanges(e){if(e.length===0)return;const r=new Set,c={};for(const f of e){c[f]=this._globalState[f];for(const g in this._layers){const v=this._layers[g],w=v.getLayoutAffectingGlobalStateRefs(),S=v.getPaintAffectingGlobalStateRefs();if(w.has(f)&&r.add(v.source),S.has(f))for(const{name:C,value:D}of S.get(f))this._updatePaintProperty(v,C,D)}}this.dispatcher.broadcast("UGS",c);for(const f in this.tileManagers)r.has(f)&&(this._reloadSource(f),this._changed=!0)}loadURL(e,r={},c){this.fire(new h.l("dataloading",{dataType:"style"})),r.validate=typeof r.validate!="boolean"||r.validate;const f=this.map._requestManager.transformRequest(e,"Style");this._loadStyleRequest=new AbortController;const g=this._loadStyleRequest;h.j(f,this._loadStyleRequest).then((v=>{this._loadStyleRequest=null,this._load(v.data,r,c)})).catch((v=>{this._loadStyleRequest=null,v&&!g.signal.aborted&&this.fire(new h.k(v))}))}loadJSON(e,r={},c){this.fire(new h.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,he.frameAsync(this._frameRequest).then((()=>{this._frameRequest=null,r.validate=r.validate!==!1,this._load(e,r,c)})).catch((()=>{}))}loadEmpty(){this.fire(new h.l("dataloading",{dataType:"style"})),this._load(Mh,{validate:!1})}_load(e,r,c){var f,g;let v=r.transformStyle?r.transformStyle(c,e):e;if(!r.validate||!Fo(this,h.C(v))){v=Object.assign({},v),this._loaded=!0,this.stylesheet=v;for(const w in v.sources)this.addSource(w,v.sources[w],{validate:!1});v.sprite?this._loadSprite(v.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(v.glyphs),this._createLayers(),this.light=new si(this.stylesheet.light),this._setProjectionInternal(((f=this.stylesheet.projection)===null||f===void 0?void 0:f.type)||"mercator"),this.sky=new Ht(this.stylesheet.sky),this.map.setTerrain((g=this.stylesheet.terrain)!==null&&g!==void 0?g:null),this.fire(new h.l("data",{dataType:"style"})),this.fire(new h.l("style.load"))}}_createLayers(){var e,r,c;const f=h.bR(this.stylesheet.layers);this.setGlobalState((e=this.stylesheet.state)!==null&&e!==void 0?e:null),this.dispatcher.broadcast("SL",f),this._order=f.map((g=>g.id)),this._layers={},this._serializedLayers=null;for(const g of f){const v=h.bS(g,this._globalState);if(v.setEventedParent(this,{layer:{id:g.id}}),this._layers[g.id]=v,h.bT(v)&&this.tileManagers[v.source]){const w=(c=(r=g.paint)===null||r===void 0?void 0:r["raster-fade-duration"])!==null&&c!==void 0?c:v.paint.get("raster-fade-duration");this.tileManagers[v.source].setRasterFadeDuration(w)}}}_loadSprite(e,r=!1,c=void 0){let f;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,(function(g,v,w,S){return h._(this,void 0,void 0,(function*(){const C=$e(g),D=w>1?"@2x":"",k={},L={};for(const{id:j,url:Z}of C){const W=v.transformRequest(Ai(Z,D,".json"),"SpriteJSON");k[j]=h.j(W,S);const Q=v.transformRequest(Ai(Z,D,".png"),"SpriteImage");L[j]=pe.getImage(Q,S)}return yield Promise.all([...Object.values(k),...Object.values(L)]),(function(j,Z){return h._(this,void 0,void 0,(function*(){const W={};for(const Q in j){W[Q]={};const it=he.getImageCanvasContext((yield Z[Q]).data),st=(yield j[Q]).data;for(const ht in st){const{width:at,height:dt,x:mt,y:ct,sdf:Tt,pixelRatio:kt,stretchX:zt,stretchY:It,content:Rt,textFitWidth:ae,textFitHeight:re}=st[ht];W[Q][ht]={data:null,pixelRatio:kt,sdf:Tt,stretchX:zt,stretchY:It,content:Rt,textFitWidth:ae,textFitHeight:re,spriteData:{width:at,height:dt,x:mt,y:ct,context:it}}}}return W}))})(k,L)}))})(e,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then((g=>{if(this._spriteRequest=null,g)for(const v in g){this._spritesImagesIds[v]=[];const w=this._spritesImagesIds[v]?this._spritesImagesIds[v].filter((S=>!(S in g))):[];for(const S of w)this.imageManager.removeImage(S),this._changedImages[S]=!0;for(const S in g[v]){const C=v==="default"?S:`${v}:${S}`;this._spritesImagesIds[v].push(C),C in this.imageManager.images?this.imageManager.updateImage(C,g[v][S],!1):this.imageManager.addImage(C,g[v][S]),r&&(this._changedImages[C]=!0)}}})).catch((g=>{this._spriteRequest=null,f=g,this.fire(new h.k(f))})).finally((()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),r&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new h.l("data",{dataType:"style"})),c&&c(f)}))}_unloadSprite(){for(const e of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(e),this._changedImages[e]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new h.l("data",{dataType:"style"}))}_validateLayer(e){const r=this.tileManagers[e.source];if(!r)return;const c=e.sourceLayer;if(!c)return;const f=r.getSource();(f.type==="geojson"||f.vectorLayerIds&&f.vectorLayerIds.indexOf(c)===-1)&&this.fire(new h.k(new Error(`Source layer "${c}" does not exist on source "${f.id}" as specified by style layer "${e.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const e in this.tileManagers)if(!this.tileManagers[e].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(e,r=!1){const c=this._serializedAllLayers();if(!e||e.length===0)return Object.values(r?h.bU(c):c);const f=[];for(const g of e)if(c[g]){const v=r?h.bU(c[g]):c[g];f.push(v)}return f}_serializedAllLayers(){let e=this._serializedLayers;if(e)return e;e=this._serializedLayers={};const r=Object.keys(this._layers);for(const c of r){const f=this._layers[c];f.type!=="custom"&&(e[c]=f.serialize())}return e}hasTransitions(){var e,r,c;if(!((e=this.light)===null||e===void 0)&&e.hasTransition()||!((r=this.sky)===null||r===void 0)&&r.hasTransition()||!((c=this.projection)===null||c===void 0)&&c.hasTransition())return!0;for(const f in this.tileManagers)if(this.tileManagers[f].hasTransition())return!0;for(const f in this._layers)if(this._layers[f].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(e){if(!this._loaded)return;const r=this._changed;if(r){const f=Object.keys(this._updatedLayers),g=Object.keys(this._removedLayers);(f.length||g.length)&&this._updateWorkerLayers(f,g);for(const v in this._updatedSources){const w=this._updatedSources[v];if(w==="reload")this._reloadSource(v);else{if(w!=="clear")throw new Error(`Invalid action ${w}`);this._clearSource(v)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const v in this._updatedPaintProps)this._layers[v].updateTransitions(e);this.light.updateTransitions(e),this.sky.updateTransitions(e),this._resetUpdates()}const c={};for(const f in this.tileManagers){const g=this.tileManagers[f];c[f]=g.used,g.used=!1}for(const f of this._order){const g=this._layers[f];g.recalculate(e,this._availableImages),!g.isHidden(e.zoom)&&g.source&&(this.tileManagers[g.source].used=!0)}for(const f in c){const g=this.tileManagers[f];!!c[f]!=!!g.used&&g.fire(new h.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:f}))}this.light.recalculate(e),this.sky.recalculate(e),this.projection.recalculate(e),this.z=e.zoom,r&&this.fire(new h.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){const e=Object.keys(this._changedImages);if(e.length){for(const r in this.tileManagers)this.tileManagers[r].reloadTilesForDependencies(["icons","patterns"],e);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const e in this.tileManagers)this.tileManagers[e].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(e,r){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(e,!1),removedIds:r})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(e,r={}){var c;this._checkLoaded();const f=this.serialize();if(e=r.transformStyle?r.transformStyle(f,e):e,((c=r.validate)===null||c===void 0||c)&&Fo(this,h.C(e)))return!1;(e=h.bU(e)).layers=h.bR(e.layers);const g=h.bV(f,e),v=this._getOperationsToPerform(g);if(v.unimplemented.length>0)throw new Error(`Unimplemented: ${v.unimplemented.join(", ")}.`);if(v.operations.length===0)return!1;for(const w of v.operations)w();return this.stylesheet=e,this._serializedLayers=null,!0}_getOperationsToPerform(e){const r=[],c=[];for(const f of e)switch(f.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":r.push((()=>this.addLayer.apply(this,f.args)));break;case"removeLayer":r.push((()=>this.removeLayer.apply(this,f.args)));break;case"setPaintProperty":r.push((()=>this.setPaintProperty.apply(this,f.args)));break;case"setLayoutProperty":r.push((()=>this.setLayoutProperty.apply(this,f.args)));break;case"setFilter":r.push((()=>this.setFilter.apply(this,f.args)));break;case"addSource":r.push((()=>this.addSource.apply(this,f.args)));break;case"removeSource":r.push((()=>this.removeSource.apply(this,f.args)));break;case"setLayerZoomRange":r.push((()=>this.setLayerZoomRange.apply(this,f.args)));break;case"setLight":r.push((()=>this.setLight.apply(this,f.args)));break;case"setGeoJSONSourceData":r.push((()=>this.setGeoJSONSourceData.apply(this,f.args)));break;case"setGlyphs":r.push((()=>this.setGlyphs.apply(this,f.args)));break;case"setSprite":r.push((()=>this.setSprite.apply(this,f.args)));break;case"setTerrain":r.push((()=>this.map.setTerrain.apply(this,f.args)));break;case"setSky":r.push((()=>this.setSky.apply(this,f.args)));break;case"setProjection":this.setProjection.apply(this,f.args);break;case"setGlobalState":r.push((()=>this.setGlobalState.apply(this,f.args)));break;case"setTransition":r.push((()=>{}));break;default:c.push(f.command)}return{operations:r,unimplemented:c}}addImage(e,r){if(this.getImage(e))return this.fire(new h.k(new Error(`An image named "${e}" already exists.`)));this.imageManager.addImage(e,r),this._afterImageUpdated(e)}updateImage(e,r){this.imageManager.updateImage(e,r)}getImage(e){return this.imageManager.getImage(e)}removeImage(e){if(!this.getImage(e))return this.fire(new h.k(new Error(`An image named "${e}" does not exist.`)));this.imageManager.removeImage(e),this._afterImageUpdated(e)}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new h.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(e,r,c={}){if(this._checkLoaded(),this.tileManagers[e]!==void 0)throw new Error(`Source "${e}" already exists.`);if(!r.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(r).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(r.type)>=0&&this._validate(h.C.source,`sources.${e}`,r,null,c))return;this.map&&this.map._collectResourceTiming&&(r.collectResourceTiming=!0);const f=this.tileManagers[e]=new Je(e,r,this.dispatcher);f.style=this,f.setEventedParent(this,(()=>({isSourceLoaded:f.loaded(),source:f.serialize(),sourceId:e}))),f.onAdd(this.map),this._changed=!0}removeSource(e){if(this._checkLoaded(),this.tileManagers[e]===void 0)throw new Error("There is no source with this ID");for(const c in this._layers)if(this._layers[c].source===e)return this.fire(new h.k(new Error(`Source "${e}" cannot be removed while layer "${c}" is using it.`)));const r=this.tileManagers[e];delete this.tileManagers[e],delete this._updatedSources[e],r.fire(new h.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),r.setEventedParent(null),r.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(e,r){if(this._checkLoaded(),this.tileManagers[e]===void 0)throw new Error(`There is no source with this ID=${e}`);const c=this.tileManagers[e].getSource();if(c.type!=="geojson")throw new Error(`geojsonSource.type is ${c.type}, which is !== 'geojson`);c.setData(r),this._changed=!0}getSource(e){return this.tileManagers[e]&&this.tileManagers[e].getSource()}addLayer(e,r,c={}){this._checkLoaded();const f=e.id;if(this.getLayer(f))return void this.fire(new h.k(new Error(`Layer "${f}" already exists on this map.`)));let g;if(e.type==="custom"){if(Fo(this,h.bW(e)))return;g=h.bS(e,this._globalState)}else{if("source"in e&&typeof e.source=="object"&&(this.addSource(f,e.source),e=h.bU(e),e=h.e(e,{source:f})),this._validate(h.C.layer,`layers.${f}`,e,{arrayIndex:-1},c))return;g=h.bS(e,this._globalState),this._validateLayer(g),g.setEventedParent(this,{layer:{id:f}})}const v=r?this._order.indexOf(r):this._order.length;if(r&&v===-1)this.fire(new h.k(new Error(`Cannot add layer "${f}" before non-existing layer "${r}".`)));else{if(this._order.splice(v,0,f),this._layerOrderChanged=!0,this._layers[f]=g,this._removedLayers[f]&&g.source&&g.type!=="custom"){const w=this._removedLayers[f];delete this._removedLayers[f],w.type!==g.type?this._updatedSources[g.source]="clear":(this._updatedSources[g.source]="reload",this.tileManagers[g.source].pause())}this._updateLayer(g),g.onAdd&&g.onAdd(this.map)}}moveLayer(e,r){if(this._checkLoaded(),this._changed=!0,!this._layers[e])return void this.fire(new h.k(new Error(`The layer '${e}' does not exist in the map's style and cannot be moved.`)));if(e===r)return;const c=this._order.indexOf(e);this._order.splice(c,1);const f=r?this._order.indexOf(r):this._order.length;r&&f===-1?this.fire(new h.k(new Error(`Cannot move layer "${e}" before non-existing layer "${r}".`))):(this._order.splice(f,0,e),this._layerOrderChanged=!0)}removeLayer(e){this._checkLoaded();const r=this._layers[e];if(!r)return void this.fire(new h.k(new Error(`Cannot remove non-existing layer "${e}".`)));r.setEventedParent(null);const c=this._order.indexOf(e);this._order.splice(c,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=r,delete this._layers[e],this._serializedLayers&&delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],r.onRemove&&r.onRemove(this.map)}getLayer(e){return this._layers[e]}getLayersOrder(){return[...this._order]}hasLayer(e){return e in this._layers}setLayerZoomRange(e,r,c){this._checkLoaded();const f=this.getLayer(e);f?f.minzoom===r&&f.maxzoom===c||(r!=null&&(f.minzoom=r),c!=null&&(f.maxzoom=c),this._updateLayer(f)):this.fire(new h.k(new Error(`Cannot set the zoom range of non-existing layer "${e}".`)))}setFilter(e,r,c={}){this._checkLoaded();const f=this.getLayer(e);if(f){if(!h.bQ(f.filter,r))return r==null?(f.setFilter(void 0),void this._updateLayer(f)):void(this._validate(h.C.filter,`layers.${f.id}.filter`,r,null,c)||(f.setFilter(h.bU(r)),this._updateLayer(f)))}else this.fire(new h.k(new Error(`Cannot filter non-existing layer "${e}".`)))}getFilter(e){return h.bU(this.getLayer(e).filter)}setLayoutProperty(e,r,c,f={}){this._checkLoaded();const g=this.getLayer(e);g?h.bQ(g.getLayoutProperty(r),c)||(g.setLayoutProperty(r,c,f),this._updateLayer(g)):this.fire(new h.k(new Error(`Cannot style non-existing layer "${e}".`)))}getLayoutProperty(e,r){const c=this.getLayer(e);if(c)return c.getLayoutProperty(r);this.fire(new h.k(new Error(`Cannot get style of non-existing layer "${e}".`)))}setPaintProperty(e,r,c,f={}){this._checkLoaded();const g=this.getLayer(e);g?h.bQ(g.getPaintProperty(r),c)||this._updatePaintProperty(g,r,c,f):this.fire(new h.k(new Error(`Cannot style non-existing layer "${e}".`)))}_updatePaintProperty(e,r,c,f={}){e.setPaintProperty(r,c,f)&&this._updateLayer(e),h.bT(e)&&r==="raster-fade-duration"&&this.tileManagers[e.source].setRasterFadeDuration(c),this._changed=!0,this._updatedPaintProps[e.id]=!0,this._serializedLayers=null}getPaintProperty(e,r){return this.getLayer(e).getPaintProperty(r)}setFeatureState(e,r){this._checkLoaded();const c=e.source,f=e.sourceLayer,g=this.tileManagers[c];if(g===void 0)return void this.fire(new h.k(new Error(`The source '${c}' does not exist in the map's style.`)));const v=g.getSource().type;v==="geojson"&&f?this.fire(new h.k(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):v!=="vector"||f?(e.id===void 0&&this.fire(new h.k(new Error("The feature id parameter must be provided."))),g.setFeatureState(f,e.id,r)):this.fire(new h.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(e,r){this._checkLoaded();const c=e.source,f=this.tileManagers[c];if(f===void 0)return void this.fire(new h.k(new Error(`The source '${c}' does not exist in the map's style.`)));const g=f.getSource().type,v=g==="vector"?e.sourceLayer:void 0;g!=="vector"||v?r&&typeof e.id!="string"&&typeof e.id!="number"?this.fire(new h.k(new Error("A feature id is required to remove its specific state property."))):f.removeFeatureState(v,e.id,r):this.fire(new h.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(e){this._checkLoaded();const r=e.source,c=e.sourceLayer,f=this.tileManagers[r];if(f!==void 0)return f.getSource().type!=="vector"||c?(e.id===void 0&&this.fire(new h.k(new Error("The feature id parameter must be provided."))),f.getFeatureState(c,e.id)):void this.fire(new h.k(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new h.k(new Error(`The source '${r}' does not exist in the map's style.`)))}getTransition(){return h.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const e=h.bX(this.tileManagers,(g=>g.serialize())),r=this._serializeByIds(this._order,!0),c=this.map.getTerrain()||void 0,f=this.stylesheet;return h.bY({version:f.version,name:f.name,metadata:f.metadata,light:f.light,sky:f.sky,center:f.center,zoom:f.zoom,bearing:f.bearing,pitch:f.pitch,sprite:f.sprite,glyphs:f.glyphs,transition:f.transition,projection:f.projection,sources:e,layers:r,terrain:c},(g=>g!==void 0))}_updateLayer(e){this._updatedLayers[e.id]=!0,e.source&&!this._updatedSources[e.source]&&this.tileManagers[e.source].getSource().type!=="raster"&&(this._updatedSources[e.source]="reload",this.tileManagers[e.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(e){const r=v=>this._layers[v].type==="fill-extrusion",c={},f=[];for(let v=this._order.length-1;v>=0;v--){const w=this._order[v];if(r(w)){c[w]=v;for(const S of e){const C=S[w];if(C)for(const D of C)f.push(D)}}}f.sort(((v,w)=>w.intersectionZ-v.intersectionZ));const g=[];for(let v=this._order.length-1;v>=0;v--){const w=this._order[v];if(r(w))for(let S=f.length-1;S>=0;S--){const C=f[S].feature;if(c[C.layer.id]<v)break;g.push(C),f.pop()}else for(const S of e){const C=S[w];if(C)for(const D of C)g.push(D.feature)}}return g}queryRenderedFeatures(e,r,c){r&&r.filter&&this._validate(h.C.filter,"queryRenderedFeatures.filter",r.filter,null,r);const f={};if(r&&r.layers){if(!(Array.isArray(r.layers)||r.layers instanceof Set))return this.fire(new h.k(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(const C of r.layers){const D=this._layers[C];if(!D)return this.fire(new h.k(new Error(`The layer '${C}' does not exist in the map's style and cannot be queried for features.`))),[];f[D.source]=!0}}const g=[];r.availableImages=this._availableImages;const v=this._serializedAllLayers(),w=r.layers instanceof Set?r.layers:Array.isArray(r.layers)?new Set(r.layers):null,S=Object.assign(Object.assign({},r),{layers:w,globalState:this._globalState});for(const C in this.tileManagers)r.layers&&!f[C]||g.push(Ki(this.tileManagers[C],this._layers,v,e,S,c,this.map.terrain?(D,k,L)=>this.map.terrain.getElevation(D,k,L):void 0));return this.placement&&g.push((function(C,D,k,L,j,Z,W){const Q={},it=Z.queryRenderedSymbols(L),st=[];for(const ht of Object.keys(it).map(Number))st.push(W[ht]);st.sort(oi);for(const ht of st){const at=ht.featureIndex.lookupSymbolFeatures(it[ht.bucketInstanceId],D,ht.bucketIndex,ht.sourceLayerIndex,{filterSpec:j.filter,globalState:j.globalState},j.layers,j.availableImages,C);for(const dt in at){const mt=Q[dt]=Q[dt]||[],ct=at[dt];ct.sort(((Tt,kt)=>{const zt=ht.featureSortOrder;if(zt){const It=zt.indexOf(Tt.featureIndex);return zt.indexOf(kt.featureIndex)-It}return kt.featureIndex-Tt.featureIndex}));for(const Tt of ct)mt.push(Tt)}}return(function(ht,at,dt){for(const mt in ht)for(const ct of ht[mt])ia(ct,dt[at[mt].source]);return ht})(Q,C,k)})(this._layers,v,this.tileManagers,e,S,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(g)}querySourceFeatures(e,r){r?.filter&&this._validate(h.C.filter,"querySourceFeatures.filter",r.filter,null,r);const c=this.tileManagers[e];return c?(function(f,g){const v=f.getRenderableIds().map((C=>f.getTileByID(C))),w=[],S={};for(let C=0;C<v.length;C++){const D=v[C],k=D.tileID.canonical.key;S[k]||(S[k]=!0,D.querySourceFeatures(w,g))}return w})(c,r?Object.assign(Object.assign({},r),{globalState:this._globalState}):{globalState:this._globalState}):[]}getLight(){return this.light.getLight()}setLight(e,r={}){this._checkLoaded();const c=this.light.getLight();let f=!1;for(const v in e)if(!h.bQ(e[v],c[v])){f=!0;break}if(!f)return;const g={now:Kt(),transition:h.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,r),this.light.updateTransitions(g)}getProjection(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.projection}setProjection(e){if(this._checkLoaded(),this.projection){if(this.projection.name===e.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=e,this._setProjectionInternal(e.type)}getSky(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.sky}setSky(e,r={}){this._checkLoaded();const c=this.getSky();let f=!1;if(!e&&!c)return;if(e&&!c)f=!0;else if(!e&&c)f=!0;else for(const v in e)if(!h.bQ(e[v],c[v])){f=!0;break}if(!f)return;const g={now:Kt(),transition:h.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=e,this.sky.setSky(e,r),this.sky.updateTransitions(g)}_setProjectionInternal(e){const r=(function(c,f){const g={constrainOverride:f};if(Array.isArray(c)){const v=new io({type:c});return{projection:v,transform:new Tu(g),cameraHelper:new Su(v)}}switch(c){case"mercator":return{projection:new Bn,transform:new Ni(g),cameraHelper:new ua};case"globe":{const v=new io({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:v,transform:new Tu(g),cameraHelper:new Su(v)}}case"vertical-perspective":return{projection:new vc,transform:new wu(g),cameraHelper:new Za};default:return h.w(`Unknown projection name: ${c}. Falling back to mercator projection.`),{projection:new Bn,transform:new Ni(g),cameraHelper:new ua}}})(e,this.map.transformConstrain);this.projection=r.projection,this.map.migrateProjection(r.transform,r.cameraHelper);for(const c in this.tileManagers)this.tileManagers[c].reload()}_validate(e,r,c,f,g={}){return(!g||g.validate!==!1)&&Fo(this,e.call(h.C,h.e({key:r,style:this.serialize(),value:c,styleSpec:h.u},f)))}_remove(e=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),za().off(Ts,this._rtlPluginLoaded);for(const r in this._layers)this._layers[r].setEventedParent(null);for(const r in this.tileManagers){const c=this.tileManagers[r];c.setEventedParent(null),c.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),e&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(e)}_clearSource(e){this.tileManagers[e].clearTiles()}_reloadSource(e){this.tileManagers[e].resume(),this.tileManagers[e].reload()}_updateSources(e){for(const r in this.tileManagers)this.tileManagers[r].update(e,this.map.terrain)}_generateCollisionBoxes(){for(const e in this.tileManagers)this._reloadSource(e)}_updatePlacement(e,r,c,f,g=!1){let v=!1,w=!1;const S={};for(const C of this._order){const D=this._layers[C];if(D.type!=="symbol")continue;if(!S[D.source]){const L=this.tileManagers[D.source];S[D.source]=L.getRenderableIds(!0).map((j=>L.getTileByID(j))).sort(((j,Z)=>Z.tileID.overscaledZ-j.tileID.overscaledZ||(j.tileID.isLessThan(Z.tileID)?-1:1)))}const k=this.crossTileSymbolIndex.addLayer(D,S[D.source],e.center.lng);v=v||k}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((g=g||this._layerOrderChanged||c===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(Kt(),e.zoom))&&(this.pauseablePlacement=new Bo(e,this.map.terrain,this._order,g,r,c,f,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,S),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(Kt()),w=!0),v&&this.pauseablePlacement.placement.setStale()),w||v)for(const C of this._order){const D=this._layers[C];D.type==="symbol"&&this.placement.updateLayerOpacities(D,S[D.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(Kt())}_releaseSymbolFadeTiles(){for(const e in this.tileManagers)this.tileManagers[e].releaseSymbolFadeTiles()}getImages(e,r){return h._(this,void 0,void 0,(function*(){const c=yield this.imageManager.getImages(r.icons);this._updateTilesForChangedImages();const f=this.tileManagers[r.source];return f&&f.setDependencies(r.tileID.key,r.type,r.icons),c}))}getGlyphs(e,r){return h._(this,void 0,void 0,(function*(){const c=yield this.glyphManager.getGlyphs(r.stacks),f=this.tileManagers[r.source];return f&&f.setDependencies(r.tileID.key,r.type,[""]),c}))}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(e,r={}){this._checkLoaded(),e&&this._validate(h.C.glyphs,"glyphs",e,null,r)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=e,this.glyphManager.entries={},this.glyphManager.setURL(e))}getDashes(e,r){return h._(this,void 0,void 0,(function*(){const c={};for(const[f,g]of Object.entries(r.dashes))c[f]=this.lineAtlas.getDash(g.dasharray,g.round);return c}))}addSprite(e,r,c={},f){this._checkLoaded();const g=[{id:e,url:r}],v=[...$e(this.stylesheet.sprite),...g];this._validate(h.C.sprite,"sprite",v,null,c)||(this.stylesheet.sprite=v,this._loadSprite(g,!0,f))}removeSprite(e){this._checkLoaded();const r=$e(this.stylesheet.sprite);if(r.find((c=>c.id===e))){if(this._spritesImagesIds[e])for(const c of this._spritesImagesIds[e])this.imageManager.removeImage(c),this._changedImages[c]=!0;r.splice(r.findIndex((c=>c.id===e)),1),this.stylesheet.sprite=r.length>0?r:void 0,delete this._spritesImagesIds[e],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new h.l("data",{dataType:"style"}))}else this.fire(new h.k(new Error(`Sprite "${e}" doesn't exists on this map.`)))}getSprite(){return $e(this.stylesheet.sprite)}setSprite(e,r={},c){this._checkLoaded(),e&&this._validate(h.C.sprite,"sprite",e,null,r)||(this.stylesheet.sprite=e,e?this._loadSprite(e,!0,c):(this._unloadSprite(),c&&c(null)))}destroy(){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null);for(const e in this.tileManagers){const r=this.tileManagers[e];if(r.setEventedParent(null),r._tiles){for(const c in r._tiles)r._tiles[c].unloadVectorData();r._tiles={}}r._cache.reset(),r.onRemove(this.map)}this.tileManagers={},this.imageManager&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this._availableImages=[],this._spritesImagesIds={}),this.glyphManager&&this.glyphManager.destroy();for(const e in this._layers){const r=this._layers[e];r.setEventedParent(null),r.onRemove&&r.onRemove(this.map)}this._setInitialValues(),this.setEventedParent(null),this.dispatcher.unregisterMessageHandler("GG"),this.dispatcher.unregisterMessageHandler("GI"),this.dispatcher.unregisterMessageHandler("GDA"),this.dispatcher.remove(!0),this._listeners={},this._oneTimeListeners={}}}var as=h.aT([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Ch{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(e,r,c,f,g,v,w,S,C){this.context=e;let D=this.boundPaintVertexBuffers.length!==f.length;for(let k=0;!D&&k<f.length;k++)this.boundPaintVertexBuffers[k]!==f[k]&&(D=!0);!this.vao||this.boundProgram!==r||this.boundLayoutVertexBuffer!==c||D||this.boundIndexBuffer!==g||this.boundVertexOffset!==v||this.boundDynamicVertexBuffer!==w||this.boundDynamicVertexBuffer2!==S||this.boundDynamicVertexBuffer3!==C?this.freshBind(r,c,f,g,v,w,S,C):(e.bindVertexArray.set(this.vao),w&&w.bind(),g&&g.dynamicDraw&&g.bind(),S&&S.bind(),C&&C.bind())}freshBind(e,r,c,f,g,v,w,S){const C=e.numAttributes,D=this.context,k=D.gl;this.vao&&this.destroy(),this.vao=D.createVertexArray(),D.bindVertexArray.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=r,this.boundPaintVertexBuffers=c,this.boundIndexBuffer=f,this.boundVertexOffset=g,this.boundDynamicVertexBuffer=v,this.boundDynamicVertexBuffer2=w,this.boundDynamicVertexBuffer3=S,r.enableAttributes(k,e);for(const L of c)L.enableAttributes(k,e);v&&v.enableAttributes(k,e),w&&w.enableAttributes(k,e),S&&S.enableAttributes(k,e),r.bind(),r.setVertexAttribPointers(k,e,g);for(const L of c)L.bind(),L.setVertexAttribPointers(k,e,g);v&&(v.bind(),v.setVertexAttribPointers(k,e,g)),f&&f.bind(),w&&(w.bind(),w.setVertexAttribPointers(k,e,g)),S&&(S.bind(),S.setVertexAttribPointers(k,e,g)),D.currentNumAttributes=C}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const jo=(m,e,r,c,f)=>({u_texture:0,u_ele_delta:m,u_fog_matrix:e,u_fog_color:r?r.properties.get("fog-color"):h.bo.white,u_fog_ground_blend:r?r.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:f?0:r?r.calculateFogBlendOpacity(c):0,u_horizon_color:r?r.properties.get("horizon-color"):h.bo.white,u_horizon_fog_blend:r?r.properties.get("horizon-fog-blend"):1,u_is_globe_mode:f?1:0}),bc={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function Ds(m){const e=[];for(let r=0;r<m.length;r++){if(m[r]===null)continue;const c=m[r].split(" ");e.push(c.pop())}return e}class kd{constructor(e,r,c,f,g,v,w,S,C=[]){const D=e.gl;this.program=D.createProgram();const k=Ds(r.staticAttributes),L=c?c.getBinderAttributes():[],j=k.concat(L),Z=Ia.prelude.staticUniforms?Ds(Ia.prelude.staticUniforms):[],W=w.staticUniforms?Ds(w.staticUniforms):[],Q=r.staticUniforms?Ds(r.staticUniforms):[],it=c?c.getBinderUniforms():[],st=Z.concat(W).concat(Q).concat(it),ht=[];for(const zt of st)ht.indexOf(zt)<0&&ht.push(zt);const at=c?c.defines():[];ar(D)&&at.unshift("#version 300 es"),g&&at.push("#define OVERDRAW_INSPECTOR;"),v&&at.push("#define TERRAIN3D;"),S&&at.push(S),C&&at.push(...C);let dt=at.concat(Ia.prelude.fragmentSource,w.fragmentSource,r.fragmentSource).join(`
`),mt=at.concat(Ia.prelude.vertexSource,w.vertexSource,r.vertexSource).join(`
`);ar(D)||(dt=(function(zt){return zt.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")})(dt),mt=(function(zt){return zt.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")})(mt));const ct=D.createShader(D.FRAGMENT_SHADER);if(D.isContextLost())return void(this.failedToCreate=!0);if(D.shaderSource(ct,dt),D.compileShader(ct),!D.getShaderParameter(ct,D.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${D.getShaderInfoLog(ct)}`);D.attachShader(this.program,ct);const Tt=D.createShader(D.VERTEX_SHADER);if(D.isContextLost())return void(this.failedToCreate=!0);if(D.shaderSource(Tt,mt),D.compileShader(Tt),!D.getShaderParameter(Tt,D.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${D.getShaderInfoLog(Tt)}`);D.attachShader(this.program,Tt),this.attributes={};const kt={};this.numAttributes=j.length;for(let zt=0;zt<this.numAttributes;zt++)j[zt]&&(D.bindAttribLocation(this.program,zt,j[zt]),this.attributes[j[zt]]=zt);if(D.linkProgram(this.program),!D.getProgramParameter(this.program,D.LINK_STATUS))throw new Error(`Program failed to link: ${D.getProgramInfoLog(this.program)}`);D.deleteShader(Tt),D.deleteShader(ct);for(let zt=0;zt<ht.length;zt++){const It=ht[zt];if(It&&!kt[It]){const Rt=D.getUniformLocation(this.program,It);Rt&&(kt[It]=Rt)}}this.fixedUniforms=f(e,kt),this.terrainUniforms=((zt,It)=>({u_depth:new h.bZ(zt,It.u_depth),u_terrain:new h.bZ(zt,It.u_terrain),u_terrain_dim:new h.bp(zt,It.u_terrain_dim),u_terrain_matrix:new h.b$(zt,It.u_terrain_matrix),u_terrain_unpack:new h.c0(zt,It.u_terrain_unpack),u_terrain_exaggeration:new h.bp(zt,It.u_terrain_exaggeration)}))(e,kt),this.projectionUniforms=((zt,It)=>({u_projection_matrix:new h.b$(zt,It.u_projection_matrix),u_projection_tile_mercator_coords:new h.c0(zt,It.u_projection_tile_mercator_coords),u_projection_clipping_plane:new h.c0(zt,It.u_projection_clipping_plane),u_projection_transition:new h.bp(zt,It.u_projection_transition),u_projection_fallback_matrix:new h.b$(zt,It.u_projection_fallback_matrix)}))(e,kt),this.binderUniforms=c?c.getUniforms(e,kt):[]}draw(e,r,c,f,g,v,w,S,C,D,k,L,j,Z,W,Q,it,st,ht){const at=e.gl;if(this.failedToCreate)return;if(e.program.set(this.program),e.setDepthMode(c),e.setStencilMode(f),e.setColorMode(g),e.setCullFace(v),S){e.activeTexture.set(at.TEXTURE2),at.bindTexture(at.TEXTURE_2D,S.depthTexture),e.activeTexture.set(at.TEXTURE3),at.bindTexture(at.TEXTURE_2D,S.texture);for(const mt in this.terrainUniforms)this.terrainUniforms[mt].set(S[mt])}if(C)for(const mt in C)this.projectionUniforms[bc[mt]].set(C[mt]);if(w)for(const mt in this.fixedUniforms)this.fixedUniforms[mt].set(w[mt]);Q&&Q.setUniforms(e,this.binderUniforms,Z,{zoom:W});let dt=0;switch(r){case at.LINES:dt=2;break;case at.TRIANGLES:dt=3;break;case at.LINE_STRIP:dt=1}for(const mt of j.get()){const ct=mt.vaos||(mt.vaos={});(ct[D]||(ct[D]=new Ch)).bind(e,this,k,Q?Q.getPaintVertexBuffers():[],L,mt.vertexOffset,it,st,ht),at.drawElements(r,mt.primitiveLength*dt,at.UNSIGNED_SHORT,mt.primitiveOffset*dt*2)}}}function zl(m,e,r){const c=1/h.aM(r,1,e.transform.tileZoom),f=Math.pow(2,r.tileID.overscaledZ),g=r.tileSize*Math.pow(2,e.transform.tileZoom)/f,v=g*(r.tileID.canonical.x+r.tileID.wrap*f),w=g*r.tileID.canonical.y;return{u_image:0,u_texsize:r.imageAtlasTexture.size,u_scale:[c,m.fromScale,m.toScale],u_fade:m.t,u_pixel_coord_upper:[v>>16,w>>16],u_pixel_coord_lower:[65535&v,65535&w]}}const Ah=(m,e,r,c)=>{const f=m.style.light,g=f.properties.get("position"),v=[g.x,g.y,g.z],w=h.c3();f.properties.get("anchor")==="viewport"&&h.c4(w,m.transform.bearingInRadians),h.c5(v,v,w);const S=m.transform.transformLightDirection(v),C=f.properties.get("color");return{u_lightpos:v,u_lightpos_globe:S,u_lightintensity:f.properties.get("intensity"),u_lightcolor:[C.r,C.g,C.b],u_vertical_gradient:+e,u_opacity:r,u_fill_translate:c}},Vo=(m,e,r,c,f,g,v)=>h.e(Ah(m,e,r,c),zl(g,m,v),{u_height_factor:-Math.pow(2,f.overscaledZ)/v.tileSize/8}),Uo=(m,e,r,c)=>h.e(zl(e,m,r),{u_fill_translate:c}),Od=(m,e)=>({u_world:m,u_fill_translate:e}),Nf=(m,e,r,c,f)=>h.e(Uo(m,e,r,f),{u_world:c}),Bd=(m,e,r,c,f)=>{const g=m.transform;let v,w,S=0;if(r.paint.get("circle-pitch-alignment")==="map"){const C=h.aM(e,1,g.zoom);v=!0,w=[C,C],S=C/(h.a4*Math.pow(2,e.tileID.overscaledZ))*2*Math.PI*f}else v=!1,w=g.pixelsToGLUnits;return{u_camera_to_center_distance:g.cameraToCenterDistance,u_scale_with_map:+(r.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+v,u_device_pixel_ratio:m.pixelRatio,u_extrude_scale:w,u_globe_extrude_scale:S,u_translate:c}},Eu=m=>({u_pixel_extrude_scale:[1/m.width,1/m.height]}),Dh=m=>({u_viewport_size:[m.width,m.height]}),Go=(m,e=1)=>({u_color:m,u_overlay:0,u_overlay_scale:e}),qo=(m,e,r,c)=>{const f=h.aM(m,1,e)/(h.a4*Math.pow(2,m.tileID.overscaledZ))*2*Math.PI*c;return{u_extrude_scale:h.aM(m,1,e),u_intensity:r,u_globe_extrude_scale:f}},zh=(m,e,r,c)=>{const f=h.N();h.c6(f,0,m.width,m.height,0,0,1);const g=m.context.gl;return{u_matrix:f,u_world:[g.drawingBufferWidth,g.drawingBufferHeight],u_image:r,u_color_ramp:c,u_opacity:e.paint.get("heatmap-opacity")}},rs=(m,e,r)=>{const c=r.paint.get("hillshade-accent-color");let f;switch(r.paint.get("hillshade-method")){case"basic":f=4;break;case"combined":f=1;break;case"igor":f=2;break;case"multidirectional":f=3;break;default:f=0}const g=r.getIlluminationProperties();for(let v=0;v<g.directionRadians.length;v++)r.paint.get("hillshade-illumination-anchor")==="viewport"&&(g.directionRadians[v]+=m.transform.bearingInRadians);return{u_image:0,u_latrange:Ih(0,e.tileID),u_exaggeration:r.paint.get("hillshade-exaggeration"),u_altitudes:g.altitudeRadians,u_azimuths:g.directionRadians,u_accent:c,u_method:f,u_highlights:g.highlightColor,u_shadows:g.shadowColor}},Ph=(m,e)=>{const r=e.stride,c=h.N();return h.c6(c,0,h.a4,-h.a4,0,0,1),h.O(c,c,[0,-h.a4,0]),{u_matrix:c,u_image:1,u_dimension:[r,r],u_zoom:m.overscaledZ,u_unpack:e.getUnpackVector()}};function Ih(m,e){const r=Math.pow(2,e.canonical.z),c=e.canonical.y;return[new h.aa(0,c/r).toLngLat().lat,new h.aa(0,(c+1)/r).toLngLat().lat]}const Zo=(m,e,r=0)=>({u_image:0,u_unpack:e.getUnpackVector(),u_dimension:[e.stride,e.stride],u_elevation_stops:1,u_color_stops:4,u_color_ramp_size:r,u_opacity:m.paint.get("color-relief-opacity")}),Pl=(m,e,r,c)=>{const f=m.transform;return{u_translation:Rh(m,e,r),u_ratio:c/h.aM(e,1,f.zoom),u_device_pixel_ratio:m.pixelRatio,u_units_to_pixels:[1/f.pixelsToGLUnits[0],1/f.pixelsToGLUnits[1]]}},Il=(m,e,r,c,f)=>h.e(Pl(m,e,r,c),{u_image:0,u_image_height:f}),Nd=(m,e,r,c,f)=>{const g=m.transform,v=Mu(e,g);return{u_translation:Rh(m,e,r),u_texsize:e.imageAtlasTexture.size,u_ratio:c/h.aM(e,1,g.zoom),u_device_pixel_ratio:m.pixelRatio,u_image:0,u_scale:[v,f.fromScale,f.toScale],u_fade:f.t,u_units_to_pixels:[1/g.pixelsToGLUnits[0],1/g.pixelsToGLUnits[1]]}},Fd=(m,e,r,c,f)=>{const g=Mu(e,m.transform);return h.e(Pl(m,e,r,c),{u_tileratio:g,u_crossfade_from:f.fromScale,u_crossfade_to:f.toScale,u_image:0,u_mix:f.t,u_lineatlas_width:m.lineAtlas.width,u_lineatlas_height:m.lineAtlas.height})},jd=(m,e,r,c,f,g)=>{const v=Mu(e,m.transform);return h.e(Pl(m,e,r,c),{u_image:0,u_image_height:g,u_tileratio:v,u_crossfade_from:f.fromScale,u_crossfade_to:f.toScale,u_image_dash:1,u_mix:f.t,u_lineatlas_width:m.lineAtlas.width,u_lineatlas_height:m.lineAtlas.height})};function Mu(m,e){return 1/h.aM(m,1,e.tileZoom)}function Rh(m,e,r){return h.aN(m.transform,e,r.paint.get("line-translate"),r.paint.get("line-translate-anchor"))}const Lh=(m,e,r,c,f)=>{return{u_tl_parent:m,u_scale_parent:e,u_buffer_scale:1,u_fade_t:r.mix,u_opacity:r.opacity*c.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:c.paint.get("raster-brightness-min"),u_brightness_high:c.paint.get("raster-brightness-max"),u_saturation_factor:(v=c.paint.get("raster-saturation"),v>0?1-1/(1.001-v):-v),u_contrast_factor:(g=c.paint.get("raster-contrast"),g>0?1/(1-g):1+g),u_spin_weights:Vd(c.paint.get("raster-hue-rotate")),u_coords_top:[f[0].x,f[0].y,f[1].x,f[1].y],u_coords_bottom:[f[3].x,f[3].y,f[2].x,f[2].y]};var g,v};function Vd(m){m*=Math.PI/180;const e=Math.sin(m),r=Math.cos(m);return[(2*r+1)/3,(-Math.sqrt(3)*e-r+1)/3,(Math.sqrt(3)*e-r+1)/3]}const da=(m,e,r,c,f,g,v,w,S,C,D,k,L)=>{const j=v.transform;return{u_is_size_zoom_constant:+(m==="constant"||m==="source"),u_is_size_feature_constant:+(m==="constant"||m==="camera"),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:j.cameraToCenterDistance,u_pitch:j.pitch/360*2*Math.PI,u_rotate_symbol:+r,u_aspect_ratio:j.width/j.height,u_fade_change:v.options.fadeDuration?v.symbolFadeChange:1,u_label_plane_matrix:w,u_coord_matrix:S,u_is_text:+D,u_pitch_with_map:+c,u_is_along_line:f,u_is_variable_anchor:g,u_texsize:k,u_texture:0,u_translation:C,u_pitched_scale:L}},Ha=(m,e,r,c,f,g,v,w,S,C,D,k,L,j)=>{const Z=v.transform;return h.e(da(m,e,r,c,f,g,v,w,S,C,D,k,j),{u_gamma_scale:c?Math.cos(Z.pitch*Math.PI/180)*Z.cameraToCenterDistance:1,u_device_pixel_ratio:v.pixelRatio,u_is_halo:1})},Cu=(m,e,r,c,f,g,v,w,S,C,D,k,L)=>h.e(Ha(m,e,r,c,f,g,v,w,S,C,!0,D,0,L),{u_texsize_icon:k,u_texture_icon:1}),Au=(m,e)=>({u_opacity:m,u_color:e}),Du=(m,e,r,c,f)=>h.e((function(g,v,w,S){const C=w.imageManager.getPattern(g.from.toString()),D=w.imageManager.getPattern(g.to.toString()),{width:k,height:L}=w.imageManager.getPixelSize(),j=Math.pow(2,S.tileID.overscaledZ),Z=S.tileSize*Math.pow(2,w.transform.tileZoom)/j,W=Z*(S.tileID.canonical.x+S.tileID.wrap*j),Q=Z*S.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:C.tl,u_pattern_br_a:C.br,u_pattern_tl_b:D.tl,u_pattern_br_b:D.br,u_texsize:[k,L],u_mix:v.t,u_pattern_size_a:C.displaySize,u_pattern_size_b:D.displaySize,u_scale_a:v.fromScale,u_scale_b:v.toScale,u_tile_units_to_pixels:1/h.aM(S,1,w.transform.tileZoom),u_pixel_coord_upper:[W>>16,Q>>16],u_pixel_coord_lower:[65535&W,65535&Q]}})(r,f,e,c),{u_opacity:m}),zu=(m,e)=>{},wc={fillExtrusion:(m,e)=>({u_lightpos:new h.c1(m,e.u_lightpos),u_lightpos_globe:new h.c1(m,e.u_lightpos_globe),u_lightintensity:new h.bp(m,e.u_lightintensity),u_lightcolor:new h.c1(m,e.u_lightcolor),u_vertical_gradient:new h.bp(m,e.u_vertical_gradient),u_opacity:new h.bp(m,e.u_opacity),u_fill_translate:new h.c2(m,e.u_fill_translate)}),fillExtrusionPattern:(m,e)=>({u_lightpos:new h.c1(m,e.u_lightpos),u_lightpos_globe:new h.c1(m,e.u_lightpos_globe),u_lightintensity:new h.bp(m,e.u_lightintensity),u_lightcolor:new h.c1(m,e.u_lightcolor),u_vertical_gradient:new h.bp(m,e.u_vertical_gradient),u_height_factor:new h.bp(m,e.u_height_factor),u_opacity:new h.bp(m,e.u_opacity),u_fill_translate:new h.c2(m,e.u_fill_translate),u_image:new h.bZ(m,e.u_image),u_texsize:new h.c2(m,e.u_texsize),u_pixel_coord_upper:new h.c2(m,e.u_pixel_coord_upper),u_pixel_coord_lower:new h.c2(m,e.u_pixel_coord_lower),u_scale:new h.c1(m,e.u_scale),u_fade:new h.bp(m,e.u_fade)}),fill:(m,e)=>({u_fill_translate:new h.c2(m,e.u_fill_translate)}),fillPattern:(m,e)=>({u_image:new h.bZ(m,e.u_image),u_texsize:new h.c2(m,e.u_texsize),u_pixel_coord_upper:new h.c2(m,e.u_pixel_coord_upper),u_pixel_coord_lower:new h.c2(m,e.u_pixel_coord_lower),u_scale:new h.c1(m,e.u_scale),u_fade:new h.bp(m,e.u_fade),u_fill_translate:new h.c2(m,e.u_fill_translate)}),fillOutline:(m,e)=>({u_world:new h.c2(m,e.u_world),u_fill_translate:new h.c2(m,e.u_fill_translate)}),fillOutlinePattern:(m,e)=>({u_world:new h.c2(m,e.u_world),u_image:new h.bZ(m,e.u_image),u_texsize:new h.c2(m,e.u_texsize),u_pixel_coord_upper:new h.c2(m,e.u_pixel_coord_upper),u_pixel_coord_lower:new h.c2(m,e.u_pixel_coord_lower),u_scale:new h.c1(m,e.u_scale),u_fade:new h.bp(m,e.u_fade),u_fill_translate:new h.c2(m,e.u_fill_translate)}),circle:(m,e)=>({u_camera_to_center_distance:new h.bp(m,e.u_camera_to_center_distance),u_scale_with_map:new h.bZ(m,e.u_scale_with_map),u_pitch_with_map:new h.bZ(m,e.u_pitch_with_map),u_extrude_scale:new h.c2(m,e.u_extrude_scale),u_device_pixel_ratio:new h.bp(m,e.u_device_pixel_ratio),u_globe_extrude_scale:new h.bp(m,e.u_globe_extrude_scale),u_translate:new h.c2(m,e.u_translate)}),collisionBox:(m,e)=>({u_pixel_extrude_scale:new h.c2(m,e.u_pixel_extrude_scale)}),collisionCircle:(m,e)=>({u_viewport_size:new h.c2(m,e.u_viewport_size)}),debug:(m,e)=>({u_color:new h.b_(m,e.u_color),u_overlay:new h.bZ(m,e.u_overlay),u_overlay_scale:new h.bp(m,e.u_overlay_scale)}),depth:zu,clippingMask:zu,heatmap:(m,e)=>({u_extrude_scale:new h.bp(m,e.u_extrude_scale),u_intensity:new h.bp(m,e.u_intensity),u_globe_extrude_scale:new h.bp(m,e.u_globe_extrude_scale)}),heatmapTexture:(m,e)=>({u_matrix:new h.b$(m,e.u_matrix),u_world:new h.c2(m,e.u_world),u_image:new h.bZ(m,e.u_image),u_color_ramp:new h.bZ(m,e.u_color_ramp),u_opacity:new h.bp(m,e.u_opacity)}),hillshade:(m,e)=>({u_image:new h.bZ(m,e.u_image),u_latrange:new h.c2(m,e.u_latrange),u_exaggeration:new h.bp(m,e.u_exaggeration),u_altitudes:new h.c8(m,e.u_altitudes),u_azimuths:new h.c8(m,e.u_azimuths),u_accent:new h.b_(m,e.u_accent),u_method:new h.bZ(m,e.u_method),u_shadows:new h.c7(m,e.u_shadows),u_highlights:new h.c7(m,e.u_highlights)}),hillshadePrepare:(m,e)=>({u_matrix:new h.b$(m,e.u_matrix),u_image:new h.bZ(m,e.u_image),u_dimension:new h.c2(m,e.u_dimension),u_zoom:new h.bp(m,e.u_zoom),u_unpack:new h.c0(m,e.u_unpack)}),colorRelief:(m,e)=>({u_image:new h.bZ(m,e.u_image),u_unpack:new h.c0(m,e.u_unpack),u_dimension:new h.c2(m,e.u_dimension),u_elevation_stops:new h.bZ(m,e.u_elevation_stops),u_color_stops:new h.bZ(m,e.u_color_stops),u_color_ramp_size:new h.bZ(m,e.u_color_ramp_size),u_opacity:new h.bp(m,e.u_opacity)}),line:(m,e)=>({u_translation:new h.c2(m,e.u_translation),u_ratio:new h.bp(m,e.u_ratio),u_device_pixel_ratio:new h.bp(m,e.u_device_pixel_ratio),u_units_to_pixels:new h.c2(m,e.u_units_to_pixels)}),lineGradient:(m,e)=>({u_translation:new h.c2(m,e.u_translation),u_ratio:new h.bp(m,e.u_ratio),u_device_pixel_ratio:new h.bp(m,e.u_device_pixel_ratio),u_units_to_pixels:new h.c2(m,e.u_units_to_pixels),u_image:new h.bZ(m,e.u_image),u_image_height:new h.bp(m,e.u_image_height)}),linePattern:(m,e)=>({u_translation:new h.c2(m,e.u_translation),u_texsize:new h.c2(m,e.u_texsize),u_ratio:new h.bp(m,e.u_ratio),u_device_pixel_ratio:new h.bp(m,e.u_device_pixel_ratio),u_image:new h.bZ(m,e.u_image),u_units_to_pixels:new h.c2(m,e.u_units_to_pixels),u_scale:new h.c1(m,e.u_scale),u_fade:new h.bp(m,e.u_fade)}),lineSDF:(m,e)=>({u_translation:new h.c2(m,e.u_translation),u_ratio:new h.bp(m,e.u_ratio),u_device_pixel_ratio:new h.bp(m,e.u_device_pixel_ratio),u_units_to_pixels:new h.c2(m,e.u_units_to_pixels),u_image:new h.bZ(m,e.u_image),u_mix:new h.bp(m,e.u_mix),u_tileratio:new h.bp(m,e.u_tileratio),u_crossfade_from:new h.bp(m,e.u_crossfade_from),u_crossfade_to:new h.bp(m,e.u_crossfade_to),u_lineatlas_width:new h.bp(m,e.u_lineatlas_width),u_lineatlas_height:new h.bp(m,e.u_lineatlas_height)}),lineGradientSDF:(m,e)=>({u_translation:new h.c2(m,e.u_translation),u_ratio:new h.bp(m,e.u_ratio),u_device_pixel_ratio:new h.bp(m,e.u_device_pixel_ratio),u_units_to_pixels:new h.c2(m,e.u_units_to_pixels),u_image:new h.bZ(m,e.u_image),u_image_height:new h.bp(m,e.u_image_height),u_tileratio:new h.bp(m,e.u_tileratio),u_crossfade_from:new h.bp(m,e.u_crossfade_from),u_crossfade_to:new h.bp(m,e.u_crossfade_to),u_image_dash:new h.bZ(m,e.u_image_dash),u_mix:new h.bp(m,e.u_mix),u_lineatlas_width:new h.bp(m,e.u_lineatlas_width),u_lineatlas_height:new h.bp(m,e.u_lineatlas_height)}),raster:(m,e)=>({u_tl_parent:new h.c2(m,e.u_tl_parent),u_scale_parent:new h.bp(m,e.u_scale_parent),u_buffer_scale:new h.bp(m,e.u_buffer_scale),u_fade_t:new h.bp(m,e.u_fade_t),u_opacity:new h.bp(m,e.u_opacity),u_image0:new h.bZ(m,e.u_image0),u_image1:new h.bZ(m,e.u_image1),u_brightness_low:new h.bp(m,e.u_brightness_low),u_brightness_high:new h.bp(m,e.u_brightness_high),u_saturation_factor:new h.bp(m,e.u_saturation_factor),u_contrast_factor:new h.bp(m,e.u_contrast_factor),u_spin_weights:new h.c1(m,e.u_spin_weights),u_coords_top:new h.c0(m,e.u_coords_top),u_coords_bottom:new h.c0(m,e.u_coords_bottom)}),symbolIcon:(m,e)=>({u_is_size_zoom_constant:new h.bZ(m,e.u_is_size_zoom_constant),u_is_size_feature_constant:new h.bZ(m,e.u_is_size_feature_constant),u_size_t:new h.bp(m,e.u_size_t),u_size:new h.bp(m,e.u_size),u_camera_to_center_distance:new h.bp(m,e.u_camera_to_center_distance),u_pitch:new h.bp(m,e.u_pitch),u_rotate_symbol:new h.bZ(m,e.u_rotate_symbol),u_aspect_ratio:new h.bp(m,e.u_aspect_ratio),u_fade_change:new h.bp(m,e.u_fade_change),u_label_plane_matrix:new h.b$(m,e.u_label_plane_matrix),u_coord_matrix:new h.b$(m,e.u_coord_matrix),u_is_text:new h.bZ(m,e.u_is_text),u_pitch_with_map:new h.bZ(m,e.u_pitch_with_map),u_is_along_line:new h.bZ(m,e.u_is_along_line),u_is_variable_anchor:new h.bZ(m,e.u_is_variable_anchor),u_texsize:new h.c2(m,e.u_texsize),u_texture:new h.bZ(m,e.u_texture),u_translation:new h.c2(m,e.u_translation),u_pitched_scale:new h.bp(m,e.u_pitched_scale)}),symbolSDF:(m,e)=>({u_is_size_zoom_constant:new h.bZ(m,e.u_is_size_zoom_constant),u_is_size_feature_constant:new h.bZ(m,e.u_is_size_feature_constant),u_size_t:new h.bp(m,e.u_size_t),u_size:new h.bp(m,e.u_size),u_camera_to_center_distance:new h.bp(m,e.u_camera_to_center_distance),u_pitch:new h.bp(m,e.u_pitch),u_rotate_symbol:new h.bZ(m,e.u_rotate_symbol),u_aspect_ratio:new h.bp(m,e.u_aspect_ratio),u_fade_change:new h.bp(m,e.u_fade_change),u_label_plane_matrix:new h.b$(m,e.u_label_plane_matrix),u_coord_matrix:new h.b$(m,e.u_coord_matrix),u_is_text:new h.bZ(m,e.u_is_text),u_pitch_with_map:new h.bZ(m,e.u_pitch_with_map),u_is_along_line:new h.bZ(m,e.u_is_along_line),u_is_variable_anchor:new h.bZ(m,e.u_is_variable_anchor),u_texsize:new h.c2(m,e.u_texsize),u_texture:new h.bZ(m,e.u_texture),u_gamma_scale:new h.bp(m,e.u_gamma_scale),u_device_pixel_ratio:new h.bp(m,e.u_device_pixel_ratio),u_is_halo:new h.bZ(m,e.u_is_halo),u_translation:new h.c2(m,e.u_translation),u_pitched_scale:new h.bp(m,e.u_pitched_scale)}),symbolTextAndIcon:(m,e)=>({u_is_size_zoom_constant:new h.bZ(m,e.u_is_size_zoom_constant),u_is_size_feature_constant:new h.bZ(m,e.u_is_size_feature_constant),u_size_t:new h.bp(m,e.u_size_t),u_size:new h.bp(m,e.u_size),u_camera_to_center_distance:new h.bp(m,e.u_camera_to_center_distance),u_pitch:new h.bp(m,e.u_pitch),u_rotate_symbol:new h.bZ(m,e.u_rotate_symbol),u_aspect_ratio:new h.bp(m,e.u_aspect_ratio),u_fade_change:new h.bp(m,e.u_fade_change),u_label_plane_matrix:new h.b$(m,e.u_label_plane_matrix),u_coord_matrix:new h.b$(m,e.u_coord_matrix),u_is_text:new h.bZ(m,e.u_is_text),u_pitch_with_map:new h.bZ(m,e.u_pitch_with_map),u_is_along_line:new h.bZ(m,e.u_is_along_line),u_is_variable_anchor:new h.bZ(m,e.u_is_variable_anchor),u_texsize:new h.c2(m,e.u_texsize),u_texsize_icon:new h.c2(m,e.u_texsize_icon),u_texture:new h.bZ(m,e.u_texture),u_texture_icon:new h.bZ(m,e.u_texture_icon),u_gamma_scale:new h.bp(m,e.u_gamma_scale),u_device_pixel_ratio:new h.bp(m,e.u_device_pixel_ratio),u_is_halo:new h.bZ(m,e.u_is_halo),u_translation:new h.c2(m,e.u_translation),u_pitched_scale:new h.bp(m,e.u_pitched_scale)}),background:(m,e)=>({u_opacity:new h.bp(m,e.u_opacity),u_color:new h.b_(m,e.u_color)}),backgroundPattern:(m,e)=>({u_opacity:new h.bp(m,e.u_opacity),u_image:new h.bZ(m,e.u_image),u_pattern_tl_a:new h.c2(m,e.u_pattern_tl_a),u_pattern_br_a:new h.c2(m,e.u_pattern_br_a),u_pattern_tl_b:new h.c2(m,e.u_pattern_tl_b),u_pattern_br_b:new h.c2(m,e.u_pattern_br_b),u_texsize:new h.c2(m,e.u_texsize),u_mix:new h.bp(m,e.u_mix),u_pattern_size_a:new h.c2(m,e.u_pattern_size_a),u_pattern_size_b:new h.c2(m,e.u_pattern_size_b),u_scale_a:new h.bp(m,e.u_scale_a),u_scale_b:new h.bp(m,e.u_scale_b),u_pixel_coord_upper:new h.c2(m,e.u_pixel_coord_upper),u_pixel_coord_lower:new h.c2(m,e.u_pixel_coord_lower),u_tile_units_to_pixels:new h.bp(m,e.u_tile_units_to_pixels)}),terrain:(m,e)=>({u_texture:new h.bZ(m,e.u_texture),u_ele_delta:new h.bp(m,e.u_ele_delta),u_fog_matrix:new h.b$(m,e.u_fog_matrix),u_fog_color:new h.b_(m,e.u_fog_color),u_fog_ground_blend:new h.bp(m,e.u_fog_ground_blend),u_fog_ground_blend_opacity:new h.bp(m,e.u_fog_ground_blend_opacity),u_horizon_color:new h.b_(m,e.u_horizon_color),u_horizon_fog_blend:new h.bp(m,e.u_horizon_fog_blend),u_is_globe_mode:new h.bp(m,e.u_is_globe_mode)}),terrainDepth:(m,e)=>({u_ele_delta:new h.bp(m,e.u_ele_delta)}),terrainCoords:(m,e)=>({u_texture:new h.bZ(m,e.u_texture),u_terrain_coords_id:new h.bp(m,e.u_terrain_coords_id),u_ele_delta:new h.bp(m,e.u_ele_delta)}),projectionErrorMeasurement:(m,e)=>({u_input:new h.bp(m,e.u_input),u_output_expected:new h.bp(m,e.u_output_expected)}),atmosphere:(m,e)=>({u_sun_pos:new h.c1(m,e.u_sun_pos),u_atmosphere_blend:new h.bp(m,e.u_atmosphere_blend),u_globe_position:new h.c1(m,e.u_globe_position),u_globe_radius:new h.bp(m,e.u_globe_radius),u_inv_proj_matrix:new h.b$(m,e.u_inv_proj_matrix)}),sky:(m,e)=>({u_sky_color:new h.b_(m,e.u_sky_color),u_horizon_color:new h.b_(m,e.u_horizon_color),u_horizon:new h.c2(m,e.u_horizon),u_horizon_normal:new h.c2(m,e.u_horizon_normal),u_sky_horizon_blend:new h.bp(m,e.u_sky_horizon_blend),u_sky_blend:new h.bp(m,e.u_sky_blend)})};class Ho{constructor(e,r,c){this.context=e;const f=e.gl;this.buffer=f.createBuffer(),this.dynamicDraw=!!c,this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),f.bufferData(f.ELEMENT_ARRAY_BUFFER,r.arrayBuffer,this.dynamicDraw?f.DYNAMIC_DRAW:f.STATIC_DRAW),this.dynamicDraw||delete r.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){const r=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),r.bufferSubData(r.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const no={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class kh{constructor(e,r,c,f){this.length=r.length,this.attributes=c,this.itemSize=r.bytesPerElement,this.dynamicDraw=f,this.context=e;const g=e.gl;this.buffer=g.createBuffer(),e.bindVertexBuffer.set(this.buffer),g.bufferData(g.ARRAY_BUFFER,r.arrayBuffer,this.dynamicDraw?g.DYNAMIC_DRAW:g.STATIC_DRAW),this.dynamicDraw||delete r.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){if(e.length!==this.length)throw new Error(`Length of new data is ${e.length}, which doesn't match current length of ${this.length}`);const r=this.context.gl;this.bind(),r.bufferSubData(r.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,r){for(let c=0;c<this.attributes.length;c++){const f=r.attributes[this.attributes[c].name];f!==void 0&&e.enableVertexAttribArray(f)}}setVertexAttribPointers(e,r,c){for(let f=0;f<this.attributes.length;f++){const g=this.attributes[f],v=r.attributes[g.name];v!==void 0&&e.vertexAttribPointer(v,g.components,e[no[g.type]],!1,this.itemSize,g.offset+this.itemSize*(c||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class ui{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Oh extends ui{getDefault(){return h.bo.transparent}set(e){const r=this.current;(e.r!==r.r||e.g!==r.g||e.b!==r.b||e.a!==r.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class Ud extends ui{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class ao extends ui{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class Rl extends ui{getDefault(){return[!0,!0,!0,!0]}set(e){const r=this.current;(e[0]!==r[0]||e[1]!==r[1]||e[2]!==r[2]||e[3]!==r[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class Pu extends ui{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class Tc extends ui{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class ss extends ui{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){const r=this.current;(e.func!==r.func||e.ref!==r.ref||e.mask!==r.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class Sc extends ui{getDefault(){const e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){const r=this.current;(e[0]!==r[0]||e[1]!==r[1]||e[2]!==r[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class Iu extends ui{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;e?r.enable(r.STENCIL_TEST):r.disable(r.STENCIL_TEST),this.current=e,this.dirty=!1}}class ro extends ui{getDefault(){return[0,1]}set(e){const r=this.current;(e[0]!==r[0]||e[1]!==r[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class Ec extends ui{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;e?r.enable(r.DEPTH_TEST):r.disable(r.DEPTH_TEST),this.current=e,this.dirty=!1}}class Ll extends ui{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class gr extends ui{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;e?r.enable(r.BLEND):r.disable(r.BLEND),this.current=e,this.dirty=!1}}class Bh extends ui{getDefault(){const e=this.gl;return[e.ONE,e.ZERO]}set(e){const r=this.current;(e[0]!==r[0]||e[1]!==r[1]||this.dirty)&&(this.gl.blendFunc(e[0],e[1]),this.current=e,this.dirty=!1)}}class Nh extends ui{getDefault(){return h.bo.transparent}set(e){const r=this.current;(e.r!==r.r||e.g!==r.g||e.b!==r.b||e.a!==r.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class Mc extends ui{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquation(e),this.current=e,this.dirty=!1)}}class fa extends ui{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;e?r.enable(r.CULL_FACE):r.disable(r.CULL_FACE),this.current=e,this.dirty=!1}}class $o extends ui{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class La extends ui{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}class os extends ui{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}}class kl extends ui{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class Cc extends ui{getDefault(){const e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){const r=this.current;(e[0]!==r[0]||e[1]!==r[1]||e[2]!==r[2]||e[3]!==r[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class zs extends ui{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;r.bindFramebuffer(r.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class so extends ui{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;r.bindRenderbuffer(r.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class oo extends ui{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;r.bindTexture(r.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class Ru extends ui{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;r.bindBuffer(r.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Ye extends ui{getDefault(){return null}set(e){const r=this.gl;r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Ps extends ui{getDefault(){return null}set(e){var r;if(e===this.current&&!this.dirty)return;const c=this.gl;ar(c)?c.bindVertexArray(e):(r=c.getExtension("OES_vertex_array_object"))===null||r===void 0||r.bindVertexArrayOES(e),this.current=e,this.dirty=!1}}class Ff extends ui{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;r.pixelStorei(r.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class $a extends ui{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class Xo extends ui{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class kr extends ui{constructor(e,r){super(e),this.context=e,this.parent=r}getDefault(){return null}}class Gd extends kr{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const r=this.gl;r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class Ac extends kr{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const r=this.gl;r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Yo extends kr{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const r=this.gl;r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.RENDERBUFFER,e),this.current=e,this.dirty=!1}}const Ol="Framebuffer is not complete";class Dc{constructor(e,r,c,f,g){this.context=e,this.width=r,this.height=c;const v=e.gl,w=this.framebuffer=v.createFramebuffer();if(this.colorAttachment=new Gd(e,w),f)this.depthAttachment=g?new Yo(e,w):new Ac(e,w);else if(g)throw new Error("Stencil cannot be set without depth");if(v.checkFramebufferStatus(v.FRAMEBUFFER)!==v.FRAMEBUFFER_COMPLETE)throw new Error(Ol)}destroy(){const e=this.context.gl,r=this.colorAttachment.get();if(r&&e.deleteTexture(r),this.depthAttachment){const c=this.depthAttachment.get();c&&e.deleteRenderbuffer(c)}e.deleteFramebuffer(this.framebuffer)}}class Bl{constructor(e){var r,c;if(this.gl=e,this.clearColor=new Oh(this),this.clearDepth=new Ud(this),this.clearStencil=new ao(this),this.colorMask=new Rl(this),this.depthMask=new Pu(this),this.stencilMask=new Tc(this),this.stencilFunc=new ss(this),this.stencilOp=new Sc(this),this.stencilTest=new Iu(this),this.depthRange=new ro(this),this.depthTest=new Ec(this),this.depthFunc=new Ll(this),this.blend=new gr(this),this.blendFunc=new Bh(this),this.blendColor=new Nh(this),this.blendEquation=new Mc(this),this.cullFace=new fa(this),this.cullFaceSide=new $o(this),this.frontFace=new La(this),this.program=new os(this),this.activeTexture=new kl(this),this.viewport=new Cc(this),this.bindFramebuffer=new zs(this),this.bindRenderbuffer=new so(this),this.bindTexture=new oo(this),this.bindVertexBuffer=new Ru(this),this.bindElementBuffer=new Ye(this),this.bindVertexArray=new Ps(this),this.pixelStoreUnpack=new Ff(this),this.pixelStoreUnpackPremultiplyAlpha=new $a(this),this.pixelStoreUnpackFlipY=new Xo(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),ar(e)){this.HALF_FLOAT=e.HALF_FLOAT;const f=e.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(r=e.RGBA16F)!==null&&r!==void 0?r:f?.RGBA16F_EXT,this.RGB16F=(c=e.RGB16F)!==null&&c!==void 0?c:f?.RGB16F_EXT,e.getExtension("EXT_color_buffer_float")}else{e.getExtension("EXT_color_buffer_half_float"),e.getExtension("OES_texture_half_float_linear");const f=e.getExtension("OES_texture_half_float");this.HALF_FLOAT=f?.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,r){return new Ho(this,e,r)}createVertexBuffer(e,r,c){return new kh(this,e,r,c)}createRenderbuffer(e,r,c){const f=this.gl,g=f.createRenderbuffer();return this.bindRenderbuffer.set(g),f.renderbufferStorage(f.RENDERBUFFER,e,r,c),this.bindRenderbuffer.set(null),g}createFramebuffer(e,r,c,f){return new Dc(this,e,r,c,f)}clear({color:e,depth:r,stencil:c}){const f=this.gl;let g=0;e&&(g|=f.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),r!==void 0&&(g|=f.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(r),this.depthMask.set(!0)),c!==void 0&&(g|=f.STENCIL_BUFFER_BIT,this.clearStencil.set(c),this.stencilMask.set(255)),f.clear(g)}setCullFace(e){e.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){h.bQ(e.blendFunction,Zi.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)}createVertexArray(){var e;return ar(this.gl)?this.gl.createVertexArray():(e=this.gl.getExtension("OES_vertex_array_object"))===null||e===void 0?void 0:e.createVertexArrayOES()}deleteVertexArray(e){var r;return ar(this.gl)?this.gl.deleteVertexArray(e):(r=this.gl.getExtension("OES_vertex_array_object"))===null||r===void 0?void 0:r.deleteVertexArrayOES(e)}unbindVAO(){this.bindVertexArray.set(null)}}let lo;function ka(m,e,r,c,f){const g=m.context,v=m.transform,w=g.gl,S=m.useProgram("collisionBox"),C=[];let D=0,k=0;for(let it=0;it<c.length;it++){const st=c[it],ht=e.getTile(st).getBucket(r);if(!ht)continue;const at=f?ht.textCollisionBox:ht.iconCollisionBox,dt=ht.collisionCircleArray;dt.length>0&&(C.push({circleArray:dt,circleOffset:k,coord:st}),D+=dt.length/4,k=D),at&&S.draw(g,w.LINES,Ze.disabled,ci.disabled,m.colorModeForRenderPass(),ti.disabled,Eu(m.transform),m.style.map.terrain&&m.style.map.terrain.getTerrainData(st),v.getProjectionData({overscaledTileID:st,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),r.id,at.layoutVertexBuffer,at.indexBuffer,at.segments,null,m.transform.zoom,null,null,at.collisionVertexBuffer)}if(!f||!C.length)return;const L=m.useProgram("collisionCircle"),j=new h.c9;j.resize(4*D),j._trim();let Z=0;for(const it of C)for(let st=0;st<it.circleArray.length/4;st++){const ht=4*st,at=it.circleArray[ht+0],dt=it.circleArray[ht+1],mt=it.circleArray[ht+2],ct=it.circleArray[ht+3];j.emplace(Z++,at,dt,mt,ct,0),j.emplace(Z++,at,dt,mt,ct,1),j.emplace(Z++,at,dt,mt,ct,2),j.emplace(Z++,at,dt,mt,ct,3)}(!lo||lo.length<2*D)&&(lo=(function(it){const st=2*it,ht=new h.cb;ht.resize(st),ht._trim();for(let at=0;at<st;at++){const dt=6*at;ht.uint16[dt+0]=4*at+0,ht.uint16[dt+1]=4*at+1,ht.uint16[dt+2]=4*at+2,ht.uint16[dt+3]=4*at+2,ht.uint16[dt+4]=4*at+3,ht.uint16[dt+5]=4*at+0}return ht})(D));const W=g.createIndexBuffer(lo,!0),Q=g.createVertexBuffer(j,h.ca.members,!0);for(const it of C){const st=Dh(m.transform);L.draw(g,w.TRIANGLES,Ze.disabled,ci.disabled,m.colorModeForRenderPass(),ti.disabled,st,m.style.map.terrain&&m.style.map.terrain.getTerrainData(it.coord),null,r.id,Q,W,h.aW.simpleSegment(0,2*it.circleOffset,it.circleArray.length,it.circleArray.length/2),null,m.transform.zoom,null,null,null)}Q.destroy(),W.destroy()}const Wo=h.ar(new Float32Array(16));function Is(m,e,r,c,f,g){const{horizontalAlign:v,verticalAlign:w}=h.aR(m);return new h.P((-(v-.5)*e/f+c[0])*g,(-(w-.5)*r/f+c[1])*g)}function Ko(m,e,r,c,f,g){const v=e.tileAnchorPoint.add(new h.P(e.translation[0],e.translation[1]));if(e.pitchWithMap){let w=c.mult(g);r||(w=w.rotate(-f));const S=v.add(w);return me(S.x,S.y,e.pitchedLabelPlaneMatrix,e.getElevation).point}if(r){const w=wa(e.tileAnchorPoint.x+1,e.tileAnchorPoint.y,e).point.sub(m),S=Math.atan(w.y/w.x)+(w.x<0?Math.PI:0);return m.add(c.rotate(S))}return m.add(c)}function co(m,e,r,c,f,g,v,w,S,C,D,k){const L=m.text.placedSymbolArray,j=m.text.dynamicLayoutVertexArray,Z=m.icon.dynamicLayoutVertexArray,W={};j.clear();for(let Q=0;Q<L.length;Q++){const it=L.get(Q),st=it.hidden||!it.crossTileID||m.allowVerticalPlacement&&!it.placedOrientation?null:c[it.crossTileID];if(st){const ht=new h.P(it.anchorX,it.anchorY),at={getElevation:k,width:f.width,height:f.height,pitchedLabelPlaneMatrix:g,pitchWithMap:r,transform:f,tileAnchorPoint:ht,translation:C,unwrappedTileID:D},dt=r?Ir(ht.x,ht.y,at):wa(ht.x,ht.y,at),mt=Ae(f.cameraToCenterDistance,dt.signedDistanceFromCamera);let ct=h.az(m.textSizeData,w,it)*mt/h.aL;r&&(ct*=m.tilePixelRatio/v);const{width:Tt,height:kt,anchor:zt,textOffset:It,textBoxScale:Rt}=st,ae=Is(zt,Tt,kt,It,Rt,ct),re=f.getPitchedTextCorrection(ht.x+C[0],ht.y+C[1],D),Xt=Ko(dt.point,at,e,ae,-f.bearingInRadians,re),ve=m.allowVerticalPlacement&&it.placedOrientation===h.ay.vertical?Math.PI/2:0;for(let Ge=0;Ge<it.numGlyphs;Ge++)h.aF(j,Xt,ve);S&&it.associatedIconIndex>=0&&(W[it.associatedIconIndex]={shiftedAnchor:Xt,angle:ve})}else Pa(it.numGlyphs,j)}if(S){Z.clear();const Q=m.icon.placedSymbolArray;for(let it=0;it<Q.length;it++){const st=Q.get(it);if(st.hidden)Pa(st.numGlyphs,Z);else{const ht=W[it];if(ht)for(let at=0;at<st.numGlyphs;at++)h.aF(Z,ht.shiftedAnchor,ht.angle);else Pa(st.numGlyphs,Z)}}m.icon.dynamicLayoutVertexBuffer.updateData(Z)}m.text.dynamicLayoutVertexBuffer.updateData(j)}function pa(m,e,r){return r.iconsInText&&e?"symbolTextAndIcon":m?"symbolSDF":"symbolIcon"}function Oa(m,e,r,c,f,g,v,w,S,C,D,k,L){const j=m.context,Z=j.gl,W=m.transform,Q=w==="map",it=S==="map",st=w!=="viewport"&&r.layout.get("symbol-placement")!=="point",ht=Q&&!it&&!st,at=!r.layout.get("symbol-sort-key").isConstant();let dt=!1;const mt=m.getDepthModeForSublayer(0,Ze.ReadOnly),ct=r._unevaluatedLayout.hasValue("text-variable-anchor")||r._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Tt=[],kt=W.getCircleRadiusCorrection();for(const zt of c){const It=e.getTile(zt),Rt=It.getBucket(r);if(!Rt)continue;const ae=f?Rt.text:Rt.icon;if(!ae||!ae.segments.get().length||!ae.hasVisibleVertices)continue;const re=ae.programConfigurations.get(r.id),Xt=f||Rt.sdfIcons,ve=f?Rt.textSizeData:Rt.iconSizeData,Ge=it||W.pitch!==0,Fe=m.useProgram(pa(Xt,f,Rt),re),Xi=h.ax(ve,W.zoom),Fi=m.style.map.terrain&&m.style.map.terrain.getTerrainData(zt);let an,Ri,Ln,Wi,_n=[0,0],yn=null;if(f)Ri=It.glyphAtlasTexture,Ln=Z.LINEAR,an=It.glyphAtlasTexture.size,Rt.iconsInText&&(_n=It.imageAtlasTexture.size,yn=It.imageAtlasTexture,Wi=Ge||m.options.rotating||m.options.zooming||ve.kind==="composite"||ve.kind==="camera"?Z.LINEAR:Z.NEAREST);else{const un=r.layout.get("icon-size").constantOr(0)!==1||Rt.iconsNeedLinear;Ri=It.imageAtlasTexture,Ln=Xt||m.options.rotating||m.options.zooming||un||Ge?Z.LINEAR:Z.NEAREST,an=It.imageAtlasTexture.size}const Sn=h.aM(It,1,m.transform.zoom),Ta=Dn(Q,m.transform,Sn),_s=h.N();h.aA(_s,Ta);const jr=vi(it,Q,m.transform,Sn),vo=h.aN(W,It,g,v),ys=W.getProjectionData({overscaledTileID:zt,applyGlobeMatrix:!L,applyTerrainMatrix:!0}),xo=ct&&Rt.hasTextData(),or=r.layout.get("icon-text-fit")!=="none"&&xo&&Rt.hasIconData();if(st){const un=m.style.map.terrain?(En,Ci)=>m.style.map.terrain.getElevation(zt,En,Ci):null,ji=r.layout.get("text-rotation-alignment")==="map";Lo(Rt,m,f,Ta,_s,it,C,ji,zt.toUnwrapped(),W.width,W.height,vo,un)}const Vr=f&&ct||or,Ka=st||Vr?Wo:it?Ta:m.transform.clipSpaceToPixelsMatrix,vs=Xt&&r.paint.get(f?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let sl;sl=Xt?Rt.iconsInText?Cu(ve.kind,Xi,ht,it,st,Vr,m,Ka,jr,vo,an,_n,kt):Ha(ve.kind,Xi,ht,it,st,Vr,m,Ka,jr,vo,f,an,0,kt):da(ve.kind,Xi,ht,it,st,Vr,m,Ka,jr,vo,f,an,kt);const ol={program:Fe,buffers:ae,uniformValues:sl,projectionData:ys,atlasTexture:Ri,atlasTextureIcon:yn,atlasInterpolation:Ln,atlasInterpolationIcon:Wi,isSDF:Xt,hasHalo:vs};if(at&&Rt.canOverlap){dt=!0;const un=ae.segments.get();for(const ji of un)Tt.push({segments:new h.aW([ji]),sortKey:ji.sortKey,state:ol,terrainData:Fi})}else Tt.push({segments:ae.segments,sortKey:0,state:ol,terrainData:Fi})}dt&&Tt.sort(((zt,It)=>zt.sortKey-It.sortKey));for(const zt of Tt){const It=zt.state;if(j.activeTexture.set(Z.TEXTURE0),It.atlasTexture.bind(It.atlasInterpolation,Z.CLAMP_TO_EDGE),It.atlasTextureIcon&&(j.activeTexture.set(Z.TEXTURE1),It.atlasTextureIcon&&It.atlasTextureIcon.bind(It.atlasInterpolationIcon,Z.CLAMP_TO_EDGE)),It.isSDF){const Rt=It.uniformValues;It.hasHalo&&(Rt.u_is_halo=1,Rs(It.buffers,zt.segments,r,m,It.program,mt,D,k,Rt,It.projectionData,zt.terrainData)),Rt.u_is_halo=0}Rs(It.buffers,zt.segments,r,m,It.program,mt,D,k,It.uniformValues,It.projectionData,zt.terrainData)}}function Rs(m,e,r,c,f,g,v,w,S,C,D){const k=c.context;f.draw(k,k.gl.TRIANGLES,g,v,w,ti.backCCW,S,D,C,r.id,m.layoutVertexBuffer,m.indexBuffer,e,r.paint,c.transform.zoom,m.programConfigurations.get(r.id),m.dynamicLayoutVertexBuffer,m.opacityVertexBuffer)}function Xa(m,e,r,c,f){const g=m.context,v=g.gl,w=ci.disabled,S=new Zi([v.ONE,v.ONE],h.bo.transparent,[!0,!0,!0,!0]),C=e.getBucket(r);if(!C)return;const D=c.key;let k=r.heatmapFbos.get(D);k||(k=Or(g,e.tileSize,e.tileSize),r.heatmapFbos.set(D,k)),g.bindFramebuffer.set(k.framebuffer),g.viewport.set([0,0,e.tileSize,e.tileSize]),g.clear({color:h.bo.transparent});const L=C.programConfigurations.get(r.id),j=m.useProgram("heatmap",L,!f),Z=m.transform.getProjectionData({overscaledTileID:e.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),W=m.style.map.terrain.getTerrainData(c);j.draw(g,v.TRIANGLES,Ze.disabled,w,S,ti.disabled,qo(e,m.transform.zoom,r.paint.get("heatmap-intensity"),1),W,Z,r.id,C.layoutVertexBuffer,C.indexBuffer,C.segments,r.paint,m.transform.zoom,L)}function ls(m,e,r,c,f){const g=m.context,v=g.gl,w=m.transform;g.setColorMode(m.colorModeForRenderPass());const S=Nl(g,e),C=r.key,D=e.heatmapFbos.get(C);if(!D)return;g.activeTexture.set(v.TEXTURE0),v.bindTexture(v.TEXTURE_2D,D.colorAttachment.get()),g.activeTexture.set(v.TEXTURE1),S.bind(v.LINEAR,v.CLAMP_TO_EDGE);const k=w.getProjectionData({overscaledTileID:r,applyTerrainMatrix:f,applyGlobeMatrix:!c});m.useProgram("heatmapTexture").draw(g,v.TRIANGLES,Ze.disabled,ci.disabled,m.colorModeForRenderPass(),ti.disabled,zh(m,e,0,1),null,k,e.id,m.rasterBoundsBuffer,m.quadTriangleIndexBuffer,m.rasterBoundsSegments,e.paint,w.zoom),D.destroy(),e.heatmapFbos.delete(C)}function Or(m,e,r){var c,f;const g=m.gl,v=g.createTexture();g.bindTexture(g.TEXTURE_2D,v),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,g.CLAMP_TO_EDGE),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,g.CLAMP_TO_EDGE),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,g.LINEAR),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,g.LINEAR);const w=(c=m.HALF_FLOAT)!==null&&c!==void 0?c:g.UNSIGNED_BYTE,S=(f=m.RGBA16F)!==null&&f!==void 0?f:g.RGBA;g.texImage2D(g.TEXTURE_2D,0,S,e,r,0,g.RGBA,w,null);const C=m.createFramebuffer(e,r,!1,!1);return C.colorAttachment.set(v),C}function Nl(m,e){return e.colorRampTexture||(e.colorRampTexture=new h.T(m,e.colorRamp,m.gl.RGBA)),e.colorRampTexture}function Fl(m,e,r,c,f,g,v,w){let S=256;if(f.stepInterpolant){const C=e.getSource().maxzoom,D=v.canonical.z===C?Math.ceil(1<<m.transform.maxZoom-v.canonical.z):1;S=h.an(h.cd(g.maxLineLength/h.a4*1024*D),256,r.maxTextureSize)}return w.gradient=h.ce({expression:f.gradientExpression(),evaluationKey:"lineProgress",resolution:S,image:w.gradient||void 0,clips:g.lineClipsArray}),w.texture?w.texture.update(w.gradient):w.texture=new h.T(r,w.gradient,c.RGBA),w.version=f.gradientVersion,w.texture}function Lu(m,e,r,c,f){m.activeTexture.set(e.TEXTURE0),r.imageAtlasTexture.bind(e.LINEAR,e.CLAMP_TO_EDGE),c.updatePaintBuffers(f)}function Fh(m,e,r,c,f,g){(f||m.lineAtlas.dirty)&&(e.activeTexture.set(r.TEXTURE0),m.lineAtlas.bind(e)),c.updatePaintBuffers(g)}function Fn(m,e,r,c,f,g,v){const w=g.gradients[f.id];let S=w.texture;f.gradientVersion!==w.version&&(S=Fl(m,e,r,c,f,g,v,w)),r.activeTexture.set(c.TEXTURE0),S.bind(f.stepInterpolant?c.NEAREST:c.LINEAR,c.CLAMP_TO_EDGE)}function Hi(m,e,r,c,f,g,v,w,S){const C=g.gradients[f.id];let D=C.texture;f.gradientVersion!==C.version&&(D=Fl(m,e,r,c,f,g,v,C)),r.activeTexture.set(c.TEXTURE0),D.bind(f.stepInterpolant?c.NEAREST:c.LINEAR,c.CLAMP_TO_EDGE),r.activeTexture.set(c.TEXTURE1),m.lineAtlas.bind(r),w.updatePaintBuffers(S)}function hi(m,e,r,c,f){if(!r||!c||!c.imageAtlas)return;const g=c.imageAtlas.patternPositions;let v=g[r.to.toString()],w=g[r.from.toString()];if(!v&&w&&(v=w),!w&&v&&(w=v),!v||!w){const S=f.getPaintProperty(e);v=g[S],w=g[S]}v&&w&&m.setConstantPatternPositions(v,w)}function cs(m,e,r,c,f,g,v,w){const S=m.context.gl,C="fill-pattern",D=r.paint.get(C),k=D&&D.constantOr(1),L=r.getCrossfadeParameters();let j,Z,W,Q,it;const st=m.transform,ht=r.paint.get("fill-translate"),at=r.paint.get("fill-translate-anchor");v?(Z=k&&!r.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",j=S.LINES):(Z=k?"fillPattern":"fill",j=S.TRIANGLES);const dt=D.constantOr(null);for(const mt of c){const ct=e.getTile(mt);if(k&&!ct.patternsLoaded())continue;const Tt=ct.getBucket(r);if(!Tt)continue;const kt=Tt.programConfigurations.get(r.id),zt=m.useProgram(Z,kt),It=m.style.map.terrain&&m.style.map.terrain.getTerrainData(mt);k&&(m.context.activeTexture.set(S.TEXTURE0),ct.imageAtlasTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE),kt.updatePaintBuffers(L)),hi(kt,C,dt,ct,r);const Rt=st.getProjectionData({overscaledTileID:mt,applyGlobeMatrix:!w,applyTerrainMatrix:!0}),ae=h.aN(st,ct,ht,at);if(v){Q=Tt.indexBuffer2,it=Tt.segments2;const Xt=[S.drawingBufferWidth,S.drawingBufferHeight];W=Z==="fillOutlinePattern"&&k?Nf(m,L,ct,Xt,ae):Od(Xt,ae)}else Q=Tt.indexBuffer,it=Tt.segments,W=k?Uo(m,L,ct,ae):{u_fill_translate:ae};const re=m.stencilModeForClipping(mt);zt.draw(m.context,j,f,re,g,ti.backCCW,W,It,Rt,r.id,Tt.layoutVertexBuffer,Q,it,r.paint,m.transform.zoom,kt)}}function gi(m,e,r,c,f,g,v,w){const S=m.context,C=S.gl,D="fill-extrusion-pattern",k=r.paint.get(D),L=k.constantOr(1),j=r.getCrossfadeParameters(),Z=r.paint.get("fill-extrusion-opacity"),W=k.constantOr(null),Q=m.transform;for(const it of c){const st=e.getTile(it),ht=st.getBucket(r);if(!ht)continue;const at=m.style.map.terrain&&m.style.map.terrain.getTerrainData(it),dt=ht.programConfigurations.get(r.id),mt=m.useProgram(L?"fillExtrusionPattern":"fillExtrusion",dt);L&&(m.context.activeTexture.set(C.TEXTURE0),st.imageAtlasTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE),dt.updatePaintBuffers(j));const ct=Q.getProjectionData({overscaledTileID:it,applyGlobeMatrix:!w,applyTerrainMatrix:!0});hi(dt,D,W,st,r);const Tt=h.aN(Q,st,r.paint.get("fill-extrusion-translate"),r.paint.get("fill-extrusion-translate-anchor")),kt=r.paint.get("fill-extrusion-vertical-gradient"),zt=L?Vo(m,kt,Z,Tt,it,j,st):Ah(m,kt,Z,Tt);mt.draw(S,S.gl.TRIANGLES,f,g,v,ti.backCCW,zt,at,ct,r.id,ht.layoutVertexBuffer,ht.indexBuffer,ht.segments,r.paint,m.transform.zoom,dt,m.style.map.terrain&&ht.centroidVertexBuffer)}}function Br(m,e,r,c,f,g,v,w,S){var C;const D=m.style.projection,k=m.context,L=m.transform,j=k.gl,Z=[`#define NUM_ILLUMINATION_SOURCES ${r.paint.get("hillshade-highlight-color").values.length}`],W=m.useProgram("hillshade",null,!1,Z),Q=!m.options.moving;for(const it of c){const st=e.getTile(it),ht=st.fbo;if(!ht)continue;const at=D.getMeshFromTileID(k,it.canonical,w,!0,"raster"),dt=(C=m.style.map.terrain)===null||C===void 0?void 0:C.getTerrainData(it);k.activeTexture.set(j.TEXTURE0),j.bindTexture(j.TEXTURE_2D,ht.colorAttachment.get());const mt=L.getProjectionData({overscaledTileID:it,aligned:Q,applyGlobeMatrix:!S,applyTerrainMatrix:!0});W.draw(k,j.TRIANGLES,g,f[it.overscaledZ],v,ti.backCCW,rs(m,st,r),dt,mt,r.id,at.vertexBuffer,at.indexBuffer,at.segments)}}function In(m,e,r,c,f,g,v,w,S){var C;const D=m.style.projection,k=m.context,L=m.transform,j=k.gl,Z=m.useProgram("colorRelief"),W=!m.options.moving;let Q=!0,it=0;for(const st of c){const ht=e.getTile(st),at=ht.dem;if(Q){const zt=j.getParameter(j.MAX_TEXTURE_SIZE),{elevationTexture:It,colorTexture:Rt}=r.getColorRampTextures(k,zt,at.getUnpackVector());k.activeTexture.set(j.TEXTURE1),It.bind(j.NEAREST,j.CLAMP_TO_EDGE),k.activeTexture.set(j.TEXTURE4),Rt.bind(j.LINEAR,j.CLAMP_TO_EDGE),Q=!1,it=It.size[0]}if(!at||!at.data)continue;const dt=at.stride,mt=at.getPixels();if(k.activeTexture.set(j.TEXTURE0),k.pixelStoreUnpackPremultiplyAlpha.set(!1),ht.demTexture=ht.demTexture||m.getTileTexture(dt),ht.demTexture){const zt=ht.demTexture;zt.update(mt,{premultiply:!1}),zt.bind(j.LINEAR,j.CLAMP_TO_EDGE)}else ht.demTexture=new h.T(k,mt,j.RGBA,{premultiply:!1}),ht.demTexture.bind(j.LINEAR,j.CLAMP_TO_EDGE);const ct=D.getMeshFromTileID(k,st.canonical,w,!0,"raster"),Tt=(C=m.style.map.terrain)===null||C===void 0?void 0:C.getTerrainData(st),kt=L.getProjectionData({overscaledTileID:st,aligned:W,applyGlobeMatrix:!S,applyTerrainMatrix:!0});Z.draw(k,j.TRIANGLES,g,f[st.overscaledZ],v,ti.backCCW,Zo(r,ht.dem,it),Tt,kt,r.id,ct.vertexBuffer,ct.indexBuffer,ct.segments)}}const jl=[new h.P(0,0),new h.P(h.a4,0),new h.P(h.a4,h.a4),new h.P(0,h.a4)];function uo(m,e,r,c,f,g,v,w,S=!1,C=!1){const D=c[c.length-1].overscaledZ,k=m.context,L=k.gl,j=m.useProgram("raster"),Z=m.transform,W=m.style.projection,Q=m.colorModeForRenderPass(),it=!m.options.moving,st=r.paint.get("raster-opacity"),ht=r.paint.get("raster-resampling"),at=r.paint.get("raster-fade-duration"),dt=!!m.style.map.terrain;for(const mt of c){const ct=m.getDepthModeForSublayer(mt.overscaledZ-D,st===1?Ze.ReadWrite:Ze.ReadOnly,L.LESS),Tt=e.getTile(mt),kt=ht==="nearest"?L.NEAREST:L.LINEAR;k.activeTexture.set(L.TEXTURE0),Tt.texture.bind(kt,L.CLAMP_TO_EDGE,L.LINEAR_MIPMAP_NEAREST),k.activeTexture.set(L.TEXTURE1);const{parentTile:zt,parentScaleBy:It,parentTopLeft:Rt,fadeValues:ae}=Qo(Tt,e,at,dt);Tt.fadeOpacity=ae.tileOpacity,zt?(zt.fadeOpacity=ae.parentTileOpacity,zt.texture.bind(kt,L.CLAMP_TO_EDGE,L.LINEAR_MIPMAP_NEAREST)):Tt.texture.bind(kt,L.CLAMP_TO_EDGE,L.LINEAR_MIPMAP_NEAREST),Tt.texture.useMipmap&&k.extTextureFilterAnisotropic&&m.transform.pitch>20&&L.texParameterf(L.TEXTURE_2D,k.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,k.extTextureFilterAnisotropicMax);const re=m.style.map.terrain&&m.style.map.terrain.getTerrainData(mt),Xt=Z.getProjectionData({overscaledTileID:mt,aligned:it,applyGlobeMatrix:!C,applyTerrainMatrix:!0}),ve=Lh(Rt,It,ae.fadeMix,r,w),Ge=W.getMeshFromTileID(k,mt.canonical,g,v,"raster");j.draw(k,L.TRIANGLES,ct,f?f[mt.overscaledZ]:ci.disabled,Q,S?ti.frontCCW:ti.backCCW,ve,re,Xt,r.id,Ge.vertexBuffer,Ge.indexBuffer,Ge.segments)}}function Qo(m,e,r,c){const f={parentTile:null,parentScaleBy:1,parentTopLeft:[0,0],fadeValues:{tileOpacity:1,parentTileOpacity:1,fadeMix:{opacity:1,mix:0}}};if(r===0||c)return f;if(m.fadingParentID){const g=e.getLoadedTile(m.fadingParentID);if(!g)return f;const v=Math.pow(2,g.tileID.overscaledZ-m.tileID.overscaledZ),w=[m.tileID.canonical.x*v%1,m.tileID.canonical.y*v%1],S=(function(C,D,k){const L=Kt(),j=(L-D.timeAdded)/k,Z=C.fadingDirection===pt.Incoming,W=h.an((L-C.timeAdded)/k,0,1),Q=h.an(1-j,0,1),it=Z?W:Q;return{tileOpacity:it,parentTileOpacity:Z?Q:W,fadeMix:{opacity:1,mix:1-it}}})(m,g,r);return{parentTile:g,parentScaleBy:v,parentTopLeft:w,fadeValues:S}}if(m.selfFading){const g=(function(v,w){const S=(Kt()-v.timeAdded)/w,C=h.an(S,0,1);return{tileOpacity:C,fadeMix:{opacity:C,mix:0}}})(m,r);return{parentTile:null,parentScaleBy:1,parentTopLeft:[0,0],fadeValues:g}}return f}const _r=new h.bo(1,0,0,1),zc=new h.bo(0,1,0,1),Ls=new h.bo(0,0,1,1),Pc=new h.bo(1,0,1,1),ho=new h.bo(0,1,1,1);function Nr(m,e,r,c){rr(m,0,e+r/2,m.transform.width,r,c)}function us(m,e,r,c){rr(m,e-r/2,0,r,m.transform.height,c)}function rr(m,e,r,c,f,g){const v=m.context,w=v.gl;w.enable(w.SCISSOR_TEST),w.scissor(e*m.pixelRatio,r*m.pixelRatio,c*m.pixelRatio,f*m.pixelRatio),v.clear({color:g}),w.disable(w.SCISSOR_TEST)}function ku(m,e,r){const c=m.context,f=c.gl,g=m.useProgram("debug"),v=Ze.disabled,w=ci.disabled,S=m.colorModeForRenderPass(),C="$debug",D=m.style.map.terrain&&m.style.map.terrain.getTerrainData(r);c.activeTexture.set(f.TEXTURE0);const k=e.getTileByID(r.key).latestRawTileData,L=Math.floor((k&&k.byteLength||0)/1024),j=e.getTile(r).tileSize,Z=512/Math.min(j,512)*(r.overscaledZ/m.transform.zoom)*.5;let W=r.canonical.toString();r.overscaledZ!==r.canonical.z&&(W+=` => ${r.overscaledZ}`),(function(it,st){it.initDebugOverlayCanvas();const ht=it.debugOverlayCanvas,at=it.context.gl,dt=it.debugOverlayCanvas.getContext("2d");dt.clearRect(0,0,ht.width,ht.height),dt.shadowColor="white",dt.shadowBlur=2,dt.lineWidth=1.5,dt.strokeStyle="white",dt.textBaseline="top",dt.font="bold 36px Open Sans, sans-serif",dt.fillText(st,5,5),dt.strokeText(st,5,5),it.debugOverlayTexture.update(ht),it.debugOverlayTexture.bind(at.LINEAR,at.CLAMP_TO_EDGE)})(m,`${W} ${L}kB`);const Q=m.transform.getProjectionData({overscaledTileID:r,applyGlobeMatrix:!0,applyTerrainMatrix:!0});g.draw(c,f.TRIANGLES,v,w,Zi.alphaBlended,ti.disabled,Go(h.bo.transparent,Z),null,Q,C,m.debugBuffer,m.quadTriangleIndexBuffer,m.debugSegments),g.draw(c,f.LINE_STRIP,v,w,S,ti.disabled,Go(h.bo.red),D,Q,C,m.debugBuffer,m.tileBorderIndexBuffer,m.debugSegments)}function hs(m,e,r,c){const{isRenderingGlobe:f}=c,g=m.context,v=g.gl,w=m.transform,S=m.colorModeForRenderPass(),C=m.getDepthModeFor3D(),D=m.useProgram("terrain");g.bindFramebuffer.set(null),g.viewport.set([0,0,m.width,m.height]);for(const k of r){const L=e.getTerrainMesh(k.tileID),j=m.renderToTexture.getTexture(k),Z=e.getTerrainData(k.tileID);g.activeTexture.set(v.TEXTURE0),v.bindTexture(v.TEXTURE_2D,j.texture);const W=e.getMeshFrameDelta(w.zoom),Q=w.calculateFogMatrix(k.tileID.toUnwrapped()),it=jo(W,Q,m.style.sky,w.pitch,f),st=w.getProjectionData({overscaledTileID:k.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});D.draw(g,v.TRIANGLES,C,ci.disabled,S,ti.backCCW,it,Z,st,"terrain",L.vertexBuffer,L.indexBuffer,L.segments)}}function fo(m,e){if(!e.mesh){const r=new h.aV;r.emplaceBack(-1,-1),r.emplaceBack(1,-1),r.emplaceBack(1,1),r.emplaceBack(-1,1);const c=new h.aX;c.emplaceBack(0,1,2),c.emplaceBack(0,2,3),e.mesh=new ts(m.createVertexBuffer(r,wn.members),m.createIndexBuffer(c),h.aW.simpleSegment(0,0,r.length,c.length))}return e.mesh}class Ic{constructor(e,r){this.context=new Bl(e),this.transform=r,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:h.ar(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Je.maxOverzooming+Je.maxUnderzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new No}resize(e,r,c){if(this.width=Math.floor(e*c),this.height=Math.floor(r*c),this.pixelRatio=c,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const f of this.style._order)this.style._layers[f].resize()}setup(){const e=this.context,r=new h.aV;r.emplaceBack(0,0),r.emplaceBack(h.a4,0),r.emplaceBack(0,h.a4),r.emplaceBack(h.a4,h.a4),this.tileExtentBuffer=e.createVertexBuffer(r,wn.members),this.tileExtentSegments=h.aW.simpleSegment(0,0,4,2);const c=new h.aV;c.emplaceBack(0,0),c.emplaceBack(h.a4,0),c.emplaceBack(0,h.a4),c.emplaceBack(h.a4,h.a4),this.debugBuffer=e.createVertexBuffer(c,wn.members),this.debugSegments=h.aW.simpleSegment(0,0,4,5);const f=new h.cg;f.emplaceBack(0,0,0,0),f.emplaceBack(h.a4,0,h.a4,0),f.emplaceBack(0,h.a4,0,h.a4),f.emplaceBack(h.a4,h.a4,h.a4,h.a4),this.rasterBoundsBuffer=e.createVertexBuffer(f,as.members),this.rasterBoundsSegments=h.aW.simpleSegment(0,0,4,2);const g=new h.aV;g.emplaceBack(0,0),g.emplaceBack(h.a4,0),g.emplaceBack(0,h.a4),g.emplaceBack(h.a4,h.a4),this.rasterBoundsBufferPosOnly=e.createVertexBuffer(g,wn.members),this.rasterBoundsSegmentsPosOnly=h.aW.simpleSegment(0,0,4,5);const v=new h.aV;v.emplaceBack(0,0),v.emplaceBack(1,0),v.emplaceBack(0,1),v.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(v,wn.members),this.viewportSegments=h.aW.simpleSegment(0,0,4,2);const w=new h.ch;w.emplaceBack(0),w.emplaceBack(1),w.emplaceBack(3),w.emplaceBack(2),w.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(w);const S=new h.aX;S.emplaceBack(1,0,2),S.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(S);const C=this.context.gl;this.stencilClearMode=new ci({func:C.ALWAYS,mask:0},0,255,C.ZERO,C.ZERO,C.ZERO),this.tileExtentMesh=new ts(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){const e=this.context,r=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const c=h.N();h.c6(c,0,this.width,this.height,0,0,1),h.Q(c,c,[r.drawingBufferWidth,r.drawingBufferHeight,0]);const f={mainMatrix:c,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:c};this.useProgram("clippingMask",null,!0).draw(e,r.TRIANGLES,Ze.disabled,this.stencilClearMode,Zi.disabled,ti.disabled,null,null,f,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(e,r,c){if(this.currentStencilSource===e.source||!e.isTileClipped()||!r||!r.length)return;this.currentStencilSource=e.source,this.nextStencilID+r.length>256&&this.clearStencil();const f=this.context;f.setColorMode(Zi.disabled),f.setDepthMode(Ze.disabled);const g={};for(const v of r)g[v.key]=this.nextStencilID++;this._renderTileMasks(g,r,c,!0),this._renderTileMasks(g,r,c,!1),this._tileClippingMaskIDs=g}_renderTileMasks(e,r,c,f){const g=this.context,v=g.gl,w=this.style.projection,S=this.transform,C=this.useProgram("clippingMask");for(const D of r){const k=e[D.key],L=this.style.map.terrain&&this.style.map.terrain.getTerrainData(D),j=w.getMeshFromTileID(this.context,D.canonical,f,!0,"stencil"),Z=S.getProjectionData({overscaledTileID:D,applyGlobeMatrix:!c,applyTerrainMatrix:!0});C.draw(g,v.TRIANGLES,Ze.disabled,new ci({func:v.ALWAYS,mask:0},k,255,v.KEEP,v.KEEP,v.REPLACE),Zi.disabled,c?ti.disabled:ti.backCCW,null,L,Z,"$clipping",j.vertexBuffer,j.indexBuffer,j.segments)}}_renderTilesDepthBuffer(){const e=this.context,r=e.gl,c=this.style.projection,f=this.transform,g=this.useProgram("depth"),v=this.getDepthModeFor3D(),w=je(f,{tileSize:f.tileSize});for(const S of w){const C=this.style.map.terrain&&this.style.map.terrain.getTerrainData(S),D=c.getMeshFromTileID(this.context,S.canonical,!0,!0,"raster"),k=f.getProjectionData({overscaledTileID:S,applyGlobeMatrix:!0,applyTerrainMatrix:!0});g.draw(e,r.TRIANGLES,v,ci.disabled,Zi.disabled,ti.backCCW,null,C,k,"$clipping",D.vertexBuffer,D.indexBuffer,D.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const e=this.nextStencilID++,r=this.context.gl;return new ci({func:r.NOTEQUAL,mask:255},e,255,r.KEEP,r.KEEP,r.REPLACE)}stencilModeForClipping(e){const r=this.context.gl;return new ci({func:r.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,r.KEEP,r.KEEP,r.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(e){const r=this.context.gl,c=e.sort(((v,w)=>w.overscaledZ-v.overscaledZ)),f=c[c.length-1].overscaledZ,g=c[0].overscaledZ-f+1;if(g>1){this.currentStencilSource=void 0,this.nextStencilID+g>256&&this.clearStencil();const v={};for(let w=0;w<g;w++)v[w+f]=new ci({func:r.GEQUAL,mask:255},w+this.nextStencilID,255,r.KEEP,r.KEEP,r.REPLACE);return this.nextStencilID+=g,[v,c]}return[{[f]:ci.disabled},c]}stencilConfigForOverlapTwoPass(e){const r=this.context.gl,c=e.sort(((v,w)=>w.overscaledZ-v.overscaledZ)),f=c[c.length-1].overscaledZ,g=c[0].overscaledZ-f+1;if(this.clearStencil(),g>1){const v={},w={};for(let S=0;S<g;S++)v[S+f]=new ci({func:r.GREATER,mask:255},g+1+S,255,r.KEEP,r.KEEP,r.REPLACE),w[S+f]=new ci({func:r.GREATER,mask:255},1+S,255,r.KEEP,r.KEEP,r.REPLACE);return this.nextStencilID=2*g+1,[v,w,c]}return this.nextStencilID=3,[{[f]:new ci({func:r.GREATER,mask:255},2,255,r.KEEP,r.KEEP,r.REPLACE)},{[f]:new ci({func:r.GREATER,mask:255},1,255,r.KEEP,r.KEEP,r.REPLACE)},c]}colorModeForRenderPass(){const e=this.context.gl;return this._showOverdrawInspector?new Zi([e.CONSTANT_COLOR,e.ONE],new h.bo(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Zi.unblended:Zi.alphaBlended}getDepthModeForSublayer(e,r,c){if(!this.opaquePassEnabledForLayer())return Ze.disabled;const f=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new Ze(c||this.context.gl.LEQUAL,r,[f,f])}getDepthModeFor3D(){return new Ze(this.context.gl.LEQUAL,Ze.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,r){var c,f;this.style=e,this.options=r,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(Kt()),this.imageManager.beginFrame();const g=this.style._order,v=this.style.tileManagers,w={},S={},C={},D={isRenderingToTexture:!1,isRenderingGlobe:((c=e.projection)===null||c===void 0?void 0:c.transitionState)>0};for(const L in v){const j=v[L];j.used&&j.prepare(this.context),w[L]=j.getVisibleCoordinates(!1),S[L]=w[L].slice().reverse(),C[L]=j.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let L=0;L<g.length;L++)if(this.style._layers[g[L]].is3D()){this.opaquePassCutoff=L;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const L of g){const j=this.style._layers[L];if(!j.hasOffscreenPass()||j.isHidden(this.transform.zoom))continue;const Z=S[j.source];(j.type==="custom"||Z.length)&&this.renderLayer(this,v[j.source],j,Z,D)}if((f=this.style.projection)===null||f===void 0||f.updateGPUdependent({context:this.context,useProgram:L=>this.useProgram(L)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:r.showOverdrawInspector?h.bo.black:h.bo.transparent,depth:1}),this.clearStencil(),this.style.sky&&(function(L,j){const Z=L.context,W=Z.gl,Q=((mt,ct,Tt)=>{const kt=Math.cos(ct.rollInRadians),zt=Math.sin(ct.rollInRadians),It=Et(ct),Rt=ct.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:mt.properties.get("sky-color"),u_horizon_color:mt.properties.get("horizon-color"),u_horizon:[(ct.width/2-It*zt)*Tt,(ct.height/2+It*kt)*Tt],u_horizon_normal:[-zt,kt],u_sky_horizon_blend:mt.properties.get("sky-horizon-blend")*ct.height/2*Tt,u_sky_blend:Rt}})(j,L.style.map.transform,L.pixelRatio),it=new Ze(W.LEQUAL,Ze.ReadWrite,[0,1]),st=ci.disabled,ht=L.colorModeForRenderPass(),at=L.useProgram("sky"),dt=fo(Z,j);at.draw(Z,W.TRIANGLES,it,st,ht,ti.disabled,Q,null,void 0,"sky",dt.vertexBuffer,dt.indexBuffer,dt.segments)})(this,this.style.sky),this._showOverdrawInspector=r.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=g.length-1;this.currentLayer>=0;this.currentLayer--){const L=this.style._layers[g[this.currentLayer]],j=v[L.source],Z=w[L.source];this._renderTileClippingMasks(L,Z,!1),this.renderLayer(this,j,L,Z,D)}this.renderPass="translucent";let k=!1;for(this.currentLayer=0;this.currentLayer<g.length;this.currentLayer++){const L=this.style._layers[g[this.currentLayer]],j=v[L.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(L,D))continue;this.opaquePassEnabledForLayer()||k||(k=!0,D.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());const Z=(L.type==="symbol"?C:S)[L.source];this._renderTileClippingMasks(L,w[L.source],!!this.renderToTexture),this.renderLayer(this,j,L,Z,D)}if(D.isRenderingGlobe&&(function(L,j,Z){const W=L.context,Q=W.gl,it=L.useProgram("atmosphere"),st=new Ze(Q.LEQUAL,Ze.ReadOnly,[0,1]),ht=L.transform,at=(function(Rt,ae){const re=Rt.properties.get("position"),Xt=[-re.x,-re.y,-re.z],ve=h.ar(new Float64Array(16));return Rt.properties.get("anchor")==="map"&&(h.bf(ve,ve,ae.rollInRadians),h.bg(ve,ve,-ae.pitchInRadians),h.bf(ve,ve,ae.bearingInRadians),h.bg(ve,ve,ae.center.lat*Math.PI/180),h.bI(ve,ve,-ae.center.lng*Math.PI/180)),h.cf(Xt,Xt,ve),Xt})(Z,L.transform),dt=ht.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),mt=j.properties.get("atmosphere-blend")*dt.projectionTransition;if(mt===0)return;const ct=vu(ht.worldSize,ht.center.lat),Tt=ht.inverseProjectionMatrix,kt=new Float64Array(4);kt[3]=1,h.aG(kt,kt,ht.modelViewProjectionMatrix),kt[0]/=kt[3],kt[1]/=kt[3],kt[2]/=kt[3],kt[3]=1,h.aG(kt,kt,Tt),kt[0]/=kt[3],kt[1]/=kt[3],kt[2]/=kt[3],kt[3]=1;const zt=((Rt,ae,re,Xt,ve)=>({u_sun_pos:Rt,u_atmosphere_blend:ae,u_globe_position:re,u_globe_radius:Xt,u_inv_proj_matrix:ve}))(at,mt,[kt[0],kt[1],kt[2]],ct,Tt),It=fo(W,j);it.draw(W,Q.TRIANGLES,st,ci.disabled,Zi.alphaBlended,ti.disabled,zt,null,null,"atmosphere",It.vertexBuffer,It.indexBuffer,It.segments)})(this,this.style.sky,this.style.light),this.options.showTileBoundaries){const L=(function(j,Z){let W=null;const Q=Object.values(j._layers).flatMap((at=>at.source&&!at.isHidden(Z)?[j.tileManagers[at.source]]:[])),it=Q.filter((at=>at.getSource().type==="vector")),st=Q.filter((at=>at.getSource().type!=="vector")),ht=at=>{(!W||W.getSource().maxzoom<at.getSource().maxzoom)&&(W=at)};return it.forEach((at=>ht(at))),W||st.forEach((at=>ht(at))),W})(this.style,this.transform.zoom);L&&(function(j,Z,W){for(let Q=0;Q<W.length;Q++)ku(j,Z,W[Q])})(this,L,L.getVisibleCoordinates())}this.options.showPadding&&(function(L){const j=L.transform.padding;Nr(L,L.transform.height-(j.top||0),3,_r),Nr(L,j.bottom||0,3,zc),us(L,j.left||0,3,Ls),us(L,L.transform.width-(j.right||0),3,Pc);const Z=L.transform.centerPoint;(function(W,Q,it,st){rr(W,Q-1,it-10,2,20,st),rr(W,Q-10,it-1,20,2,st)})(L,Z.x,L.transform.height-Z.y,ho)})(this),this.context.setDefault()}maybeDrawDepthAndCoords(e){if(!this.style||!this.style.map||!this.style.map.terrain)return;const r=this.terrainFacilitator.matrix,c=this.transform.modelViewProjectionMatrix;let f=this.terrainFacilitator.dirty;f||(f=e?!h.ci(r,c):!h.cj(r,c)),f||(f=this.style.map.terrain.tileManager.anyTilesAfterTime(this.terrainFacilitator.renderTime)),f&&(h.ck(r,c),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,(function(g,v){const w=g.context,S=w.gl,C=g.transform,D=Zi.unblended,k=new Ze(S.LEQUAL,Ze.ReadWrite,[0,1]),L=v.tileManager.getRenderableTiles(),j=g.useProgram("terrainDepth");w.bindFramebuffer.set(v.getFramebuffer("depth").framebuffer),w.viewport.set([0,0,g.width/devicePixelRatio,g.height/devicePixelRatio]),w.clear({color:h.bo.transparent,depth:1});for(const Z of L){const W=v.getTerrainMesh(Z.tileID),Q=v.getTerrainData(Z.tileID),it=C.getProjectionData({overscaledTileID:Z.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),st={u_ele_delta:v.getMeshFrameDelta(C.zoom)};j.draw(w,S.TRIANGLES,k,ci.disabled,D,ti.backCCW,st,Q,it,"terrain",W.vertexBuffer,W.indexBuffer,W.segments)}w.bindFramebuffer.set(null),w.viewport.set([0,0,g.width,g.height])})(this,this.style.map.terrain),(function(g,v){const w=g.context,S=w.gl,C=g.transform,D=Zi.unblended,k=new Ze(S.LEQUAL,Ze.ReadWrite,[0,1]),L=v.getCoordsTexture(),j=v.tileManager.getRenderableTiles(),Z=g.useProgram("terrainCoords");w.bindFramebuffer.set(v.getFramebuffer("coords").framebuffer),w.viewport.set([0,0,g.width/devicePixelRatio,g.height/devicePixelRatio]),w.clear({color:h.bo.transparent,depth:1}),v.coordsIndex=[];for(const W of j){const Q=v.getTerrainMesh(W.tileID),it=v.getTerrainData(W.tileID);w.activeTexture.set(S.TEXTURE0),S.bindTexture(S.TEXTURE_2D,L.texture);const st={u_terrain_coords_id:(255-v.coordsIndex.length)/255,u_texture:0,u_ele_delta:v.getMeshFrameDelta(C.zoom)},ht=C.getProjectionData({overscaledTileID:W.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});Z.draw(w,S.TRIANGLES,k,ci.disabled,D,ti.backCCW,st,it,ht,"terrain",Q.vertexBuffer,Q.indexBuffer,Q.segments),v.coordsIndex.push(W.tileID.key)}w.bindFramebuffer.set(null),w.viewport.set([0,0,g.width,g.height])})(this,this.style.map.terrain))}renderLayer(e,r,c,f,g){c.isHidden(this.transform.zoom)||(c.type==="background"||c.type==="custom"||(f||[]).length)&&(this.id=c.id,h.cl(c)?(function(v,w,S,C,D,k){if(v.renderPass!=="translucent")return;const{isRenderingToTexture:L}=k,j=ci.disabled,Z=v.colorModeForRenderPass();(S._unevaluatedLayout.hasValue("text-variable-anchor")||S._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&(function(W,Q,it,st,ht,at,dt,mt,ct){const Tt=Q.transform,kt=Q.style.map.terrain,zt=ht==="map",It=at==="map";for(const Rt of W){const ae=st.getTile(Rt),re=ae.getBucket(it);if(!re||!re.text||!re.text.segments.get().length)continue;const Xt=h.ax(re.textSizeData,Tt.zoom),ve=h.aM(ae,1,Q.transform.zoom),Ge=Dn(zt,Q.transform,ve),Fe=it.layout.get("icon-text-fit")!=="none"&&re.hasIconData();if(Xt){const Xi=Math.pow(2,Tt.zoom-ae.tileID.overscaledZ),Fi=kt?(an,Ri)=>kt.getElevation(Rt,an,Ri):null;co(re,zt,It,ct,Tt,Ge,Xi,Xt,Fe,h.aN(Tt,ae,dt,mt),Rt.toUnwrapped(),Fi)}}})(C,v,S,w,S.layout.get("text-rotation-alignment"),S.layout.get("text-pitch-alignment"),S.paint.get("text-translate"),S.paint.get("text-translate-anchor"),D),S.paint.get("icon-opacity").constantOr(1)!==0&&Oa(v,w,S,C,!1,S.paint.get("icon-translate"),S.paint.get("icon-translate-anchor"),S.layout.get("icon-rotation-alignment"),S.layout.get("icon-pitch-alignment"),S.layout.get("icon-keep-upright"),j,Z,L),S.paint.get("text-opacity").constantOr(1)!==0&&Oa(v,w,S,C,!0,S.paint.get("text-translate"),S.paint.get("text-translate-anchor"),S.layout.get("text-rotation-alignment"),S.layout.get("text-pitch-alignment"),S.layout.get("text-keep-upright"),j,Z,L),w.map.showCollisionBoxes&&(ka(v,w,S,C,!0),ka(v,w,S,C,!1))})(e,r,c,f,this.style.placement.variableOffsets,g):h.cm(c)?(function(v,w,S,C,D){if(v.renderPass!=="translucent")return;const{isRenderingToTexture:k}=D,L=S.paint.get("circle-opacity"),j=S.paint.get("circle-stroke-width"),Z=S.paint.get("circle-stroke-opacity"),W=!S.layout.get("circle-sort-key").isConstant();if(L.constantOr(1)===0&&(j.constantOr(1)===0||Z.constantOr(1)===0))return;const Q=v.context,it=Q.gl,st=v.transform,ht=v.getDepthModeForSublayer(0,Ze.ReadOnly),at=ci.disabled,dt=v.colorModeForRenderPass(),mt=[],ct=st.getCircleRadiusCorrection();for(let Tt=0;Tt<C.length;Tt++){const kt=C[Tt],zt=w.getTile(kt),It=zt.getBucket(S);if(!It)continue;const Rt=S.paint.get("circle-translate"),ae=S.paint.get("circle-translate-anchor"),re=h.aN(st,zt,Rt,ae),Xt=It.programConfigurations.get(S.id),ve=v.useProgram("circle",Xt),Ge=It.layoutVertexBuffer,Fe=It.indexBuffer,Xi=v.style.map.terrain&&v.style.map.terrain.getTerrainData(kt),Fi={programConfiguration:Xt,program:ve,layoutVertexBuffer:Ge,indexBuffer:Fe,uniformValues:Bd(v,zt,S,re,ct),terrainData:Xi,projectionData:st.getProjectionData({overscaledTileID:kt,applyGlobeMatrix:!k,applyTerrainMatrix:!0})};if(W){const an=It.segments.get();for(const Ri of an)mt.push({segments:new h.aW([Ri]),sortKey:Ri.sortKey,state:Fi})}else mt.push({segments:It.segments,sortKey:0,state:Fi})}W&&mt.sort(((Tt,kt)=>Tt.sortKey-kt.sortKey));for(const Tt of mt){const{programConfiguration:kt,program:zt,layoutVertexBuffer:It,indexBuffer:Rt,uniformValues:ae,terrainData:re,projectionData:Xt}=Tt.state;zt.draw(Q,it.TRIANGLES,ht,at,dt,ti.backCCW,ae,re,Xt,S.id,It,Rt,Tt.segments,S.paint,v.transform.zoom,kt)}})(e,r,c,f,g):h.cn(c)?(function(v,w,S,C,D){if(S.paint.get("heatmap-opacity")===0)return;const k=v.context,{isRenderingToTexture:L,isRenderingGlobe:j}=D;if(v.style.map.terrain){for(const Z of C){const W=w.getTile(Z);w.hasRenderableParent(Z)||(v.renderPass==="offscreen"?Xa(v,W,S,Z,j):v.renderPass==="translucent"&&ls(v,S,Z,L,j))}k.viewport.set([0,0,v.width,v.height])}else v.renderPass==="offscreen"?(function(Z,W,Q,it){const st=Z.context,ht=st.gl,at=Z.transform,dt=ci.disabled,mt=new Zi([ht.ONE,ht.ONE],h.bo.transparent,[!0,!0,!0,!0]);(function(ct,Tt,kt){const zt=ct.gl;ct.activeTexture.set(zt.TEXTURE1),ct.viewport.set([0,0,Tt.width/4,Tt.height/4]);let It=kt.heatmapFbos.get(h.cc);It?(zt.bindTexture(zt.TEXTURE_2D,It.colorAttachment.get()),ct.bindFramebuffer.set(It.framebuffer)):(It=Or(ct,Tt.width/4,Tt.height/4),kt.heatmapFbos.set(h.cc,It))})(st,Z,Q),st.clear({color:h.bo.transparent});for(let ct=0;ct<it.length;ct++){const Tt=it[ct];if(W.hasRenderableParent(Tt))continue;const kt=W.getTile(Tt),zt=kt.getBucket(Q);if(!zt)continue;const It=zt.programConfigurations.get(Q.id),Rt=Z.useProgram("heatmap",It),ae=at.getProjectionData({overscaledTileID:Tt,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),re=at.getCircleRadiusCorrection();Rt.draw(st,ht.TRIANGLES,Ze.disabled,dt,mt,ti.backCCW,qo(kt,at.zoom,Q.paint.get("heatmap-intensity"),re),null,ae,Q.id,zt.layoutVertexBuffer,zt.indexBuffer,zt.segments,Q.paint,at.zoom,It)}st.viewport.set([0,0,Z.width,Z.height])})(v,w,S,C):v.renderPass==="translucent"&&(function(Z,W){const Q=Z.context,it=Q.gl;Q.setColorMode(Z.colorModeForRenderPass());const st=W.heatmapFbos.get(h.cc);st&&(Q.activeTexture.set(it.TEXTURE0),it.bindTexture(it.TEXTURE_2D,st.colorAttachment.get()),Q.activeTexture.set(it.TEXTURE1),Nl(Q,W).bind(it.LINEAR,it.CLAMP_TO_EDGE),Z.useProgram("heatmapTexture").draw(Q,it.TRIANGLES,Ze.disabled,ci.disabled,Z.colorModeForRenderPass(),ti.disabled,zh(Z,W,0,1),null,null,W.id,Z.viewportBuffer,Z.quadTriangleIndexBuffer,Z.viewportSegments,W.paint,Z.transform.zoom))})(v,S)})(e,r,c,f,g):h.co(c)?(function(v,w,S,C,D){if(v.renderPass!=="translucent")return;const{isRenderingToTexture:k}=D,L=S.paint.get("line-opacity"),j=S.paint.get("line-width");if(L.constantOr(1)===0||j.constantOr(1)===0)return;const Z=v.getDepthModeForSublayer(0,Ze.ReadOnly),W=v.colorModeForRenderPass(),Q=S.paint.get("line-dasharray"),it=Q.constantOr(1),st=S.paint.get("line-pattern"),ht=st.constantOr(1),at=S.paint.get("line-gradient"),dt=S.getCrossfadeParameters();let mt;mt=ht?"linePattern":it&&at?"lineGradientSDF":it?"lineSDF":at?"lineGradient":"line";const ct=v.context,Tt=ct.gl,kt=v.transform;let zt=!0;for(const It of C){const Rt=w.getTile(It);if(ht&&!Rt.patternsLoaded())continue;const ae=Rt.getBucket(S);if(!ae)continue;const re=ae.programConfigurations.get(S.id),Xt=v.context.program.get(),ve=v.useProgram(mt,re),Ge=zt||ve.program!==Xt,Fe=v.style.map.terrain&&v.style.map.terrain.getTerrainData(It),Xi=st.constantOr(null),Fi=Q&&Q.constantOr(null);if(Xi&&Rt.imageAtlas){const _n=Rt.imageAtlas,yn=_n.patternPositions[Xi.to.toString()],Sn=_n.patternPositions[Xi.from.toString()];yn&&Sn&&re.setConstantPatternPositions(yn,Sn)}else if(Fi){const _n=S.layout.get("line-cap")==="round",yn=v.lineAtlas.getDash(Fi.to,_n),Sn=v.lineAtlas.getDash(Fi.from,_n);re.setConstantDashPositions(yn,Sn)}const an=kt.getProjectionData({overscaledTileID:It,applyGlobeMatrix:!k,applyTerrainMatrix:!0}),Ri=kt.getPixelScale();let Ln;ht?(Ln=Nd(v,Rt,S,Ri,dt),Lu(ct,Tt,Rt,re,dt)):it&&at?(Ln=jd(v,Rt,S,Ri,dt,ae.lineClipsArray.length),Hi(v,w,ct,Tt,S,ae,It,re,dt)):it?(Ln=Fd(v,Rt,S,Ri,dt),Fh(v,ct,Tt,re,Ge,dt)):at?(Ln=Il(v,Rt,S,Ri,ae.lineClipsArray.length),Fn(v,w,ct,Tt,S,ae,It)):Ln=Pl(v,Rt,S,Ri);const Wi=v.stencilModeForClipping(It);ve.draw(ct,Tt.TRIANGLES,Z,Wi,W,ti.disabled,Ln,Fe,an,S.id,ae.layoutVertexBuffer,ae.indexBuffer,ae.segments,S.paint,v.transform.zoom,re,ae.layoutVertexBuffer2),zt=!1}})(e,r,c,f,g):h.cp(c)?(function(v,w,S,C,D){const k=S.paint.get("fill-color"),L=S.paint.get("fill-opacity");if(L.constantOr(1)===0)return;const{isRenderingToTexture:j}=D,Z=v.colorModeForRenderPass(),W=S.paint.get("fill-pattern"),Q=v.opaquePassEnabledForLayer()&&!W.constantOr(1)&&k.constantOr(h.bo.transparent).a===1&&L.constantOr(0)===1?"opaque":"translucent";if(v.renderPass===Q){const it=v.getDepthModeForSublayer(1,v.renderPass==="opaque"?Ze.ReadWrite:Ze.ReadOnly);cs(v,w,S,C,it,Z,!1,j)}if(v.renderPass==="translucent"&&S.paint.get("fill-antialias")){const it=v.getDepthModeForSublayer(S.getPaintProperty("fill-outline-color")?2:0,Ze.ReadOnly);cs(v,w,S,C,it,Z,!0,j)}})(e,r,c,f,g):h.cq(c)?(function(v,w,S,C,D){const k=S.paint.get("fill-extrusion-opacity");if(k===0)return;const{isRenderingToTexture:L}=D;if(v.renderPass==="translucent"){const j=new Ze(v.context.gl.LEQUAL,Ze.ReadWrite,v.depthRangeFor3D);if(k!==1||S.paint.get("fill-extrusion-pattern").constantOr(1))gi(v,w,S,C,j,ci.disabled,Zi.disabled,L),gi(v,w,S,C,j,v.stencilModeFor3D(),v.colorModeForRenderPass(),L);else{const Z=v.colorModeForRenderPass();gi(v,w,S,C,j,ci.disabled,Z,L)}}})(e,r,c,f,g):h.cr(c)?(function(v,w,S,C,D){if(v.renderPass!=="offscreen"&&v.renderPass!=="translucent")return;const{isRenderingToTexture:k}=D,L=v.context,j=v.style.projection.useSubdivision,Z=v.getDepthModeForSublayer(0,Ze.ReadOnly),W=v.colorModeForRenderPass();if(v.renderPass==="offscreen")(function(Q,it,st,ht,at,dt,mt){const ct=Q.context,Tt=ct.gl;for(const kt of st){const zt=it.getTile(kt),It=zt.dem;if(!It||!It.data||!zt.needsHillshadePrepare)continue;const Rt=It.dim,ae=It.stride,re=It.getPixels();if(ct.activeTexture.set(Tt.TEXTURE1),ct.pixelStoreUnpackPremultiplyAlpha.set(!1),zt.demTexture=zt.demTexture||Q.getTileTexture(ae),zt.demTexture){const ve=zt.demTexture;ve.update(re,{premultiply:!1}),ve.bind(Tt.NEAREST,Tt.CLAMP_TO_EDGE)}else zt.demTexture=new h.T(ct,re,Tt.RGBA,{premultiply:!1}),zt.demTexture.bind(Tt.NEAREST,Tt.CLAMP_TO_EDGE);ct.activeTexture.set(Tt.TEXTURE0);let Xt=zt.fbo;if(!Xt){const ve=new h.T(ct,{width:Rt,height:Rt,data:null},Tt.RGBA);ve.bind(Tt.LINEAR,Tt.CLAMP_TO_EDGE),Xt=zt.fbo=ct.createFramebuffer(Rt,Rt,!0,!1),Xt.colorAttachment.set(ve.texture)}ct.bindFramebuffer.set(Xt.framebuffer),ct.viewport.set([0,0,Rt,Rt]),Q.useProgram("hillshadePrepare").draw(ct,Tt.TRIANGLES,at,dt,mt,ti.disabled,Ph(zt.tileID,It),null,null,ht.id,Q.rasterBoundsBuffer,Q.quadTriangleIndexBuffer,Q.rasterBoundsSegments),zt.needsHillshadePrepare=!1}})(v,w,C,S,Z,ci.disabled,W),L.viewport.set([0,0,v.width,v.height]);else if(v.renderPass==="translucent")if(j){const[Q,it,st]=v.stencilConfigForOverlapTwoPass(C);Br(v,w,S,st,Q,Z,W,!1,k),Br(v,w,S,st,it,Z,W,!0,k)}else{const[Q,it]=v.getStencilConfigForOverlapAndUpdateStencilID(C);Br(v,w,S,it,Q,Z,W,!1,k)}})(e,r,c,f,g):h.cs(c)?(function(v,w,S,C,D){if(v.renderPass!=="translucent"||!C.length)return;const{isRenderingToTexture:k}=D,L=v.style.projection.useSubdivision,j=v.getDepthModeForSublayer(0,Ze.ReadOnly),Z=v.colorModeForRenderPass();if(L){const[W,Q,it]=v.stencilConfigForOverlapTwoPass(C);In(v,w,S,it,W,j,Z,!1,k),In(v,w,S,it,Q,j,Z,!0,k)}else{const[W,Q]=v.getStencilConfigForOverlapAndUpdateStencilID(C);In(v,w,S,Q,W,j,Z,!1,k)}})(e,r,c,f,g):h.bT(c)?(function(v,w,S,C,D){if(v.renderPass!=="translucent"||S.paint.get("raster-opacity")===0||!C.length)return;const{isRenderingToTexture:k}=D,L=w.getSource(),j=v.style.projection.useSubdivision;if(L instanceof bn)uo(v,w,S,C,null,!1,!1,L.tileCoords,L.flippedWindingOrder,k);else if(j){const[Z,W,Q]=v.stencilConfigForOverlapTwoPass(C);uo(v,w,S,Q,Z,!1,!0,jl,!1,k),uo(v,w,S,Q,W,!0,!0,jl,!1,k)}else{const[Z,W]=v.getStencilConfigForOverlapAndUpdateStencilID(C);uo(v,w,S,W,Z,!1,!0,jl,!1,k)}})(e,r,c,f,g):h.ct(c)?(function(v,w,S,C,D){const k=S.paint.get("background-color"),L=S.paint.get("background-opacity");if(L===0)return;const{isRenderingToTexture:j}=D,Z=v.context,W=Z.gl,Q=v.style.projection,it=v.transform,st=it.tileSize,ht=S.paint.get("background-pattern");if(v.isPatternMissing(ht))return;const at=!ht&&k.a===1&&L===1&&v.opaquePassEnabledForLayer()?"opaque":"translucent";if(v.renderPass!==at)return;const dt=ci.disabled,mt=v.getDepthModeForSublayer(0,at==="opaque"?Ze.ReadWrite:Ze.ReadOnly),ct=v.colorModeForRenderPass(),Tt=v.useProgram(ht?"backgroundPattern":"background"),kt=C||je(it,{tileSize:st,terrain:v.style.map.terrain});ht&&(Z.activeTexture.set(W.TEXTURE0),v.imageManager.bind(v.context));const zt=S.getCrossfadeParameters();for(const It of kt){const Rt=it.getProjectionData({overscaledTileID:It,applyGlobeMatrix:!j,applyTerrainMatrix:!0}),ae=ht?Du(L,v,ht,{tileID:It,tileSize:st},zt):Au(L,k),re=v.style.map.terrain&&v.style.map.terrain.getTerrainData(It),Xt=Q.getMeshFromTileID(Z,It.canonical,!1,!0,"raster");Tt.draw(Z,W.TRIANGLES,mt,dt,ct,ti.backCCW,ae,re,Rt,S.id,Xt.vertexBuffer,Xt.indexBuffer,Xt.segments)}})(e,0,c,f,g):h.cu(c)&&(function(v,w,S,C){const{isRenderingGlobe:D}=C,k=v.context,L=S.implementation,j=v.style.projection,Z=v.transform,W=Z.getProjectionDataForCustomLayer(D),Q={farZ:Z.farZ,nearZ:Z.nearZ,fov:Z.fov*Math.PI/180,modelViewProjectionMatrix:Z.modelViewProjectionMatrix,projectionMatrix:Z.projectionMatrix,shaderData:{variantName:j.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${j.shaderPreludeCode.vertexSource}`,define:j.shaderDefine},defaultProjectionData:W},it=L.renderingMode?L.renderingMode:"2d";if(v.renderPass==="offscreen"){const st=L.prerender;st&&(v.setCustomLayerDefaults(),k.setColorMode(v.colorModeForRenderPass()),st.call(L,k.gl,Q),k.setDirty(),v.setBaseState())}else if(v.renderPass==="translucent"){v.setCustomLayerDefaults(),k.setColorMode(v.colorModeForRenderPass()),k.setStencilMode(ci.disabled);const st=it==="3d"?v.getDepthModeFor3D():v.getDepthModeForSublayer(0,Ze.ReadOnly);k.setDepthMode(st),L.render(k.gl,Q),k.setDirty(),v.setBaseState(),k.bindFramebuffer.set(null)}})(e,0,c,g))}saveTileTexture(e){const r=this._tileTextures[e.size[0]];r?r.push(e):this._tileTextures[e.size[0]]=[e]}getTileTexture(e){const r=this._tileTextures[e];return r&&r.length>0?r.pop():null}isPatternMissing(e){if(!e)return!1;if(!e.from||!e.to)return!0;const r=this.imageManager.getPattern(e.from.toString()),c=this.imageManager.getPattern(e.to.toString());return!r||!c}useProgram(e,r,c=!1,f=[]){this.cache=this.cache||{};const g=!!this.style.map.terrain,v=this.style.projection,w=c?Ia.projectionMercator:v.shaderPreludeCode,S=c?zn:v.shaderDefine,C=e+(r?r.cacheKey:"")+`/${c?Pn:v.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(g?"/terrain":"")+(f?`/${f.join("/")}`:"");return this.cache[C]||(this.cache[C]=new kd(this.context,Ia[e],r,wc[e],this._showOverdrawInspector,g,w,S,f)),this.cache[C]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new h.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){var e,r;if(this._tileTextures){for(const c in this._tileTextures){const f=this._tileTextures[c];if(f)for(const g of f)g.destroy()}this._tileTextures={}}if(this.tileExtentBuffer&&this.tileExtentBuffer.destroy(),this.debugBuffer&&this.debugBuffer.destroy(),this.rasterBoundsBuffer&&this.rasterBoundsBuffer.destroy(),this.rasterBoundsBufferPosOnly&&this.rasterBoundsBufferPosOnly.destroy(),this.viewportBuffer&&this.viewportBuffer.destroy(),this.tileBorderIndexBuffer&&this.tileBorderIndexBuffer.destroy(),this.quadTriangleIndexBuffer&&this.quadTriangleIndexBuffer.destroy(),this.tileExtentMesh&&((e=this.tileExtentMesh.vertexBuffer)===null||e===void 0||e.destroy()),this.tileExtentMesh&&((r=this.tileExtentMesh.indexBuffer)===null||r===void 0||r.destroy()),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.cache){for(const c in this.cache){const f=this.cache[c];f&&f.program&&this.context.gl.deleteProgram(f.program)}this.cache={}}this.context&&this.context.setDefault()}overLimit(){const{drawingBufferWidth:e,drawingBufferHeight:r}=this.context.gl;return this.width!==e||this.height!==r}}function ks(m,e){let r,c=!1,f=null,g=null;const v=()=>{f=null,c&&(m.apply(g,r),f=setTimeout(v,e),c=!1)};return(...w)=>(c=!0,g=this,r=w,f||v(),f)}class $n{constructor(e){this._getCurrentHash=()=>{const r=window.location.hash.replace("#","");if(this._hashName){let c;return r.split("&").map((f=>f.split("="))).forEach((f=>{f[0]===this._hashName&&(c=f)})),(c&&c[1]||"").split("/")}return r.split("/")},this._onHashChange=()=>{const r=this._getCurrentHash();if(!this._isValidHash(r))return!1;const c=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(r[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+r[2],+r[1]],zoom:+r[0],bearing:c,pitch:+(r[4]||0)}),!0},this._updateHashUnthrottled=()=>{const r=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,r)},this._removeHash=()=>{const r=this._getCurrentHash();if(r.length===0)return;const c=r.join("/");let f=c;f.split("&").length>0&&(f=f.split("&")[0]),this._hashName&&(f=`${this._hashName}=${c}`);let g=window.location.hash.replace(f,"");g.startsWith("#&")?g=g.slice(0,1)+g.slice(2):g==="#"&&(g="");let v=window.location.href.replace(/(#.+)?$/,g);v=v.replace("&&","&"),window.history.replaceState(window.history.state,null,v)},this._updateHash=ks(this._updateHashUnthrottled,300),this._hashName=e&&encodeURIComponent(e)}addTo(e){return this._map=e,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(e){const r=this._map.getCenter(),c=Math.round(100*this._map.getZoom())/100,f=Math.ceil((c*Math.LN2+Math.log(512/360/.5))/Math.LN10),g=Math.pow(10,f),v=Math.round(r.lng*g)/g,w=Math.round(r.lat*g)/g,S=this._map.getBearing(),C=this._map.getPitch();let D="";if(D+=e?`/${v}/${w}/${c}`:`${c}/${w}/${v}`,(S||C)&&(D+="/"+Math.round(10*S)/10),C&&(D+=`/${Math.round(C)}`),this._hashName){const k=this._hashName;let L=!1;const j=window.location.hash.slice(1).split("&").map((Z=>{const W=Z.split("=")[0];return W===k?(L=!0,`${W}=${D}`):Z})).filter((Z=>Z));return L||j.push(`${k}=${D}`),`#${j.join("&")}`}return`#${D}`}_isValidHash(e){if(e.length<3||e.some(isNaN))return!1;try{new h.V(+e[2],+e[1])}catch{return!1}const r=+e[0],c=+(e[3]||0),f=+(e[4]||0);return r>=this._map.getMinZoom()&&r<=this._map.getMaxZoom()&&c>=-180&&c<=180&&f>=this._map.getMinPitch()&&f<=this._map.getMaxPitch()}}const Os={linearity:.3,easing:h.cv(0,0,.3,1)},jh=h.e({deceleration:2500,maxSpeed:1400},Os),qd=h.e({deceleration:20,maxSpeed:1400},Os),Zd=h.e({deceleration:1e3,maxSpeed:360},Os),Ou=h.e({deceleration:1e3,maxSpeed:90},Os),Rn=h.e({deceleration:1e3,maxSpeed:360},Os);class Ya{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:Kt(),settings:e})}_drainInertiaBuffer(){const e=this._inertiaBuffer,r=Kt();for(;e.length>0&&r-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const r={zoom:0,bearing:0,pitch:0,roll:0,pan:new h.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:g}of this._inertiaBuffer)r.zoom+=g.zoomDelta||0,r.bearing+=g.bearingDelta||0,r.pitch+=g.pitchDelta||0,r.roll+=g.rollDelta||0,g.panDelta&&r.pan._add(g.panDelta),g.around&&(r.around=g.around),g.pinchAround&&(r.pinchAround=g.pinchAround);const c=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,f={};if(r.pan.mag()){const g=ds(r.pan.mag(),c,h.e({},jh,e||{})),v=r.pan.mult(g.amount/r.pan.mag()),w=this._map.cameraHelper.handlePanInertia(v,this._map.transform);f.center=w.easingCenter,f.offset=w.easingOffset,Xn(f,g)}if(r.zoom){const g=ds(r.zoom,c,qd);f.zoom=this._map.transform.zoom+g.amount,Xn(f,g)}if(r.bearing){const g=ds(r.bearing,c,Zd);f.bearing=this._map.transform.bearing+h.an(g.amount,-179,179),Xn(f,g)}if(r.pitch){const g=ds(r.pitch,c,Ou);f.pitch=this._map.transform.pitch+g.amount,Xn(f,g)}if(r.roll){const g=ds(r.roll,c,Rn);f.roll=this._map.transform.roll+h.an(g.amount,-179,179),Xn(f,g)}if(f.zoom||f.bearing){const g=r.pinchAround===void 0?r.around:r.pinchAround;f.around=g?this._map.unproject(g):this._map.getCenter()}return this.clear(),h.e(f,{noMoveStart:!0})}}function Xn(m,e){(!m.duration||m.duration<e.duration)&&(m.duration=e.duration,m.easing=e.easing)}function ds(m,e,r){const{maxSpeed:c,linearity:f,deceleration:g}=r,v=h.an(m*f/(e/1e3),-c,c),w=Math.abs(v)/(g*f);return{easing:r.easing,duration:1e3*w,amount:v*(w/2)}}class en extends h.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,r,c,f={}){c=c instanceof MouseEvent?c:new MouseEvent(e,c);const g=gt.mousePos(r.getCanvas(),c),v=r.unproject(g);super(e,h.e({point:g,lngLat:v,originalEvent:c},f)),this._defaultPrevented=!1,this.target=r}}class fs extends h.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,r,c){const f=e==="touchend"?c.changedTouches:c.touches,g=gt.touchPos(r.getCanvasContainer(),f),v=g.map((S=>r.unproject(S))),w=g.reduce(((S,C,D,k)=>S.add(C.div(k.length))),new h.P(0,0));super(e,{points:g,point:w,lngLats:v,lngLat:r.unproject(w),originalEvent:c}),this._defaultPrevented=!1}}class yr extends h.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,r,c){super(e,{originalEvent:c}),this._defaultPrevented=!1}}class jf{constructor(e,r){this._map=e,this._clickTolerance=r.clickTolerance}reset(){delete this._mousedownPos}wheel(e){return this._firePreventable(new yr(e.type,this._map,e))}mousedown(e,r){return this._mousedownPos=r,this._firePreventable(new en(e.type,this._map,e))}mouseup(e){this._map.fire(new en(e.type,this._map,e))}click(e,r){this._mousedownPos&&this._mousedownPos.dist(r)>=this._clickTolerance||this._map.fire(new en(e.type,this._map,e))}dblclick(e){return this._firePreventable(new en(e.type,this._map,e))}mouseover(e){this._map.fire(new en(e.type,this._map,e))}mouseout(e){this._map.fire(new en(e.type,this._map,e))}touchstart(e){return this._firePreventable(new fs(e.type,this._map,e))}touchmove(e){this._map.fire(new fs(e.type,this._map,e))}touchend(e){this._map.fire(new fs(e.type,this._map,e))}touchcancel(e){this._map.fire(new fs(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Hd{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(e){this._map.fire(new en(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new en("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._ignoreContextMenu||this._map.fire(new en(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Rc{constructor(e){this._map=e}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(e){return this.transform.screenPointToLocation(h.P.convert(e),this._map.terrain)}}class Vh{constructor(e,r){this._map=e,this._tr=new Rc(e),this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=r.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,r){this.isEnabled()&&e.shiftKey&&e.button===0&&(gt.disableDrag(),this._startPos=this._lastPos=r,this._active=!0)}mousemoveWindow(e,r){if(!this._active)return;const c=r;if(this._lastPos.equals(c)||!this._box&&c.dist(this._startPos)<this._clickTolerance)return;const f=this._startPos;this._lastPos=c,this._box||(this._box=gt.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",e));const g=Math.min(f.x,c.x),v=Math.max(f.x,c.x),w=Math.min(f.y,c.y),S=Math.max(f.y,c.y);gt.setTransform(this._box,`translate(${g}px,${w}px)`),this._box.style.width=v-g+"px",this._box.style.height=S-w+"px"}mouseupWindow(e,r){if(!this._active||e.button!==0)return;const c=this._startPos,f=r;if(this.reset(),gt.suppressClick(),c.x!==f.x||c.y!==f.y)return this._map.fire(new h.l("boxzoomend",{originalEvent:e})),{cameraAnimation:g=>g.fitScreenCoordinates(c,f,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",e)}keydown(e){this._active&&e.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",e))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(gt.remove(this._box),this._box=null),gt.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(e,r){return this._map.fire(new h.l(e,{originalEvent:r}))}}function ps(m,e){if(m.length!==e.length)throw new Error(`The number of touches and points are not equal - touches ${m.length}, points ${e.length}`);const r={};for(let c=0;c<m.length;c++)r[m[c].identifier]=e[c];return r}class Jo{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(e,r,c){(this.centroid||c.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=e.timeStamp),c.length===this.numTouches&&(this.centroid=(function(f){const g=new h.P(0,0);for(const v of f)g._add(v);return g.div(f.length)})(r),this.touches=ps(c,r)))}touchmove(e,r,c){if(this.aborted||!this.centroid)return;const f=ps(c,r);for(const g in this.touches){const v=f[g];(!v||v.dist(this.touches[g])>30)&&(this.aborted=!0)}}touchend(e,r,c){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),c.length===0){const f=!this.aborted&&this.centroid;if(this.reset(),f)return f}}}class Wa{constructor(e){this.singleTap=new Jo(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(e,r,c){this.singleTap.touchstart(e,r,c)}touchmove(e,r,c){this.singleTap.touchmove(e,r,c)}touchend(e,r,c){const f=this.singleTap.touchend(e,r,c);if(f){const g=e.timeStamp-this.lastTime<500,v=!this.lastTap||this.lastTap.dist(f)<30;if(g&&v||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=f,this.count===this.numTaps)return this.reset(),f}}}class ge{constructor(e){this._tr=new Rc(e),this._zoomIn=new Wa({numTouches:1,numTaps:2}),this._zoomOut=new Wa({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,r,c){this._zoomIn.touchstart(e,r,c),this._zoomOut.touchstart(e,r,c)}touchmove(e,r,c){this._zoomIn.touchmove(e,r,c),this._zoomOut.touchmove(e,r,c)}touchend(e,r,c){const f=this._zoomIn.touchend(e,r,c),g=this._zoomOut.touchend(e,r,c),v=this._tr;return f?(this._active=!0,e.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:v.zoom+1,around:v.unproject(f)},{originalEvent:e})}):g?(this._active=!0,e.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:v.zoom-1,around:v.unproject(g)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Fr{constructor(e){this._enabled=!!e.enable,this._moveStateManager=e.moveStateManager,this._clickTolerance=e.clickTolerance||1,this._moveFunction=e.move,this._activateOnStart=!!e.activateOnStart,e.assignEvents(this),this.reset()}reset(e){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(e)}_move(...e){const r=this._moveFunction(...e);if(r.bearingDelta||r.pitchDelta||r.rollDelta||r.around||r.panDelta)return this._active=!0,r}dragStart(e,r){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(e)&&(this._moveStateManager.startMove(e),this._lastPoint=Array.isArray(r)?r[0]:r,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(e,r){if(!this.isEnabled())return;const c=this._lastPoint;if(!c)return;if(e.preventDefault(),!this._moveStateManager.isValidMoveEvent(e))return void this.reset(e);const f=Array.isArray(r)?r[0]:r;return!this._moved&&f.dist(c)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=f,this._move(c,f))}dragEnd(e){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(e)&&(this._moved&&gt.suppressClick(),this.reset(e))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Lc=0,kc=2,po={[Lc]:1,[kc]:2};class ms{constructor(e){this._correctEvent=e.checkCorrectEvent}startMove(e){const r=gt.mouseButton(e);this._eventButton=r}endMove(e){delete this._eventButton}isValidStartEvent(e){return this._correctEvent(e)}isValidMoveEvent(e){return!(function(r,c){const f=po[c];return r.buttons===void 0||(r.buttons&f)!==f})(e,this._eventButton)}isValidEndEvent(e){return gt.mouseButton(e)===this._eventButton}}class Bu{constructor(){this._firstTouch=void 0}_isOneFingerTouch(e){return e.targetTouches.length===1}_isSameTouchEvent(e){return e.targetTouches[0].identifier===this._firstTouch}startMove(e){this._firstTouch=e.targetTouches[0].identifier}endMove(e){delete this._firstTouch}isValidStartEvent(e){return this._isOneFingerTouch(e)}isValidMoveEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}isValidEndEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}}class tl{constructor(e=new ms({checkCorrectEvent:()=>!0}),r=new Bu){this.mouseMoveStateManager=e,this.oneFingerTouchMoveStateManager=r}_executeRelevantHandler(e,r,c){return e instanceof MouseEvent?r(e):typeof TouchEvent<"u"&&e instanceof TouchEvent?c(e):void 0}startMove(e){this._executeRelevantHandler(e,(r=>this.mouseMoveStateManager.startMove(r)),(r=>this.oneFingerTouchMoveStateManager.startMove(r)))}endMove(e){this._executeRelevantHandler(e,(r=>this.mouseMoveStateManager.endMove(r)),(r=>this.oneFingerTouchMoveStateManager.endMove(r)))}isValidStartEvent(e){return this._executeRelevantHandler(e,(r=>this.mouseMoveStateManager.isValidStartEvent(r)),(r=>this.oneFingerTouchMoveStateManager.isValidStartEvent(r)))}isValidMoveEvent(e){return this._executeRelevantHandler(e,(r=>this.mouseMoveStateManager.isValidMoveEvent(r)),(r=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(r)))}isValidEndEvent(e){return this._executeRelevantHandler(e,(r=>this.mouseMoveStateManager.isValidEndEvent(r)),(r=>this.oneFingerTouchMoveStateManager.isValidEndEvent(r)))}}const vr=m=>{m.mousedown=m.dragStart,m.mousemoveWindow=m.dragMove,m.mouseup=m.dragEnd,m.contextmenu=e=>{e.preventDefault()}};class Uh{constructor(e,r){this._clickTolerance=e.clickTolerance||1,this._map=r,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new h.P(0,0)}_shouldBePrevented(e){return e<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(e,r,c){return this._calculateTransform(e,r,c)}touchmove(e,r,c){if(this._active){if(!this._shouldBePrevented(c.length))return e.preventDefault(),this._calculateTransform(e,r,c);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",e)}}touchend(e,r,c){this._calculateTransform(e,r,c),this._active&&this._shouldBePrevented(c.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,r,c){c.length>0&&(this._active=!0);const f=ps(c,r),g=new h.P(0,0),v=new h.P(0,0);let w=0;for(const C in f){const D=f[C],k=this._touches[C];k&&(g._add(D),v._add(D.sub(k)),w++,f[C]=D)}if(this._touches=f,this._shouldBePrevented(w)||!v.mag())return;const S=v.div(w);return this._sum._add(S),this._sum.mag()<this._clickTolerance?void 0:{around:g.div(w),panDelta:S}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Vl{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(e,r,c){this._firstTwoTouches||c.length<2||(this._firstTwoTouches=[c[0].identifier,c[1].identifier],this._start([r[0],r[1]]))}touchmove(e,r,c){if(!this._firstTwoTouches)return;e.preventDefault();const[f,g]=this._firstTwoTouches,v=Bs(c,r,f),w=Bs(c,r,g);if(!v||!w)return;const S=this._aroundCenter?null:v.add(w).div(2);return this._move([v,w],S,e)}touchend(e,r,c){if(!this._firstTwoTouches)return;const[f,g]=this._firstTwoTouches,v=Bs(c,r,f),w=Bs(c,r,g);v&&w||(this._active&&gt.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&e.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Bs(m,e,r){for(let c=0;c<m.length;c++)if(m[c].identifier===r)return e[c]}function el(m,e){return Math.log(m/e)/Math.LN2}class Oc extends Vl{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,r){const c=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(el(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:el(this._distance,c),pinchAround:r}}}function Ul(m,e){return 180*m.angleWith(e)/Math.PI}class Gl extends Vl{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,r,c){const f=this._vector;if(this._vector=e[0].sub(e[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Ul(this._vector,f),pinchAround:r}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());const r=25/(Math.PI*this._minDiameter)*360,c=Ul(e,this._startVector);return Math.abs(c)<r}}function Nu(m){return Math.abs(m.y)>Math.abs(m.x)}class Ns extends Vl{constructor(e){super(),this._currentTouchCount=0,this._map=e}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(e,r,c){super.touchstart(e,r,c),this._currentTouchCount=c.length}_start(e){this._lastPoints=e,Nu(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,r,c){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const f=e[0].sub(this._lastPoints[0]),g=e[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(f,g,c.timeStamp),this._valid?(this._lastPoints=e,this._active=!0,{pitchDelta:(f.y+g.y)/2*-.5}):void 0}gestureBeginsVertically(e,r,c){if(this._valid!==void 0)return this._valid;const f=e.mag()>=2,g=r.mag()>=2;if(!f&&!g)return;if(!f||!g)return this._firstMove===void 0&&(this._firstMove=c),c-this._firstMove<100&&void 0;const v=e.y>0==r.y>0;return Nu(e)&&Nu(r)&&v}}const $d={panStep:100,bearingStep:15,pitchStep:10};class Fs{constructor(e){this._tr=new Rc(e);const r=$d;this._panStep=r.panStep,this._bearingStep=r.bearingStep,this._pitchStep=r.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let r=0,c=0,f=0,g=0,v=0;switch(e.keyCode){case 61:case 107:case 171:case 187:r=1;break;case 189:case 109:case 173:r=-1;break;case 37:e.shiftKey?c=-1:(e.preventDefault(),g=-1);break;case 39:e.shiftKey?c=1:(e.preventDefault(),g=1);break;case 38:e.shiftKey?f=1:(e.preventDefault(),v=-1);break;case 40:e.shiftKey?f=-1:(e.preventDefault(),v=1);break;default:return}return this._rotationDisabled&&(c=0,f=0),{cameraAnimation:w=>{const S=this._tr;w.easeTo({duration:300,easeId:"keyboardHandler",easing:gs,zoom:r?Math.round(S.zoom)+r*(e.shiftKey?2:1):S.zoom,bearing:S.bearing+c*this._bearingStep,pitch:S.pitch+f*this._pitchStep,offset:[-g*this._panStep,-v*this._panStep],center:S.center},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function gs(m){return m*(2-m)}const Mi=4.000244140625,mo=1/450;class xr{constructor(e,r){this._onTimeout=c=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(c)},this._map=e,this._tr=new Rc(e),this._triggerRenderFrame=r,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=mo}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&e.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(e){return!!this._map.cooperativeGestures.isEnabled()&&!(e.ctrlKey||this._map.cooperativeGestures.isBypassed(e))}wheel(e){if(!this.isEnabled())return;if(this._shouldBePrevented(e))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",e);let r=e.deltaMode===WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY;const c=Kt(),f=c-(this._lastWheelEventTime||0);this._lastWheelEventTime=c,r!==0&&r%Mi==0?this._type="wheel":r!==0&&Math.abs(r)<4?this._type="trackpad":f>400?(this._type=null,this._lastValue=r,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(f*r)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,r+=this._lastValue)),e.shiftKey&&r&&(r/=4),this._type&&(this._lastWheelEvent=e,this._delta-=r,this._active||this._start(e)),e.preventDefault()}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const r=gt.mousePos(this._map.getCanvas(),e),c=this._tr;this._aroundPoint=this._aroundCenter?c.transform.locationToScreenPoint(h.V.convert(c.center)):r,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const e=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){const w=e.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=w),typeof this._targetZoom=="number"&&(this._targetZoom+=w)}if(this._delta!==0){const w=this._type==="wheel"&&Math.abs(this._delta)>Mi?this._wheelZoomRate:this._defaultZoomRate;let S=2/(1+Math.exp(-Math.abs(this._delta*w)));this._delta<0&&S!==0&&(S=1/S);const C=typeof this._targetZoom!="number"?e.scale:h.aq(this._targetZoom);this._targetZoom=e.applyConstrain(e.getCameraLngLat(),h.at(C*S)).zoom,this._type==="wheel"&&(this._startZoom=e.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const r=typeof this._targetZoom!="number"?e.zoom:this._targetZoom,c=this._startZoom,f=this._easing;let g,v=!1;if(this._type==="wheel"&&c&&f){const w=Kt()-this._lastWheelEventTime,S=Math.min((w+5)/200,1),C=f(S);g=h.G.number(c,r,C),S<1?this._frameId||(this._frameId=!0):v=!0}else g=r,v=!0;return this._active=!0,v&&(this._active=!1,this._finishTimeout=setTimeout((()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout}),200)),this._lastExpectedZoom=g,{noInertia:!0,needsRenderFrame:!v,zoomDelta:g-e.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let r=h.cx;if(this._prevEase){const c=this._prevEase,f=(Kt()-c.start)/c.duration,g=c.easing(f+.01)-c.easing(f),v=.27/Math.sqrt(g*g+1e-4)*.01,w=Math.sqrt(.0729-v*v);r=h.cv(v,w,.25,1)}return this._prevEase={start:Kt(),duration:e,easing:r},r}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class js{constructor(e,r){this._clickZoom=e,this._tapZoom=r}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Bc{constructor(e){this._tr=new Rc(e),this.reset()}reset(){this._active=!1}dblclick(e,r){return e.preventDefault(),{cameraAnimation:c=>{c.easeTo({duration:300,zoom:this._tr.zoom+(e.shiftKey?-1:1),around:this._tr.unproject(r)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Fu{constructor(){this._tap=new Wa({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(e,r,c){if(!this._swipePoint)if(this._tapTime){const f=r[0],g=e.timeStamp-this._tapTime<500,v=this._tapPoint.dist(f)<30;g&&v?c.length>0&&(this._swipePoint=f,this._swipeTouch=c[0].identifier):this.reset()}else this._tap.touchstart(e,r,c)}touchmove(e,r,c){if(this._tapTime){if(this._swipePoint){if(c[0].identifier!==this._swipeTouch)return;const f=r[0],g=f.y-this._swipePoint.y;return this._swipePoint=f,e.preventDefault(),this._active=!0,{zoomDelta:g/128}}}else this._tap.touchmove(e,r,c)}touchend(e,r,c){if(this._tapTime)this._swipePoint&&c.length===0&&this.reset();else{const f=this._tap.touchend(e,r,c);f&&(this._tapTime=e.timeStamp,this._tapPoint=f)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class il{constructor(e,r,c){this._el=e,this._mousePan=r,this._touchPan=c}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class nl{constructor(e,r,c,f){this._pitchWithRotate=e.pitchWithRotate,this._rollEnabled=e.rollEnabled,this._mouseRotate=r,this._mousePitch=c,this._mouseRoll=f}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class Gh{constructor(e,r,c,f){this._el=e,this._touchZoom=r,this._touchRotate=c,this._tapDragZoom=f,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class br{constructor(e,r){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=e,this._options=r,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const e=this._map.getCanvasContainer();e.classList.add("maplibregl-cooperative-gestures"),this._container=gt.create("div","maplibregl-cooperative-gesture-screen",e);let r=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(r=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const c=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),f=document.createElement("div");f.className="maplibregl-desktop-message",f.textContent=r,this._container.appendChild(f);const g=document.createElement("div");g.className="maplibregl-mobile-message",g.textContent=c,this._container.appendChild(g),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(gt.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(e){return e[this._bypassKey]}notifyGestureBlocked(e,r){this._enabled&&(this._map.fire(new h.l("cooperativegestureprevented",{gestureType:e,originalEvent:r})),this._container.classList.add("maplibregl-show"),setTimeout((()=>{this._container.classList.remove("maplibregl-show")}),100))}}const wr=m=>m.zoom||m.drag||m.roll||m.pitch||m.rotate;class Se extends h.l{}function Le(m){return m.panDelta&&m.panDelta.mag()||m.zoomDelta||m.bearingDelta||m.pitchDelta||m.rollDelta}class al{constructor(e,r){this.handleWindowEvent=f=>{this.handleEvent(f,`${f.type}Window`)},this.handleEvent=(f,g)=>{if(f.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const v=f.type==="renderFrame"?void 0:f,w={needsRenderFrame:!1},S={},C={};for(const{handlerName:L,handler:j,allowed:Z}of this._handlers){if(!j.isEnabled())continue;let W;if(this._blockedByActive(C,Z,L))j.reset();else if(j[g||f.type]){if(h.cy(f,g||f.type)){const Q=gt.mousePos(this._map.getCanvas(),f);W=j[g||f.type](f,Q)}else if(h.cz(f,g||f.type)){const Q=this._getMapTouches(f.touches),it=gt.touchPos(this._map.getCanvas(),Q);W=j[g||f.type](f,it,Q)}else h.cA(g||f.type)||(W=j[g||f.type](f));this.mergeHandlerResult(w,S,W,L,v),W&&W.needsRenderFrame&&this._triggerRenderFrame()}(W||j.isActive())&&(C[L]=j)}const D={};for(const L in this._previousActiveHandlers)C[L]||(D[L]=v);this._previousActiveHandlers=C,(Object.keys(D).length||Le(w))&&(this._changes.push([w,S,D]),this._triggerRenderFrame()),(Object.keys(C).length||Le(w))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:k}=w;k&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],k(this._map))},this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Ya(e),this._bearingSnap=r.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(r);const c=this._el;this._listeners=[[c,"touchstart",{passive:!0}],[c,"touchmove",{passive:!1}],[c,"touchend",void 0],[c,"touchcancel",void 0],[c,"mousedown",void 0],[c,"mousemove",void 0],[c,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[c,"mouseover",void 0],[c,"mouseout",void 0],[c,"dblclick",void 0],[c,"click",void 0],[c,"keydown",{capture:!1}],[c,"keyup",void 0],[c,"wheel",{passive:!1}],[c,"contextmenu",void 0],[window,"blur",void 0]];for(const[f,g,v]of this._listeners)gt.addEventListener(f,g,f===document?this.handleWindowEvent:this.handleEvent,v)}destroy(){for(const[e,r,c]of this._listeners)gt.removeEventListener(e,r,e===document?this.handleWindowEvent:this.handleEvent,c)}_addDefaultHandlers(e){const r=this._map,c=r.getCanvasContainer();this._add("mapEvent",new jf(r,e));const f=r.boxZoom=new Vh(r,e);this._add("boxZoom",f),e.interactive&&e.boxZoom&&f.enable();const g=r.cooperativeGestures=new br(r,e.cooperativeGestures);this._add("cooperativeGestures",g),e.cooperativeGestures&&g.enable();const v=new ge(r),w=new Bc(r);r.doubleClickZoom=new js(w,v),this._add("tapZoom",v),this._add("clickZoom",w),e.interactive&&e.doubleClickZoom&&r.doubleClickZoom.enable();const S=new Fu;this._add("tapDragZoom",S);const C=r.touchPitch=new Ns(r);this._add("touchPitch",C),e.interactive&&e.touchPitch&&r.touchPitch.enable(e.touchPitch);const D=()=>r.project(r.getCenter()),k=(function({enable:at,clickTolerance:dt,aroundCenter:mt=!0,minPixelCenterThreshold:ct=100,rotateDegreesPerPixelMoved:Tt=.8},kt){const zt=new ms({checkCorrectEvent:It=>gt.mouseButton(It)===0&&It.ctrlKey||gt.mouseButton(It)===2&&!It.ctrlKey});return new Fr({clickTolerance:dt,move:(It,Rt)=>{const ae=kt();if(mt&&Math.abs(ae.y-It.y)>ct)return{bearingDelta:h.cw(new h.P(It.x,Rt.y),Rt,ae)};let re=(Rt.x-It.x)*Tt;return mt&&Rt.y<ae.y&&(re=-re),{bearingDelta:re}},moveStateManager:zt,enable:at,assignEvents:vr})})(e,D),L=(function({enable:at,clickTolerance:dt,pitchDegreesPerPixelMoved:mt=-.5}){const ct=new ms({checkCorrectEvent:Tt=>gt.mouseButton(Tt)===0&&Tt.ctrlKey||gt.mouseButton(Tt)===2});return new Fr({clickTolerance:dt,move:(Tt,kt)=>({pitchDelta:(kt.y-Tt.y)*mt}),moveStateManager:ct,enable:at,assignEvents:vr})})(e),j=(function({enable:at,clickTolerance:dt,rollDegreesPerPixelMoved:mt=.3},ct){const Tt=new ms({checkCorrectEvent:kt=>gt.mouseButton(kt)===2&&kt.ctrlKey});return new Fr({clickTolerance:dt,move:(kt,zt)=>{const It=ct();let Rt=(zt.x-kt.x)*mt;return zt.y<It.y&&(Rt=-Rt),{rollDelta:Rt}},moveStateManager:Tt,enable:at,assignEvents:vr})})(e,D);r.dragRotate=new nl(e,k,L,j),this._add("mouseRotate",k,["mousePitch"]),this._add("mousePitch",L,["mouseRotate","mouseRoll"]),this._add("mouseRoll",j,["mousePitch"]),e.interactive&&e.dragRotate&&r.dragRotate.enable();const Z=(function({enable:at,clickTolerance:dt}){const mt=new ms({checkCorrectEvent:ct=>gt.mouseButton(ct)===0&&!ct.ctrlKey});return new Fr({clickTolerance:dt,move:(ct,Tt)=>({around:Tt,panDelta:Tt.sub(ct)}),activateOnStart:!0,moveStateManager:mt,enable:at,assignEvents:vr})})(e),W=new Uh(e,r);r.dragPan=new il(c,Z,W),this._add("mousePan",Z),this._add("touchPan",W,["touchZoom","touchRotate"]),e.interactive&&e.dragPan&&r.dragPan.enable(e.dragPan);const Q=new Gl,it=new Oc;r.touchZoomRotate=new Gh(c,it,Q,S),this._add("touchRotate",Q,["touchPan","touchZoom"]),this._add("touchZoom",it,["touchPan","touchRotate"]),e.interactive&&e.touchZoomRotate&&r.touchZoomRotate.enable(e.touchZoomRotate),this._add("blockableMapEvent",new Hd(r));const st=r.scrollZoom=new xr(r,(()=>this._triggerRenderFrame()));this._add("scrollZoom",st,["mousePan"]),e.interactive&&e.scrollZoom&&r.scrollZoom.enable(e.scrollZoom);const ht=r.keyboard=new Fs(r);this._add("keyboard",ht),e.interactive&&e.keyboard&&r.keyboard.enable()}_add(e,r,c){this._handlers.push({handlerName:e,handler:r,allowed:c}),this._handlersById[e]=r}stop(e){if(!this._updatingCamera){for(const{handler:r}of this._handlers)r.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}}isActive(){for(const{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!wr(this._eventsInProgress)||this.isZooming()}_blockedByActive(e,r,c){for(const f in e)if(f!==c&&(!r||r.indexOf(f)<0))return!0;return!1}_getMapTouches(e){const r=[];for(const c of e)this._el.contains(c.target)&&r.push(c);return r}mergeHandlerResult(e,r,c,f,g){if(!c)return;h.e(e,c);const v={handlerName:f,originalEvent:c.originalEvent||g};c.zoomDelta!==void 0&&(r.zoom=v),c.panDelta!==void 0&&(r.drag=v),c.rollDelta!==void 0&&(r.roll=v),c.pitchDelta!==void 0&&(r.pitch=v),c.bearingDelta!==void 0&&(r.rotate=v)}_applyChanges(){const e={},r={},c={};for(const[f,g,v]of this._changes)f.panDelta&&(e.panDelta=(e.panDelta||new h.P(0,0))._add(f.panDelta)),f.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+f.zoomDelta),f.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+f.bearingDelta),f.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+f.pitchDelta),f.rollDelta&&(e.rollDelta=(e.rollDelta||0)+f.rollDelta),f.around!==void 0&&(e.around=f.around),f.pinchAround!==void 0&&(e.pinchAround=f.pinchAround),f.noInertia&&(e.noInertia=f.noInertia),h.e(r,g),h.e(c,v);this._updateMapTransform(e,r,c),this._changes=[]}_updateMapTransform(e,r,c){const f=this._map,g=f._getTransformForUpdate(),v=f.terrain;if(!(Le(e)||v&&this._terrainMovement))return this._fireEvents(r,c,!0);f._stop(!0);let{panDelta:w,zoomDelta:S,bearingDelta:C,pitchDelta:D,rollDelta:k,around:L,pinchAround:j}=e;j!==void 0&&(L=j),L=L||f.transform.centerPoint,v&&!g.isPointOnMapSurface(L)&&(L=g.centerPoint);const Z={panDelta:w,zoomDelta:S,rollDelta:k,pitchDelta:D,bearingDelta:C,around:L};this._map.cameraHelper.useGlobeControls&&!g.isPointOnMapSurface(L)&&(L=g.centerPoint);const W=L.distSqr(g.centerPoint)<.01?g.center:g.screenPointToLocation(w?L.sub(w):L);this._handleMapControls({terrain:v,tr:g,deltasForHelper:Z,preZoomAroundLoc:W,combinedEventsInProgress:r,panDelta:w}),f._applyUpdatedTransform(g),this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(r,c,!0)}_handleMapControls({terrain:e,tr:r,deltasForHelper:c,preZoomAroundLoc:f,combinedEventsInProgress:g,panDelta:v}){const w=this._map.cameraHelper;if(w.handleMapControlsRollPitchBearingZoom(c,r),e)return w.useGlobeControls?(this._terrainMovement||!g.drag&&!g.zoom||(this._terrainMovement=!0,this._map._elevationFreeze=!0),void w.handleMapControlsPan(c,r,f)):this._terrainMovement||!g.drag&&!g.zoom?void(g.drag&&this._terrainMovement&&v?r.setCenter(r.screenPointToLocation(r.centerPoint.sub(v))):w.handleMapControlsPan(c,r,f)):(this._terrainMovement=!0,this._map._elevationFreeze=!0,void w.handleMapControlsPan(c,r,f));w.handleMapControlsPan(c,r,f)}_fireEvents(e,r,c){const f=wr(this._eventsInProgress),g=wr(e),v={};for(const k in e){const{originalEvent:L}=e[k];this._eventsInProgress[k]||(v[`${k}start`]=L),this._eventsInProgress[k]=e[k]}!f&&g&&this._fireEvent("movestart",g.originalEvent);for(const k in v)this._fireEvent(k,v[k]);g&&this._fireEvent("move",g.originalEvent);for(const k in e){const{originalEvent:L}=e[k];this._fireEvent(k,L)}const w={};let S;for(const k in this._eventsInProgress){const{handlerName:L,originalEvent:j}=this._eventsInProgress[k];this._handlersById[L].isActive()||(delete this._eventsInProgress[k],S=r[L]||j,w[`${k}end`]=S)}for(const k in w)this._fireEvent(k,w[k]);const C=wr(this._eventsInProgress),D=(f||g)&&!C;if(D&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const k=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&k.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(k)}if(c&&D){this._updatingCamera=!0;const k=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),L=j=>j!==0&&-this._bearingSnap<j&&j<this._bearingSnap;!k||!k.essential&&he.prefersReducedMotion?(this._map.fire(new h.l("moveend",{originalEvent:S})),L(this._map.getBearing())&&this._map.resetNorth()):(L(k.bearing||this._map.getBearing())&&(k.bearing=0),k.freezeElevation=!0,this._map.easeTo(k,{originalEvent:S})),this._updatingCamera=!1}}_fireEvent(e,r){this._map.fire(new h.l(e,r?{originalEvent:r}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((e=>{delete this._frameId,this.handleEvent(new Se("renderFrame",{timeStamp:e})),this._applyChanges()}))}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class ju extends h.E{constructor(e,r,c){super(),this._renderFrameCallback=()=>{const f=Math.min((Kt()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(f)),f<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=c.bearingSnap,this.cameraHelper=r,this.on("moveend",(()=>{delete this._requestedCameraState}))}migrateProjection(e,r){e.apply(this.transform),this.transform=e,this.cameraHelper=r}getCenter(){return new h.V(this.transform.center.lng,this.transform.center.lat)}setCenter(e,r){return this.jumpTo({center:e},r)}getCenterElevation(){return this.transform.elevation}setCenterElevation(e,r){return this.jumpTo({elevation:e},r),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(e){this._centerClampedToGround=e}panBy(e,r,c){return e=h.P.convert(e).mult(-1),this.panTo(this.transform.center,h.e({offset:e},r),c)}panTo(e,r,c){return this.easeTo(h.e({center:e},r),c)}getZoom(){return this.transform.zoom}setZoom(e,r){return this.jumpTo({zoom:e},r),this}zoomTo(e,r,c){return this.easeTo(h.e({zoom:e},r),c)}zoomIn(e,r){return this.zoomTo(this.getZoom()+1,e,r),this}zoomOut(e,r){return this.zoomTo(this.getZoom()-1,e,r),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(e,r){return e!=this.transform.fov&&(this.transform.setFov(e),this.fire(new h.l("movestart",r)).fire(new h.l("move",r)).fire(new h.l("moveend",r))),this}getBearing(){return this.transform.bearing}setBearing(e,r){return this.jumpTo({bearing:e},r),this}getPadding(){return this.transform.padding}setPadding(e,r){return this.jumpTo({padding:e},r),this}rotateTo(e,r,c){return this.easeTo(h.e({bearing:e},r),c)}resetNorth(e,r){return this.rotateTo(0,h.e({duration:1e3},e),r),this}resetNorthPitch(e,r){return this.easeTo(h.e({bearing:0,pitch:0,roll:0,duration:1e3},e),r),this}snapToNorth(e,r){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,r):this}getPitch(){return this.transform.pitch}setPitch(e,r){return this.jumpTo({pitch:e},r),this}getRoll(){return this.transform.roll}setRoll(e,r){return this.jumpTo({roll:e},r),this}cameraForBounds(e,r){e=Di.convert(e).adjustAntiMeridian();const c=r&&r.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),c,r)}_cameraForBoxAndBearing(e,r,c,f){const g={top:0,bottom:0,right:0,left:0};if(typeof(f=h.e({padding:g,offset:[0,0],maxZoom:this.transform.maxZoom},f)).padding=="number"){const C=f.padding;f.padding={top:C,bottom:C,right:C,left:C}}const v=h.e(g,f.padding);f.padding=v;const w=this.transform,S=new Di(e,r);return this.cameraHelper.cameraForBoxAndBearing(f,v,S,c,w)}fitBounds(e,r,c){return this._fitInternal(this.cameraForBounds(e,r),r,c)}fitScreenCoordinates(e,r,c,f,g){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(h.P.convert(e)),this.transform.screenPointToLocation(h.P.convert(r)),c,f),f,g)}_fitInternal(e,r,c){return e?(delete(r=h.e(e,r)).padding,r.linear?this.easeTo(r,c):this.flyTo(r,c)):this}jumpTo(e,r){this.stop();const c=this._getTransformForUpdate();let f=!1,g=!1,v=!1;const w=c.zoom;this.cameraHelper.handleJumpToCenterZoom(c,e);const S=c.zoom!==w;return"elevation"in e&&c.elevation!==+e.elevation&&c.setElevation(+e.elevation),"bearing"in e&&c.bearing!==+e.bearing&&(f=!0,c.setBearing(+e.bearing)),"pitch"in e&&c.pitch!==+e.pitch&&(g=!0,c.setPitch(+e.pitch)),"roll"in e&&c.roll!==+e.roll&&(v=!0,c.setRoll(+e.roll)),e.padding==null||c.isPaddingEqual(e.padding)||c.setPadding(e.padding),this._applyUpdatedTransform(c),this.fire(new h.l("movestart",r)).fire(new h.l("move",r)),S&&this.fire(new h.l("zoomstart",r)).fire(new h.l("zoom",r)).fire(new h.l("zoomend",r)),f&&this.fire(new h.l("rotatestart",r)).fire(new h.l("rotate",r)).fire(new h.l("rotateend",r)),g&&this.fire(new h.l("pitchstart",r)).fire(new h.l("pitch",r)).fire(new h.l("pitchend",r)),v&&this.fire(new h.l("rollstart",r)).fire(new h.l("roll",r)).fire(new h.l("rollend",r)),this.fire(new h.l("moveend",r))}calculateCameraOptionsFromTo(e,r,c,f=0){const g=h.aa.fromLngLat(e,r),v=h.aa.fromLngLat(c,f),w=v.x-g.x,S=v.y-g.y,C=v.z-g.z,D=Math.hypot(w,S,C);if(D===0)throw new Error("Can't calculate camera options with same From and To");const k=Math.hypot(w,S),L=h.at(this.transform.cameraToCenterDistance/D/this.transform.tileSize),j=180*Math.atan2(w,-S)/Math.PI;let Z=180*Math.acos(k/D)/Math.PI;return Z=C<0?90-Z:90+Z,{center:v.toLngLat(),elevation:f,zoom:L,pitch:Z,bearing:j}}calculateCameraOptionsFromCameraLngLatAltRotation(e,r,c,f,g){const v=this.transform.calculateCenterFromCameraLngLatAlt(e,r,c,f);return{center:v.center,elevation:v.elevation,zoom:v.zoom,bearing:c,pitch:f,roll:g}}easeTo(e,r){this._stop(!1,e.easeId),((e=h.e({offset:[0,0],duration:500,easing:h.cx},e)).animate===!1||!e.essential&&he.prefersReducedMotion)&&(e.duration=0);const c=this._getTransformForUpdate(),f=this.getBearing(),g=c.pitch,v=c.roll,w="bearing"in e?this._normalizeBearing(e.bearing,f):f,S="pitch"in e?+e.pitch:g,C="roll"in e?this._normalizeBearing(e.roll,v):v,D="padding"in e?e.padding:c.padding,k=h.P.convert(e.offset);let L,j;e.around&&(L=h.V.convert(e.around),j=c.locationToScreenPoint(L));const Z={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},W=this.cameraHelper.handleEaseTo(c,{bearing:w,pitch:S,roll:C,padding:D,around:L,aroundPoint:j,offsetAsPoint:k,offset:e.offset,zoom:e.zoom,center:e.center});return this._rotating=this._rotating||f!==w,this._pitching=this._pitching||S!==g,this._rolling=this._rolling||C!==v,this._padding=!c.isPaddingEqual(D),this._zooming=this._zooming||W.isZooming,this._easeId=e.easeId,this._prepareEase(r,e.noMoveStart,Z),this.terrain&&this._prepareElevation(W.elevationCenter),this._ease((Q=>{W.easeFunc(Q),this.terrain&&!e.freezeElevation&&this._updateElevation(Q),this._applyUpdatedTransform(c),this._fireMoveEvents(r)}),(Q=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(r,Q)}),e),this}_prepareEase(e,r,c={}){this._moving=!0,r||c.moving||this.fire(new h.l("movestart",e)),this._zooming&&!c.zooming&&this.fire(new h.l("zoomstart",e)),this._rotating&&!c.rotating&&this.fire(new h.l("rotatestart",e)),this._pitching&&!c.pitching&&this.fire(new h.l("pitchstart",e)),this._rolling&&!c.rolling&&this.fire(new h.l("rollstart",e))}_prepareElevation(e){this._elevationCenter=e,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(e,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(e){this._elevationStart!==void 0&&this._elevationCenter!==void 0||this._prepareElevation(this.transform.center),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));const r=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(e<1&&r!==this._elevationTarget){const c=this._elevationTarget-this._elevationStart;this._elevationStart+=e*(c-(r-(c*e+this._elevationStart))/(1-e)),this._elevationTarget=r}this.transform.setElevation(h.G.number(this._elevationStart,this._elevationTarget,e))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(e){if(!this.terrain&&e.elevation>=0&&e.pitch<=90)return{};const r=e.getCameraLngLat(),c=e.getCameraAltitude(),f=this.terrain?this.terrain.getElevationForLngLatZoom(r,e.zoom):0;if(c<f){const g=this.calculateCameraOptionsFromTo(r,f,e.center,e.elevation);return{pitch:g.pitch,zoom:g.zoom}}return{}}_applyUpdatedTransform(e){const r=[];if(r.push((f=>this._elevateCameraIfInsideTerrain(f))),this.transformCameraUpdate&&r.push((f=>this.transformCameraUpdate(f))),!r.length)return;const c=e.clone();for(const f of r){const g=c.clone(),{center:v,zoom:w,roll:S,pitch:C,bearing:D,elevation:k}=f(g);v&&g.setCenter(v),k!==void 0&&g.setElevation(k),w!==void 0&&g.setZoom(w),S!==void 0&&g.setRoll(S),C!==void 0&&g.setPitch(C),D!==void 0&&g.setBearing(D),c.apply(g)}this.transform.apply(c)}_fireMoveEvents(e){this.fire(new h.l("move",e)),this._zooming&&this.fire(new h.l("zoom",e)),this._rotating&&this.fire(new h.l("rotate",e)),this._pitching&&this.fire(new h.l("pitch",e)),this._rolling&&this.fire(new h.l("roll",e))}_afterEase(e,r){if(this._easeId&&r&&this._easeId===r)return;delete this._easeId;const c=this._zooming,f=this._rotating,g=this._pitching,v=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,c&&this.fire(new h.l("zoomend",e)),f&&this.fire(new h.l("rotateend",e)),g&&this.fire(new h.l("pitchend",e)),v&&this.fire(new h.l("rollend",e)),this.fire(new h.l("moveend",e))}flyTo(e,r){if(!e.essential&&he.prefersReducedMotion){const Rt=h.U(e,["center","zoom","bearing","pitch","roll","elevation","padding"]);return this.jumpTo(Rt,r)}this.stop(),e=h.e({offset:[0,0],speed:1.2,curve:1.42,easing:h.cx},e);const c=this._getTransformForUpdate(),f=c.bearing,g=c.pitch,v=c.roll,w=c.padding,S="bearing"in e?this._normalizeBearing(e.bearing,f):f,C="pitch"in e?+e.pitch:g,D="roll"in e?this._normalizeBearing(e.roll,v):v,k="padding"in e?e.padding:c.padding,L=h.P.convert(e.offset);let j=c.centerPoint.add(L);const Z=c.screenPointToLocation(j),W=this.cameraHelper.handleFlyTo(c,{bearing:S,pitch:C,roll:D,padding:k,locationAtOffset:Z,offsetAsPoint:L,center:e.center,minZoom:e.minZoom,zoom:e.zoom});let Q=e.curve;const it=Math.max(c.width,c.height),st=it/W.scaleOfZoom,ht=W.pixelPathLength;typeof W.scaleOfMinZoom=="number"&&(Q=Math.sqrt(it/W.scaleOfMinZoom/ht*2));const at=Q*Q;function dt(Rt){const ae=(st*st-it*it+(Rt?-1:1)*at*at*ht*ht)/(2*(Rt?st:it)*at*ht);return Math.log(Math.sqrt(ae*ae+1)-ae)}function mt(Rt){return(Math.exp(Rt)-Math.exp(-Rt))/2}function ct(Rt){return(Math.exp(Rt)+Math.exp(-Rt))/2}const Tt=dt(!1);let kt=function(Rt){return ct(Tt)/ct(Tt+Q*Rt)},zt=function(Rt){return it*((ct(Tt)*(mt(ae=Tt+Q*Rt)/ct(ae))-mt(Tt))/at)/ht;var ae},It=(dt(!0)-Tt)/Q;if(Math.abs(ht)<2e-6||!isFinite(It)){if(Math.abs(it-st)<1e-6)return this.easeTo(e,r);const Rt=st<it?-1:1;It=Math.abs(Math.log(st/it))/Q,zt=()=>0,kt=ae=>Math.exp(Rt*Q*ae)}return e.duration="duration"in e?+e.duration:1e3*It/("screenSpeed"in e?+e.screenSpeed/Q:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=f!==S,this._pitching=C!==g,this._rolling=D!==v,this._padding=!c.isPaddingEqual(k),this._prepareEase(r,!1),this.terrain&&this._prepareElevation(W.targetCenter),this._ease((Rt=>{const ae=Rt*It,re=1/kt(ae),Xt=zt(ae);this._rotating&&c.setBearing(h.G.number(f,S,Rt)),this._pitching&&c.setPitch(h.G.number(g,C,Rt)),this._rolling&&c.setRoll(h.G.number(v,D,Rt)),this._padding&&(c.interpolatePadding(w,k,Rt),j=c.centerPoint.add(L)),W.easeFunc(Rt,re,Xt,j),this.terrain&&!e.freezeElevation&&this._updateElevation(Rt),this._applyUpdatedTransform(c),this._fireMoveEvents(r)}),(()=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(r)}),e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,r){var c;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const f=this._onEaseEnd;delete this._onEaseEnd,f.call(this,r)}return e||(c=this.handlers)===null||c===void 0||c.stop(!1),this}_ease(e,r,c){c.animate===!1||c.duration===0?(e(1),r()):(this._easeStart=Kt(),this._easeOptions=c,this._onEaseFrame=e,this._onEaseEnd=r,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(e,r){e=h.W(e,-180,180);const c=Math.abs(e-r);return Math.abs(e-360-r)<c&&(e-=360),Math.abs(e+360-r)<c&&(e+=360),e}queryTerrainElevation(e){return this.terrain?this.terrain.getElevationForLngLatZoom(h.V.convert(e),this.transform.tileZoom):null}}const ma={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class $i{constructor(e=ma){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=r=>{!r||r.sourceDataType!=="metadata"&&r.sourceDataType!=="visibility"&&r.dataType!=="style"&&r.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=e}getDefaultPosition(){return"bottom-right"}onAdd(e){return this._map=e,this._compact=this.options.compact,this._container=gt.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=gt.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=gt.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){gt.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(e,r){const c=this._map._getUIString(`AttributionControl.${r}`);e.title=c,e.setAttribute("aria-label",c)}_updateAttributions(){if(!this._map.style)return;let e=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=e.concat(this.options.customAttribution.map((f=>typeof f!="string"?"":f))):typeof this.options.customAttribution=="string"&&e.push(this.options.customAttribution)),this._map.style.stylesheet){const f=this._map.style.stylesheet;this.styleOwner=f.owner,this.styleId=f.id}const r=this._map.style.tileManagers;for(const f in r){const g=r[f];if(g.used||g.usedForTerrain){const v=g.getSource();v.attribution&&e.indexOf(v.attribution)<0&&e.push(v.attribution)}}e=e.filter((f=>String(f).trim())),e.sort(((f,g)=>f.length-g.length)),e=e.filter(((f,g)=>{for(let v=g+1;v<e.length;v++)if(e[v].indexOf(f)>=0)return!1;return!0}));const c=e.join(" | ");c!==this._attribHTML&&(this._attribHTML=c,e.length?(this._innerContainer.innerHTML=gt.sanitize(c),this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Yn{constructor(e={}){this._updateCompact=()=>{const r=this._container.children;if(r.length){const c=r[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&c.classList.add("maplibregl-compact"):c.classList.remove("maplibregl-compact")}},this.options=e}getDefaultPosition(){return"bottom-left"}onAdd(e){this._map=e,this._compact=this.options&&this.options.compact,this._container=gt.create("div","maplibregl-ctrl");const r=gt.create("a","maplibregl-ctrl-logo");return r.target="_blank",r.rel="noopener nofollow",r.href="https://maplibre.org/",r.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),r.setAttribute("rel","noopener nofollow"),this._container.appendChild(r),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){gt.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Vu{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){const r=++this._id;return this._queue.push({callback:e,id:r,cancelled:!1}),r}remove(e){const r=this._currentlyRunning,c=r?this._queue.concat(r):this._queue;for(const f of c)if(f.id===e)return void(f.cancelled=!0)}run(e=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const r=this._currentlyRunning=this._queue;this._queue=[];for(const c of r)if(!c.cancelled&&(c.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Xd=h.aT([{name:"a_pos3d",type:"Int16",components:3}]);class go extends h.E{constructor(e){super(),this._lastTilesetChange=Kt(),this.tileManager=e,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=e._source.tileSize*2**this.deltaZoom,e.usedForTerrain=!0,e.tileSize=this.tileSize}destruct(){this.tileManager.usedForTerrain=!1,this.tileManager.tileSize=null}getSource(){return this.tileManager._source}update(e,r){this.tileManager.update(e,r),this._renderableTilesKeys=[];const c={};for(const f of je(e,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:r,calculateTileZoom:this.tileManager._source.calculateTileZoom}))c[f.key]=!0,this._renderableTilesKeys.push(f.key),this._tiles[f.key]||(f.terrainRttPosMatrix32f=new Float64Array(16),h.c6(f.terrainRttPosMatrix32f,0,h.a4,h.a4,0,0,1),this._tiles[f.key]=new F(f,this.tileSize),this._lastTilesetChange=Kt());for(const f in this._tiles)c[f]||delete this._tiles[f]}freeRtt(e){for(const r in this._tiles){const c=this._tiles[r];(!e||c.tileID.equals(e)||c.tileID.isChildOf(e)||e.isChildOf(c.tileID))&&(c.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map((e=>this.getTileByID(e)))}getTileByID(e){return this._tiles[e]}getTerrainCoords(e,r){return r?this._getTerrainCoordsForTileRanges(e,r):this._getTerrainCoordsForRegularTile(e)}_getTerrainCoordsForRegularTile(e){const r={};for(const c of this._renderableTilesKeys){const f=this._tiles[c].tileID,g=e.clone(),v=h.bj();if(f.canonical.equals(e.canonical))h.c6(v,0,h.a4,h.a4,0,0,1);else if(f.canonical.isChildOf(e.canonical)){const w=f.canonical.z-e.canonical.z,S=f.canonical.x-(f.canonical.x>>w<<w),C=f.canonical.y-(f.canonical.y>>w<<w),D=h.a4>>w;h.c6(v,0,D,D,0,0,1),h.O(v,v,[-S*D,-C*D,0])}else{if(!e.canonical.isChildOf(f.canonical))continue;{const w=e.canonical.z-f.canonical.z,S=e.canonical.x-(e.canonical.x>>w<<w),C=e.canonical.y-(e.canonical.y>>w<<w),D=h.a4>>w;h.c6(v,0,h.a4,h.a4,0,0,1),h.O(v,v,[S*D,C*D,0]),h.Q(v,v,[1/2**w,1/2**w,0])}}g.terrainRttPosMatrix32f=new Float32Array(v),r[c]=g}return r}_getTerrainCoordsForTileRanges(e,r){const c={};for(const f of this._renderableTilesKeys){const g=this._tiles[f].tileID;if(!this._isWithinTileRanges(g,r))continue;const v=e.clone(),w=h.bj();if(g.canonical.z===e.canonical.z){const S=e.canonical.x-g.canonical.x,C=e.canonical.y-g.canonical.y;h.c6(w,0,h.a4,h.a4,0,0,1),h.O(w,w,[S*h.a4,C*h.a4,0])}else if(g.canonical.z>e.canonical.z){const S=g.canonical.z-e.canonical.z,C=g.canonical.x-(g.canonical.x>>S<<S),D=g.canonical.y-(g.canonical.y>>S<<S),k=e.canonical.x-(g.canonical.x>>S),L=e.canonical.y-(g.canonical.y>>S),j=h.a4>>S;h.c6(w,0,j,j,0,0,1),h.O(w,w,[-C*j+k*h.a4,-D*j+L*h.a4,0])}else{const S=e.canonical.z-g.canonical.z,C=e.canonical.x-(e.canonical.x>>S<<S),D=e.canonical.y-(e.canonical.y>>S<<S),k=(e.canonical.x>>S)-g.canonical.x,L=(e.canonical.y>>S)-g.canonical.y,j=h.a4<<S;h.c6(w,0,j,j,0,0,1),h.O(w,w,[C*h.a4+k*j,D*h.a4+L*j,0])}v.terrainRttPosMatrix32f=new Float32Array(w),c[f]=v}return c}getSourceTile(e,r){const c=this.tileManager._source;let f=e.overscaledZ-this.deltaZoom;if(f>c.maxzoom&&(f=c.maxzoom),f<c.minzoom)return null;this._sourceTileCache[e.key]||(this._sourceTileCache[e.key]=e.scaledTo(f).key);let g=this.tileManager.getTileByID(this._sourceTileCache[e.key]);if((!g||!g.dem)&&r)for(;f>=c.minzoom&&(!g||!g.dem);)g=this.tileManager.getTileByID(e.scaledTo(f--).key);return g}anyTilesAfterTime(e=Date.now()){return this._lastTilesetChange>=e}_isWithinTileRanges(e,r){return r[e.canonical.z]&&e.canonical.x>=r[e.canonical.z].minTileX&&e.canonical.x<=r[e.canonical.z].maxTileX&&e.canonical.y>=r[e.canonical.z].minTileY&&e.canonical.y<=r[e.canonical.z].maxTileY}}class sr{constructor(e,r,c){this._meshCache={},this.painter=e,this.tileManager=new go(r),this.options=c,this.exaggeration=typeof c.exaggeration=="number"?c.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(e,r,c,f=h.a4){var g;if(!(r>=0&&r<f&&c>=0&&c<f))return 0;const v=this.getTerrainData(e),w=(g=v.tile)===null||g===void 0?void 0:g.dem;if(!w)return 0;const S=h.cB([],[r/f*h.a4,c/f*h.a4],v.u_terrain_matrix),C=[S[0]*w.dim,S[1]*w.dim],D=Math.floor(C[0]),k=Math.floor(C[1]),L=C[0]-D,j=C[1]-k;return w.get(D,k)*(1-L)*(1-j)+w.get(D+1,k)*L*(1-j)+w.get(D,k+1)*(1-L)*j+w.get(D+1,k+1)*L*j}getElevationForLngLatZoom(e,r){if(!h.cC(r,e.wrap()))return 0;const{tileID:c,mercatorX:f,mercatorY:g}=this._getOverscaledTileIDFromLngLatZoom(e,r);return this.getElevation(c,f%h.a4,g%h.a4,h.a4)}getElevation(e,r,c,f=h.a4){return this.getDEMElevation(e,r,c,f)*this.exaggeration}getTerrainData(e){if(!this._emptyDemTexture){const f=this.painter.context,g=new h.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new h.T(f,g,f.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new h.T(f,new h.R({width:1,height:1}),f.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(f.gl.NEAREST,f.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=h.ar([])}const r=this.tileManager.getSourceTile(e,!0);if(r&&r.dem&&(!r.demTexture||r.needsTerrainPrepare)){const f=this.painter.context;r.demTexture=this.painter.getTileTexture(r.dem.stride),r.demTexture?r.demTexture.update(r.dem.getPixels(),{premultiply:!1}):r.demTexture=new h.T(f,r.dem.getPixels(),f.gl.RGBA,{premultiply:!1}),r.demTexture.bind(f.gl.NEAREST,f.gl.CLAMP_TO_EDGE),r.needsTerrainPrepare=!1}const c=r&&r+r.tileID.key+e.key;if(c&&!this._demMatrixCache[c]){const f=this.tileManager.getSource().maxzoom;let g=e.canonical.z-r.tileID.canonical.z;e.overscaledZ>e.canonical.z&&(e.canonical.z>=f?g=e.canonical.z-f:h.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const v=e.canonical.x-(e.canonical.x>>g<<g),w=e.canonical.y-(e.canonical.y>>g<<g),S=h.cD(new Float64Array(16),[1/(h.a4<<g),1/(h.a4<<g),0]);h.O(S,S,[v*h.a4,w*h.a4,0]),this._demMatrixCache[e.key]={matrix:S,coord:e}}return{u_depth:2,u_terrain:3,u_terrain_dim:r&&r.dem&&r.dem.dim||1,u_terrain_matrix:c?this._demMatrixCache[e.key].matrix:this._emptyDemMatrix,u_terrain_unpack:r&&r.dem&&r.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(r&&r.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:r}}getFramebuffer(e){const r=this.painter,c=r.width/devicePixelRatio,f=r.height/devicePixelRatio;return!this._fbo||this._fbo.width===c&&this._fbo.height===f||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new h.T(r.context,{width:c,height:f,data:null},r.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(r.context.gl.NEAREST,r.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new h.T(r.context,{width:c,height:f,data:null},r.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(r.context.gl.NEAREST,r.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=r.context.createFramebuffer(c,f,!0,!1),this._fbo.depthAttachment.set(r.context.createRenderbuffer(r.context.gl.DEPTH_COMPONENT16,c,f))),this._fbo.colorAttachment.set(e==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const e=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const r=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let g=0,v=0;g<this._coordsTextureSize;g++)for(let w=0;w<this._coordsTextureSize;w++,v+=4)r[v+0]=255&w,r[v+1]=255&g,r[v+2]=w>>8<<4|g>>8,r[v+3]=0;const c=new h.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(r.buffer)),f=new h.T(e,c,e.gl.RGBA,{premultiply:!1});return f.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),this._coordsTexture=f,f}pointCoordinate(e){this.painter.maybeDrawDepthAndCoords(!0);const r=new Uint8Array(4),c=this.painter.context,f=c.gl,g=Math.round(e.x*this.painter.pixelRatio/devicePixelRatio),v=Math.round(e.y*this.painter.pixelRatio/devicePixelRatio),w=Math.round(this.painter.height/devicePixelRatio);c.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),f.readPixels(g,w-v-1,1,1,f.RGBA,f.UNSIGNED_BYTE,r),c.bindFramebuffer.set(null);const S=r[0]+(r[2]>>4<<8),C=r[1]+((15&r[2])<<8),D=this.coordsIndex[255-r[3]],k=D&&this.tileManager.getTileByID(D);if(!k)return null;const L=this._coordsTextureSize,j=(1<<k.tileID.canonical.z)*L;return new h.aa((k.tileID.canonical.x*L+S)/j+k.tileID.wrap,(k.tileID.canonical.y*L+C)/j,this.getElevation(k.tileID,S,C,L))}depthAtPoint(e){const r=new Uint8Array(4),c=this.painter.context,f=c.gl;return c.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),f.readPixels(e.x,this.painter.height/devicePixelRatio-e.y-1,1,1,f.RGBA,f.UNSIGNED_BYTE,r),c.bindFramebuffer.set(null),(r[0]/16777216+r[1]/65536+r[2]/256+r[3])/256}getTerrainMesh(e){var r;const c=((r=this.painter.style.projection)===null||r===void 0?void 0:r.transitionState)>0,f=c&&e.canonical.y===0,g=c&&e.canonical.y===(1<<e.canonical.z)-1,v=`m_${f?"n":""}_${g?"s":""}`;if(this._meshCache[v])return this._meshCache[v];const w=this.painter.context,S=new h.cE,C=new h.aX,D=this.meshSize,k=h.a4/D,L=D*D;for(let ct=0;ct<=D;ct++)for(let Tt=0;Tt<=D;Tt++)S.emplaceBack(Tt*k,ct*k,0);for(let ct=0;ct<L;ct+=D+1)for(let Tt=0;Tt<D;Tt++)C.emplaceBack(Tt+ct,D+Tt+ct+1,D+Tt+ct+2),C.emplaceBack(Tt+ct,D+Tt+ct+2,Tt+ct+1);const j=S.length,Z=j+(D+1),W=(D+1)*D,Q=f?h.bq:0,it=f?0:1,st=g?h.br:h.a4,ht=g?0:1;for(let ct=0;ct<=D;ct++)S.emplaceBack(ct*k,Q,it);for(let ct=0;ct<=D;ct++)S.emplaceBack(ct*k,st,ht);for(let ct=0;ct<D;ct++)C.emplaceBack(W+ct,Z+ct,Z+ct+1),C.emplaceBack(W+ct,Z+ct+1,W+ct+1),C.emplaceBack(0+ct,j+ct+1,j+ct),C.emplaceBack(0+ct,0+ct+1,j+ct+1);const at=S.length,dt=at+2*(D+1);for(const ct of[0,1])for(let Tt=0;Tt<=D;Tt++)for(const kt of[0,1])S.emplaceBack(ct*h.a4,Tt*k,kt);for(let ct=0;ct<2*D;ct+=2)C.emplaceBack(at+ct,at+ct+1,at+ct+3),C.emplaceBack(at+ct,at+ct+3,at+ct+2),C.emplaceBack(dt+ct,dt+ct+3,dt+ct+1),C.emplaceBack(dt+ct,dt+ct+2,dt+ct+3);const mt=new ts(w.createVertexBuffer(S,Xd.members),w.createIndexBuffer(C),h.aW.simpleSegment(0,0,S.length,C.length));return this._meshCache[v]=mt,mt}getMeshFrameDelta(e){return 2*Math.PI*h.bD/Math.pow(2,Math.max(e,0))/5}getMinTileElevationForLngLatZoom(e,r){var c;const{tileID:f}=this._getOverscaledTileIDFromLngLatZoom(e,r);return(c=this.getMinMaxElevation(f).minElevation)!==null&&c!==void 0?c:0}getMinMaxElevation(e){const r=this.getTerrainData(e).tile,c={minElevation:null,maxElevation:null};return r&&r.dem&&(c.minElevation=r.dem.min*this.exaggeration,c.maxElevation=r.dem.max*this.exaggeration),c}_getOverscaledTileIDFromLngLatZoom(e,r){const c=h.aa.fromLngLat(e.wrap()),f=(1<<r)*h.a4,g=c.x*f,v=c.y*f,w=Math.floor(g/h.a4),S=Math.floor(v/h.a4);return{tileID:new h.a1(r,0,r,w,S),mercatorX:g,mercatorY:v}}}class nn{constructor(e,r,c){this._context=e,this._size=r,this._tileSize=c,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const e of this._objects)e.texture.destroy(),e.fbo.destroy()}_createObject(e){const r=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),c=new h.T(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return c.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),r.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),r.colorAttachment.set(c.texture),{id:e,fbo:r,texture:c,stamp:-1,inUse:!1}}getObjectForId(e){return this._objects[e]}useObject(e){e.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter((r=>e.id!==r)),this._recentlyUsed.push(e.id)}stampObject(e){e.stamp=++this._stamp}getOrCreateFreeObject(){for(const r of this._recentlyUsed)if(!this._objects[r].inUse)return this._objects[r];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const e=this._createObject(this._objects.length);return this._objects.push(e),e}freeObject(e){e.inUse=!1}freeAllObjects(){for(const e of this._objects)this.freeObject(e)}isFull(){return!(this._objects.length<this._size)&&this._objects.some((e=>!e.inUse))===!1}}const Ti={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0,"color-relief":!0};class zi{constructor(e,r){this.painter=e,this.terrain=r,this.pool=new nn(e.context,30,r.tileManager.tileSize*r.qualityFactor)}destruct(){this.pool.destruct()}getTexture(e){return this.pool.getObjectForId(e.rtt[this._stacks.length-1].id).texture}prepareForRender(e,r){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.tileManager.getRenderableTiles(),this._renderableLayerIds=e._order.filter((c=>!e._layers[c].isHidden(r))),this._coordsAscending={};for(const c in e.tileManagers){this._coordsAscending[c]={};const f=e.tileManagers[c].getVisibleCoordinates(),g=e.tileManagers[c].getSource(),v=g instanceof bn?g.terrainTileRanges:null;for(const w of f){const S=this.terrain.tileManager.getTerrainCoords(w,v);for(const C in S)this._coordsAscending[c][C]||(this._coordsAscending[c][C]=[]),this._coordsAscending[c][C].push(S[C])}}this._coordsAscendingStr={};for(const c of e._order){const f=e._layers[c],g=f.source;if(Ti[f.type]&&!this._coordsAscendingStr[g]){this._coordsAscendingStr[g]={};for(const v in this._coordsAscending[g])this._coordsAscendingStr[g][v]=this._coordsAscending[g][v].map((w=>w.key)).sort().join()}}for(const c of this._renderableTiles)for(const f in this._coordsAscendingStr){const g=this._coordsAscendingStr[f][c.tileID.key];g&&g!==c.rttCoords[f]&&(c.rtt=[])}}renderLayer(e,r){if(e.isHidden(this.painter.transform.zoom))return!1;const c=Object.assign(Object.assign({},r),{isRenderingToTexture:!0}),f=e.type,g=this.painter,v=this._renderableLayerIds[this._renderableLayerIds.length-1]===e.id;if(Ti[f]&&(this._prevType&&Ti[this._prevType]||this._stacks.push([]),this._prevType=f,this._stacks[this._stacks.length-1].push(e.id),!v))return!0;if(Ti[this._prevType]||Ti[f]&&v){this._prevType=f;const w=this._stacks.length-1,S=this._stacks[w]||[];for(const C of this._renderableTiles){if(this.pool.isFull()&&(hs(this.painter,this.terrain,this._rttTiles,c),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(C),C.rtt[w]){const k=this.pool.getObjectForId(C.rtt[w].id);if(k.stamp===C.rtt[w].stamp){this.pool.useObject(k);continue}}const D=this.pool.getOrCreateFreeObject();this.pool.useObject(D),this.pool.stampObject(D),C.rtt[w]={id:D.id,stamp:D.stamp},g.context.bindFramebuffer.set(D.fbo.framebuffer),g.context.clear({color:h.bo.transparent,stencil:0}),g.currentStencilSource=void 0;for(let k=0;k<S.length;k++){const L=g.style._layers[S[k]],j=L.source?this._coordsAscending[L.source][C.tileID.key]:[C.tileID];g.context.viewport.set([0,0,D.fbo.width,D.fbo.height]),g._renderTileClippingMasks(L,j,!0),g.renderLayer(g,g.style.tileManagers[L.source],L,j,c),L.source&&(C.rttCoords[L.source]=this._coordsAscendingStr[L.source][C.tileID.key])}}return hs(this.painter,this.terrain,this._rttTiles,c),this._rttTiles=[],this.pool.freeAllObjects(),Ti[f]}return!1}}const We={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Si=et,ln={hash:!1,interactive:!0,bearingSnap:7,attributionControl:ma,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:h.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,transformConstrain:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,reduceMotion:void 0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0,experimentalZoomLevelsToOverscale:void 0},ql={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class _o{constructor(e,r,c=!1){this.mousedown=g=>{this.startMove(g,gt.mousePos(this.element,g)),gt.addEventListener(window,"mousemove",this.mousemove),gt.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=g=>{this.move(g,gt.mousePos(this.element,g))},this.mouseup=g=>{this._rotatePitchHandler.dragEnd(g),this.offTemp()},this.touchstart=g=>{g.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=gt.touchPos(this.element,g.targetTouches)[0],this.startMove(g,this._startPos),gt.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),gt.addEventListener(window,"touchend",this.touchend))},this.touchmove=g=>{g.targetTouches.length!==1?this.reset():(this._lastPos=gt.touchPos(this.element,g.targetTouches)[0],this.move(g,this._lastPos))},this.touchend=g=>{g.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHandler.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=r;const f=new tl;this._rotatePitchHandler=new Fr({clickTolerance:3,move:(g,v)=>{const w=r.getBoundingClientRect(),S=new h.P((w.bottom-w.top)/2,(w.right-w.left)/2);return{bearingDelta:h.cw(new h.P(g.x,v.y),v,S),pitchDelta:c?-.5*(v.y-g.y):void 0}},moveStateManager:f,enable:!0,assignEvents:()=>{}}),this.map=e,gt.addEventListener(r,"mousedown",this.mousedown),gt.addEventListener(r,"touchstart",this.touchstart,{passive:!1}),gt.addEventListener(r,"touchcancel",this.reset)}startMove(e,r){this._rotatePitchHandler.dragStart(e,r),gt.disableDrag()}move(e,r){const c=this.map,{bearingDelta:f,pitchDelta:g}=this._rotatePitchHandler.dragMove(e,r)||{};f&&c.setBearing(c.getBearing()+f),g&&c.setPitch(c.getPitch()+g)}off(){const e=this.element;gt.removeEventListener(e,"mousedown",this.mousedown),gt.removeEventListener(e,"touchstart",this.touchstart,{passive:!1}),gt.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),gt.removeEventListener(window,"touchend",this.touchend),gt.removeEventListener(e,"touchcancel",this.reset),this.offTemp()}offTemp(){gt.enableDrag(),gt.removeEventListener(window,"mousemove",this.mousemove),gt.removeEventListener(window,"mouseup",this.mouseup),gt.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),gt.removeEventListener(window,"touchend",this.touchend)}}let Ba;function Vs(m,e,r,c=!1){if(c||!r.getCoveringTilesDetailsProvider().allowWorldCopies())return m?.wrap();const f=new h.V(m.lng,m.lat);if(m=new h.V(m.lng,m.lat),e){const g=new h.V(m.lng-360,m.lat),v=new h.V(m.lng+360,m.lat),w=r.locationToScreenPoint(m).distSqr(e);r.locationToScreenPoint(g).distSqr(e)<w?m=g:r.locationToScreenPoint(v).distSqr(e)<w&&(m=v)}for(;Math.abs(m.lng-r.center.lng)>180;){const g=r.locationToScreenPoint(m);if(g.x>=0&&g.y>=0&&g.x<=r.width&&g.y<=r.height)break;m.lng>r.center.lng?m.lng-=360:m.lng+=360}return m.lng!==f.lng&&r.isPointOnMapSurface(r.locationToScreenPoint(m))?m:f}const Us={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Gs(m,e,r){const c=m.classList;for(const f in Us)c.remove(`maplibregl-${r}-anchor-${f}`);c.add(`maplibregl-${r}-anchor-${e}`)}class Nc extends h.E{constructor(e){if(super(),this._onKeyPress=r=>{const c=r.code,f=r.charCode||r.keyCode;c!=="Space"&&c!=="Enter"&&f!==32&&f!==13||this.togglePopup()},this._onMapClick=r=>{const c=r.originalEvent.target,f=this._element;this._popup&&(c===f||f.contains(c))&&this.togglePopup()},this._update=r=>{if(!this._map)return;const c=this._map.loaded()&&!this._map.isMoving();(r?.type==="terrain"||r?.type==="render"&&!c)&&this._map.once("render",this._update),this._lngLat=Vs(this._lngLat,this._flatPos,this._map.transform),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let f="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?f=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(f=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let g="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?g="rotateX(0deg)":this._pitchAlignment==="map"&&(g=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||r&&r.type!=="moveend"||(this._pos=this._pos.round()),gt.setTransform(this._element,`${Us[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${g} ${f}`),he.frameAsync(new AbortController).then((()=>{this._updateOpacity(r&&r.type==="moveend")})).catch((()=>{}))},this._onMove=r=>{if(!this._isDragging){const c=this._clickTolerance||this._map._clickTolerance;this._isDragging=r.point.dist(this._pointerdownPos)>=c}this._isDragging&&(this._pos=r.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new h.l("dragstart"))),this.fire(new h.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new h.l("dragend")),this._state="inactive"},this._addDragHandler=r=>{this._element.contains(r.originalEvent.target)&&(r.preventDefault(),this._positionDelta=r.point.sub(this._pos).add(this._offset),this._pointerdownPos=r.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._subpixelPositioning=e&&e.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&e.pitchAlignment!=="auto"?e.pitchAlignment:this._rotationAlignment,this.setOpacity(e?.opacity,e?.opacityWhenCovered),e&&e.element)this._element=e.element,this._offset=h.P.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=gt.create("div");const r=gt.createNS("http://www.w3.org/2000/svg","svg"),c=41,f=27;r.setAttributeNS(null,"display","block"),r.setAttributeNS(null,"height",`${c}px`),r.setAttributeNS(null,"width",`${f}px`),r.setAttributeNS(null,"viewBox",`0 0 ${f} ${c}`);const g=gt.createNS("http://www.w3.org/2000/svg","g");g.setAttributeNS(null,"stroke","none"),g.setAttributeNS(null,"stroke-width","1"),g.setAttributeNS(null,"fill","none"),g.setAttributeNS(null,"fill-rule","evenodd");const v=gt.createNS("http://www.w3.org/2000/svg","g");v.setAttributeNS(null,"fill-rule","nonzero");const w=gt.createNS("http://www.w3.org/2000/svg","g");w.setAttributeNS(null,"transform","translate(3.0, 29.0)"),w.setAttributeNS(null,"fill","#000000");const S=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const it of S){const st=gt.createNS("http://www.w3.org/2000/svg","ellipse");st.setAttributeNS(null,"opacity","0.04"),st.setAttributeNS(null,"cx","10.5"),st.setAttributeNS(null,"cy","5.80029008"),st.setAttributeNS(null,"rx",it.rx),st.setAttributeNS(null,"ry",it.ry),w.appendChild(st)}const C=gt.createNS("http://www.w3.org/2000/svg","g");C.setAttributeNS(null,"fill",this._color);const D=gt.createNS("http://www.w3.org/2000/svg","path");D.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),C.appendChild(D);const k=gt.createNS("http://www.w3.org/2000/svg","g");k.setAttributeNS(null,"opacity","0.25"),k.setAttributeNS(null,"fill","#000000");const L=gt.createNS("http://www.w3.org/2000/svg","path");L.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),k.appendChild(L);const j=gt.createNS("http://www.w3.org/2000/svg","g");j.setAttributeNS(null,"transform","translate(6.0, 7.0)"),j.setAttributeNS(null,"fill","#FFFFFF");const Z=gt.createNS("http://www.w3.org/2000/svg","g");Z.setAttributeNS(null,"transform","translate(8.0, 8.0)");const W=gt.createNS("http://www.w3.org/2000/svg","circle");W.setAttributeNS(null,"fill","#000000"),W.setAttributeNS(null,"opacity","0.25"),W.setAttributeNS(null,"cx","5.5"),W.setAttributeNS(null,"cy","5.5"),W.setAttributeNS(null,"r","5.4999962");const Q=gt.createNS("http://www.w3.org/2000/svg","circle");Q.setAttributeNS(null,"fill","#FFFFFF"),Q.setAttributeNS(null,"cx","5.5"),Q.setAttributeNS(null,"cy","5.5"),Q.setAttributeNS(null,"r","5.4999962"),Z.appendChild(W),Z.appendChild(Q),v.appendChild(w),v.appendChild(C),v.appendChild(k),v.appendChild(j),v.appendChild(Z),r.appendChild(v),r.setAttributeNS(null,"height",c*this._scale+"px"),r.setAttributeNS(null,"width",f*this._scale+"px"),this._element.appendChild(r),this._offset=h.P.convert(e&&e.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",(r=>{r.preventDefault()})),this._element.addEventListener("mousedown",(r=>{r.preventDefault()})),Gs(this._element,this._anchor,"marker"),e&&e.className)for(const r of e.className.split(" "))this._element.classList.add(r);this._popup=null}addTo(e){return this.remove(),this._map=e,this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label",e._getUIString("Marker.Title")),this._element.hasAttribute("role")||this._element.setAttribute("role","button"),e.getCanvasContainer().appendChild(this._element),e.on("move",this._update),e.on("moveend",this._update),e.on("terrain",this._update),e.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),gt.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=h.V.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){const f=Math.abs(13.5)/Math.SQRT2;e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[f,-1*(38.1-13.5+f)],"bottom-right":[-f,-1*(38.1-13.5+f)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=e,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(e){return this._subpixelPositioning=e,this}getPopup(){return this._popup}togglePopup(){const e=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:e?(e.isOpen()?e.remove():(e.setLngLat(this._lngLat),e.addTo(this._map)),this):this}_updateOpacity(e=!1){var r,c;const f=(r=this._map)===null||r===void 0?void 0:r.terrain,g=this._map.transform.isLocationOccluded(this._lngLat);if(!f||g){const j=g?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==j&&(this._element.style.opacity=j))}if(e)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout((()=>{this._opacityTimeout=null}),100)}const v=this._map,w=v.terrain.depthAtPoint(this._pos),S=v.terrain.getElevationForLngLatZoom(this._lngLat,v.transform.tileZoom);if(v.transform.lngLatToCameraDepth(this._lngLat,S)-w<.006)return void(this._element.style.opacity=this._opacity);const C=-this._offset.y/v.transform.pixelsPerMeter,D=Math.sin(v.getPitch()*Math.PI/180)*C,k=v.terrain.depthAtPoint(new h.P(this._pos.x,this._pos.y-this._offset.y)),L=v.transform.lngLatToCameraDepth(this._lngLat,S+D)-k>.006;!((c=this._popup)===null||c===void 0)&&c.isOpen()&&L&&this._popup.remove(),this._element.style.opacity=L?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(e){return this._offset=h.P.convert(e),this._update(),this}addClassName(e){this._element.classList.add(e)}removeClassName(e){this._element.classList.remove(e)}toggleClassName(e){return this._element.classList.toggle(e)}setDraggable(e){return this._draggable=!!e,this._map&&(e?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e&&e!=="auto"?e:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(e,r){return(this._opacity===void 0||e===void 0&&r===void 0)&&(this._opacity="1",this._opacityWhenCovered="0.2"),e!==void 0&&(this._opacity=e),r!==void 0&&(this._opacityWhenCovered=r),this._map&&this._updateOpacity(!0),this}}const cn={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let yo=0,qs=!1;const Uu={maxWidth:100,unit:"metric"};function Fc(m,e,r){const c=r&&r.maxWidth||100,f=m._container.clientHeight/2,g=m._container.clientWidth/2,v=m.unproject([g-c/2,f]),w=m.unproject([g+c/2,f]),S=Math.round(m.project(w).x-m.project(v).x),C=Math.min(c,S,m._container.clientWidth),D=v.distanceTo(w);if(r&&r.unit==="imperial"){const k=3.2808*D;k>5280?rl(e,C,k/5280,m._getUIString("ScaleControl.Miles")):rl(e,C,k,m._getUIString("ScaleControl.Feet"))}else r&&r.unit==="nautical"?rl(e,C,D/1852,m._getUIString("ScaleControl.NauticalMiles")):D>=1e3?rl(e,C,D/1e3,m._getUIString("ScaleControl.Kilometers")):rl(e,C,D,m._getUIString("ScaleControl.Meters"))}function rl(m,e,r,c){const f=(function(g){const v=Math.pow(10,`${Math.floor(g)}`.length-1);let w=g/v;return w=w>=10?10:w>=5?5:w>=3?3:w>=2?2:w>=1?1:(function(S){const C=Math.pow(10,Math.ceil(-Math.log(S)/Math.LN10));return Math.round(S*C)/C})(w),v*w})(r);m.style.width=e*(f/r)+"px",m.innerHTML=`${f}&nbsp;${c}`}const Zl={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0},jc=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Hl(m){if(m){if(typeof m=="number"){const e=Math.round(Math.abs(m)/Math.SQRT2);return{center:new h.P(0,0),top:new h.P(0,m),"top-left":new h.P(e,e),"top-right":new h.P(-e,e),bottom:new h.P(0,-m),"bottom-left":new h.P(e,-e),"bottom-right":new h.P(-e,-e),left:new h.P(m,0),right:new h.P(-m,0)}}if(m instanceof h.P||Array.isArray(m)){const e=h.P.convert(m);return{center:e,top:e,"top-left":e,"top-right":e,bottom:e,"bottom-left":e,"bottom-right":e,left:e,right:e}}return{center:h.P.convert(m.center||[0,0]),top:h.P.convert(m.top||[0,0]),"top-left":h.P.convert(m["top-left"]||[0,0]),"top-right":h.P.convert(m["top-right"]||[0,0]),bottom:h.P.convert(m.bottom||[0,0]),"bottom-left":h.P.convert(m["bottom-left"]||[0,0]),"bottom-right":h.P.convert(m["bottom-right"]||[0,0]),left:h.P.convert(m.left||[0,0]),right:h.P.convert(m.right||[0,0])}}return Hl(new h.P(0,0))}const sa=et;P.AJAXError=h.cI,P.Event=h.l,P.Evented=h.E,P.LngLat=h.V,P.MercatorCoordinate=h.aa,P.Point=h.P,P.addProtocol=h.cJ,P.config=h.a,P.removeProtocol=h.cK,P.AttributionControl=$i,P.BoxZoomHandler=Vh,P.CanvasSource=Sl,P.CooperativeGesturesHandler=br,P.DoubleClickZoomHandler=js,P.DragPanHandler=il,P.DragRotateHandler=nl,P.EdgeInsets=Ii,P.FullscreenControl=class extends h.E{constructor(m={}){super(),this._onFullscreenChange=()=>{var e;let r=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((e=r?.shadowRoot)===null||e===void 0)&&e.fullscreenElement;)r=r.shadowRoot.fullscreenElement;r===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,m&&m.container&&(m.container instanceof HTMLElement?this._container=m.container:h.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(m){return this._map=m,this._container||(this._container=this._map.getContainer()),this._controlContainer=gt.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){gt.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const m=this._fullscreenButton=gt.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);gt.create("span","maplibregl-ctrl-icon",m).setAttribute("aria-hidden","true"),m.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const m=this._getTitle();this._fullscreenButton.setAttribute("aria-label",m),this._fullscreenButton.title=m}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new h.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new h.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},P.GeoJSONSource=qi,P.GeolocateControl=class extends h.E{constructor(m){super(),this._onSuccess=e=>{if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new h.l("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(e),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new h.l("geolocate",e)),this._finish()}},this._updateCamera=e=>{const r=new h.V(e.coords.longitude,e.coords.latitude),c=e.coords.accuracy,f=this._map.getBearing(),g=h.e({bearing:f},this.options.fitBoundsOptions),v=Di.fromLngLat(r,c);this._map.fitBounds(v,g,{geolocateSource:!0})},this._updateMarker=e=>{if(e){const r=new h.V(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(r).addTo(this._map),this._userLocationDotMarker.setLngLat(r).addTo(this._map),this._accuracy=e.coords.accuracy,this._updateCircleRadiusIfNeeded()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onUpdate=()=>{this._updateCircleRadiusIfNeeded()},this._onError=e=>{if(this._map){if(e.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=r,this._geolocateButton.setAttribute("aria-label",r),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(e.code===3&&qs)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new h.l("error",e)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",(e=>e.preventDefault())),this._geolocateButton=gt.create("button","maplibregl-ctrl-geolocate",this._container),gt.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=e=>{if(this._map){if(e===!1){h.w("Geolocation support is not available so the GeolocateControl will be disabled.");const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=r,this._geolocateButton.setAttribute("aria-label",r)}else{const r=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=r,this._geolocateButton.setAttribute("aria-label",r)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=gt.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Nc({element:this._dotElement}),this._circleElement=gt.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Nc({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onUpdate),this._map.on("move",this._onUpdate),this._map.on("rotate",this._onUpdate),this._map.on("pitch",this._onUpdate)),this._geolocateButton.addEventListener("click",(()=>this.trigger())),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(r=>{const c=r?.[0]instanceof ResizeObserverEntry;r.geolocateSource||this._watchState!=="ACTIVE_LOCK"||c||this._map.isZooming()||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new h.l("trackuserlocationend")),this.fire(new h.l("userlocationlostfocus")))}))}},this.options=h.e({},cn,m)}onAdd(m){return this._map=m,this._container=gt.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),(function(){return h._(this,arguments,void 0,(function*(e=!1){if(Ba!==void 0&&!e)return Ba;if(window.navigator.permissions===void 0)return Ba=!!window.navigator.geolocation,Ba;try{Ba=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{Ba=!!window.navigator.geolocation}return Ba}))})().then((e=>this._finishSetupUI(e))),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),gt.remove(this._container),this._map.off("zoom",this._onUpdate),this._map.off("move",this._onUpdate),this._map.off("rotate",this._onUpdate),this._map.off("pitch",this._onUpdate),this._map=void 0,yo=0,qs=!1}_isOutOfMapMaxBounds(m){const e=this._map.getMaxBounds(),r=m.coords;return e&&(r.longitude<e.getWest()||r.longitude>e.getEast()||r.latitude<e.getSouth()||r.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":case"BACKGROUND_ERROR":case"OFF":case void 0:break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadiusIfNeeded(){const m=this._userLocationDotMarker.getLngLat();if(!(this.options.showUserLocation&&this.options.showAccuracyCircle&&this._accuracy&&m))return;const e=this._map.project(m),r=this._map.unproject([e.x+100,e.y]),c=m.distanceTo(r)/100,f=2*this._accuracy/c;this._circleElement.style.width=`${f.toFixed(2)}px`,this._circleElement.style.height=`${f.toFixed(2)}px`}trigger(){if(!this._setup)return h.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new h.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":yo--,qs=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new h.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new h.l("trackuserlocationstart")),this.fire(new h.l("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let m;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),yo++,yo>1?(m={maximumAge:6e5,timeout:0},qs=!0):(m=this.options.positionOptions,qs=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,m)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},P.GlobeControl=class{constructor(){this._toggleProjection=()=>{var m;const e=(m=this._map.getProjection())===null||m===void 0?void 0:m.type;this._map.setProjection(e!=="mercator"&&e?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var m;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),((m=this._map.getProjection())===null||m===void 0?void 0:m.type)==="globe"?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(m){return this._map=m,this._container=gt.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=gt.create("button","maplibregl-ctrl-globe",this._container),gt.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){gt.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},P.Hash=$n,P.ImageSource=bn,P.KeyboardHandler=Fs,P.LngLatBounds=Di,P.LogoControl=Yn,P.Map=class extends ju{constructor(m){var e,r;h.cF.mark(h.cG.create);const c=Object.assign(Object.assign(Object.assign({},ln),m),{canvasContextAttributes:Object.assign(Object.assign({},ln.canvasContextAttributes),m.canvasContextAttributes)});if(c.minZoom!=null&&c.maxZoom!=null&&c.minZoom>c.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(c.minPitch!=null&&c.maxPitch!=null&&c.minPitch>c.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(c.minPitch!=null&&c.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(c.maxPitch!=null&&c.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");const f=new Ni,g=new ua;if(c.minZoom!==void 0&&f.setMinZoom(c.minZoom),c.maxZoom!==void 0&&f.setMaxZoom(c.maxZoom),c.minPitch!==void 0&&f.setMinPitch(c.minPitch),c.maxPitch!==void 0&&f.setMaxPitch(c.maxPitch),c.renderWorldCopies!==void 0&&f.setRenderWorldCopies(c.renderWorldCopies),c.transformConstrain!==null&&f.setConstrainOverride(c.transformConstrain),super(f,g,{bearingSnap:c.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new Vu,this._controls=[],this._mapId=h.ag(),this._lostContextStyle={style:null,images:null},this._contextLost=w=>{w.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.painter.destroy();for(const S of Object.values(this.style._layers))if(S.type==="custom"&&console.warn(`Custom layer with id '${S.id}' cannot be restored after WebGL context loss. You will need to re-add it manually after context restoration.`),S._listeners)for(const[C]of Object.entries(S._listeners))console.warn(`Custom layer with id '${S.id}' had event listeners for event '${C}' which cannot be restored after WebGL context loss. You will need to re-add them manually after context restoration.`);this._lostContextStyle=this._getStyleAndImages(),this.style.destroy(),this.style=null,this.fire(new h.l("webglcontextlost",{originalEvent:w}))},this._contextRestored=w=>{this._lostContextStyle.style&&this.setStyle(this._lostContextStyle.style,{diff:!1}),this._lostContextStyle.images&&(this.style.imageManager.images=this._lostContextStyle.images),this._setupPainter(),this.resize(),this._update(),this.fire(new h.l("webglcontextrestored",{originalEvent:w}))},this._onMapScroll=w=>{if(w.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=c.interactive,this._maxTileCacheSize=c.maxTileCacheSize,this._maxTileCacheZoomLevels=c.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},c.canvasContextAttributes),this._trackResize=c.trackResize===!0,this._bearingSnap=c.bearingSnap,this._centerClampedToGround=c.centerClampedToGround,this._refreshExpiredTiles=c.refreshExpiredTiles===!0,this._fadeDuration=c.fadeDuration,this._crossSourceCollisions=c.crossSourceCollisions===!0,this._collectResourceTiming=c.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},We),c.locale),this._clickTolerance=c.clickTolerance,this._overridePixelRatio=c.pixelRatio,this._maxCanvasSize=c.maxCanvasSize,this._zoomLevelsToOverscale=c.experimentalZoomLevelsToOverscale,this.transformCameraUpdate=c.transformCameraUpdate,this.transformConstrain=c.transformConstrain,this.cancelPendingTileRequestsWhileZooming=c.cancelPendingTileRequestsWhileZooming===!0,c.reduceMotion!==void 0&&(he.prefersReducedMotion=c.reduceMotion),this._imageQueueHandle=pe.addThrottleControl((()=>this.isMoving())),this._requestManager=new pi(c.transformRequest),typeof c.container=="string"){if(this._container=document.getElementById(c.container),!this._container)throw new Error(`Container '${c.container}' not found.`)}else{if(!(c.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=c.container}if(c.maxBounds&&this.setMaxBounds(c.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),this.on("terrain",(()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)})),this.once("idle",(()=>{this._idleTriggered=!0})),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let w=!1;const S=ks((C=>{this._trackResize&&!this._removed&&(this.resize(C),this.redraw())}),50);this._resizeObserver=new ResizeObserver((C=>{w?S(C):w=!0})),this._resizeObserver.observe(this._container)}this.handlers=new al(this,c),this._hash=c.hash&&new $n(typeof c.hash=="string"&&c.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:c.center,elevation:c.elevation,zoom:c.zoom,bearing:c.bearing,pitch:c.pitch,roll:c.roll}),c.bounds&&(this.resize(),this.fitBounds(c.bounds,h.e({},c.fitBoundsOptions,{duration:0}))));const v=typeof c.style=="string"||((r=(e=c.style)===null||e===void 0?void 0:e.projection)===null||r===void 0?void 0:r.type)!=="globe";this.resize(null,v),this._localIdeographFontFamily=c.localIdeographFontFamily,this._validateStyle=c.validateStyle,c.style&&this.setStyle(c.style,{localIdeographFontFamily:c.localIdeographFontFamily}),c.attributionControl&&this.addControl(new $i(typeof c.attributionControl=="boolean"?void 0:c.attributionControl)),c.maplibreLogo&&this.addControl(new Yn,c.logoPosition),this.on("style.load",(()=>{if(v||this._resizeTransform(),this.transform.unmodified){const w=h.U(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(w)}})),this.on("data",(w=>{this._update(w.dataType==="style"),this.fire(new h.l(`${w.dataType}data`,w))})),this.on("dataloading",(w=>{this.fire(new h.l(`${w.dataType}dataloading`,w))})),this.on("dataabort",(w=>{this.fire(new h.l("sourcedataabort",w))}))}_getMapId(){return this._mapId}setGlobalStateProperty(m,e){return this.style.setGlobalStateProperty(m,e),this._update(!0)}getGlobalState(){return this.style.getGlobalState()}addControl(m,e){if(e===void 0&&(e=m.getDefaultPosition?m.getDefaultPosition():"top-right"),!m||!m.onAdd)return this.fire(new h.k(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const r=m.onAdd(this);this._controls.push(m);const c=this._controlPositions[e];return e.indexOf("bottom")!==-1?c.insertBefore(r,c.firstChild):c.appendChild(r),this}removeControl(m){if(!m||!m.onRemove)return this.fire(new h.k(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const e=this._controls.indexOf(m);return e>-1&&this._controls.splice(e,1),m.onRemove(this),this}hasControl(m){return this._controls.indexOf(m)>-1}coveringTiles(m){return je(this.transform,m)}calculateCameraOptionsFromTo(m,e,r,c){return c==null&&this.terrain&&(c=this.terrain.getElevationForLngLatZoom(r,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(m,e,r,c)}resize(m,e=!0){const[r,c]=this._containerDimensions(),f=this._getClampedPixelRatio(r,c);if(this._resizeCanvas(r,c,f),this.painter.resize(r,c,f),this.painter.overLimit()){const v=this.painter.context.gl;this._maxCanvasSize=[v.drawingBufferWidth,v.drawingBufferHeight];const w=this._getClampedPixelRatio(r,c);this._resizeCanvas(r,c,w),this.painter.resize(r,c,w)}this._resizeTransform(e);const g=!this._moving;return g&&(this.stop(),this.fire(new h.l("movestart",m)).fire(new h.l("move",m))),this.fire(new h.l("resize",m)),g&&this.fire(new h.l("moveend",m)),this}_resizeTransform(m=!0){var e;const[r,c]=this._containerDimensions();this.transform.resize(r,c,m),(e=this._requestedCameraState)===null||e===void 0||e.resize(r,c,m)}_getClampedPixelRatio(m,e){const{0:r,1:c}=this._maxCanvasSize,f=this.getPixelRatio(),g=m*f,v=e*f;return Math.min(g>r?r/g:1,v>c?c/v:1)*f}getPixelRatio(){var m;return(m=this._overridePixelRatio)!==null&&m!==void 0?m:devicePixelRatio}setPixelRatio(m){this._overridePixelRatio=m,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(m){return this.transform.setMaxBounds(Di.convert(m)),this._update()}setMinZoom(m){if((m=m??-2)>=-2&&m<=this.transform.maxZoom)return this.transform.setMinZoom(m),this._update(),this.getZoom()<m&&this.setZoom(m),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(m){if((m=m??22)>=this.transform.minZoom)return this.transform.setMaxZoom(m),this._update(),this.getZoom()>m&&this.setZoom(m),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(m){if((m=m??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(m>=0&&m<=this.transform.maxPitch)return this.transform.setMinPitch(m),this._update(),this.getPitch()<m&&this.setPitch(m),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(m){if((m=m??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(m>=this.transform.minPitch)return this.transform.setMaxPitch(m),this._update(),this.getPitch()>m&&this.setPitch(m),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(m){return this.transform.setRenderWorldCopies(m),this._update()}setTransformConstrain(m){return this.transform.setConstrainOverride(m),this._update()}project(m){return this.transform.locationToScreenPoint(h.V.convert(m),this.style&&this.terrain)}unproject(m){return this.transform.screenPointToLocation(h.P.convert(m),this.terrain)}isMoving(){var m;return this._moving||((m=this.handlers)===null||m===void 0?void 0:m.isMoving())}isZooming(){var m;return this._zooming||((m=this.handlers)===null||m===void 0?void 0:m.isZooming())}isRotating(){var m;return this._rotating||((m=this.handlers)===null||m===void 0?void 0:m.isRotating())}_createDelegatedListener(m,e,r){if(m==="mouseenter"||m==="mouseover"){let c=!1;return{layers:e,listener:r,delegates:{mousemove:g=>{const v=e.filter((S=>this.getLayer(S))),w=v.length!==0?this.queryRenderedFeatures(g.point,{layers:v}):[];w.length?c||(c=!0,r.call(this,new en(m,this,g.originalEvent,{features:w}))):c=!1},mouseout:()=>{c=!1}}}}if(m==="mouseleave"||m==="mouseout"){let c=!1;return{layers:e,listener:r,delegates:{mousemove:v=>{const w=e.filter((S=>this.getLayer(S)));(w.length!==0?this.queryRenderedFeatures(v.point,{layers:w}):[]).length?c=!0:c&&(c=!1,r.call(this,new en(m,this,v.originalEvent)))},mouseout:v=>{c&&(c=!1,r.call(this,new en(m,this,v.originalEvent)))}}}}{const c=f=>{const g=e.filter((w=>this.getLayer(w))),v=g.length!==0?this.queryRenderedFeatures(f.point,{layers:g}):[];v.length&&(f.features=v,r.call(this,f),delete f.features)};return{layers:e,listener:r,delegates:{[m]:c}}}}_saveDelegatedListener(m,e){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[m]=this._delegatedListeners[m]||[],this._delegatedListeners[m].push(e)}_removeDelegatedListener(m,e,r){if(!this._delegatedListeners||!this._delegatedListeners[m])return;const c=this._delegatedListeners[m];for(let f=0;f<c.length;f++){const g=c[f];if(g.listener===r&&g.layers.length===e.length&&g.layers.every((v=>e.includes(v)))){for(const v in g.delegates)this.off(v,g.delegates[v]);return void c.splice(f,1)}}}on(m,e,r){if(r===void 0)return super.on(m,e);const c=typeof e=="string"?[e]:e,f=this._createDelegatedListener(m,c,r);this._saveDelegatedListener(m,f);for(const g in f.delegates)this.on(g,f.delegates[g]);return{unsubscribe:()=>{this._removeDelegatedListener(m,c,r)}}}once(m,e,r){if(r===void 0)return super.once(m,e);const c=typeof e=="string"?[e]:e,f=this._createDelegatedListener(m,c,r);for(const g in f.delegates){const v=f.delegates[g];f.delegates[g]=(...w)=>{this._removeDelegatedListener(m,c,r),v(...w)}}this._saveDelegatedListener(m,f);for(const g in f.delegates)this.once(g,f.delegates[g]);return this}off(m,e,r){return r===void 0?super.off(m,e):(this._removeDelegatedListener(m,typeof e=="string"?[e]:e,r),this)}queryRenderedFeatures(m,e){if(!this.style)return[];let r;const c=m instanceof h.P||Array.isArray(m),f=c?m:[[0,0],[this.transform.width,this.transform.height]];if(e=e||(c?{}:m)||{},f instanceof h.P||typeof f[0]=="number")r=[h.P.convert(f)];else{const g=h.P.convert(f[0]),v=h.P.convert(f[1]);r=[g,new h.P(v.x,g.y),v,new h.P(g.x,v.y),g]}return this.style.queryRenderedFeatures(r,e,this.transform)}querySourceFeatures(m,e){return this.style.querySourceFeatures(m,e)}setStyle(m,e){return(e=h.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},e)).diff!==!1&&e.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&m?(this._diffStyle(m,e),this):(this._localIdeographFontFamily=e.localIdeographFontFamily,this._updateStyle(m,e))}setTransformRequest(m){return this._requestManager.setTransformRequest(m),this}_getUIString(m){const e=this._locale[m];if(e==null)throw new Error(`Missing UI string '${m}'`);return e}_updateStyle(m,e){var r,c;if(e.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",(()=>this._updateStyle(m,e)));const f=this.style&&e.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!m)),m?(this.style=new xc(this,e||{}),this.style.setEventedParent(this,{style:this.style}),typeof m=="string"?this.style.loadURL(m,e,f):this.style.loadJSON(m,e,f),this):((c=(r=this.style)===null||r===void 0?void 0:r.projection)===null||c===void 0||c.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new xc(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(m,e){if(typeof m=="string"){const r=this._requestManager.transformRequest(m,"Style");h.j(r,new AbortController).then((c=>{this._updateDiff(c.data,e)})).catch((c=>{c&&this.fire(new h.k(c))}))}else typeof m=="object"&&this._updateDiff(m,e)}_updateDiff(m,e){try{this.style.setState(m,e)&&this._update(!0)}catch(r){h.w(`Unable to perform style diff: ${r.message||r.error||r}.  Rebuilding the style from scratch.`),this._updateStyle(m,e)}}getStyle(){if(this.style)return this.style.serialize()}_getStyleAndImages(){return this.style?{style:this.style.serialize(),images:this.style.imageManager.cloneImages()}:{style:null,images:{}}}isStyleLoaded(){return this.style?this.style.loaded():h.w("There is no style added to the map.")}addSource(m,e){return this._lazyInitEmptyStyle(),this.style.addSource(m,e),this._update(!0)}isSourceLoaded(m){const e=this.style&&this.style.tileManagers[m];if(e!==void 0)return e.loaded();this.fire(new h.k(new Error(`There is no tile manager with ID '${m}'`)))}setTerrain(m){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),m){const e=this.style.tileManagers[m.source];if(!e)throw new Error(`cannot load terrain, because there exists no source with ID: ${m.source}`);this.terrain===null&&e.reload();for(const r in this.style._layers){const c=this.style._layers[r];c.type==="hillshade"&&c.source===m.source&&h.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality."),c.type==="color-relief"&&c.source===m.source&&h.w("You are using the same source for a color-relief layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new sr(this.painter,e,m),this.painter.renderToTexture=new zi(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=r=>{var c;r.dataType==="style"?this.terrain.tileManager.freeRtt():r.dataType==="source"&&r.tile&&(r.sourceId!==m.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),((c=r.source)===null||c===void 0?void 0:c.type)==="image"?this.terrain.tileManager.freeRtt():this.terrain.tileManager.freeRtt(r.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.tileManager.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new h.l("terrain",{terrain:m})),this}getTerrain(){var m,e;return(e=(m=this.terrain)===null||m===void 0?void 0:m.options)!==null&&e!==void 0?e:null}areTilesLoaded(){const m=this.style&&this.style.tileManagers;for(const e in m){const r=m[e]._tiles;for(const c in r){const f=r[c];if(f.state!=="loaded"&&f.state!=="errored")return!1}}return!0}removeSource(m){return this.style.removeSource(m),this._update(!0)}getSource(m){return this.style.getSource(m)}setSourceTileLodParams(m,e,r){if(r){const c=this.getSource(r);if(!c)throw new Error(`There is no source with ID "${r}", cannot set LOD parameters`);c.calculateTileZoom=Ut(Math.max(1,m),Math.max(1,e))}else for(const c in this.style.tileManagers)this.style.tileManagers[c].getSource().calculateTileZoom=Ut(Math.max(1,m),Math.max(1,e));return this._update(!0),this}refreshTiles(m,e){const r=this.style.tileManagers[m];if(!r)throw new Error(`There is no tile manager with ID "${m}", cannot refresh tile`);e===void 0?r.reload(!0):r.refreshTiles(e.map((c=>new h.ad(c.z,c.x,c.y))))}addImage(m,e,r={}){const{pixelRatio:c=1,sdf:f=!1,stretchX:g,stretchY:v,content:w,textFitWidth:S,textFitHeight:C}=r;if(this._lazyInitEmptyStyle(),!(e instanceof HTMLImageElement||h.b(e))){if(e.width===void 0||e.height===void 0)return this.fire(new h.k(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:D,height:k,data:L}=e,j=e;return this.style.addImage(m,{data:new h.R({width:D,height:k},new Uint8Array(L)),pixelRatio:c,stretchX:g,stretchY:v,content:w,textFitWidth:S,textFitHeight:C,sdf:f,version:0,userImage:j}),j.onAdd&&j.onAdd(this,m),this}}{const{width:D,height:k,data:L}=he.getImageData(e);this.style.addImage(m,{data:new h.R({width:D,height:k},L),pixelRatio:c,stretchX:g,stretchY:v,content:w,textFitWidth:S,textFitHeight:C,sdf:f,version:0})}}updateImage(m,e){const r=this.style.getImage(m);if(!r)return this.fire(new h.k(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const c=e instanceof HTMLImageElement||h.b(e)?he.getImageData(e):e,{width:f,height:g,data:v}=c;if(f===void 0||g===void 0)return this.fire(new h.k(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(f!==r.data.width||g!==r.data.height)return this.fire(new h.k(new Error("The width and height of the updated image must be that same as the previous version of the image")));const w=!(e instanceof HTMLImageElement||h.b(e));return r.data.replace(v,w),this.style.updateImage(m,r),this}getImage(m){return this.style.getImage(m)}hasImage(m){return m?!!this.style.getImage(m):(this.fire(new h.k(new Error("Missing required image id"))),!1)}removeImage(m){this.style.removeImage(m)}loadImage(m){return pe.getImage(this._requestManager.transformRequest(m,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(m,e){return this._lazyInitEmptyStyle(),this.style.addLayer(m,e),this._update(!0)}moveLayer(m,e){return this.style.moveLayer(m,e),this._update(!0)}removeLayer(m){return this.style.removeLayer(m),this._update(!0)}getLayer(m){return this.style.getLayer(m)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(m,e,r){return this.style.setLayerZoomRange(m,e,r),this._update(!0)}setFilter(m,e,r={}){return this.style.setFilter(m,e,r),this._update(!0)}getFilter(m){return this.style.getFilter(m)}setPaintProperty(m,e,r,c={}){return this.style.setPaintProperty(m,e,r,c),this._update(!0)}getPaintProperty(m,e){return this.style.getPaintProperty(m,e)}setLayoutProperty(m,e,r,c={}){return this.style.setLayoutProperty(m,e,r,c),this._update(!0)}getLayoutProperty(m,e){return this.style.getLayoutProperty(m,e)}setGlyphs(m,e={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(m,e),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(m,e,r={}){return this._lazyInitEmptyStyle(),this.style.addSprite(m,e,r,(c=>{c||this._update(!0)})),this}removeSprite(m){return this._lazyInitEmptyStyle(),this.style.removeSprite(m),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(m,e={}){return this._lazyInitEmptyStyle(),this.style.setSprite(m,e,(r=>{r||this._update(!0)})),this}setLight(m,e={}){return this._lazyInitEmptyStyle(),this.style.setLight(m,e),this._update(!0)}getLight(){return this.style.getLight()}setSky(m,e={}){return this._lazyInitEmptyStyle(),this.style.setSky(m,e),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(m,e){return this.style.setFeatureState(m,e),this._update()}removeFeatureState(m,e){return this.style.removeFeatureState(m,e),this._update()}getFeatureState(m){return this.style.getFeatureState(m)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let m=0,e=0;return this._container&&(m=this._container.clientWidth||400,e=this._container.clientHeight||300),[m,e]}_setupContainer(){const m=this._container;m.classList.add("maplibregl-map");const e=this._canvasContainer=gt.create("div","maplibregl-canvas-container",m);this._interactive&&e.classList.add("maplibregl-interactive"),this._canvas=gt.create("canvas","maplibregl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const r=this._containerDimensions(),c=this._getClampedPixelRatio(r[0],r[1]);this._resizeCanvas(r[0],r[1],c);const f=this._controlContainer=gt.create("div","maplibregl-control-container",m),g=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((v=>{g[v]=gt.create("div",`maplibregl-ctrl-${v} `,f)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(m,e,r){this._canvas.width=Math.floor(r*m),this._canvas.height=Math.floor(r*e),this._canvas.style.width=`${m}px`,this._canvas.style.height=`${e}px`}_setupPainter(){const m=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0});let e=null;this._canvas.addEventListener("webglcontextcreationerror",(c=>{e={requestedAttributes:m},c&&(e.statusMessage=c.statusMessage,e.type=c.type)}),{once:!0});let r=null;if(r=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,m):this._canvas.getContext("webgl2",m)||this._canvas.getContext("webgl",m),!r){const c="Failed to initialize WebGL";throw e?(e.message=c,new Error(JSON.stringify(e))):new Error(c)}this.painter=new Ic(r,this.transform),Yt.testSupport(r)}migrateProjection(m,e){super.migrateProjection(m,e),this.painter.transform=m,this.fire(new h.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(m){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||m,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(m){return this._update(),this._renderTaskQueue.add(m)}_cancelRenderFrame(m){this._renderTaskQueue.remove(m)}_render(m){var e,r,c,f,g;const v=this._idleTriggered?this._fadeDuration:0,w=((e=this.style.projection)===null||e===void 0?void 0:e.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(m),this._removed)return;let S=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const k=this.transform.zoom,L=Kt();this.style.zoomHistory.update(k,L);const j=new h.H(k,{now:L,fadeDuration:v,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),Z=j.crossFadingFactor();Z===1&&Z===this._crossFadingFactor||(S=!0,this._crossFadingFactor=Z),this.style.update(j)}const C=((r=this.style.projection)===null||r===void 0?void 0:r.transitionState)>0!==w;(c=this.style.projection)===null||c===void 0||c.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((f=this.style.projection)===null||f===void 0?void 0:f.transitionState,(g=this.style.projection)===null||g===void 0?void 0:g.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||C)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.tileManager.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,v,this._crossSourceCollisions,C),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:v,showPadding:this.showPadding}),this.fire(new h.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,h.cF.mark(h.cG.load),this.fire(new h.l("load"))),this.style&&(this.style.hasTransitions()||S)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const D=this._sourcesDirty||this._styleDirty||this._placementDirty;return D||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new h.l("idle")),!this._loaded||this._fullyLoaded||D||(this._fullyLoaded=!0,h.cF.mark(h.cG.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var m;this._hash&&this._hash.remove();for(const r of this._controls)r.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),pe.removeThrottleControl(this._imageQueueHandle),(m=this._resizeObserver)===null||m===void 0||m.disconnect();const e=this.painter.context.gl.getExtension("WEBGL_lose_context");e?.loseContext&&e.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),gt.remove(this._canvasContainer),gt.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),h.cF.clearMetrics(),this._removed=!0,this.fire(new h.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,he.frame(this._frameRequest,(m=>{h.cF.frame(m),this._frameRequest=null;try{this._render(m)}catch(e){if(!h.cH(e)&&!(function(r){return r.message===Ol})(e))throw e}}),(()=>{})))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(m){this._showTileBoundaries!==m&&(this._showTileBoundaries=m,this._update())}get showPadding(){return!!this._showPadding}set showPadding(m){this._showPadding!==m&&(this._showPadding=m,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(m){this._showCollisionBoxes!==m&&(this._showCollisionBoxes=m,m?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(m){this._showOverdrawInspector!==m&&(this._showOverdrawInspector=m,this._update())}get repaint(){return!!this._repaint}set repaint(m){this._repaint!==m&&(this._repaint=m,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(m){this._vertices=m,this._update()}get version(){return Si}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(m){return this._lazyInitEmptyStyle(),this.style.setProjection(m),this._update(!0)}},P.MapMouseEvent=en,P.MapTouchEvent=fs,P.MapWheelEvent=yr,P.Marker=Nc,P.NavigationControl=class{constructor(m){this._updateZoomButtons=()=>{const e=this._map.getZoom(),r=e===this._map.getMaxZoom(),c=e===this._map.getMinZoom();this._zoomInButton.disabled=r,this._zoomOutButton.disabled=c,this._zoomInButton.setAttribute("aria-disabled",r.toString()),this._zoomOutButton.setAttribute("aria-disabled",c.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(e,r)=>{const c=this._map._getUIString(`NavigationControl.${r}`);e.title=c,e.setAttribute("aria-label",c)},this.options=h.e({},ql,m),this._container=gt.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",(e=>e.preventDefault())),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",(e=>this._map.zoomIn({},{originalEvent:e}))),gt.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",(e=>this._map.zoomOut({},{originalEvent:e}))),gt.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",(e=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:e}):this._map.resetNorth({},{originalEvent:e})})),this._compassIcon=gt.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(m){return this._map=m,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new _o(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){gt.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(m,e){const r=gt.create("button",m,this._container);return r.type="button",r.addEventListener("click",e),r}},P.Popup=class extends h.E{constructor(m){super(),this._updateOpacity=()=>{this.options.locationOccludedOpacity!==void 0&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?`${this.options.locationOccludedOpacity}`:"")},this.remove=()=>(this._content&&gt.remove(this._content),this._container&&(gt.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new h.l("close"))),this),this._onMouseUp=e=>{this._update(e.point)},this._onMouseMove=e=>{this._update(e.point)},this._onDrag=e=>{this._update(e.point)},this._update=e=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=gt.create("div","maplibregl-popup",this._map.getContainer()),this._tip=gt.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const v of this.options.className.split(" "))this._container.classList.add(v);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=Vs(this._lngLat,this._flatPos,this._map.transform,this._trackPointer),this._trackPointer&&!e)return;const r=this._flatPos=this._pos=this._trackPointer&&e?e:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&e?e:this._map.transform.locationToScreenPoint(this._lngLat));let c=this.options.anchor;const f=Hl(this.options.offset);if(!c){const v=this._container.offsetWidth,w=this._container.offsetHeight;let S;S=r.y+f.bottom.y<w?["top"]:r.y>this._map.transform.height-w?["bottom"]:[],r.x<v/2?S.push("left"):r.x>this._map.transform.width-v/2&&S.push("right"),c=S.length===0?"bottom":S.join("-")}let g=r.add(f[c]);this.options.subpixelPositioning||(g=g.round()),gt.setTransform(this._container,`${Us[c]} translate(${g.x}px,${g.y}px)`),Gs(this._container,c,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=h.e(Object.create(Zl),m)}addTo(m){return this._map&&this.remove(),this._map=m,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new h.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(m){return this._lngLat=h.V.convert(m),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(m){return this.setDOMContent(document.createTextNode(m))}setHTML(m){const e=document.createDocumentFragment(),r=document.createElement("body");let c;for(r.innerHTML=m;c=r.firstChild,c;)e.appendChild(c);return this.setDOMContent(e)}getMaxWidth(){var m;return(m=this._container)===null||m===void 0?void 0:m.style.maxWidth}setMaxWidth(m){return this.options.maxWidth=m,this._update(),this}setDOMContent(m){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=gt.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(m),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(m){return this._container&&this._container.classList.add(m),this}removeClassName(m){return this._container&&this._container.classList.remove(m),this}setOffset(m){return this.options.offset=m,this._update(),this}toggleClassName(m){if(this._container)return this._container.classList.toggle(m)}setSubpixelPositioning(m){this.options.subpixelPositioning=m}_createCloseButton(){this.options.closeButton&&(this._closeButton=gt.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const m=this._container.querySelector(jc);m&&m.focus()}},P.RasterDEMTileSource=Qi,P.RasterTileSource=ca,P.ScaleControl=class{constructor(m){this._onMove=()=>{Fc(this._map,this._container,this.options)},this.setUnit=e=>{this.options.unit=e,Fc(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},Uu),m)}getDefaultPosition(){return"bottom-left"}onAdd(m){return this._map=m,this._container=gt.create("div","maplibregl-ctrl maplibregl-ctrl-scale",m.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){gt.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},P.ScrollZoomHandler=xr,P.Style=xc,P.TerrainControl=class{constructor(m){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=m}onAdd(m){return this._map=m,this._container=gt.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=gt.create("button","maplibregl-ctrl-terrain",this._container),gt.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){gt.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},P.TwoFingersTouchPitchHandler=Ns,P.TwoFingersTouchRotateHandler=Gl,P.TwoFingersTouchZoomHandler=Oc,P.TwoFingersTouchZoomRotateHandler=Gh,P.VectorTileSource=An,P.VideoSource=Io,P.addSourceType=(m,e)=>h._(void 0,void 0,void 0,(function*(){if(El(m))throw new Error(`A source type called "${m}" already exists.`);((r,c)=>{Wr[r]=c})(m,e)})),P.clearPrewarmedResources=function(){const m=Ue;m&&(m.isPreloaded()&&m.numActive()===1?(m.release(Te),Ue=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},P.createTileMesh=_c,P.getMaxParallelImageRequests=function(){return h.a.MAX_PARALLEL_IMAGE_REQUESTS},P.getRTLTextPluginStatus=function(){return za().getRTLTextPluginStatus()},P.getVersion=function(){return sa},P.getWorkerCount=function(){return be.workerCount},P.getWorkerUrl=function(){return h.a.WORKER_URL},P.importScriptInWorkers=function(m){return Qe().broadcast("IS",m)},P.isTimeFrozen=function(){return xe.isFrozen()},P.now=Kt,P.prewarm=function(){mi().acquire(Te)},P.restoreNow=function(){xe.restoreNow()},P.setMaxParallelImageRequests=function(m){h.a.MAX_PARALLEL_IMAGE_REQUESTS=m},P.setNow=function(m){xe.setNow(m)},P.setRTLTextPlugin=function(m,e){return za().setRTLTextPlugin(m,e)},P.setWorkerCount=function(m){be.workerCount=m},P.setWorkerUrl=function(m){h.a.WORKER_URL=m}}));var yt=nt;return yt}))})(Km)),Km.exports}var Fv=Nv();const Yp=X_(Fv),Wp=[{name:"Food",color:"#e53935"},{name:"ViewPoint",color:"#3949ab"},{name:"Museum",color:"#00897b"},{name:"Other",color:"#fbc02d"}],O_="dots_custom_categories";function Bg(){try{const B=localStorage.getItem(O_);return B?JSON.parse(B):[]}catch{return[]}}function jv(B,Y){const nt=Bg();nt.find(q=>q.name===B)||(nt.push({name:B,color:Y}),localStorage.setItem(O_,JSON.stringify(nt)))}function Vv({show:B,onClose:Y,onSave:nt,onDelete:q,onAddComment:lt,onEditPin:yt,onLikeComment:P,onReplyComment:h,locationName:et,lat:ft,lng:Bt,viewPin:Dt}){const se=Mt.useRef(),he=Mt.useRef(),xe=Mt.useRef(),Kt=Mt.useRef(),[gt,Yt]=Mt.useState(Wp[0].name),[Pt,At]=Mt.useState(""),[ce,ue]=Mt.useState("#1976d2"),[we,pe]=Mt.useState(Bg()),[pi,$e]=Mt.useState(!1),[Ai,sn]=Mt.useState(""),[on,va]=Mt.useState(""),[On,Zn]=Mt.useState([]),[$t,de]=Mt.useState(""),[Ne,Re]=Mt.useState(""),[si,bt]=Mt.useState(null),Ht=er();function _e(be){if(!Ht){alert("Please log in to add to wishlist");return}try{const Ie="dots_wishlist",Ue=JSON.parse(localStorage.getItem(Ie)||"{}"),Ke=Ue[Ht.email]||[];if(Ke.some(Qe=>Qe.place===be.name&&Qe.location===be.locationName)){alert("This place is already in your wishlist!");return}const dn={id:Date.now(),place:be.name,location:be.locationName,description:be.comment||"",status:"pending",createdAt:new Date().toISOString(),visitedAt:null,pinId:be.id};Ke.push(dn),Ue[Ht.email]=Ke,localStorage.setItem(Ie,JSON.stringify(Ue)),alert("Added to your wishlist!")}catch(Ie){console.error("Error adding to wishlist:",Ie),alert("Failed to add to wishlist. Please try again.")}}if(Mt.useEffect(()=>{Yt(Wp[0].name),At(""),ue("#1976d2"),pe(Bg()),$e(!1),bt(null),Dt&&(sn(Dt.name||""),va(Dt.comment||""),Zn(Dt.photos||[]),de(Dt.category||""),Re(Dt.color||"#1976d2"))},[B,Dt]),!B)return null;if(Dt){let be=function(){if(!Ht){alert("Please log in to comment");return}const Qe=Kt.current.value.trim();Qe&&lt&&(lt(Dt.id,{text:Qe,author:{name:Ht.name,email:Ht.email},createdAt:new Date().toISOString(),likes:[],replies:[],replyTo:si}),Kt.current.value="",bt(null))},Ie=function(){yt&&(yt(Dt.id,{name:Ai,comment:on,photos:On,category:$t,color:Ne}),$e(!1))},Ue=function(Qe){Zn(qe=>qe.filter((Ki,oi)=>oi!==Qe))},Ke=function(Qe){const qe=Qe.target.files;if(qe&&qe.length){const Ki=5-On.length;if(Ki<=0){alert("Maximum 5 photos allowed");return}const oi=Array.from(qe).slice(0,Ki);qe.length>Ki&&alert(`Only ${Ki} more photo(s) can be added (max 5 total)`);const ia=oi.map(xn=>new Promise((Di,Cn)=>{const An=new FileReader;An.onload=ca=>{const Qi=new Image;Qi.onload=()=>{const fn=document.createElement("canvas"),xa=800;let qi=Qi.width,bn=Qi.height;qi>bn?qi>xa&&(bn*=xa/qi,qi=xa):bn>xa&&(qi*=xa/bn,bn=xa),fn.width=qi,fn.height=bn,fn.getContext("2d").drawImage(Qi,0,0,qi,bn),Di(fn.toDataURL("image/jpeg",.7))},Qi.onerror=Cn,Qi.src=ca.target.result},An.onerror=Cn,An.readAsDataURL(xn)}));Promise.all(ia).then(xn=>{Zn(Di=>[...Di,...xn])}).catch(xn=>{console.error("Error processing images:",xn),alert("Error processing images. Please try again.")})}};const mi=Ht&&Dt.author&&Ht.email===Dt.author.email,dn=Dt.comments||[];if(pi&&mi){const Qe=[...Wp,...we];return U.jsxs("div",{className:"card",style:{marginTop:8},children:[U.jsx("h5",{children:"Edit Pin"}),U.jsxs("div",{className:"mb-2",children:[U.jsx("label",{className:"form-label",children:"Name"}),U.jsx("input",{className:"form-control",value:Ai,onChange:qe=>sn(qe.target.value)})]}),U.jsxs("div",{className:"mb-2",children:[U.jsx("label",{className:"form-label",children:"Category"}),U.jsx("select",{className:"form-select",value:$t,onChange:qe=>{const Ki=Qe.find(oi=>oi.name===qe.target.value);de(qe.target.value),Ki&&Re(Ki.color)},children:Qe.map(qe=>U.jsx("option",{value:qe.name,children:qe.name},qe.name))})]}),U.jsxs("div",{className:"mb-2",children:[U.jsx("label",{className:"form-label",children:"Description"}),U.jsx("textarea",{className:"form-control",rows:3,value:on,onChange:qe=>va(qe.target.value)})]}),U.jsxs("div",{className:"mb-2",children:[U.jsxs("label",{className:"form-label",children:["Photos (",On.length,"/5)"]}),U.jsx("div",{className:"mb-2",children:On.map((qe,Ki)=>U.jsxs("div",{style:{display:"inline-block",position:"relative",marginRight:6},children:[U.jsx("img",{src:qe,alt:`Photo ${Ki+1} thumbnail`,style:{width:80,height:80,objectFit:"cover"}}),U.jsx("button",{className:"btn btn-danger btn-sm",style:{position:"absolute",top:0,right:0,padding:"2px 6px"},onClick:()=>Ue(Ki),children:""})]},Ki))}),U.jsx("input",{type:"file",accept:"image/*",multiple:!0,className:"form-control",onChange:Ke,disabled:On.length>=5}),On.length>=5&&U.jsx("small",{className:"text-muted",children:"Maximum 5 photos reached"})]}),U.jsxs("div",{className:"d-flex gap-2 mt-2",children:[U.jsx("button",{className:"btn btn-primary btn-sm",onClick:Ie,children:"Save Changes"}),U.jsx("button",{className:"btn btn-secondary btn-sm",onClick:()=>$e(!1),children:"Cancel"})]})]})}return U.jsxs("div",{className:"card",style:{marginTop:8},children:[U.jsx("h5",{children:Dt.name||"Pin Details"}),Dt.author&&U.jsxs("div",{className:"mb-2",style:{fontSize:"0.9rem"},children:[U.jsx("b",{children:"Created by:"})," ",U.jsx("a",{href:`#/user-profile/${encodeURIComponent(Dt.author.email)}`,style:{color:"#D4A574",textDecoration:"none",cursor:"pointer",fontWeight:"bold"},onMouseOver:Qe=>Qe.target.style.textDecoration="underline",onMouseOut:Qe=>Qe.target.style.textDecoration="none",children:Dt.author.name})]}),U.jsxs("div",{className:"mb-2 small text-muted",children:[U.jsxs("div",{children:[U.jsx("b",{children:"Location:"})," ",Dt.locationName||""]}),U.jsxs("div",{children:[U.jsx("b",{children:"Coordinates:"})," ",Dt.lat&&Dt.lng?`${Dt.lat.toFixed(5)}, ${Dt.lng.toFixed(5)}`:""]}),U.jsxs("div",{children:[U.jsx("b",{children:"Category:"})," ",U.jsx("span",{style:{color:Dt.color,fontWeight:"bold"},children:Dt.category})]})]}),U.jsxs("div",{className:"mb-2",children:[U.jsx("b",{children:"Description:"})," ",Dt.comment]}),Dt.photos&&Dt.photos.length>0&&U.jsxs("div",{className:"mb-2",children:[U.jsx("b",{children:"Photos:"}),U.jsx("br",{}),Dt.photos.map((Qe,qe)=>U.jsx("img",{src:Qe,alt:`Photo ${qe+1} of ${Dt.name}`,style:{width:80,marginRight:6,marginTop:6}},qe))]}),U.jsxs("div",{className:"mt-3 mb-2",children:[U.jsxs("h6",{children:["Comments (",dn.length,")"]}),dn.length>0?U.jsx("div",{style:{maxHeight:"300px",overflowY:"auto",marginBottom:"1rem"},children:dn.map((Qe,qe)=>U.jsxs("div",{className:"mb-2 p-2 bg-light rounded",children:[Qe.replyTo!==null&&Qe.replyTo!==void 0&&U.jsx("div",{className:"small text-muted mb-1",children:U.jsxs("i",{children:["Replying to ",dn[Qe.replyTo]?.author.name]})}),U.jsx("div",{className:"small d-flex justify-content-between align-items-start",children:U.jsxs("div",{children:[U.jsx("a",{href:`#/user-profile/${encodeURIComponent(Qe.author.email)}`,style:{color:"#D4A574",textDecoration:"none",fontWeight:"bold"},children:Qe.author.name}),U.jsx("span",{className:"text-muted ms-2",children:new Date(Qe.createdAt).toLocaleDateString()})]})}),U.jsx("div",{className:"mt-1",children:Qe.text}),U.jsxs("div",{className:"d-flex gap-2 mt-1",children:[Ht&&P&&U.jsxs("button",{className:"btn btn-link btn-sm p-0",style:{fontSize:"0.85rem"},onClick:()=>P(Dt.id,qe),children:[" ",Qe.likes?.length||0]}),Ht&&U.jsx("button",{className:"btn btn-link btn-sm p-0",style:{fontSize:"0.85rem"},onClick:()=>{bt(qe),Kt.current?.focus()},children:"Reply"})]})]},qe))}):U.jsx("p",{className:"small text-muted",children:"No comments yet. Be the first to comment!"}),Ht&&U.jsxs("div",{className:"mt-2",children:[si!==null&&U.jsxs("div",{className:"small text-muted mb-1",children:["Replying to ",dn[si]?.author.name,U.jsx("button",{className:"btn btn-link btn-sm p-0 ms-2",onClick:()=>bt(null),children:"Cancel"})]}),U.jsx("textarea",{ref:Kt,className:"form-control form-control-sm mb-2",rows:2,placeholder:si!==null?"Write a reply...":"Add a comment..."}),U.jsx("button",{className:"btn btn-primary btn-sm",onClick:be,children:si!==null?"Reply":"Comment"})]})]}),U.jsxs("div",{className:"d-flex gap-2 mt-2",children:[U.jsx("button",{type:"button",className:"btn btn-secondary btn-sm",onClick:Y,children:"Close"}),Ht&&!mi&&U.jsx("button",{type:"button",className:"btn btn-success btn-sm",onClick:()=>_e(Dt),children:"Add to Wishlist"}),mi&&U.jsxs(U.Fragment,{children:[U.jsx("button",{type:"button",className:"btn btn-info btn-sm",onClick:()=>$e(!0),children:"Edit"}),q&&U.jsx("button",{type:"button",className:"btn btn-danger btn-sm",onClick:()=>q(Dt.id),children:"Delete"})]})]})]})}function Te(be){be.preventDefault();const Ie=se.current.value,Ue=he.current.value,Ke=xe.current.files;let mi=[];const dn=Pt.trim()?Pt.trim():gt,Qe=Pt.trim()?ce:Wp.find(qe=>qe.name===gt)?.color||we.find(qe=>qe.name===gt)?.color||"#1976d2";if(Pt.trim()&&jv(Pt.trim(),ce),Ke&&Ke.length){if(Ke.length>5){alert("Maximum 5 photos allowed");return}const qe=Array.from(Ke).map(Ki=>new Promise((oi,ia)=>{const xn=new FileReader;xn.onload=Di=>{const Cn=new Image;Cn.onload=()=>{const An=document.createElement("canvas"),ca=800;let Qi=Cn.width,fn=Cn.height;Qi>fn?Qi>ca&&(fn*=ca/Qi,Qi=ca):fn>ca&&(Qi*=ca/fn,fn=ca),An.width=Qi,An.height=fn,An.getContext("2d").drawImage(Cn,0,0,Qi,fn),oi(An.toDataURL("image/jpeg",.7))},Cn.onerror=ia,Cn.src=Di.target.result},xn.onerror=ia,xn.readAsDataURL(Ki)}));Promise.all(qe).then(Ki=>{mi=Ki,nt({name:Ie,category:dn,color:Qe,comment:Ue,photos:mi})}).catch(Ki=>{console.error("Error processing images:",Ki),alert("Error processing images. Please try again.")});return}nt({name:Ie,category:dn,color:Qe,comment:Ue,photos:mi})}return U.jsxs("div",{className:"card",style:{marginTop:8},children:[U.jsx("h5",{children:"Add Pin Details"}),U.jsxs("div",{className:"mb-2 small text-muted",children:[U.jsxs("div",{children:[U.jsx("b",{children:"Location:"})," ",et||"Loading..."," "]}),U.jsxs("div",{children:[U.jsx("b",{children:"Coordinates:"})," ",ft&&Bt?`${ft.toFixed(5)}, ${Bt.toFixed(5)}`:""]})]}),U.jsxs("form",{onSubmit:Te,children:[U.jsxs("div",{className:"mb-2",children:[U.jsx("label",{className:"form-label",children:"Name"}),U.jsx("input",{ref:se,className:"form-control",required:!0})]}),U.jsxs("div",{className:"mb-2",children:[U.jsx("label",{className:"form-label",children:"Category"}),U.jsxs("select",{className:"form-select",value:gt,onChange:be=>Yt(be.target.value),children:[U.jsx("optgroup",{label:"Default Categories",children:Wp.map(be=>U.jsx("option",{value:be.name,children:be.name},be.name))}),we.length>0&&U.jsx("optgroup",{label:"Custom Categories",children:we.map(be=>U.jsx("option",{value:be.name,children:be.name},be.name))})]})]}),U.jsxs("div",{className:"mb-2",children:[U.jsx("label",{className:"form-label",children:"Or create your own"}),U.jsx("input",{className:"form-control",placeholder:"Custom category",value:Pt,onChange:be=>At(be.target.value)}),Pt.trim()&&U.jsxs("div",{className:"mt-1",children:[U.jsx("label",{children:"Color: "}),U.jsx("input",{type:"color",value:ce,onChange:be=>ue(be.target.value),style:{marginLeft:8}})]})]}),U.jsxs("div",{className:"mb-2",children:[U.jsx("label",{className:"form-label",children:"Photos (max 5)"}),U.jsx("input",{ref:xe,type:"file",accept:"image/*",multiple:!0,className:"form-control"}),U.jsx("small",{className:"text-muted",children:"You can upload up to 5 photos"})]}),U.jsxs("div",{className:"mb-2",children:[U.jsx("label",{className:"form-label",children:"Comments"}),U.jsx("textarea",{ref:he,className:"form-control",rows:3})]}),U.jsxs("div",{className:"d-flex gap-2 mt-2",children:[U.jsx("button",{type:"submit",className:"btn btn-primary btn-sm",children:"Save"}),U.jsx("button",{type:"button",className:"btn btn-secondary btn-sm",onClick:Y,children:"Cancel"})]})]})]})}function Uv(B){const Y=new Set;return B.forEach(nt=>nt.category&&Y.add(nt.category)),Array.from(Y)}const Gv=["Alabama","Alaska","Arizona","Arkansas","California","Colorado","Connecticut","Delaware","Florida","Georgia","Hawaii","Idaho","Illinois","Indiana","Iowa","Kansas","Kentucky","Louisiana","Maine","Maryland","Massachusetts","Michigan","Minnesota","Mississippi","Missouri","Montana","Nebraska","Nevada","New Hampshire","New Jersey","New Mexico","New York","North Carolina","North Dakota","Ohio","Oklahoma","Oregon","Pennsylvania","Rhode Island","South Carolina","South Dakota","Tennessee","Texas","Utah","Vermont","Virginia","Washington","West Virginia","Wisconsin","Wyoming","AL","AK","AZ","AR","CA","CO","CT","DE","FL","GA","HI","ID","IL","IN","IA","KS","KY","LA","ME","MD","MA","MI","MN","MS","MO","MT","NE","NV","NH","NJ","NM","NY","NC","ND","OH","OK","OR","PA","RI","SC","SD","TN","TX","UT","VT","VA","WA","WV","WI","WY"];function qv(B){const Y=new Set;return B.forEach(nt=>{if(nt.locationName){const q=nt.locationName.split(",").map(lt=>lt.trim());for(const lt of q)Gv.includes(lt)&&Y.add(lt)}}),Array.from(Y)}function Ig(B,Y){if(!B||!Y)return 0;if(B=B.toLowerCase(),Y=Y.toLowerCase(),B.includes(Y))return 100;let nt=0,q=0;for(let lt=0;lt<B.length&&q<Y.length;lt++)B[lt]===Y[q]&&(nt+=10,q++);return nt}function Zv({pins:B,setModal:Y,mapBounds:nt,currentUser:q}){const[lt,yt]=Mt.useState(!1),[P,h]=Mt.useState(""),[et,ft]=Mt.useState(""),[Bt,Dt]=Mt.useState(""),[se,he]=Mt.useState(!1),[xe,Kt]=Mt.useState(!1),gt=Mt.useMemo(()=>Uv(B),[B]),Yt=Mt.useMemo(()=>qv(B),[B]),Pt=Mt.useMemo(()=>{let At=B;if(se&&q&&(At=At.filter(ce=>ce.author&&ce.author.email===q.email)),xe&&nt&&(At=At.filter(ce=>ce.lng>=nt.getWest()&&ce.lng<=nt.getEast()&&ce.lat>=nt.getSouth()&&ce.lat<=nt.getNorth())),et&&(At=At.filter(ce=>ce.locationName?ce.locationName.split(",").map(we=>we.trim()).includes(et):!1)),P&&(At=At.filter(ce=>ce.category===P)),Bt.trim()){const ce=Bt.trim().toLowerCase();if(At=At.filter(ue=>ue.name&&ue.name.toLowerCase().includes(ce)||ue.comment&&ue.comment.toLowerCase().includes(ce)||ue.locationName&&ue.locationName.toLowerCase().includes(ce)),At.length===0&&B.length>0){let ue=B.map(we=>{let pe=Math.max(Ig(we.name,ce),Ig(we.comment,ce),Ig(we.locationName,ce));return{pin:we,score:pe}});ue=ue.filter(we=>we.score>0),ue.sort((we,pe)=>pe.score-we.score),At=ue.slice(0,3).map(we=>we.pin)}}return At},[B,et,P,Bt,se,xe,q,nt]);return U.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start"},children:[U.jsx("h4",{style:{marginTop:8,marginBottom:16,fontSize:"1.5rem",fontWeight:"bold"},children:"All Dropped Memories "}),U.jsxs("div",{className:"mb-3 d-flex gap-2 align-items-center flex-wrap",style:{width:"100%"},children:[U.jsx("button",{className:"btn btn-outline-secondary",onClick:()=>yt(At=>!At),children:"Filter"}),U.jsx("input",{className:"form-control",style:{maxWidth:200},placeholder:"Search keyword",value:Bt,onChange:At=>Dt(At.target.value)})]}),lt&&U.jsxs("div",{className:"card p-3 mb-3",style:{maxWidth:380,width:"100%"},children:[U.jsxs("div",{className:"mb-3",children:[U.jsx("label",{className:"form-label mb-1",style:{fontSize:"1rem",fontWeight:"500"},children:"State"}),U.jsxs("select",{className:"form-select",value:et,onChange:At=>ft(At.target.value),children:[U.jsx("option",{value:"",children:"All States"}),Yt.map(At=>U.jsx("option",{value:At,children:At},At))]})]}),U.jsxs("div",{className:"mb-3",children:[U.jsx("label",{className:"form-label mb-1",style:{fontSize:"1rem",fontWeight:"500"},children:"Category"}),U.jsxs("select",{className:"form-select",value:P,onChange:At=>h(At.target.value),children:[U.jsx("option",{value:"",children:"All Categories"}),gt.map(At=>U.jsx("option",{value:At,children:At},At))]})]}),U.jsxs("div",{className:"d-flex gap-2",children:[U.jsx("button",{className:"btn btn-primary",onClick:()=>yt(!1),children:"Apply"}),U.jsx("button",{className:"btn btn-secondary",onClick:()=>{h(""),ft(""),yt(!1)},children:"Clear"})]})]}),U.jsxs("div",{style:{marginTop:"1em",width:"100%"},children:[U.jsxs("div",{className:"d-flex gap-2 mb-3 flex-wrap",children:[U.jsx("button",{className:`btn btn-sm ${xe?"btn-success":"btn-outline-success"}`,onClick:()=>Kt(At=>!At),disabled:!nt,children:xe?" In View":"In View"}),q&&U.jsx("button",{className:`btn btn-sm ${se?"btn-success":"btn-outline-success"}`,onClick:()=>he(At=>!At),children:se?" My Places":"Show Mine"}),U.jsx("button",{className:"btn btn-sm btn-outline-success",onClick:()=>window.location.reload(),children:"Reset View"})]}),Pt.length===0&&U.jsx("div",{className:"text-muted",children:"No pins match your filter."}),Pt.map(At=>U.jsxs("div",{className:"card mb-2",style:{padding:"1em",cursor:"pointer",borderLeft:`6px solid ${At.color||"#1976d2"}`,display:"flex",flexDirection:"row",gap:"12px",alignItems:"center"},onClick:()=>Y({show:!0,viewPin:At}),children:[U.jsx("img",{src:At.photos&&At.photos.length>0?At.photos[0]:Qp,alt:At.name||"Pin",style:{width:"70px",height:"70px",objectFit:"cover",borderRadius:"8px",flexShrink:0}}),U.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",position:"relative"},children:[U.jsx("div",{style:{fontWeight:"bold",color:At.color||"#1976d2"},children:At.name||"Untitled Pin"}),U.jsx("div",{className:"small text-muted",children:At.locationName&&At.locationName.split(",").slice(0,2).join(", ")}),U.jsxs("div",{className:"small",children:["Category: ",U.jsx("span",{style:{color:At.color||"#1976d2"},children:At.category})]}),U.jsx("div",{className:"small",children:At.lat&&At.lng?`${At.lat.toFixed(3)}, ${At.lng.toFixed(3)}`:""}),U.jsxs("div",{className:"d-flex justify-content-between align-items-center mt-1",children:[U.jsx("button",{className:"btn btn-primary btn-sm",style:{fontSize:"0.85em"},onClick:ce=>{ce.stopPropagation(),Y({show:!0,viewPin:At})},children:"View Details"}),At.author&&U.jsxs("div",{className:"small text-muted",style:{fontSize:"0.75rem"},children:["by ",At.author.name]})]})]})]},At.id))]})]})}const g_="dots_pins_v2";function Hv(){const B=Mt.useRef(null),Y=Mt.useRef(null),[nt,q]=Mt.useState(()=>{try{const Pt=localStorage.getItem(g_);return Pt?JSON.parse(Pt):[]}catch{return[]}}),[lt,yt]=Mt.useState({show:!1,lngLat:null,locationName:"",viewPin:void 0}),[P,h]=Mt.useState(null),[et,ft]=Mt.useState(null),[Bt,Dt]=Mt.useState(null);Mt.useEffect(()=>{localStorage.setItem(g_,JSON.stringify(nt))},[nt]),Mt.useEffect(()=>{if(Y.current)return;Y.current=new Yp.Map({container:B.current,style:"https://api.maptiler.com/maps/streets-v2/style.json?key=ixBfIZyyRA6omFxQhu4x",center:[0,20],zoom:2}),Y.current.addControl(new Yp.NavigationControl,"top-right");let Pt;navigator.geolocation&&(navigator.geolocation.getCurrentPosition(ue=>{ft({lat:ue.coords.latitude,lng:ue.coords.longitude}),Y.current.flyTo({center:[ue.coords.longitude,ue.coords.latitude],zoom:10})},()=>{},{enableHighAccuracy:!0}),Pt=navigator.geolocation.watchPosition(ue=>{ft({lat:ue.coords.latitude,lng:ue.coords.longitude})},()=>{},{enableHighAccuracy:!0}));async function At(ue){let we="";try{const pe=await fetch(`https://nominatim.openstreetmap.org/reverse?lat=${ue.lngLat.lat}&lon=${ue.lngLat.lng}&format=json`);pe.ok&&(we=(await pe.json()).display_name||"")}catch{}yt({show:!0,lngLat:ue.lngLat,locationName:we}),h({lat:ue.lngLat.lat,lng:ue.lngLat.lng,color:"#1976d2"})}Y.current.on("click",At);const ce=()=>{if(Y.current){const ue=Y.current.getBounds();Dt(ue)}};return Y.current.on("moveend",ce),Y.current.on("load",ce),()=>{Pt&&navigator.geolocation.clearWatch(Pt),Y.current&&Y.current.remove()}},[]),Mt.useEffect(()=>{if(Y.current){if(Y.current._pinMarkers&&Y.current._pinMarkers.forEach(Pt=>Pt.remove()),Y.current._pinMarkers=nt.map(Pt=>{const At=document.createElement("div");return At.className="maplibre-pin-marker",At.style.background=Pt.color||"#1976d2",At.style.width="24px",At.style.height="24px",At.style.borderRadius="50%",At.style.border="2px solid #fff",At.style.boxShadow="0 1px 4px rgba(0,0,0,0.15)",At.style.cursor="pointer",At.title=Pt.name||"Pin",At.onclick=ce=>{ce.stopPropagation(),yt({show:!0,viewPin:Pt})},new Yp.Marker(At).setLngLat([Pt.lng,Pt.lat]).addTo(Y.current)}),lt.show&&lt.lngLat&&!lt.viewPin&&P){const Pt=document.createElement("div");Pt.className="maplibre-pin-marker",Pt.style.background=P.color||"#1976d2",Pt.style.width="24px",Pt.style.height="24px",Pt.style.borderRadius="50%",Pt.style.border="2px solid #fff",Pt.style.boxShadow="0 1px 4px rgba(0,0,0,0.15)",Pt.style.cursor="pointer",Pt.title="New Pin",Y.current._tempPinMarker?Y.current._tempPinMarker.setLngLat([P.lng,P.lat]):Y.current._tempPinMarker=new Yp.Marker(Pt,{interactive:!1}).setLngLat([P.lng,P.lat]).addTo(Y.current)}else Y.current._tempPinMarker&&(Y.current._tempPinMarker.remove(),Y.current._tempPinMarker=null);if(et){const Pt=document.createElement("div");Pt.className="maplibre-user-marker",Pt.style.background="#222",Pt.style.width="14px",Pt.style.height="14px",Pt.style.borderRadius="50%",Pt.style.border="2px solid #fff",Pt.style.boxShadow="0 1px 4px rgba(0,0,0,0.15)",Pt.title="Your Location",Y.current._userMarker?Y.current._userMarker.setLngLat([et.lng,et.lat]):Y.current._userMarker=new Yp.Marker(Pt,{interactive:!1}).setLngLat([et.lng,et.lat]).addTo(Y.current)}}},[nt,et,lt,P]);function se(Pt){const At=[{name:"Food",color:"#e53935"},{name:"ViewPoint",color:"#3949ab"},{name:"Museum",color:"#00897b"},{name:"Other",color:"#fbc02d"}];let ce=Pt.color;const ue=At.find(pe=>pe.name===Pt.category);ue&&(!Pt.customCat||!Pt.customCat.trim())&&(ce=ue.color);const we=er();q(pe=>[...pe,{id:Date.now(),lat:lt.lngLat.lat,lng:lt.lngLat.lng,locationName:lt.locationName,...Pt,color:ce,author:we?{name:we.name,email:we.email}:null,createdAt:new Date().toISOString()}]),h(null),yt({show:!1,lngLat:null,locationName:""})}function he(){h(null),yt({show:!1,lngLat:null,locationName:"",viewPin:void 0})}function xe(Pt){window.confirm("Are you sure you want to delete this pin?")&&(q(At=>At.filter(ce=>ce.id!==Pt)),yt({show:!1,lngLat:null,locationName:"",viewPin:void 0}))}function Kt(Pt,At){q(ce=>ce.map(ue=>ue.id===Pt?{...ue,comments:[...ue.comments||[],At]}:ue)),yt(ce=>({...ce,viewPin:ce.viewPin?{...ce.viewPin,comments:[...ce.viewPin.comments||[],At]}:ce.viewPin}))}function gt(Pt,At){q(ce=>ce.map(ue=>ue.id===Pt?{...ue,...At}:ue)),yt(ce=>({...ce,viewPin:ce.viewPin?{...ce.viewPin,...At}:ce.viewPin}))}function Yt(Pt,At){const ce=er();ce&&(q(ue=>ue.map(we=>{if(we.id===Pt){const pe=[...we.comments||[]],pi=pe[At];if(pi){const $e=pi.likes||[],Ai=$e.includes(ce.email);pe[At]={...pi,likes:Ai?$e.filter(sn=>sn!==ce.email):[...$e,ce.email]}}return{...we,comments:pe}}return we})),yt(ue=>{if(ue.viewPin&&ue.viewPin.id===Pt){const we=[...ue.viewPin.comments||[]],pe=we[At];if(pe){const pi=pe.likes||[],$e=pi.includes(ce.email);we[At]={...pe,likes:$e?pi.filter(Ai=>Ai!==ce.email):[...pi,ce.email]}}return{...ue,viewPin:{...ue.viewPin,comments:we}}}return ue}))}return U.jsx("div",{className:"container-fluid py-4",style:{maxWidth:"100%",width:"100%",padding:"1rem"},children:U.jsxs("div",{className:"map-layout",style:{display:"flex",flexDirection:"row",alignItems:"flex-start",width:"100%",minHeight:"60vh",gap:24},children:[U.jsx("div",{className:"pin-panel",style:{flex:"0 0 380px",minWidth:280,maxWidth:420,maxHeight:"70vh",overflowY:"auto"},children:lt.show?U.jsx(Vv,{show:lt.show,onClose:he,onSave:se,onDelete:xe,onAddComment:Kt,onEditPin:gt,onLikeComment:Yt,locationName:lt.locationName,lat:lt.lngLat&&lt.lngLat.lat,lng:lt.lngLat&&lt.lngLat.lng,viewPin:lt.viewPin}):U.jsx(Zv,{pins:nt,setModal:yt,mapBounds:Bt,currentUser:er()})}),U.jsx("div",{className:"map-container",style:{flex:1,minWidth:0,display:"flex",flexDirection:"column",gap:"0.5rem"},children:U.jsx("div",{ref:B,style:{height:"70vh",minHeight:400,width:"100%",borderRadius:8,overflow:"hidden"},id:"maplibre-map"})})]})})}const Xm="dots_user_profiles";function $v(){const[B,Y]=Mt.useState(er()),[nt,q]=Mt.useState(""),[lt,yt]=Mt.useState(""),[P,h]=Mt.useState(!1),[et,ft]=Mt.useState([]),Bt=Mt.useRef(),Dt=Mt.useRef();Mt.useEffect(()=>{const Kt=er();if(Y(Kt),!Kt)return;const Yt=JSON.parse(localStorage.getItem(Xm)||"{}")[Kt.email]||{};q(Yt.profilePic||""),yt(Yt.description||"");const Pt=localStorage.getItem("dots_pins_v2");if(Pt){const ue=JSON.parse(Pt).filter(we=>we.author&&we.author.email===Kt.email);ft(ue)}const At=()=>{const ce=er();if(Y(ce),ce){const we=JSON.parse(localStorage.getItem(Xm)||"{}")[ce.email]||{};q(we.profilePic||""),yt(we.description||"");const pe=localStorage.getItem("dots_pins_v2");if(pe){const $e=JSON.parse(pe).filter(Ai=>Ai.author&&Ai.author.email===ce.email);ft($e)}}};return window.addEventListener("authChanged",At),()=>window.removeEventListener("authChanged",At)},[]);function se(Kt){const gt=Kt.target.files[0];if(gt){const Yt=new FileReader;Yt.onload=Pt=>{const At=new Image;At.onload=()=>{const ce=document.createElement("canvas"),ue=200;let we=At.width,pe=At.height;we>pe?we>ue&&(pe*=ue/we,we=ue):pe>ue&&(we*=ue/pe,pe=ue),ce.width=we,ce.height=pe,ce.getContext("2d").drawImage(At,0,0,we,pe);const $e=ce.toDataURL("image/jpeg",.7);q($e),xe($e,lt)},At.src=Pt.target.result},Yt.readAsDataURL(gt)}}function he(){const Kt=Dt.current.value;yt(Kt),xe(nt,Kt),h(!1)}function xe(Kt,gt){if(B)try{const Yt=JSON.parse(localStorage.getItem(Xm)||"{}");Yt[B.email]={name:B.name,email:B.email,profilePic:Kt,description:gt},localStorage.setItem(Xm,JSON.stringify(Yt))}catch(Yt){Yt.name==="QuotaExceededError"?alert("Storage quota exceeded. Please use a smaller image or clear some data."):(console.error("Error saving profile:",Yt),alert("Failed to save profile. Please try again."))}}return B?U.jsx("div",{className:"container py-4",children:U.jsxs("div",{className:"row",children:[U.jsx("div",{className:"col-md-4",children:U.jsxs("div",{className:"card p-4 text-center",children:[U.jsx("div",{className:"mb-3",children:nt?U.jsx("img",{src:nt,alt:"Profile",style:{width:"150px",height:"150px",borderRadius:"50%",objectFit:"cover",border:"3px solid #D4A574"}}):U.jsx("div",{style:{width:"150px",height:"150px",borderRadius:"50%",backgroundColor:"#f0f0f0",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto",border:"3px solid #D4A574",fontSize:"3rem",color:"#D4A574"},children:B.name.charAt(0).toUpperCase()})}),U.jsx("input",{type:"file",ref:Bt,onChange:se,accept:"image/*",style:{display:"none"}}),U.jsx("button",{className:"btn btn-sm btn-outline-secondary mb-3",onClick:()=>Bt.current.click(),children:"Change Photo"}),U.jsx("h2",{children:B.name}),U.jsxs("p",{className:"text-muted mb-2",children:[U.jsx("i",{className:"bi bi-envelope"})," ",B.email]}),U.jsxs("div",{className:"mt-3 p-3 bg-light rounded",children:[U.jsx("h3",{children:"Travel Stats"}),U.jsxs("div",{className:"d-flex justify-content-around mt-2",children:[U.jsxs("div",{children:[U.jsx("div",{style:{fontSize:"1.5rem",fontWeight:"bold",color:"#D4A574"},children:et.length}),U.jsx("div",{className:"small text-muted",children:"Places"})]}),U.jsxs("div",{children:[U.jsx("div",{style:{fontSize:"1.5rem",fontWeight:"bold",color:"#D4A574"},children:new Set(et.map(Kt=>Kt.category)).size}),U.jsx("div",{className:"small text-muted",children:"Categories"})]})]})]})]})}),U.jsxs("div",{className:"col-md-8",children:[U.jsxs("div",{className:"card p-4 mb-3",children:[U.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[U.jsx("h3",{className:"mb-0",children:"About Me"}),!P&&U.jsx("button",{className:"btn btn-sm btn-outline-secondary",onClick:()=>h(!0),children:"Edit"})]}),P?U.jsxs("div",{children:[U.jsx("textarea",{ref:Dt,className:"form-control mb-2",rows:5,defaultValue:lt,placeholder:"Tell us about yourself..."}),U.jsxs("div",{className:"d-flex gap-2",children:[U.jsx("button",{className:"btn btn-primary btn-sm",onClick:he,children:"Save"}),U.jsx("button",{className:"btn btn-secondary btn-sm",onClick:()=>h(!1),children:"Cancel"})]})]}):U.jsx("p",{className:"text-muted",children:lt||"No description yet. Click Edit to add one!"})]}),U.jsxs("div",{className:"card p-4",children:[U.jsxs("h3",{className:"mb-3",children:["My Places (",et.length,")"]}),U.jsx("div",{className:"row",children:et.length===0?U.jsx("div",{className:"col-12",children:U.jsx("p",{className:"text-muted text-center py-4",children:"No places added yet. Start exploring and drop some pins!"})}):et.map(Kt=>U.jsx("div",{className:"col-md-6 mb-3",children:U.jsx("div",{className:"card h-100",style:{borderLeft:`4px solid ${Kt.color||"#D4A574"}`},children:U.jsxs("div",{className:"card-body",children:[U.jsx("h6",{className:"card-title",style:{color:Kt.color||"#D4A574"},children:Kt.name||"Untitled"}),U.jsx("p",{className:"card-text small text-muted mb-1",children:Kt.locationName?.split(",").slice(0,2).join(", ")}),U.jsx("span",{className:"badge",style:{backgroundColor:Kt.color||"#D4A574",color:"#fff"},children:Kt.category}),Kt.comment&&U.jsxs("p",{className:"card-text small mt-2",children:[Kt.comment.substring(0,80),Kt.comment.length>80?"...":""]})]})})},Kt.id))})]})]})]})}):U.jsx("div",{className:"container py-4",children:U.jsx("div",{className:"alert alert-warning",children:"Please log in to view your profile."})})}const Xv="dots_user_profiles",Yv="dots_pins_v2";function Wv(){const{email:B}=Ly(),[Y,nt]=Mt.useState(null),[q,lt]=Mt.useState([]),[yt,P]=Mt.useState(!0);return Mt.useEffect(()=>{if(!B)return;const h=decodeURIComponent(B),ft=JSON.parse(localStorage.getItem(Xv)||"{}")[h],Bt=localStorage.getItem(Yv);let Dt=[];Bt&&(Dt=JSON.parse(Bt).filter(he=>he.author&&he.author.email===h),lt(Dt)),ft?nt(ft):Dt.length>0&&Dt[0].author&&nt({name:Dt[0].author.name,email:Dt[0].author.email,profilePic:"",description:""}),P(!1)},[B]),yt?U.jsx("div",{className:"container py-4",children:U.jsx("p",{children:"Loading..."})}):Y?U.jsxs("div",{className:"container py-4",children:[U.jsx("div",{className:"mb-3",children:U.jsx("a",{href:"#/map",className:"btn btn-sm btn-outline-secondary",children:" Back to Map"})}),U.jsxs("div",{className:"row",children:[U.jsx("div",{className:"col-md-4",children:U.jsxs("div",{className:"card p-4 text-center",children:[U.jsx("div",{className:"mb-3",children:Y.profilePic?U.jsx("img",{src:Y.profilePic,alt:Y.name,style:{width:"120px",height:"120px",borderRadius:"50%",objectFit:"cover",border:"3px solid #D4A574",margin:"0 auto",display:"block"}}):U.jsx("div",{style:{width:"120px",height:"120px",borderRadius:"50%",backgroundColor:"#f0f0f0",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto",border:"3px solid #D4A574",fontSize:"2.5rem",color:"#D4A574"},children:Y.name.charAt(0).toUpperCase()})}),U.jsx("h2",{children:Y.name}),U.jsx("p",{className:"text-muted small mb-3",children:Y.email}),Y.description&&U.jsxs("div",{className:"mb-3 p-3 bg-light rounded text-start",children:[U.jsx("h3",{children:"About"}),U.jsx("p",{className:"small mb-0",children:Y.description})]}),U.jsxs("div",{className:"mt-3 p-3 bg-light rounded",children:[U.jsx("h3",{children:"Travel Stats"}),U.jsxs("div",{className:"d-flex justify-content-around mt-2",children:[U.jsxs("div",{children:[U.jsx("div",{style:{fontSize:"1.5rem",fontWeight:"bold",color:"#D4A574"},children:q.length}),U.jsx("div",{className:"small text-muted",children:"Places"})]}),U.jsxs("div",{children:[U.jsx("div",{style:{fontSize:"1.5rem",fontWeight:"bold",color:"#D4A574"},children:new Set(q.map(h=>h.category)).size}),U.jsx("div",{className:"small text-muted",children:"Categories"})]})]})]})]})}),U.jsx("div",{className:"col-md-8",children:U.jsxs("div",{className:"card p-4",children:[U.jsxs("h3",{className:"mb-3",children:[Y.name,"'s Places (",q.length,")"]}),U.jsx("div",{className:"row",children:q.length===0?U.jsx("div",{className:"col-12",children:U.jsx("p",{className:"text-muted text-center py-4",children:"No places shared yet."})}):q.map(h=>U.jsx("div",{className:"col-md-6 mb-3",children:U.jsx("div",{className:"card h-100",style:{borderLeft:`4px solid ${h.color||"#D4A574"}`},children:U.jsxs("div",{className:"card-body",children:[U.jsx("h6",{className:"card-title",style:{color:h.color||"#D4A574"},children:h.name||"Untitled"}),U.jsx("p",{className:"card-text small text-muted mb-1",children:h.locationName?.split(",").slice(0,2).join(", ")}),U.jsx("span",{className:"badge",style:{backgroundColor:h.color||"#D4A574",color:"#fff"},children:h.category}),h.comment&&U.jsxs("p",{className:"card-text small mt-2",children:[h.comment.substring(0,100),h.comment.length>100?"...":""]}),h.photos&&h.photos.length>0&&U.jsx("div",{className:"mt-2",children:h.photos.slice(0,3).map((et,ft)=>U.jsx("img",{src:et,alt:"Place",style:{width:"60px",height:"60px",objectFit:"cover",marginRight:"4px",borderRadius:"4px"}},ft))})]})})},h.id))})]})})]})]}):U.jsxs("div",{className:"container py-4",children:[U.jsx("div",{className:"alert alert-warning",children:"User not found or no pins available."}),U.jsx("a",{href:"#/",className:"btn btn-secondary",children:"Back to Home"})]})}const Rg="dots_wishlist";function Kv(){const[B,Y]=Mt.useState(er()),[nt,q]=Mt.useState([]),[lt,yt]=Mt.useState(""),[P,h]=Mt.useState(""),[et,ft]=Mt.useState("all");Mt.useEffect(()=>{const Yt=er();Y(Yt),Yt&&Bt(Yt.email);const Pt=()=>{const At=er();Y(At),At?Bt(At.email):q([])};return window.addEventListener("authChanged",Pt),()=>window.removeEventListener("authChanged",Pt)},[]);function Bt(Yt){try{const At=JSON.parse(localStorage.getItem(Rg)||"{}")[Yt]||[];q(At)}catch(Pt){console.error("Error loading wishlist:",Pt),q([])}}function Dt(Yt){if(B)try{const Pt=JSON.parse(localStorage.getItem(Rg)||"{}");Pt[B.email]=Yt,localStorage.setItem(Rg,JSON.stringify(Pt)),q(Yt)}catch(Pt){console.error("Error saving wishlist:",Pt),alert("Failed to save wishlist. Please try again.")}}function se(Yt){if(Yt.preventDefault(),!lt.trim())return;const Pt={id:Date.now(),place:lt.trim(),description:P.trim(),status:"pending",createdAt:new Date().toISOString(),visitedAt:null};Dt([...nt,Pt]),yt(""),h("")}function he(Yt){const Pt=nt.map(At=>At.id===Yt?{...At,status:At.status==="visited"?"pending":"visited",visitedAt:At.status==="visited"?null:new Date().toISOString()}:At);Dt(Pt)}function xe(Yt){window.confirm("Remove this place from your wishlist?")&&Dt(nt.filter(Pt=>Pt.id!==Yt))}if(!B)return U.jsx("div",{className:"container py-4",children:U.jsx("div",{className:"alert alert-warning",children:"Please log in to manage your travel wishlist."})});const Kt=nt.filter(Yt=>et==="all"?!0:Yt.status===et),gt={total:nt.length,pending:nt.filter(Yt=>Yt.status==="pending").length,visited:nt.filter(Yt=>Yt.status==="visited").length,progress:nt.length>0?Math.round(nt.filter(Yt=>Yt.status==="visited").length/nt.length*100):0};return U.jsxs("div",{className:"container py-4",children:[U.jsx("h1",{className:"mb-4",children:"Travel Wishlist "}),U.jsxs("div",{className:"row mb-4",children:[U.jsx("div",{className:"col-md-3 mb-3",children:U.jsx("div",{className:"card text-center",children:U.jsxs("div",{className:"card-body",children:[U.jsx("h2",{style:{color:"#D4A574",fontSize:"2.5rem",fontWeight:"bold"},children:gt.total}),U.jsx("p",{className:"text-muted mb-0",children:"Total Places"})]})})}),U.jsx("div",{className:"col-md-3 mb-3",children:U.jsx("div",{className:"card text-center",children:U.jsxs("div",{className:"card-body",children:[U.jsx("h2",{style:{color:"#ffc107",fontSize:"2.5rem",fontWeight:"bold"},children:gt.pending}),U.jsx("p",{className:"text-muted mb-0",children:"To Visit"})]})})}),U.jsx("div",{className:"col-md-3 mb-3",children:U.jsx("div",{className:"card text-center",children:U.jsxs("div",{className:"card-body",children:[U.jsx("h2",{style:{color:"#28a745",fontSize:"2.5rem",fontWeight:"bold"},children:gt.visited}),U.jsx("p",{className:"text-muted mb-0",children:"Visited"})]})})}),U.jsx("div",{className:"col-md-3 mb-3",children:U.jsx("div",{className:"card text-center",children:U.jsxs("div",{className:"card-body",children:[U.jsxs("h2",{style:{color:"#D4A574",fontSize:"2.5rem",fontWeight:"bold"},children:[gt.progress,"%"]}),U.jsx("p",{className:"text-muted mb-0",children:"Progress"})]})})})]}),U.jsxs("div",{className:"row",children:[U.jsx("div",{className:"col-md-4 mb-4",children:U.jsx("div",{className:"card",children:U.jsxs("div",{className:"card-body",children:[U.jsx("h2",{className:"h5 mb-3",children:"Add to Wishlist"}),U.jsxs("form",{onSubmit:se,children:[U.jsxs("div",{className:"mb-3",children:[U.jsx("label",{className:"form-label",children:"Place Name *"}),U.jsx("input",{type:"text",className:"form-control",placeholder:"e.g., Paris, France",value:lt,onChange:Yt=>yt(Yt.target.value),required:!0})]}),U.jsxs("div",{className:"mb-3",children:[U.jsx("label",{className:"form-label",children:"Why visit?"}),U.jsx("textarea",{className:"form-control",rows:3,placeholder:"What attracts you to this place?",value:P,onChange:Yt=>h(Yt.target.value)})]}),U.jsx("button",{type:"submit",className:"btn btn-primary w-100",children:"Add to Wishlist"})]})]})})}),U.jsx("div",{className:"col-md-8",children:U.jsx("div",{className:"card",children:U.jsxs("div",{className:"card-body",children:[U.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[U.jsx("h2",{className:"h5 mb-0",children:"My Places"}),U.jsxs("div",{className:"btn-group btn-group-sm",children:[U.jsxs("button",{className:`btn ${et==="all"?"btn-primary":"btn-outline-primary"}`,onClick:()=>ft("all"),children:["All (",gt.total,")"]}),U.jsxs("button",{className:`btn ${et==="pending"?"btn-warning":"btn-outline-warning"}`,onClick:()=>ft("pending"),children:["To Visit (",gt.pending,")"]}),U.jsxs("button",{className:`btn ${et==="visited"?"btn-success":"btn-outline-success"}`,onClick:()=>ft("visited"),children:["Visited (",gt.visited,")"]})]})]}),Kt.length===0?U.jsx("div",{className:"text-center py-5 text-muted",children:et==="all"?U.jsxs("div",{children:[U.jsx("p",{className:"h4",children:" Start Your Dream List!"}),U.jsx("p",{children:"Add places you want to visit to your wishlist."})]}):et==="pending"?U.jsx("p",{children:"No pending places. Add some dream destinations!"}):U.jsx("p",{children:"No visited places yet. Start checking off your wishlist!"})}):U.jsx("div",{className:"list-group",children:Kt.map(Yt=>U.jsx("div",{className:`list-group-item ${Yt.status==="visited"?"list-group-item-success":""}`,children:U.jsxs("div",{className:"d-flex justify-content-between align-items-start",children:[U.jsxs("div",{className:"flex-grow-1",children:[U.jsxs("div",{className:"d-flex align-items-center mb-1",children:[U.jsx("input",{type:"checkbox",className:"form-check-input me-2",checked:Yt.status==="visited",onChange:()=>he(Yt.id),style:{cursor:"pointer"}}),U.jsx("h3",{className:`h6 mb-0 ${Yt.status==="visited"?"text-decoration-line-through":""}`,children:Yt.place})]}),Yt.description&&U.jsx("p",{className:"text-muted small mb-1 ms-4",children:Yt.description}),U.jsx("div",{className:"small text-muted ms-4",children:Yt.status==="visited"?U.jsxs("span",{className:"text-success",children:[" Visited ",new Date(Yt.visitedAt).toLocaleDateString()]}):U.jsxs("span",{children:["Added ",new Date(Yt.createdAt).toLocaleDateString()]})})]}),U.jsx("button",{className:"btn btn-sm btn-outline-danger",onClick:()=>xe(Yt.id),children:""})]})},Yt.id))})]})})})]})]})}function Qv(){const[B,Y]=Mt.useState(er());return Mt.useEffect(()=>{function nt(){Y(er())}return window.addEventListener("authChanged",nt),window.addEventListener("storage",nt),()=>{window.removeEventListener("authChanged",nt),window.removeEventListener("storage",nt)}},[]),U.jsxs(yv,{children:[U.jsx(Lv,{}),U.jsxs(Yy,{children:[U.jsx(_h,{path:"/",element:U.jsx(Iv,{})}),U.jsx(_h,{path:"/about",element:U.jsx(Rv,{})}),U.jsx(_h,{path:"/map",element:B?U.jsx(Hv,{}):U.jsx(zg,{to:"/",replace:!0})}),U.jsx(_h,{path:"/profile",element:B?U.jsx($v,{}):U.jsx(zg,{to:"/",replace:!0})}),U.jsx(_h,{path:"/user-profile/:email",element:U.jsx(Wv,{})}),U.jsx(_h,{path:"/wishlist",element:B?U.jsx(Kv,{}):U.jsx(zg,{to:"/",replace:!0})}),U.jsx(_h,{path:"/contact",element:U.jsx(Ov,{})})]})]})}ay.createRoot(document.getElementById("root")).render(U.jsx(Qv,{}));
